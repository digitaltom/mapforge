// maplibre-gl@4.7.1 downloaded from https://ga.jspm.io/npm:maplibre-gl@4.7.1/dist/maplibre-gl.js

var u=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var F={};
/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(u,Wt){F=Wt()})(0,(function(){var F={};var Wt={};function define(u,Xe,Vi){Wt[u]=Vi;if(u==="index"){var fr="var sharedModule = {}; ("+Wt.shared+")(sharedModule); ("+Wt.worker+")(sharedModule);";var _r={};Wt.shared(_r);Wt.index(F,_r);typeof window!=="undefined"&&F.setWorkerUrl(window.URL.createObjectURL(new Blob([fr],{type:"text/javascript"})));return F}}define("shared",["exports"],(function(F){function e(u,F,Wt,Xe){return new(Wt||(Wt=Promise))((function(Vi,fr){function a(u){try{l(Xe.next(u))}catch(u){fr(u)}}function o(u){try{l(Xe.throw(u))}catch(u){fr(u)}}function l(u){var F;u.done?Vi(u.value):(F=u.value,F instanceof Wt?F:new Wt((function(u){u(F)}))).then(a,o)}l((Xe=Xe.apply(u,F||[])).next())}))}function r(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}"function"==typeof SuppressedError&&SuppressedError;var Wt=i;function i(F,Wt){(this||u).x=F,(this||u).y=Wt}i.prototype={clone:function(){return new i((this||u).x,(this||u).y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,F){return this.clone()._rotateAround(u,F)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt((this||u).x*(this||u).x+(this||u).y*(this||u).y)},equals:function(F){return(this||u).x===F.x&&(this||u).y===F.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(F){var Wt=F.x-(this||u).x,Xe=F.y-(this||u).y;return Wt*Wt+Xe*Xe},angle:function(){return Math.atan2((this||u).y,(this||u).x)},angleTo:function(F){return Math.atan2((this||u).y-F.y,(this||u).x-F.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(F,Wt){return Math.atan2((this||u).x*Wt-(this||u).y*F,(this||u).x*F+(this||u).y*Wt)},_matMult:function(F){var Wt=F[2]*(this||u).x+F[3]*(this||u).y;return(this||u).x=F[0]*(this||u).x+F[1]*(this||u).y,(this||u).y=Wt,this||u},_add:function(F){return(this||u).x+=F.x,(this||u).y+=F.y,this||u},_sub:function(F){return(this||u).x-=F.x,(this||u).y-=F.y,this||u},_mult:function(F){return(this||u).x*=F,(this||u).y*=F,this||u},_div:function(F){return(this||u).x/=F,(this||u).y/=F,this||u},_multByPoint:function(F){return(this||u).x*=F.x,(this||u).y*=F.y,this||u},_divByPoint:function(F){return(this||u).x/=F.x,(this||u).y/=F.y,this||u},_unit:function(){return this._div(this.mag()),this||u},_perp:function(){var F=(this||u).y;return(this||u).y=(this||u).x,(this||u).x=-F,this||u},_rotate:function(F){var Wt=Math.cos(F),Xe=Math.sin(F),Vi=Xe*(this||u).x+Wt*(this||u).y;return(this||u).x=Wt*(this||u).x-Xe*(this||u).y,(this||u).y=Vi,this||u},_rotateAround:function(F,Wt){var Xe=Math.cos(F),Vi=Math.sin(F),fr=Wt.y+Vi*((this||u).x-Wt.x)+Xe*((this||u).y-Wt.y);return(this||u).x=Wt.x+Xe*((this||u).x-Wt.x)-Vi*((this||u).y-Wt.y),(this||u).y=fr,this||u},_round:function(){return(this||u).x=Math.round((this||u).x),(this||u).y=Math.round((this||u).y),this||u}},i.convert=function(u){return u instanceof i?u:Array.isArray(u)?new i(u[0],u[1]):u};var Xe=r(Wt),Vi=o;function o(F,Wt,Xe,Vi){(this||u).cx=3*F,(this||u).bx=3*(Xe-F)-(this||u).cx,(this||u).ax=1-(this||u).cx-(this||u).bx,(this||u).cy=3*Wt,(this||u).by=3*(Vi-Wt)-(this||u).cy,(this||u).ay=1-(this||u).cy-(this||u).by,(this||u).p1x=F,(this||u).p1y=Wt,(this||u).p2x=Xe,(this||u).p2y=Vi}o.prototype={sampleCurveX:function(F){return(((this||u).ax*F+(this||u).bx)*F+(this||u).cx)*F},sampleCurveY:function(F){return(((this||u).ay*F+(this||u).by)*F+(this||u).cy)*F},sampleCurveDerivativeX:function(F){return(3*(this||u).ax*F+2*(this||u).bx)*F+(this||u).cx},solveCurveX:function(u,F){if(void 0===F&&(F=1e-6),u<0)return 0;if(u>1)return 1;for(var Wt=u,Xe=0;Xe<8;Xe++){var Vi=this.sampleCurveX(Wt)-u;if(Math.abs(Vi)<F)return Wt;var fr=this.sampleCurveDerivativeX(Wt);if(Math.abs(fr)<1e-6)break;Wt-=Vi/fr}var _r=0,wr=1;for(Wt=u,Xe=0;Xe<20&&(Vi=this.sampleCurveX(Wt),!(Math.abs(Vi-u)<F));Xe++)u>Vi?_r=Wt:wr=Wt,Wt=.5*(wr-_r)+_r;return Wt},solve:function(u,F){return this.sampleCurveY(this.solveCurveX(u,F))}};var fr=r(Vi);let _r,wr;function h(){return null==_r&&(_r="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),_r}function p(){if(null==wr&&(wr=!1,h())){const u=5,F=new OffscreenCanvas(u,u).getContext("2d",{willReadFrequently:!0});if(F){for(let Wt=0;Wt<u*u;Wt++){const Xe=4*Wt;F.fillStyle=`rgb(${Xe},${Xe+1},${Xe+2})`,F.fillRect(Wt%u,Math.floor(Wt/u),1,1)}const Wt=F.getImageData(0,0,u,u).data;for(let F=0;F<u*u*4;F++)if(F%4!=3&&Wt[F]!==F){wr=!0;break}}}return wr||!1}function f(u,F,Wt,Xe){const Vi=new fr(u,F,Wt,Xe);return u=>Vi.solve(u)}const Ar=f(.25,.1,.25,1);function y(u,F,Wt){return Math.min(Wt,Math.max(F,u))}function m(u,F,Wt){const Xe=Wt-F,Vi=((u-F)%Xe+Xe)%Xe+F;return Vi===F?Wt:Vi}function g(u,...F){for(const Wt of F)for(const F in Wt)u[F]=Wt[F];return u}let Kr=1;function v(F,Wt,Xe){const Vi={};for(const Xe in F)Vi[Xe]=Wt.call(this||u,F[Xe],Xe,F);return Vi}function b(F,Wt,Xe){const Vi={};for(const Xe in F)Wt.call(this||u,F[Xe],Xe,F)&&(Vi[Xe]=F[Xe]);return Vi}function w(u){return Array.isArray(u)?u.map(w):"object"==typeof u&&u?v(u,w):u}const In={};function A(u){In[u]||("undefined"!=typeof console&&console.warn(u),In[u]=!0)}function S(u,F,Wt){return(Wt.y-u.y)*(F.x-u.x)>(F.y-u.y)*(Wt.x-u.x)}function k(u){return"undefined"!=typeof WorkerGlobalScope&&void 0!==u&&u instanceof WorkerGlobalScope}let ns=null;function I(u){return"undefined"!=typeof ImageBitmap&&u instanceof ImageBitmap}const ca="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function P(F,Wt,Xe,Vi,fr){return e(this||u,void 0,void 0,(function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const u=new VideoFrame(F,{timestamp:0});try{const _r=null==u?void 0:u.format;if(!_r||!_r.startsWith("BGR")&&!_r.startsWith("RGB"))throw new Error(`Unrecognized format ${_r}`);const wr=_r.startsWith("BGR"),Ar=new Uint8ClampedArray(Vi*fr*4);if(yield u.copyTo(Ar,function(u,F,Wt,Xe,Vi){const fr=4*Math.max(-F,0),_r=(Math.max(0,Wt)-Wt)*Xe*4+fr,wr=4*Xe,Ar=Math.max(0,F),Kr=Math.max(0,Wt);return{rect:{x:Ar,y:Kr,width:Math.min(u.width,F+Xe)-Ar,height:Math.min(u.height,Wt+Vi)-Kr},layout:[{offset:_r,stride:wr}]}}(F,Wt,Xe,Vi,fr)),wr)for(let u=0;u<Ar.length;u+=4){const F=Ar[u];Ar[u]=Ar[u+2],Ar[u+2]=F}return Ar}finally{u.close()}}))}let ha,ua;const Da="AbortError";function E(){return new Error(Da)}const io={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function T(u){return io.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const no="global-dispatcher";class L extends Error{constructor(u,F,Wt,Xe){super(`AJAXError: ${F} (${u}): ${Wt}`),this.status=u,this.statusText=F,this.url=Wt,this.body=Xe}}const D=()=>k(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,O=function(F,Wt){if(/:\/\//.test(F.url)&&!/^https?:|^file:/.test(F.url)){const u=T(F.url);if(u)return u(F,Wt);if(k(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:F,targetMapId:no},Wt)}if(!(/^file:/.test(Xe=F.url)||/^file:/.test(D())&&!/^\w+:/.test(Xe))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(F,Wt){return e(this||u,void 0,void 0,(function*(){const u=new Request(F.url,{method:F.method||"GET",body:F.body,credentials:F.credentials,headers:F.headers,cache:F.cache,referrer:D(),signal:Wt.signal});"json"!==F.type||u.headers.has("Accept")||u.headers.set("Accept","application/json");const Xe=yield fetch(u);if(!Xe.ok){const u=yield Xe.blob();throw new L(Xe.status,Xe.statusText,F.url,u)}let Vi;Vi="arrayBuffer"===F.type||"image"===F.type?Xe.arrayBuffer():"json"===F.type?Xe.json():Xe.text();const fr=yield Vi;if(Wt.signal.aborted)throw E();return{data:fr,cacheControl:Xe.headers.get("Cache-Control"),expires:Xe.headers.get("Expires")}}))}(F,Wt);if(k(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:F,mustQueue:!0,targetMapId:no},Wt)}var Xe;return function(u,F){return new Promise(((Wt,Xe)=>{var Vi;const fr=new XMLHttpRequest;fr.open(u.method||"GET",u.url,!0),"arrayBuffer"!==u.type&&"image"!==u.type||(fr.responseType="arraybuffer");for(const F in u.headers)fr.setRequestHeader(F,u.headers[F]);"json"===u.type&&(fr.responseType="text",(null===(Vi=u.headers)||void 0===Vi?void 0:Vi.Accept)||fr.setRequestHeader("Accept","application/json")),fr.withCredentials="include"===u.credentials,fr.onerror=()=>{Xe(new Error(fr.statusText))},fr.onload=()=>{if(!F.signal.aborted)if((fr.status>=200&&fr.status<300||0===fr.status)&&null!==fr.response){let F=fr.response;if("json"===u.type)try{F=JSON.parse(fr.response)}catch(u){return void Xe(u)}Wt({data:F,cacheControl:fr.getResponseHeader("Cache-Control"),expires:fr.getResponseHeader("Expires")})}else{const F=new Blob([fr.response],{type:fr.getResponseHeader("Content-Type")});Xe(new L(fr.status,fr.statusText,u.url,F))}},F.signal.addEventListener("abort",(()=>{fr.abort(),Xe(E())})),fr.send(u.body)}))}(F,Wt)};function j(u){if(!u||u.indexOf("://")<=0||0===u.indexOf("data:image/")||0===u.indexOf("blob:"))return!0;const F=new URL(u),Wt=window.location;return F.protocol===Wt.protocol&&F.host===Wt.host}function R(u,F,Wt){Wt[u]&&-1!==Wt[u].indexOf(F)||(Wt[u]=Wt[u]||[],Wt[u].push(F))}function U(u,F,Wt){if(Wt&&Wt[u]){const Xe=Wt[u].indexOf(F);-1!==Xe&&Wt[u].splice(Xe,1)}}class q{constructor(u,F={}){g(this,F),this.type=u}}class N extends q{constructor(u,F={}){super("error",g({error:u},F))}}class Z{on(u,F){return this._listeners=this._listeners||{},R(u,F,this._listeners),this}off(u,F){return U(u,F,this._listeners),U(u,F,this._oneTimeListeners),this}once(u,F){return F?(this._oneTimeListeners=this._oneTimeListeners||{},R(u,F,this._oneTimeListeners),this):new Promise((F=>this.once(u,F)))}fire(u,F){"string"==typeof u&&(u=new q(u,F||{}));const Wt=u.type;if(this.listens(Wt)){u.target=this;const F=this._listeners&&this._listeners[Wt]?this._listeners[Wt].slice():[];for(const Wt of F)Wt.call(this,u);const Xe=this._oneTimeListeners&&this._oneTimeListeners[Wt]?this._oneTimeListeners[Wt].slice():[];for(const F of Xe)U(Wt,F,this._oneTimeListeners),F.call(this,u);const Vi=this._eventedParent;Vi&&(g(u,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),Vi.fire(u))}else u instanceof N&&console.error(u.error);return this}listens(u){return this._listeners&&this._listeners[u]&&this._listeners[u].length>0||this._oneTimeListeners&&this._oneTimeListeners[u]&&this._oneTimeListeners[u].length>0||this._eventedParent&&this._eventedParent.listens(u)}setEventedParent(u,F){return this._eventedParent=u,this._eventedParentData=F,this}}var so={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ao=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function X(u,F){const Wt={};for(const F in u)"ref"!==F&&(Wt[F]=u[F]);return ao.forEach((u=>{u in F&&(Wt[u]=F[u])})),Wt}function H(u,F){if(Array.isArray(u)){if(!Array.isArray(F)||u.length!==F.length)return!1;for(let Wt=0;Wt<u.length;Wt++)if(!H(u[Wt],F[Wt]))return!1;return!0}if("object"==typeof u&&null!==u&&null!==F){if("object"!=typeof F)return!1;if(Object.keys(u).length!==Object.keys(F).length)return!1;for(const Wt in u)if(!H(u[Wt],F[Wt]))return!1;return!0}return u===F}function Y(u,F){u.push(F)}function J(u,F,Wt){Y(Wt,{command:"addSource",args:[u,F[u]]})}function W(u,F,Wt){Y(F,{command:"removeSource",args:[u]}),Wt[u]=!0}function Q(u,F,Wt,Xe){W(u,Wt,Xe),J(u,F,Wt)}function tt(u,F,Wt){let Xe;for(Xe in u[Wt])if(Object.prototype.hasOwnProperty.call(u[Wt],Xe)&&"data"!==Xe&&!H(u[Wt][Xe],F[Wt][Xe]))return!1;for(Xe in F[Wt])if(Object.prototype.hasOwnProperty.call(F[Wt],Xe)&&"data"!==Xe&&!H(u[Wt][Xe],F[Wt][Xe]))return!1;return!0}function et(u,F,Wt,Xe,Vi,fr){u=u||{},F=F||{};for(const _r in u)Object.prototype.hasOwnProperty.call(u,_r)&&(H(u[_r],F[_r])||Wt.push({command:fr,args:[Xe,_r,F[_r],Vi]}));for(const _r in F)Object.prototype.hasOwnProperty.call(F,_r)&&!Object.prototype.hasOwnProperty.call(u,_r)&&(H(u[_r],F[_r])||Wt.push({command:fr,args:[Xe,_r,F[_r],Vi]}))}function rt(u){return u.id}function nt(u,F){return u[F.id]=F,u}class it{constructor(u,F,Wt,Xe){this.message=(u?`${u}: `:"")+Wt,Xe&&(this.identifier=Xe),null!=F&&F.__line__&&(this.line=F.__line__)}}function st(u,...F){for(const Wt of F)for(const F in Wt)u[F]=Wt[F];return u}class at extends Error{constructor(u,F){super(F),this.message=F,this.key=u}}class ot{constructor(u,F=[]){this.parent=u,this.bindings={};for(const[u,Wt]of F)this.bindings[u]=Wt}concat(u){return new ot(this,u)}get(u){if(this.bindings[u])return this.bindings[u];if(this.parent)return this.parent.get(u);throw new Error(`${u} not found in scope.`)}has(u){return!!this.bindings[u]||!!this.parent&&this.parent.has(u)}}const oo={kind:"null"},co={kind:"number"},ho={kind:"string"},go={kind:"boolean"},xo={kind:"color"},Io={kind:"object"},ko={kind:"value"},Co={kind:"collator"},zo={kind:"formatted"},Bo={kind:"padding"},al={kind:"resolvedImage"},ol={kind:"variableAnchorOffsetCollection"};function bt(u,F){return{kind:"array",itemType:u,N:F}}function wt(u){if("array"===u.kind){const F=wt(u.itemType);return"number"==typeof u.N?`array<${F}, ${u.N}>`:"value"===u.itemType.kind?"array":`array<${F}>`}return u.kind}const ll=[oo,co,ho,go,xo,zo,Io,bt(ko),Bo,al,ol];function At(u,F){if("error"===F.kind)return null;if("array"===u.kind){if("array"===F.kind&&(0===F.N&&"value"===F.itemType.kind||!At(u.itemType,F.itemType))&&("number"!=typeof u.N||u.N===F.N))return null}else{if(u.kind===F.kind)return null;if("value"===u.kind)for(const u of ll)if(!At(u,F))return null}return`Expected ${wt(u)} but found ${wt(F)} instead.`}function St(u,F){return F.some((F=>F.kind===u.kind))}function kt(u,F){return F.some((F=>"null"===F?null===u:"array"===F?Array.isArray(u):"object"===F?u&&!Array.isArray(u)&&"object"==typeof u:F===typeof u))}function Mt(u,F){return"array"===u.kind&&"array"===F.kind?u.itemType.kind===F.itemType.kind&&"number"==typeof u.N:u.kind===F.kind}const cl=.96422,hl=.82521,dl=4/29,pl=6/29,fl=3*pl*pl,yl=pl*pl*pl,vl=Math.PI/180,bl=180/Math.PI;function Tt(u){return(u%=360)<0&&(u+=360),u}function $t([u,F,Wt,Xe]){let Vi,fr;const _r=Dt((.2225045*(u=Lt(u))+.7168786*(F=Lt(F))+.0606169*(Wt=Lt(Wt)))/1);u===F&&F===Wt?Vi=fr=_r:(Vi=Dt((.4360747*u+.3850649*F+.1430804*Wt)/cl),fr=Dt((.0139322*u+.0971045*F+.7141733*Wt)/hl));const wr=116*_r-16;return[wr<0?0:wr,500*(Vi-_r),200*(_r-fr),Xe]}function Lt(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Dt(u){return u>yl?Math.pow(u,1/3):u/fl+dl}function Ot([u,F,Wt,Xe]){let Vi=(u+16)/116,fr=isNaN(F)?Vi:Vi+F/500,_r=isNaN(Wt)?Vi:Vi-Wt/200;return Vi=1*Rt(Vi),fr=cl*Rt(fr),_r=hl*Rt(_r),[jt(3.1338561*fr-1.6168667*Vi-.4906146*_r),jt(-.9787684*fr+1.9161415*Vi+.033454*_r),jt(.0719453*fr-.2289914*Vi+1.4052427*_r),Xe]}function jt(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function Rt(u){return u>pl?u*u*u:fl*(u-dl)}function Ut(u){return parseInt(u.padEnd(2,u),16)/255}function qt(u,F){return Nt(F?u/100:u,0,1)}function Nt(u,F,Wt){return Math.min(Math.max(F,u),Wt)}function Zt(u){return!u.some(Number.isNaN)}const Al={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Kt{constructor(u,F,Wt,Xe=1,Vi=!0){this.r=u,this.g=F,this.b=Wt,this.a=Xe,Vi||(this.r*=Xe,this.g*=Xe,this.b*=Xe,Xe||this.overwriteGetter("rgb",[u,F,Wt,Xe]))}static parse(u){if(u instanceof Kt)return u;if("string"!=typeof u)return;const F=function(u){if("transparent"===(u=u.toLowerCase().trim()))return[0,0,0,0];const F=Al[u];if(F){const[u,Wt,Xe]=F;return[u/255,Wt/255,Xe/255,1]}if(u.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(u)){const F=u.length<6?1:2;let Wt=1;return[Ut(u.slice(Wt,Wt+=F)),Ut(u.slice(Wt,Wt+=F)),Ut(u.slice(Wt,Wt+=F)),Ut(u.slice(Wt,Wt+F)||"ff")]}if(u.startsWith("rgb")){const F=u.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(F){const[u,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca]=F,ha=[Vi||" ",wr||" ",In].join("");if("  "===ha||"  /"===ha||",,"===ha||",,,"===ha){const u=[Xe,_r,Kr].join(""),F="%%%"===u?100:""===u?255:0;if(F){const u=[Nt(+Wt/F,0,1),Nt(+fr/F,0,1),Nt(+Ar/F,0,1),ns?qt(+ns,ca):1];if(Zt(u))return u}}return}}const Wt=u.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(Wt){const[u,F,Xe,Vi,fr,_r,wr,Ar,Kr]=Wt,In=[Xe||" ",fr||" ",wr].join("");if("  "===In||"  /"===In||",,"===In||",,,"===In){const u=[+F,Nt(+Vi,0,100),Nt(+_r,0,100),Ar?qt(+Ar,Kr):1];if(Zt(u))return function([u,F,Wt,Xe]){function i(Xe){const Vi=(Xe+u/30)%12,fr=F*Math.min(Wt,1-Wt);return Wt-fr*Math.max(-1,Math.min(Vi-3,9-Vi,1))}return u=Tt(u),F/=100,Wt/=100,[i(0),i(8),i(4),Xe]}(u)}}}(u);return F?new Kt(...F,!1):void 0}get rgb(){const{r:u,g:F,b:Wt,a:Xe}=this,Vi=Xe||1/0;return this.overwriteGetter("rgb",[u/Vi,F/Vi,Wt/Vi,Xe])}get hcl(){return this.overwriteGetter("hcl",function(u){const[F,Wt,Xe,Vi]=$t(u),fr=Math.sqrt(Wt*Wt+Xe*Xe);return[Math.round(1e4*fr)?Tt(Math.atan2(Xe,Wt)*bl):NaN,fr,F,Vi]}(this.rgb))}get lab(){return this.overwriteGetter("lab",$t(this.rgb))}overwriteGetter(u,F){return Object.defineProperty(this,u,{value:F}),F}toString(){const[u,F,Wt,Xe]=this.rgb;return`rgba(${[u,F,Wt].map((u=>Math.round(255*u))).join(",")},${Xe})`}}Kt.black=new Kt(0,0,0,1),Kt.white=new Kt(1,1,1,1),Kt.transparent=new Kt(0,0,0,0),Kt.red=new Kt(1,0,0,1);class Xt{constructor(u,F,Wt){this.sensitivity=u?F?"variant":"case":F?"accent":"base",this.locale=Wt,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(u,F){return this.collator.compare(u,F)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ht{constructor(u,F,Wt,Xe,Vi){this.text=u,this.image=F,this.scale=Wt,this.fontStack=Xe,this.textColor=Vi}}class Yt{constructor(u){this.sections=u}static fromString(u){return new Yt([new Ht(u,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((u=>0!==u.text.length||u.image&&0!==u.image.name.length))}static factory(u){return u instanceof Yt?u:Yt.fromString(u)}toString(){return 0===this.sections.length?"":this.sections.map((u=>u.text)).join("")}}class Jt{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof Jt)return u;if("number"==typeof u)return new Jt([u,u,u,u]);if(Array.isArray(u)&&!(u.length<1||u.length>4)){for(const F of u)if("number"!=typeof F)return;switch(u.length){case 1:u=[u[0],u[0],u[0],u[0]];break;case 2:u=[u[0],u[1],u[0],u[1]];break;case 3:u=[u[0],u[1],u[2],u[1]]}return new Jt(u)}}toString(){return JSON.stringify(this.values)}}const Ml=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Qt{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof Qt)return u;if(Array.isArray(u)&&!(u.length<1)&&u.length%2==0){for(let F=0;F<u.length;F+=2){const Wt=u[F],Xe=u[F+1];if("string"!=typeof Wt||!Ml.has(Wt))return;if(!Array.isArray(Xe)||2!==Xe.length||"number"!=typeof Xe[0]||"number"!=typeof Xe[1])return}return new Qt(u)}}toString(){return JSON.stringify(this.values)}}class te{constructor(u){this.name=u.name,this.available=u.available}toString(){return this.name}static fromString(u){return u?new te({name:u,available:!1}):null}}function ee(u,F,Wt,Xe){return"number"==typeof u&&u>=0&&u<=255&&"number"==typeof F&&F>=0&&F<=255&&"number"==typeof Wt&&Wt>=0&&Wt<=255?void 0===Xe||"number"==typeof Xe&&Xe>=0&&Xe<=1?null:`Invalid rgba value [${[u,F,Wt,Xe].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof Xe?[u,F,Wt,Xe]:[u,F,Wt]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function re(u){if(null===u||"string"==typeof u||"boolean"==typeof u||"number"==typeof u||u instanceof Kt||u instanceof Xt||u instanceof Yt||u instanceof Jt||u instanceof Qt||u instanceof te)return!0;if(Array.isArray(u)){for(const F of u)if(!re(F))return!1;return!0}if("object"==typeof u){for(const F in u)if(!re(u[F]))return!1;return!0}return!1}function ne(u){if(null===u)return oo;if("string"==typeof u)return ho;if("boolean"==typeof u)return go;if("number"==typeof u)return co;if(u instanceof Kt)return xo;if(u instanceof Xt)return Co;if(u instanceof Yt)return zo;if(u instanceof Jt)return Bo;if(u instanceof Qt)return ol;if(u instanceof te)return al;if(Array.isArray(u)){const F=u.length;let Wt;for(const F of u){const u=ne(F);if(Wt){if(Wt===u)continue;Wt=ko;break}Wt=u}return bt(Wt||ko,F)}return Io}function ie(u){const F=typeof u;return null===u?"":"string"===F||"number"===F||"boolean"===F?String(u):u instanceof Kt||u instanceof Yt||u instanceof Jt||u instanceof Qt||u instanceof te?u.toString():JSON.stringify(u)}class se{constructor(u,F){this.type=u,this.value=F}static parse(u,F){if(2!==u.length)return F.error(`'literal' expression requires exactly one argument, but found ${u.length-1} instead.`);if(!re(u[1]))return F.error("invalid value");const Wt=u[1];let Xe=ne(Wt);const Vi=F.expectedType;return"array"!==Xe.kind||0!==Xe.N||!Vi||"array"!==Vi.kind||"number"==typeof Vi.N&&0!==Vi.N||(Xe=Vi),new se(Xe,Wt)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ae{constructor(u){this.name="ExpressionEvaluationError",this.message=u}toJSON(){return this.message}}const kl={string:ho,number:co,boolean:go,object:Io};class le{constructor(u,F){this.type=u,this.args=F}static parse(u,F){if(u.length<2)return F.error("Expected at least one argument.");let Wt,Xe=1;const Vi=u[0];if("array"===Vi){let Vi,fr;if(u.length>2){const Wt=u[1];if("string"!=typeof Wt||!(Wt in kl)||"object"===Wt)return F.error('The item type argument of "array" must be one of string, number, boolean',1);Vi=kl[Wt],Xe++}else Vi=ko;if(u.length>3){if(null!==u[2]&&("number"!=typeof u[2]||u[2]<0||u[2]!==Math.floor(u[2])))return F.error('The length argument to "array" must be a positive integer literal',2);fr=u[2],Xe++}Wt=bt(Vi,fr)}else{if(!kl[Vi])throw new Error(`Types doesn't contain name = ${Vi}`);Wt=kl[Vi]}const fr=[];for(;Xe<u.length;Xe++){const Wt=F.parse(u[Xe],Xe,ko);if(!Wt)return null;fr.push(Wt)}return new le(Wt,fr)}evaluate(u){for(let F=0;F<this.args.length;F++){const Wt=this.args[F].evaluate(u);if(!At(this.type,ne(Wt)))return Wt;if(F===this.args.length-1)throw new ae(`Expected value to be of type ${wt(this.type)}, but found ${wt(ne(Wt))} instead.`)}throw new Error}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every((u=>u.outputDefined()))}}const Dl={"to-boolean":go,"to-color":xo,"to-number":co,"to-string":ho};class ce{constructor(u,F){this.type=u,this.args=F}static parse(u,F){if(u.length<2)return F.error("Expected at least one argument.");const Wt=u[0];if(!Dl[Wt])throw new Error(`Can't parse ${Wt} as it is not part of the known types`);if(("to-boolean"===Wt||"to-string"===Wt)&&2!==u.length)return F.error("Expected one argument.");const Xe=Dl[Wt],Vi=[];for(let Wt=1;Wt<u.length;Wt++){const Xe=F.parse(u[Wt],Wt,ko);if(!Xe)return null;Vi.push(Xe)}return new ce(Xe,Vi)}evaluate(u){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(u));case"color":{let F,Wt;for(const Xe of this.args){if(F=Xe.evaluate(u),Wt=null,F instanceof Kt)return F;if("string"==typeof F){const Wt=u.parseColor(F);if(Wt)return Wt}else if(Array.isArray(F)&&(Wt=F.length<3||F.length>4?`Invalid rbga value ${JSON.stringify(F)}: expected an array containing either three or four numeric values.`:ee(F[0],F[1],F[2],F[3]),!Wt))return new Kt(F[0]/255,F[1]/255,F[2]/255,F[3])}throw new ae(Wt||`Could not parse color from value '${"string"==typeof F?F:JSON.stringify(F)}'`)}case"padding":{let F;for(const Wt of this.args){F=Wt.evaluate(u);const Xe=Jt.parse(F);if(Xe)return Xe}throw new ae(`Could not parse padding from value '${"string"==typeof F?F:JSON.stringify(F)}'`)}case"variableAnchorOffsetCollection":{let F;for(const Wt of this.args){F=Wt.evaluate(u);const Xe=Qt.parse(F);if(Xe)return Xe}throw new ae(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof F?F:JSON.stringify(F)}'`)}case"number":{let F=null;for(const Wt of this.args){if(F=Wt.evaluate(u),null===F)return 0;const Xe=Number(F);if(!isNaN(Xe))return Xe}throw new ae(`Could not convert ${JSON.stringify(F)} to number.`)}case"formatted":return Yt.fromString(ie(this.args[0].evaluate(u)));case"resolvedImage":return te.fromString(ie(this.args[0].evaluate(u)));default:return ie(this.args[0].evaluate(u))}}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every((u=>u.outputDefined()))}}const Ll=["Unknown","Point","LineString","Polygon"];class pe{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ll[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(u){let F=this._parseColorCache[u];return F||(F=this._parseColorCache[u]=Kt.parse(u)),F}}class fe{constructor(u,F,Wt=[],Xe,Vi=new ot,fr=[]){this.registry=u,this.path=Wt,this.key=Wt.map((u=>`[${u}]`)).join(""),this.scope=Vi,this.errors=fr,this.expectedType=Xe,this._isConstant=F}parse(u,F,Wt,Xe,Vi={}){return F?this.concat(F,Wt,Xe)._parse(u,Vi):this._parse(u,Vi)}_parse(u,F){function r(u,F,Wt){return"assert"===Wt?new le(F,[u]):"coerce"===Wt?new ce(F,[u]):u}if(null!==u&&"string"!=typeof u&&"boolean"!=typeof u&&"number"!=typeof u||(u=["literal",u]),Array.isArray(u)){if(0===u.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const Wt=u[0];if("string"!=typeof Wt)return this.error(`Expression name must be a string, but found ${typeof Wt} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const Xe=this.registry[Wt];if(Xe){let Wt=Xe.parse(u,this);if(!Wt)return null;if(this.expectedType){const u=this.expectedType,Xe=Wt.type;if("string"!==u.kind&&"number"!==u.kind&&"boolean"!==u.kind&&"object"!==u.kind&&"array"!==u.kind||"value"!==Xe.kind)if("color"!==u.kind&&"formatted"!==u.kind&&"resolvedImage"!==u.kind||"value"!==Xe.kind&&"string"!==Xe.kind)if("padding"!==u.kind||"value"!==Xe.kind&&"number"!==Xe.kind&&"array"!==Xe.kind)if("variableAnchorOffsetCollection"!==u.kind||"value"!==Xe.kind&&"array"!==Xe.kind){if(this.checkSubtype(u,Xe))return null}else Wt=r(Wt,u,F.typeAnnotation||"coerce");else Wt=r(Wt,u,F.typeAnnotation||"coerce");else Wt=r(Wt,u,F.typeAnnotation||"coerce");else Wt=r(Wt,u,F.typeAnnotation||"assert")}if(!(Wt instanceof se)&&"resolvedImage"!==Wt.type.kind&&this._isConstant(Wt)){const F=new pe;try{Wt=new se(Wt.type,Wt.evaluate(F))}catch(u){return this.error(u.message),null}}return Wt}return this.error(`Unknown expression "${Wt}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===u?"'undefined' value invalid. Use null instead.":"object"==typeof u?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof u} instead.`)}concat(u,F,Wt){const Xe="number"==typeof u?this.path.concat(u):this.path,Vi=Wt?this.scope.concat(Wt):this.scope;return new fe(this.registry,this._isConstant,Xe,F||null,Vi,this.errors)}error(u,...F){const Wt=`${this.key}${F.map((u=>`[${u}]`)).join("")}`;this.errors.push(new at(Wt,u))}checkSubtype(u,F){const Wt=At(u,F);return Wt&&this.error(Wt),Wt}}class de{constructor(u,F){this.type=F.type,this.bindings=[].concat(u),this.result=F}evaluate(u){return this.result.evaluate(u)}eachChild(u){for(const F of this.bindings)u(F[1]);u(this.result)}static parse(u,F){if(u.length<4)return F.error(`Expected at least 3 arguments, but found ${u.length-1} instead.`);const Wt=[];for(let Xe=1;Xe<u.length-1;Xe+=2){const Vi=u[Xe];if("string"!=typeof Vi)return F.error(`Expected string, but found ${typeof Vi} instead.`,Xe);if(/[^a-zA-Z0-9_]/.test(Vi))return F.error("Variable names must contain only alphanumeric characters or '_'.",Xe);const fr=F.parse(u[Xe+1],Xe+1);if(!fr)return null;Wt.push([Vi,fr])}const Xe=F.parse(u[u.length-1],u.length-1,F.expectedType,Wt);return Xe?new de(Wt,Xe):null}outputDefined(){return this.result.outputDefined()}}class ye{constructor(u,F){this.type=F.type,this.name=u,this.boundExpression=F}static parse(u,F){if(2!==u.length||"string"!=typeof u[1])return F.error("'var' expression requires exactly one string literal argument.");const Wt=u[1];return F.scope.has(Wt)?new ye(Wt,F.scope.get(Wt)):F.error(`Unknown variable "${Wt}". Make sure "${Wt}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(u){return this.boundExpression.evaluate(u)}eachChild(){}outputDefined(){return!1}}class me{constructor(u,F,Wt){this.type=u,this.index=F,this.input=Wt}static parse(u,F){if(3!==u.length)return F.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const Wt=F.parse(u[1],1,co),Xe=F.parse(u[2],2,bt(F.expectedType||ko));return Wt&&Xe?new me(Xe.type.itemType,Wt,Xe):null}evaluate(u){const F=this.index.evaluate(u),Wt=this.input.evaluate(u);if(F<0)throw new ae(`Array index out of bounds: ${F} < 0.`);if(F>=Wt.length)throw new ae(`Array index out of bounds: ${F} > ${Wt.length-1}.`);if(F!==Math.floor(F))throw new ae(`Array index must be an integer, but found ${F} instead.`);return Wt[F]}eachChild(u){u(this.index),u(this.input)}outputDefined(){return!1}}class ge{constructor(u,F){this.type=go,this.needle=u,this.haystack=F}static parse(u,F){if(3!==u.length)return F.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const Wt=F.parse(u[1],1,ko),Xe=F.parse(u[2],2,ko);return Wt&&Xe?St(Wt.type,[go,ho,co,oo,ko])?new ge(Wt,Xe):F.error(`Expected first argument to be of type boolean, string, number or null, but found ${wt(Wt.type)} instead`):null}evaluate(u){const F=this.needle.evaluate(u),Wt=this.haystack.evaluate(u);if(!Wt)return!1;if(!kt(F,["boolean","string","number","null"]))throw new ae(`Expected first argument to be of type boolean, string, number or null, but found ${wt(ne(F))} instead.`);if(!kt(Wt,["string","array"]))throw new ae(`Expected second argument to be of type array or string, but found ${wt(ne(Wt))} instead.`);return Wt.indexOf(F)>=0}eachChild(u){u(this.needle),u(this.haystack)}outputDefined(){return!0}}class xe{constructor(u,F,Wt){this.type=co,this.needle=u,this.haystack=F,this.fromIndex=Wt}static parse(u,F){if(u.length<=2||u.length>=5)return F.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const Wt=F.parse(u[1],1,ko),Xe=F.parse(u[2],2,ko);if(!Wt||!Xe)return null;if(!St(Wt.type,[go,ho,co,oo,ko]))return F.error(`Expected first argument to be of type boolean, string, number or null, but found ${wt(Wt.type)} instead`);if(4===u.length){const Vi=F.parse(u[3],3,co);return Vi?new xe(Wt,Xe,Vi):null}return new xe(Wt,Xe)}evaluate(u){const F=this.needle.evaluate(u),Wt=this.haystack.evaluate(u);if(!kt(F,["boolean","string","number","null"]))throw new ae(`Expected first argument to be of type boolean, string, number or null, but found ${wt(ne(F))} instead.`);let Xe;if(this.fromIndex&&(Xe=this.fromIndex.evaluate(u)),kt(Wt,["string"])){const u=Wt.indexOf(F,Xe);return-1===u?-1:[...Wt.slice(0,u)].length}if(kt(Wt,["array"]))return Wt.indexOf(F,Xe);throw new ae(`Expected second argument to be of type array or string, but found ${wt(ne(Wt))} instead.`)}eachChild(u){u(this.needle),u(this.haystack),this.fromIndex&&u(this.fromIndex)}outputDefined(){return!1}}class ve{constructor(u,F,Wt,Xe,Vi,fr){this.inputType=u,this.type=F,this.input=Wt,this.cases=Xe,this.outputs=Vi,this.otherwise=fr}static parse(u,F){if(u.length<5)return F.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if(u.length%2!=1)return F.error("Expected an even number of arguments.");let Wt,Xe;F.expectedType&&"value"!==F.expectedType.kind&&(Xe=F.expectedType);const Vi={},fr=[];for(let _r=2;_r<u.length-1;_r+=2){let wr=u[_r];const Ar=u[_r+1];Array.isArray(wr)||(wr=[wr]);const Kr=F.concat(_r);if(0===wr.length)return Kr.error("Expected at least one branch label.");for(const u of wr){if("number"!=typeof u&&"string"!=typeof u)return Kr.error("Branch labels must be numbers or strings.");if("number"==typeof u&&Math.abs(u)>Number.MAX_SAFE_INTEGER)return Kr.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof u&&Math.floor(u)!==u)return Kr.error("Numeric branch labels must be integer values.");if(Wt){if(Kr.checkSubtype(Wt,ne(u)))return null}else Wt=ne(u);if(void 0!==Vi[String(u)])return Kr.error("Branch labels must be unique.");Vi[String(u)]=fr.length}const In=F.parse(Ar,_r,Xe);if(!In)return null;Xe=Xe||In.type,fr.push(In)}const _r=F.parse(u[1],1,ko);if(!_r)return null;const wr=F.parse(u[u.length-1],u.length-1,Xe);return wr?"value"!==_r.type.kind&&F.concat(1).checkSubtype(Wt,_r.type)?null:new ve(Wt,Xe,_r,Vi,fr,wr):null}evaluate(u){const F=this.input.evaluate(u);return(ne(F)===this.inputType&&this.outputs[this.cases[F]]||this.otherwise).evaluate(u)}eachChild(u){u(this.input),this.outputs.forEach(u),u(this.otherwise)}outputDefined(){return this.outputs.every((u=>u.outputDefined()))&&this.otherwise.outputDefined()}}class be{constructor(u,F,Wt){this.type=u,this.branches=F,this.otherwise=Wt}static parse(u,F){if(u.length<4)return F.error(`Expected at least 3 arguments, but found only ${u.length-1}.`);if(u.length%2!=0)return F.error("Expected an odd number of arguments.");let Wt;F.expectedType&&"value"!==F.expectedType.kind&&(Wt=F.expectedType);const Xe=[];for(let Vi=1;Vi<u.length-1;Vi+=2){const fr=F.parse(u[Vi],Vi,go);if(!fr)return null;const _r=F.parse(u[Vi+1],Vi+1,Wt);if(!_r)return null;Xe.push([fr,_r]),Wt=Wt||_r.type}const Vi=F.parse(u[u.length-1],u.length-1,Wt);if(!Vi)return null;if(!Wt)throw new Error("Can't infer output type");return new be(Wt,Xe,Vi)}evaluate(u){for(const[F,Wt]of this.branches)if(F.evaluate(u))return Wt.evaluate(u);return this.otherwise.evaluate(u)}eachChild(u){for(const[F,Wt]of this.branches)u(F),u(Wt);u(this.otherwise)}outputDefined(){return this.branches.every((([u,F])=>F.outputDefined()))&&this.otherwise.outputDefined()}}class we{constructor(u,F,Wt,Xe){this.type=u,this.input=F,this.beginIndex=Wt,this.endIndex=Xe}static parse(u,F){if(u.length<=2||u.length>=5)return F.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const Wt=F.parse(u[1],1,ko),Xe=F.parse(u[2],2,co);if(!Wt||!Xe)return null;if(!St(Wt.type,[bt(ko),ho,ko]))return F.error(`Expected first argument to be of type array or string, but found ${wt(Wt.type)} instead`);if(4===u.length){const Vi=F.parse(u[3],3,co);return Vi?new we(Wt.type,Wt,Xe,Vi):null}return new we(Wt.type,Wt,Xe)}evaluate(u){const F=this.input.evaluate(u),Wt=this.beginIndex.evaluate(u);let Xe;if(this.endIndex&&(Xe=this.endIndex.evaluate(u)),kt(F,["string"]))return[...F].slice(Wt,Xe).join("");if(kt(F,["array"]))return F.slice(Wt,Xe);throw new ae(`Expected first argument to be of type array or string, but found ${wt(ne(F))} instead.`)}eachChild(u){u(this.input),u(this.beginIndex),this.endIndex&&u(this.endIndex)}outputDefined(){return!1}}function _e(u,F){const Wt=u.length-1;let Xe,Vi,fr=0,_r=Wt,wr=0;for(;fr<=_r;)if(wr=Math.floor((fr+_r)/2),Xe=u[wr],Vi=u[wr+1],Xe<=F){if(wr===Wt||F<Vi)return wr;fr=wr+1}else{if(!(Xe>F))throw new ae("Input is not a number.");_r=wr-1}return 0}class Ae{constructor(u,F,Wt){this.type=u,this.input=F,this.labels=[],this.outputs=[];for(const[u,F]of Wt)this.labels.push(u),this.outputs.push(F)}static parse(u,F){if(u.length-1<4)return F.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return F.error("Expected an even number of arguments.");const Wt=F.parse(u[1],1,co);if(!Wt)return null;const Xe=[];let Vi=null;F.expectedType&&"value"!==F.expectedType.kind&&(Vi=F.expectedType);for(let Wt=1;Wt<u.length;Wt+=2){const fr=1===Wt?-1/0:u[Wt],_r=u[Wt+1],wr=Wt,Ar=Wt+1;if("number"!=typeof fr)return F.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',wr);if(Xe.length&&Xe[Xe.length-1][0]>=fr)return F.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',wr);const Kr=F.parse(_r,Ar,Vi);if(!Kr)return null;Vi=Vi||Kr.type,Xe.push([fr,Kr])}return new Ae(Vi,Wt,Xe)}evaluate(u){const F=this.labels,Wt=this.outputs;if(1===F.length)return Wt[0].evaluate(u);const Xe=this.input.evaluate(u);if(Xe<=F[0])return Wt[0].evaluate(u);const Vi=F.length;return Xe>=F[Vi-1]?Wt[Vi-1].evaluate(u):Wt[_e(F,Xe)].evaluate(u)}eachChild(u){u(this.input);for(const F of this.outputs)u(F)}outputDefined(){return this.outputs.every((u=>u.outputDefined()))}}function Se(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Rl=Me;function Me(F,Wt,Xe,Vi){(this||u).cx=3*F,(this||u).bx=3*(Xe-F)-(this||u).cx,(this||u).ax=1-(this||u).cx-(this||u).bx,(this||u).cy=3*Wt,(this||u).by=3*(Vi-Wt)-(this||u).cy,(this||u).ay=1-(this||u).cy-(this||u).by,(this||u).p1x=F,(this||u).p1y=Wt,(this||u).p2x=Xe,(this||u).p2y=Vi}Me.prototype={sampleCurveX:function(F){return(((this||u).ax*F+(this||u).bx)*F+(this||u).cx)*F},sampleCurveY:function(F){return(((this||u).ay*F+(this||u).by)*F+(this||u).cy)*F},sampleCurveDerivativeX:function(F){return(3*(this||u).ax*F+2*(this||u).bx)*F+(this||u).cx},solveCurveX:function(u,F){if(void 0===F&&(F=1e-6),u<0)return 0;if(u>1)return 1;for(var Wt=u,Xe=0;Xe<8;Xe++){var Vi=this.sampleCurveX(Wt)-u;if(Math.abs(Vi)<F)return Wt;var fr=this.sampleCurveDerivativeX(Wt);if(Math.abs(fr)<1e-6)break;Wt-=Vi/fr}var _r=0,wr=1;for(Wt=u,Xe=0;Xe<20&&(Vi=this.sampleCurveX(Wt),!(Math.abs(Vi-u)<F));Xe++)u>Vi?_r=Wt:wr=Wt,Wt=.5*(wr-_r)+_r;return Wt},solve:function(u,F){return this.sampleCurveY(this.solveCurveX(u,F))}};var Bl=Se(Rl);function ze(u,F,Wt){return u+Wt*(F-u)}function Pe(u,F,Wt){return u.map(((u,Xe)=>ze(u,F[Xe],Wt)))}const Ol={number:ze,color:function(u,F,Wt,Xe="rgb"){switch(Xe){case"rgb":{const[Xe,Vi,fr,_r]=Pe(u.rgb,F.rgb,Wt);return new Kt(Xe,Vi,fr,_r,!1)}case"hcl":{const[Xe,Vi,fr,_r]=u.hcl,[wr,Ar,Kr,In]=F.hcl;let ns,ca;if(isNaN(Xe)||isNaN(wr))isNaN(Xe)?isNaN(wr)?ns=NaN:(ns=wr,1!==fr&&0!==fr||(ca=Ar)):(ns=Xe,1!==Kr&&0!==Kr||(ca=Vi));else{let u=wr-Xe;wr>Xe&&u>180?u-=360:wr<Xe&&Xe-wr>180&&(u+=360),ns=Xe+Wt*u}const[ha,ua,Da,io]=function([u,F,Wt,Xe]){return u=isNaN(u)?0:u*vl,Ot([Wt,Math.cos(u)*F,Math.sin(u)*F,Xe])}([ns,null!=ca?ca:ze(Vi,Ar,Wt),ze(fr,Kr,Wt),ze(_r,In,Wt)]);return new Kt(ha,ua,Da,io,!1)}case"lab":{const[Xe,Vi,fr,_r]=Ot(Pe(u.lab,F.lab,Wt));return new Kt(Xe,Vi,fr,_r,!1)}}},array:Pe,padding:function(u,F,Wt){return new Jt(Pe(u.values,F.values,Wt))},variableAnchorOffsetCollection:function(u,F,Wt){const Xe=u.values,Vi=F.values;if(Xe.length!==Vi.length)throw new ae(`Cannot interpolate values of different length. from: ${u.toString()}, to: ${F.toString()}`);const fr=[];for(let u=0;u<Xe.length;u+=2){if(Xe[u]!==Vi[u])throw new ae(`Cannot interpolate values containing mismatched anchors. from[${u}]: ${Xe[u]}, to[${u}]: ${Vi[u]}`);fr.push(Xe[u]);const[F,_r]=Xe[u+1],[wr,Ar]=Vi[u+1];fr.push([ze(F,wr,Wt),ze(_r,Ar,Wt)])}return new Qt(fr)}};class Be{constructor(u,F,Wt,Xe,Vi){this.type=u,this.operator=F,this.interpolation=Wt,this.input=Xe,this.labels=[],this.outputs=[];for(const[u,F]of Vi)this.labels.push(u),this.outputs.push(F)}static interpolationFactor(u,F,Wt,Xe){let Vi=0;if("exponential"===u.name)Vi=Ve(F,u.base,Wt,Xe);else if("linear"===u.name)Vi=Ve(F,1,Wt,Xe);else if("cubic-bezier"===u.name){const fr=u.controlPoints;Vi=new Bl(fr[0],fr[1],fr[2],fr[3]).solve(Ve(F,1,Wt,Xe))}return Vi}static parse(u,F){let[Wt,Xe,Vi,...fr]=u;if(!Array.isArray(Xe)||0===Xe.length)return F.error("Expected an interpolation type expression.",1);if("linear"===Xe[0])Xe={name:"linear"};else if("exponential"===Xe[0]){const u=Xe[1];if("number"!=typeof u)return F.error("Exponential interpolation requires a numeric base.",1,1);Xe={name:"exponential",base:u}}else{if("cubic-bezier"!==Xe[0])return F.error(`Unknown interpolation type ${String(Xe[0])}`,1,0);{const u=Xe.slice(1);if(4!==u.length||u.some((u=>"number"!=typeof u||u<0||u>1)))return F.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);Xe={name:"cubic-bezier",controlPoints:u}}}if(u.length-1<4)return F.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return F.error("Expected an even number of arguments.");if(Vi=F.parse(Vi,2,co),!Vi)return null;const _r=[];let wr=null;"interpolate-hcl"===Wt||"interpolate-lab"===Wt?wr=xo:F.expectedType&&"value"!==F.expectedType.kind&&(wr=F.expectedType);for(let u=0;u<fr.length;u+=2){const Wt=fr[u],Xe=fr[u+1],Vi=u+3,Ar=u+4;if("number"!=typeof Wt)return F.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Vi);if(_r.length&&_r[_r.length-1][0]>=Wt)return F.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Vi);const Kr=F.parse(Xe,Ar,wr);if(!Kr)return null;wr=wr||Kr.type,_r.push([Wt,Kr])}return Mt(wr,co)||Mt(wr,xo)||Mt(wr,Bo)||Mt(wr,ol)||Mt(wr,bt(co))?new Be(wr,Wt,Xe,Vi,_r):F.error(`Type ${wt(wr)} is not interpolatable.`)}evaluate(u){const F=this.labels,Wt=this.outputs;if(1===F.length)return Wt[0].evaluate(u);const Xe=this.input.evaluate(u);if(Xe<=F[0])return Wt[0].evaluate(u);const Vi=F.length;if(Xe>=F[Vi-1])return Wt[Vi-1].evaluate(u);const fr=_e(F,Xe),_r=Be.interpolationFactor(this.interpolation,Xe,F[fr],F[fr+1]),wr=Wt[fr].evaluate(u),Ar=Wt[fr+1].evaluate(u);switch(this.operator){case"interpolate":return Ol[this.type.kind](wr,Ar,_r);case"interpolate-hcl":return Ol.color(wr,Ar,_r,"hcl");case"interpolate-lab":return Ol.color(wr,Ar,_r,"lab")}}eachChild(u){u(this.input);for(const F of this.outputs)u(F)}outputDefined(){return this.outputs.every((u=>u.outputDefined()))}}function Ve(u,F,Wt,Xe){const Vi=Xe-Wt,fr=u-Wt;return 0===Vi?0:1===F?fr/Vi:(Math.pow(F,fr)-1)/(Math.pow(F,Vi)-1)}class Ee{constructor(u,F){this.type=u,this.args=F}static parse(u,F){if(u.length<2)return F.error("Expectected at least one argument.");let Wt=null;const Xe=F.expectedType;Xe&&"value"!==Xe.kind&&(Wt=Xe);const Vi=[];for(const Xe of u.slice(1)){const u=F.parse(Xe,1+Vi.length,Wt,void 0,{typeAnnotation:"omit"});if(!u)return null;Wt=Wt||u.type,Vi.push(u)}if(!Wt)throw new Error("No output type");const fr=Xe&&Vi.some((u=>At(Xe,u.type)));return new Ee(fr?ko:Wt,Vi)}evaluate(u){let F,Wt=null,Xe=0;for(const Vi of this.args)if(Xe++,Wt=Vi.evaluate(u),Wt&&Wt instanceof te&&!Wt.available&&(F||(F=Wt.name),Wt=null,Xe===this.args.length&&(Wt=F)),null!==Wt)break;return Wt}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every((u=>u.outputDefined()))}}function Fe(u,F){return"=="===u||"!="===u?"boolean"===F.kind||"string"===F.kind||"number"===F.kind||"null"===F.kind||"value"===F.kind:"string"===F.kind||"number"===F.kind||"value"===F.kind}function Te(u,F,Wt,Xe){return 0===Xe.compare(F,Wt)}function $e(u,F,Wt){const Xe="=="!==u&&"!="!==u;return class i{constructor(u,F,Wt){this.type=go,this.lhs=u,this.rhs=F,this.collator=Wt,this.hasUntypedArgument="value"===u.type.kind||"value"===F.type.kind}static parse(u,F){if(3!==u.length&&4!==u.length)return F.error("Expected two or three arguments.");const Wt=u[0];let Vi=F.parse(u[1],1,ko);if(!Vi)return null;if(!Fe(Wt,Vi.type))return F.concat(1).error(`"${Wt}" comparisons are not supported for type '${wt(Vi.type)}'.`);let fr=F.parse(u[2],2,ko);if(!fr)return null;if(!Fe(Wt,fr.type))return F.concat(2).error(`"${Wt}" comparisons are not supported for type '${wt(fr.type)}'.`);if(Vi.type.kind!==fr.type.kind&&"value"!==Vi.type.kind&&"value"!==fr.type.kind)return F.error(`Cannot compare types '${wt(Vi.type)}' and '${wt(fr.type)}'.`);Xe&&("value"===Vi.type.kind&&"value"!==fr.type.kind?Vi=new le(fr.type,[Vi]):"value"!==Vi.type.kind&&"value"===fr.type.kind&&(fr=new le(Vi.type,[fr])));let _r=null;if(4===u.length){if("string"!==Vi.type.kind&&"string"!==fr.type.kind&&"value"!==Vi.type.kind&&"value"!==fr.type.kind)return F.error("Cannot use collator to compare non-string types.");if(_r=F.parse(u[3],3,Co),!_r)return null}return new i(Vi,fr,_r)}evaluate(Vi){const fr=this.lhs.evaluate(Vi),_r=this.rhs.evaluate(Vi);if(Xe&&this.hasUntypedArgument){const F=ne(fr),Wt=ne(_r);if(F.kind!==Wt.kind||"string"!==F.kind&&"number"!==F.kind)throw new ae(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${F.kind}, ${Wt.kind}) instead.`)}if(this.collator&&!Xe&&this.hasUntypedArgument){const u=ne(fr),Wt=ne(_r);if("string"!==u.kind||"string"!==Wt.kind)return F(Vi,fr,_r)}return this.collator?Wt(Vi,fr,_r,this.collator.evaluate(Vi)):F(Vi,fr,_r)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}}}const Vl=$e("==",(function(u,F,Wt){return F===Wt}),Te),jl=$e("!=",(function(u,F,Wt){return F!==Wt}),(function(u,F,Wt,Xe){return!Te(0,F,Wt,Xe)})),Nl=$e("<",(function(u,F,Wt){return F<Wt}),(function(u,F,Wt,Xe){return Xe.compare(F,Wt)<0})),Ul=$e(">",(function(u,F,Wt){return F>Wt}),(function(u,F,Wt,Xe){return Xe.compare(F,Wt)>0})),$l=$e("<=",(function(u,F,Wt){return F<=Wt}),(function(u,F,Wt,Xe){return Xe.compare(F,Wt)<=0})),Zl=$e(">=",(function(u,F,Wt){return F>=Wt}),(function(u,F,Wt,Xe){return Xe.compare(F,Wt)>=0}));class qe{constructor(u,F,Wt){this.type=Co,this.locale=Wt,this.caseSensitive=u,this.diacriticSensitive=F}static parse(u,F){if(2!==u.length)return F.error("Expected one argument.");const Wt=u[1];if("object"!=typeof Wt||Array.isArray(Wt))return F.error("Collator options argument must be an object.");const Xe=F.parse(void 0!==Wt["case-sensitive"]&&Wt["case-sensitive"],1,go);if(!Xe)return null;const Vi=F.parse(void 0!==Wt["diacritic-sensitive"]&&Wt["diacritic-sensitive"],1,go);if(!Vi)return null;let fr=null;return Wt.locale&&(fr=F.parse(Wt.locale,1,ho),!fr)?null:new qe(Xe,Vi,fr)}evaluate(u){return new Xt(this.caseSensitive.evaluate(u),this.diacriticSensitive.evaluate(u),this.locale?this.locale.evaluate(u):null)}eachChild(u){u(this.caseSensitive),u(this.diacriticSensitive),this.locale&&u(this.locale)}outputDefined(){return!1}}class Ne{constructor(u,F,Wt,Xe,Vi){this.type=ho,this.number=u,this.locale=F,this.currency=Wt,this.minFractionDigits=Xe,this.maxFractionDigits=Vi}static parse(u,F){if(3!==u.length)return F.error("Expected two arguments.");const Wt=F.parse(u[1],1,co);if(!Wt)return null;const Xe=u[2];if("object"!=typeof Xe||Array.isArray(Xe))return F.error("NumberFormat options argument must be an object.");let Vi=null;if(Xe.locale&&(Vi=F.parse(Xe.locale,1,ho),!Vi))return null;let fr=null;if(Xe.currency&&(fr=F.parse(Xe.currency,1,ho),!fr))return null;let _r=null;if(Xe["min-fraction-digits"]&&(_r=F.parse(Xe["min-fraction-digits"],1,co),!_r))return null;let wr=null;return Xe["max-fraction-digits"]&&(wr=F.parse(Xe["max-fraction-digits"],1,co),!wr)?null:new Ne(Wt,Vi,fr,_r,wr)}evaluate(u){return new Intl.NumberFormat(this.locale?this.locale.evaluate(u):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(u):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(u):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(u):void 0}).format(this.number.evaluate(u))}eachChild(u){u(this.number),this.locale&&u(this.locale),this.currency&&u(this.currency),this.minFractionDigits&&u(this.minFractionDigits),this.maxFractionDigits&&u(this.maxFractionDigits)}outputDefined(){return!1}}class Ze{constructor(u){this.type=zo,this.sections=u}static parse(u,F){if(u.length<2)return F.error("Expected at least one argument.");const Wt=u[1];if(!Array.isArray(Wt)&&"object"==typeof Wt)return F.error("First argument must be an image or text section.");const Xe=[];let Vi=!1;for(let Wt=1;Wt<=u.length-1;++Wt){const fr=u[Wt];if(Vi&&"object"==typeof fr&&!Array.isArray(fr)){Vi=!1;let u=null;if(fr["font-scale"]&&(u=F.parse(fr["font-scale"],1,co),!u))return null;let Wt=null;if(fr["text-font"]&&(Wt=F.parse(fr["text-font"],1,bt(ho)),!Wt))return null;let _r=null;if(fr["text-color"]&&(_r=F.parse(fr["text-color"],1,xo),!_r))return null;const wr=Xe[Xe.length-1];wr.scale=u,wr.font=Wt,wr.textColor=_r}else{const fr=F.parse(u[Wt],1,ko);if(!fr)return null;const _r=fr.type.kind;if("string"!==_r&&"value"!==_r&&"null"!==_r&&"resolvedImage"!==_r)return F.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");Vi=!0,Xe.push({content:fr,scale:null,font:null,textColor:null})}}return new Ze(Xe)}evaluate(u){return new Yt(this.sections.map((F=>{const Wt=F.content.evaluate(u);return ne(Wt)===al?new Ht("",Wt,null,null,null):new Ht(ie(Wt),null,F.scale?F.scale.evaluate(u):null,F.font?F.font.evaluate(u).join(","):null,F.textColor?F.textColor.evaluate(u):null)})))}eachChild(u){for(const F of this.sections)u(F.content),F.scale&&u(F.scale),F.font&&u(F.font),F.textColor&&u(F.textColor)}outputDefined(){return!1}}class Ge{constructor(u){this.type=al,this.input=u}static parse(u,F){if(2!==u.length)return F.error("Expected two arguments.");const Wt=F.parse(u[1],1,ho);return Wt?new Ge(Wt):F.error("No image name provided.")}evaluate(u){const F=this.input.evaluate(u),Wt=te.fromString(F);return Wt&&u.availableImages&&(Wt.available=u.availableImages.indexOf(F)>-1),Wt}eachChild(u){u(this.input)}outputDefined(){return!1}}class Ke{constructor(u){this.type=co,this.input=u}static parse(u,F){if(2!==u.length)return F.error(`Expected 1 argument, but found ${u.length-1} instead.`);const Wt=F.parse(u[1],1);return Wt?"array"!==Wt.type.kind&&"string"!==Wt.type.kind&&"value"!==Wt.type.kind?F.error(`Expected argument of type string or array, but found ${wt(Wt.type)} instead.`):new Ke(Wt):null}evaluate(u){const F=this.input.evaluate(u);if("string"==typeof F)return[...F].length;if(Array.isArray(F))return F.length;throw new ae(`Expected value to be of type string or array, but found ${wt(ne(F))} instead.`)}eachChild(u){u(this.input)}outputDefined(){return!1}}const Gl=8192;function He(u,F){const Wt=(180+u[0])/360,Xe=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,Vi=Math.pow(2,F.z);return[Math.round(Wt*Vi*Gl),Math.round(Xe*Vi*Gl)]}function Ye(u,F){const Wt=Math.pow(2,F.z);return[(Vi=(u[0]/Gl+F.x)/Wt,360*Vi-180),(Xe=(u[1]/Gl+F.y)/Wt,360/Math.PI*Math.atan(Math.exp((180-360*Xe)*Math.PI/180))-90)];var Xe,Vi}function Je(u,F){u[0]=Math.min(u[0],F[0]),u[1]=Math.min(u[1],F[1]),u[2]=Math.max(u[2],F[0]),u[3]=Math.max(u[3],F[1])}function We(u,F){return!(u[0]<=F[0]||u[2]>=F[2]||u[1]<=F[1]||u[3]>=F[3])}function Qe(u,F,Wt){const Xe=u[0]-F[0],Vi=u[1]-F[1],fr=u[0]-Wt[0],_r=u[1]-Wt[1];return Xe*_r-fr*Vi==0&&Xe*fr<=0&&Vi*_r<=0}function tr(u,F,Wt,Xe){return 0!=(Vi=[Xe[0]-Wt[0],Xe[1]-Wt[1]])[0]*(fr=[F[0]-u[0],F[1]-u[1]])[1]-Vi[1]*fr[0]&&!(!ar(u,F,Wt,Xe)||!ar(Wt,Xe,u,F));var Vi,fr}function er(u,F,Wt){for(const Xe of Wt)for(let Wt=0;Wt<Xe.length-1;++Wt)if(tr(u,F,Xe[Wt],Xe[Wt+1]))return!0;return!1}function rr(u,F,Wt=!1){let Xe=!1;for(const wr of F)for(let F=0;F<wr.length-1;F++){if(Qe(u,wr[F],wr[F+1]))return Wt;(fr=wr[F])[1]>(Vi=u)[1]!=(_r=wr[F+1])[1]>Vi[1]&&Vi[0]<(_r[0]-fr[0])*(Vi[1]-fr[1])/(_r[1]-fr[1])+fr[0]&&(Xe=!Xe)}var Vi,fr,_r;return Xe}function nr(u,F){for(const Wt of F)if(rr(u,Wt))return!0;return!1}function ir(u,F){for(const Wt of u)if(!rr(Wt,F))return!1;for(let Wt=0;Wt<u.length-1;++Wt)if(er(u[Wt],u[Wt+1],F))return!1;return!0}function sr(u,F){for(const Wt of F)if(ir(u,Wt))return!0;return!1}function ar(u,F,Wt,Xe){const Vi=Xe[0]-Wt[0],fr=Xe[1]-Wt[1],_r=(u[0]-Wt[0])*fr-Vi*(u[1]-Wt[1]),wr=(F[0]-Wt[0])*fr-Vi*(F[1]-Wt[1]);return _r>0&&wr<0||_r<0&&wr>0}function or(u,F,Wt){const Xe=[];for(let Vi=0;Vi<u.length;Vi++){const fr=[];for(let Xe=0;Xe<u[Vi].length;Xe++){const _r=He(u[Vi][Xe],Wt);Je(F,_r),fr.push(_r)}Xe.push(fr)}return Xe}function lr(u,F,Wt){const Xe=[];for(let Vi=0;Vi<u.length;Vi++){const fr=or(u[Vi],F,Wt);Xe.push(fr)}return Xe}function ur(u,F,Wt,Xe){if(u[0]<Wt[0]||u[0]>Wt[2]){const F=.5*Xe;let Vi=u[0]-Wt[0]>F?-Xe:Wt[0]-u[0]>F?Xe:0;0===Vi&&(Vi=u[0]-Wt[2]>F?-Xe:Wt[2]-u[0]>F?Xe:0),u[0]+=Vi}Je(F,u)}function cr(u,F,Wt,Xe){const Vi=Math.pow(2,Xe.z)*Gl,fr=[Xe.x*Gl,Xe.y*Gl],_r=[];for(const Xe of u)for(const u of Xe){const Xe=[u.x+fr[0],u.y+fr[1]];ur(Xe,F,Wt,Vi),_r.push(Xe)}return _r}function hr(u,F,Wt,Xe){const Vi=Math.pow(2,Xe.z)*Gl,fr=[Xe.x*Gl,Xe.y*Gl],_r=[];for(const Wt of u){const u=[];for(const Xe of Wt){const Wt=[Xe.x+fr[0],Xe.y+fr[1]];Je(F,Wt),u.push(Wt)}_r.push(u)}if(F[2]-F[0]<=Vi/2){(wr=F)[0]=wr[1]=1/0,wr[2]=wr[3]=-1/0;for(const u of _r)for(const Xe of u)ur(Xe,F,Wt,Vi)}var wr;return _r}class pr{constructor(u,F){this.type=go,this.geojson=u,this.geometries=F}static parse(u,F){if(2!==u.length)return F.error(`'within' expression requires exactly one argument, but found ${u.length-1} instead.`);if(re(u[1])){const F=u[1];if("FeatureCollection"===F.type){const u=[];for(const Wt of F.features){const{type:F,coordinates:Xe}=Wt.geometry;"Polygon"===F&&u.push(Xe),"MultiPolygon"===F&&u.push(...Xe)}if(u.length)return new pr(F,{type:"MultiPolygon",coordinates:u})}else if("Feature"===F.type){const u=F.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new pr(F,F.geometry)}else if("Polygon"===F.type||"MultiPolygon"===F.type)return new pr(F,F)}return F.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(u){if(null!=u.geometry()&&null!=u.canonicalID()){if("Point"===u.geometryType())return function(u,F){const Wt=[1/0,1/0,-1/0,-1/0],Xe=[1/0,1/0,-1/0,-1/0],Vi=u.canonicalID();if("Polygon"===F.type){const fr=or(F.coordinates,Xe,Vi),_r=cr(u.geometry(),Wt,Xe,Vi);if(!We(Wt,Xe))return!1;for(const u of _r)if(!rr(u,fr))return!1}if("MultiPolygon"===F.type){const fr=lr(F.coordinates,Xe,Vi),_r=cr(u.geometry(),Wt,Xe,Vi);if(!We(Wt,Xe))return!1;for(const u of _r)if(!nr(u,fr))return!1}return!0}(u,this.geometries);if("LineString"===u.geometryType())return function(u,F){const Wt=[1/0,1/0,-1/0,-1/0],Xe=[1/0,1/0,-1/0,-1/0],Vi=u.canonicalID();if("Polygon"===F.type){const fr=or(F.coordinates,Xe,Vi),_r=hr(u.geometry(),Wt,Xe,Vi);if(!We(Wt,Xe))return!1;for(const u of _r)if(!ir(u,fr))return!1}if("MultiPolygon"===F.type){const fr=lr(F.coordinates,Xe,Vi),_r=hr(u.geometry(),Wt,Xe,Vi);if(!We(Wt,Xe))return!1;for(const u of _r)if(!sr(u,fr))return!1}return!0}(u,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Wl=class{constructor(u=[],F=((u,F)=>u<F?-1:u>F?1:0)){if(this.data=u,this.length=this.data.length,this.compare=F,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(u){this.data.push(u),this._up(this.length++)}pop(){if(0===this.length)return;const u=this.data[0],F=this.data.pop();return--this.length>0&&(this.data[0]=F,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:F,compare:Wt}=this,Xe=F[u];for(;u>0;){const Vi=u-1>>1,fr=F[Vi];if(Wt(Xe,fr)>=0)break;F[u]=fr,u=Vi}F[u]=Xe}_down(u){const{data:F,compare:Wt}=this,Xe=this.length>>1,Vi=F[u];for(;u<Xe;){let Xe=1+(u<<1);const fr=Xe+1;if(fr<this.length&&Wt(F[fr],F[Xe])<0&&(Xe=fr),Wt(F[Xe],Vi)>=0)break;F[u]=F[Xe],u=Xe}F[u]=Vi}};function dr(u,F,Wt,Xe,Vi){yr(u,F,Wt,Xe||u.length-1,Vi||gr)}function yr(u,F,Wt,Xe,Vi){for(;Xe>Wt;){if(Xe-Wt>600){var fr=Xe-Wt+1,_r=F-Wt+1,wr=Math.log(fr),Ar=.5*Math.exp(2*wr/3),Kr=.5*Math.sqrt(wr*Ar*(fr-Ar)/fr)*(_r-fr/2<0?-1:1);yr(u,F,Math.max(Wt,Math.floor(F-_r*Ar/fr+Kr)),Math.min(Xe,Math.floor(F+(fr-_r)*Ar/fr+Kr)),Vi)}var In=u[F],ns=Wt,ca=Xe;for(mr(u,Wt,F),Vi(u[Xe],In)>0&&mr(u,Wt,Xe);ns<ca;){for(mr(u,ns,ca),ns++,ca--;Vi(u[ns],In)<0;)ns++;for(;Vi(u[ca],In)>0;)ca--}0===Vi(u[Wt],In)?mr(u,Wt,ca):mr(u,++ca,Xe),ca<=F&&(Wt=ca+1),F<=ca&&(Xe=ca-1)}}function mr(u,F,Wt){var Xe=u[F];u[F]=u[Wt],u[Wt]=Xe}function gr(u,F){return u<F?-1:u>F?1:0}function xr(u,F){if(u.length<=1)return[u];const Wt=[];let Xe,Vi;for(const F of u){const u=br(F);0!==u&&(F.area=Math.abs(u),void 0===Vi&&(Vi=u<0),Vi===u<0?(Xe&&Wt.push(Xe),Xe=[F]):Xe.push(F))}if(Xe&&Wt.push(Xe),F>1)for(let u=0;u<Wt.length;u++)Wt[u].length<=F||(dr(Wt[u],F,1,Wt[u].length-1,vr),Wt[u]=Wt[u].slice(0,F));return Wt}function vr(u,F){return F.area-u.area}function br(u){let F=0;for(let Wt,Xe,Vi=0,fr=u.length,_r=fr-1;Vi<fr;_r=Vi++)Wt=u[Vi],Xe=u[_r],F+=(Xe.x-Wt.x)*(Wt.y+Xe.y);return F}const Xl=1/298.257223563,Jl=Xl*(2-Xl),Ql=Math.PI/180;class Sr{constructor(u){const F=6378.137*Ql*1e3,Wt=Math.cos(u*Ql),Xe=1/(1-Jl*(1-Wt*Wt)),Vi=Math.sqrt(Xe);this.kx=F*Vi*Wt,this.ky=F*Vi*Xe*(1-Jl)}distance(u,F){const Wt=this.wrap(u[0]-F[0])*this.kx,Xe=(u[1]-F[1])*this.ky;return Math.sqrt(Wt*Wt+Xe*Xe)}pointOnLine(u,F){let Wt,Xe,Vi,fr,_r=1/0;for(let wr=0;wr<u.length-1;wr++){let Ar=u[wr][0],Kr=u[wr][1],In=this.wrap(u[wr+1][0]-Ar)*this.kx,ns=(u[wr+1][1]-Kr)*this.ky,ca=0;0===In&&0===ns||(ca=(this.wrap(F[0]-Ar)*this.kx*In+(F[1]-Kr)*this.ky*ns)/(In*In+ns*ns),ca>1?(Ar=u[wr+1][0],Kr=u[wr+1][1]):ca>0&&(Ar+=In/this.kx*ca,Kr+=ns/this.ky*ca)),In=this.wrap(F[0]-Ar)*this.kx,ns=(F[1]-Kr)*this.ky;const ha=In*In+ns*ns;ha<_r&&(_r=ha,Wt=Ar,Xe=Kr,Vi=wr,fr=ca)}return{point:[Wt,Xe],index:Vi,t:Math.max(0,Math.min(1,fr))}}wrap(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}}function kr(u,F){return F[0]-u[0]}function Mr(u){return u[1]-u[0]+1}function Ir(u,F){return u[1]>=u[0]&&u[1]<F}function zr(u,F){if(u[0]>u[1])return[null,null];const Wt=Mr(u);if(F){if(2===Wt)return[u,null];const F=Math.floor(Wt/2);return[[u[0],u[0]+F],[u[0]+F,u[1]]]}if(1===Wt)return[u,null];const Xe=Math.floor(Wt/2)-1;return[[u[0],u[0]+Xe],[u[0]+Xe+1,u[1]]]}function Pr(u,F){if(!Ir(F,u.length))return[1/0,1/0,-1/0,-1/0];const Wt=[1/0,1/0,-1/0,-1/0];for(let Xe=F[0];Xe<=F[1];++Xe)Je(Wt,u[Xe]);return Wt}function Cr(u){const F=[1/0,1/0,-1/0,-1/0];for(const Wt of u)for(const u of Wt)Je(F,u);return F}function Br(u){return u[0]!==-1/0&&u[1]!==-1/0&&u[2]!==1/0&&u[3]!==1/0}function Vr(u,F,Wt){if(!Br(u)||!Br(F))return NaN;let Xe=0,Vi=0;return u[2]<F[0]&&(Xe=F[0]-u[2]),u[0]>F[2]&&(Xe=u[0]-F[2]),u[1]>F[3]&&(Vi=u[1]-F[3]),u[3]<F[1]&&(Vi=F[1]-u[3]),Wt.distance([0,0],[Xe,Vi])}function Er(u,F,Wt){const Xe=Wt.pointOnLine(F,u);return Wt.distance(u,Xe.point)}function Fr(u,F,Wt,Xe,Vi){const fr=Math.min(Er(u,[Wt,Xe],Vi),Er(F,[Wt,Xe],Vi)),_r=Math.min(Er(Wt,[u,F],Vi),Er(Xe,[u,F],Vi));return Math.min(fr,_r)}function Tr(u,F,Wt,Xe,Vi){if(!Ir(F,u.length)||!Ir(Xe,Wt.length))return 1/0;let fr=1/0;for(let _r=F[0];_r<F[1];++_r){const F=u[_r],wr=u[_r+1];for(let u=Xe[0];u<Xe[1];++u){const Xe=Wt[u],_r=Wt[u+1];if(tr(F,wr,Xe,_r))return 0;fr=Math.min(fr,Fr(F,wr,Xe,_r,Vi))}}return fr}function $r(u,F,Wt,Xe,Vi){if(!Ir(F,u.length)||!Ir(Xe,Wt.length))return NaN;let fr=1/0;for(let _r=F[0];_r<=F[1];++_r)for(let F=Xe[0];F<=Xe[1];++F)if(fr=Math.min(fr,Vi.distance(u[_r],Wt[F])),0===fr)return fr;return fr}function Lr(u,F,Wt){if(rr(u,F,!0))return 0;let Xe=1/0;for(const Vi of F){const F=Vi[0],fr=Vi[Vi.length-1];if(F!==fr&&(Xe=Math.min(Xe,Er(u,[fr,F],Wt)),0===Xe))return Xe;const _r=Wt.pointOnLine(Vi,u);if(Xe=Math.min(Xe,Wt.distance(u,_r.point)),0===Xe)return Xe}return Xe}function Dr(u,F,Wt,Xe){if(!Ir(F,u.length))return NaN;for(let Xe=F[0];Xe<=F[1];++Xe)if(rr(u[Xe],Wt,!0))return 0;let Vi=1/0;for(let fr=F[0];fr<F[1];++fr){const F=u[fr],_r=u[fr+1];for(const u of Wt)for(let Wt=0,fr=u.length,wr=fr-1;Wt<fr;wr=Wt++){const fr=u[wr],Ar=u[Wt];if(tr(F,_r,fr,Ar))return 0;Vi=Math.min(Vi,Fr(F,_r,fr,Ar,Xe))}}return Vi}function Or(u,F){for(const Wt of u)for(const u of Wt)if(rr(u,F,!0))return!0;return!1}function jr(u,F,Wt,Xe=1/0){const Vi=Cr(u),fr=Cr(F);if(Xe!==1/0&&Vr(Vi,fr,Wt)>=Xe)return Xe;if(We(Vi,fr)){if(Or(u,F))return 0}else if(Or(F,u))return 0;let _r=1/0;for(const Xe of u)for(let u=0,Vi=Xe.length,fr=Vi-1;u<Vi;fr=u++){const Vi=Xe[fr],wr=Xe[u];for(const u of F)for(let F=0,Xe=u.length,fr=Xe-1;F<Xe;fr=F++){const Xe=u[fr],Ar=u[F];if(tr(Vi,wr,Xe,Ar))return 0;_r=Math.min(_r,Fr(Vi,wr,Xe,Ar,Wt))}}return _r}function Rr(u,F,Wt,Xe,Vi,fr){if(!fr)return;const _r=Vr(Pr(Xe,fr),Vi,Wt);_r<F&&u.push([_r,fr,[0,0]])}function Ur(u,F,Wt,Xe,Vi,fr,_r){if(!fr||!_r)return;const wr=Vr(Pr(Xe,fr),Pr(Vi,_r),Wt);wr<F&&u.push([wr,fr,_r])}function qr(u,F,Wt,Xe,Vi=1/0){let fr=Math.min(Xe.distance(u[0],Wt[0][0]),Vi);if(0===fr)return fr;const _r=new Wl([[0,[0,u.length-1],[0,0]]],kr),wr=Cr(Wt);for(;_r.length>0;){const Vi=_r.pop();if(Vi[0]>=fr)continue;const Ar=Vi[1],Kr=F?50:100;if(Mr(Ar)<=Kr){if(!Ir(Ar,u.length))return NaN;if(F){const F=Dr(u,Ar,Wt,Xe);if(isNaN(F)||0===F)return F;fr=Math.min(fr,F)}else for(let F=Ar[0];F<=Ar[1];++F){const Vi=Lr(u[F],Wt,Xe);if(fr=Math.min(fr,Vi),0===fr)return 0}}else{const Wt=zr(Ar,F);Rr(_r,fr,Xe,u,wr,Wt[0]),Rr(_r,fr,Xe,u,wr,Wt[1])}}return fr}function Nr(u,F,Wt,Xe,Vi,fr=1/0){let _r=Math.min(fr,Vi.distance(u[0],Wt[0]));if(0===_r)return _r;const wr=new Wl([[0,[0,u.length-1],[0,Wt.length-1]]],kr);for(;wr.length>0;){const fr=wr.pop();if(fr[0]>=_r)continue;const Ar=fr[1],Kr=fr[2],In=F?50:100,ns=Xe?50:100;if(Mr(Ar)<=In&&Mr(Kr)<=ns){if(!Ir(Ar,u.length)&&Ir(Kr,Wt.length))return NaN;let fr;if(F&&Xe)fr=Tr(u,Ar,Wt,Kr,Vi),_r=Math.min(_r,fr);else if(F&&!Xe){const F=u.slice(Ar[0],Ar[1]+1);for(let u=Kr[0];u<=Kr[1];++u)if(fr=Er(Wt[u],F,Vi),_r=Math.min(_r,fr),0===_r)return _r}else if(!F&&Xe){const F=Wt.slice(Kr[0],Kr[1]+1);for(let Wt=Ar[0];Wt<=Ar[1];++Wt)if(fr=Er(u[Wt],F,Vi),_r=Math.min(_r,fr),0===_r)return _r}else fr=$r(u,Ar,Wt,Kr,Vi),_r=Math.min(_r,fr)}else{const fr=zr(Ar,F),In=zr(Kr,Xe);Ur(wr,_r,Vi,u,Wt,fr[0],In[0]),Ur(wr,_r,Vi,u,Wt,fr[0],In[1]),Ur(wr,_r,Vi,u,Wt,fr[1],In[0]),Ur(wr,_r,Vi,u,Wt,fr[1],In[1])}}return _r}function Zr(u){return"MultiPolygon"===u.type?u.coordinates.map((u=>({type:"Polygon",coordinates:u}))):"MultiLineString"===u.type?u.coordinates.map((u=>({type:"LineString",coordinates:u}))):"MultiPoint"===u.type?u.coordinates.map((u=>({type:"Point",coordinates:u}))):[u]}class Gr{constructor(u,F){this.type=co,this.geojson=u,this.geometries=F}static parse(u,F){if(2!==u.length)return F.error(`'distance' expression requires exactly one argument, but found ${u.length-1} instead.`);if(re(u[1])){const F=u[1];if("FeatureCollection"===F.type)return new Gr(F,F.features.map((u=>Zr(u.geometry))).flat());if("Feature"===F.type)return new Gr(F,Zr(F.geometry));if("type"in F&&"coordinates"in F)return new Gr(F,Zr(F))}return F.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(u){if(null!=u.geometry()&&null!=u.canonicalID()){if("Point"===u.geometryType())return function(u,F){const Wt=u.geometry(),Xe=Wt.flat().map((F=>Ye([F.x,F.y],u.canonical)));if(0===Wt.length)return NaN;const Vi=new Sr(Xe[0][1]);let fr=1/0;for(const u of F){switch(u.type){case"Point":fr=Math.min(fr,Nr(Xe,!1,[u.coordinates],!1,Vi,fr));break;case"LineString":fr=Math.min(fr,Nr(Xe,!1,u.coordinates,!0,Vi,fr));break;case"Polygon":fr=Math.min(fr,qr(Xe,!1,u.coordinates,Vi,fr))}if(0===fr)return fr}return fr}(u,this.geometries);if("LineString"===u.geometryType())return function(u,F){const Wt=u.geometry(),Xe=Wt.flat().map((F=>Ye([F.x,F.y],u.canonical)));if(0===Wt.length)return NaN;const Vi=new Sr(Xe[0][1]);let fr=1/0;for(const u of F){switch(u.type){case"Point":fr=Math.min(fr,Nr(Xe,!0,[u.coordinates],!1,Vi,fr));break;case"LineString":fr=Math.min(fr,Nr(Xe,!0,u.coordinates,!0,Vi,fr));break;case"Polygon":fr=Math.min(fr,qr(Xe,!0,u.coordinates,Vi,fr))}if(0===fr)return fr}return fr}(u,this.geometries);if("Polygon"===u.geometryType())return function(u,F){const Wt=u.geometry();if(0===Wt.length||0===Wt[0].length)return NaN;const Xe=xr(Wt,0).map((F=>F.map((F=>F.map((F=>Ye([F.x,F.y],u.canonical))))))),Vi=new Sr(Xe[0][0][0][1]);let fr=1/0;for(const u of F)for(const F of Xe){switch(u.type){case"Point":fr=Math.min(fr,qr([u.coordinates],!1,F,Vi,fr));break;case"LineString":fr=Math.min(fr,qr(u.coordinates,!0,F,Vi,fr));break;case"Polygon":fr=Math.min(fr,jr(F,u.coordinates,Vi,fr))}if(0===fr)return fr}return fr}(u,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const ic={"==":Vl,"!=":jl,">":Ul,"<":Nl,">=":Zl,"<=":$l,array:le,at:me,boolean:le,case:be,coalesce:Ee,collator:qe,format:Ze,image:Ge,in:ge,"index-of":xe,interpolate:Be,"interpolate-hcl":Be,"interpolate-lab":Be,length:Ke,let:de,literal:se,match:ve,number:le,"number-format":Ne,object:le,slice:we,step:Ae,string:le,"to-boolean":ce,"to-color":ce,"to-number":ce,"to-string":ce,var:ye,within:pr,distance:Gr};class Xr{constructor(u,F,Wt,Xe){this.name=u,this.type=F,this._evaluate=Wt,this.args=Xe}evaluate(u){return this._evaluate(u,this.args)}eachChild(u){this.args.forEach(u)}outputDefined(){return!1}static parse(u,F){const Wt=u[0],Xe=Xr.definitions[Wt];if(!Xe)return F.error(`Unknown expression "${Wt}". If you wanted a literal array, use ["literal", [...]].`,0);const Vi=Array.isArray(Xe)?Xe[0]:Xe.type,fr=Array.isArray(Xe)?[[Xe[1],Xe[2]]]:Xe.overloads,_r=fr.filter((([F])=>!Array.isArray(F)||F.length===u.length-1));let wr=null;for(const[Xe,fr]of _r){wr=new fe(F.registry,Qr,F.path,null,F.scope);const _r=[];let Ar=!1;for(let F=1;F<u.length;F++){const Wt=u[F],Vi=Array.isArray(Xe)?Xe[F-1]:Xe.type,fr=wr.parse(Wt,1+_r.length,Vi);if(!fr){Ar=!0;break}_r.push(fr)}if(!Ar)if(Array.isArray(Xe)&&Xe.length!==_r.length)wr.error(`Expected ${Xe.length} arguments, but found ${_r.length} instead.`);else{for(let u=0;u<_r.length;u++){const F=Array.isArray(Xe)?Xe[u]:Xe.type,Wt=_r[u];wr.concat(u+1).checkSubtype(F,Wt.type)}if(0===wr.errors.length)return new Xr(Wt,Vi,fr,_r)}}if(1===_r.length)F.errors.push(...wr.errors);else{const Wt=(_r.length?_r:fr).map((([u])=>{return F=u,Array.isArray(F)?`(${F.map(wt).join(", ")})`:`(${wt(F.type)}...)`;var F})).join(" | "),Xe=[];for(let Wt=1;Wt<u.length;Wt++){const Vi=F.parse(u[Wt],1+Xe.length);if(!Vi)return null;Xe.push(wt(Vi.type))}F.error(`Expected arguments of type ${Wt}, but found (${Xe.join(", ")}) instead.`)}return null}static register(u,F){Xr.definitions=F;for(const Wt in F)u[Wt]=Xr}}function Hr(u,[F,Wt,Xe,Vi]){F=F.evaluate(u),Wt=Wt.evaluate(u),Xe=Xe.evaluate(u);const fr=Vi?Vi.evaluate(u):1,_r=ee(F,Wt,Xe,fr);if(_r)throw new ae(_r);return new Kt(F/255,Wt/255,Xe/255,fr,!1)}function Yr(u,F){return u in F}function Jr(u,F){const Wt=F[u];return void 0===Wt?null:Wt}function Wr(u){return{type:u}}function Qr(u){if(u instanceof ye)return Qr(u.boundExpression);if(u instanceof Xr&&"error"===u.name)return!1;if(u instanceof qe)return!1;if(u instanceof pr)return!1;if(u instanceof Gr)return!1;const F=u instanceof ce||u instanceof le;let Wt=!0;return u.eachChild((u=>{Wt=F?Wt&&Qr(u):Wt&&u instanceof se})),!!Wt&&tn(u)&&rn(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function tn(u){if(u instanceof Xr){if("get"===u.name&&1===u.args.length)return!1;if("feature-state"===u.name)return!1;if("has"===u.name&&1===u.args.length)return!1;if("properties"===u.name||"geometry-type"===u.name||"id"===u.name)return!1;if(/^filter-/.test(u.name))return!1}if(u instanceof pr)return!1;if(u instanceof Gr)return!1;let F=!0;return u.eachChild((u=>{F&&!tn(u)&&(F=!1)})),F}function en(u){if(u instanceof Xr&&"feature-state"===u.name)return!1;let F=!0;return u.eachChild((u=>{F&&!en(u)&&(F=!1)})),F}function rn(u,F){if(u instanceof Xr&&F.indexOf(u.name)>=0)return!1;let Wt=!0;return u.eachChild((u=>{Wt&&!rn(u,F)&&(Wt=!1)})),Wt}function nn(u){return{result:"success",value:u}}function sn(u){return{result:"error",value:u}}function an(u){return"data-driven"===u["property-type"]||"cross-faded-data-driven"===u["property-type"]}function on(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function ln(u){return!!u.expression&&u.expression.interpolated}function un(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":null===u?"null":typeof u}function cn(u){return"object"==typeof u&&null!==u&&!Array.isArray(u)}function hn(u){return u}function pn(u,F){const Wt="color"===F.type,Xe=u.stops&&"object"==typeof u.stops[0][0],Vi=Xe||!(Xe||void 0!==u.property),fr=u.type||(ln(F)?"exponential":"interval");if(Wt||"padding"===F.type){const Xe=Wt?Kt.parse:Jt.parse;(u=st({},u)).stops&&(u.stops=u.stops.map((u=>[u[0],Xe(u[1])]))),u.default=Xe(u.default?u.default:F.default)}if(u.colorSpace&&"rgb"!==(_r=u.colorSpace)&&"hcl"!==_r&&"lab"!==_r)throw new Error(`Unknown color space: "${u.colorSpace}"`);var _r;let wr,Ar,Kr;if("exponential"===fr)wr=mn;else if("interval"===fr)wr=yn;else if("categorical"===fr){wr=dn,Ar=Object.create(null);for(const F of u.stops)Ar[F[0]]=F[1];Kr=typeof u.stops[0][0]}else{if("identity"!==fr)throw new Error(`Unknown function type "${fr}"`);wr=gn}if(Xe){const Wt={},Xe=[];for(let F=0;F<u.stops.length;F++){const Vi=u.stops[F],fr=Vi[0].zoom;void 0===Wt[fr]&&(Wt[fr]={zoom:fr,type:u.type,property:u.property,default:u.default,stops:[]},Xe.push(fr)),Wt[fr].stops.push([Vi[0].value,Vi[1]])}const Vi=[];for(const u of Xe)Vi.push([Wt[u].zoom,pn(Wt[u],F)]);const fr={name:"linear"};return{kind:"composite",interpolationType:fr,interpolationFactor:Be.interpolationFactor.bind(void 0,fr),zoomStops:Vi.map((u=>u[0])),evaluate:({zoom:Wt},Xe)=>mn({stops:Vi,base:u.base},F,Wt).evaluate(Wt,Xe)}}if(Vi){const Wt="exponential"===fr?{name:"exponential",base:void 0!==u.base?u.base:1}:null;return{kind:"camera",interpolationType:Wt,interpolationFactor:Be.interpolationFactor.bind(void 0,Wt),zoomStops:u.stops.map((u=>u[0])),evaluate:({zoom:Wt})=>wr(u,F,Wt,Ar,Kr)}}return{kind:"source",evaluate(Wt,Xe){const Vi=Xe&&Xe.properties?Xe.properties[u.property]:void 0;return void 0===Vi?fn(u.default,F.default):wr(u,F,Vi,Ar,Kr)}}}function fn(u,F,Wt){return void 0!==u?u:void 0!==F?F:void 0!==Wt?Wt:void 0}function dn(u,F,Wt,Xe,Vi){return fn(typeof Wt===Vi?Xe[Wt]:void 0,u.default,F.default)}function yn(u,F,Wt){if("number"!==un(Wt))return fn(u.default,F.default);const Xe=u.stops.length;if(1===Xe)return u.stops[0][1];if(Wt<=u.stops[0][0])return u.stops[0][1];if(Wt>=u.stops[Xe-1][0])return u.stops[Xe-1][1];const Vi=_e(u.stops.map((u=>u[0])),Wt);return u.stops[Vi][1]}function mn(u,F,Wt){const Xe=void 0!==u.base?u.base:1;if("number"!==un(Wt))return fn(u.default,F.default);const Vi=u.stops.length;if(1===Vi)return u.stops[0][1];if(Wt<=u.stops[0][0])return u.stops[0][1];if(Wt>=u.stops[Vi-1][0])return u.stops[Vi-1][1];const fr=_e(u.stops.map((u=>u[0])),Wt),_r=function(u,F,Wt,Xe){const Vi=Xe-Wt,fr=u-Wt;return 0===Vi?0:1===F?fr/Vi:(Math.pow(F,fr)-1)/(Math.pow(F,Vi)-1)}(Wt,Xe,u.stops[fr][0],u.stops[fr+1][0]),wr=u.stops[fr][1],Ar=u.stops[fr+1][1],Kr=Ol[F.type]||hn;return"function"==typeof wr.evaluate?{evaluate(...F){const Wt=wr.evaluate.apply(void 0,F),Xe=Ar.evaluate.apply(void 0,F);if(void 0!==Wt&&void 0!==Xe)return Kr(Wt,Xe,_r,u.colorSpace)}}:Kr(wr,Ar,_r,u.colorSpace)}function gn(u,F,Wt){switch(F.type){case"color":Wt=Kt.parse(Wt);break;case"formatted":Wt=Yt.fromString(Wt.toString());break;case"resolvedImage":Wt=te.fromString(Wt.toString());break;case"padding":Wt=Jt.parse(Wt);break;default:un(Wt)===F.type||"enum"===F.type&&F.values[Wt]||(Wt=void 0)}return fn(Wt,u.default,F.default)}Xr.register(ic,{error:[{kind:"error"},[ho],(u,[F])=>{throw new ae(F.evaluate(u))}],typeof:[ho,[ko],(u,[F])=>wt(ne(F.evaluate(u)))],"to-rgba":[bt(co,4),[xo],(u,[F])=>{const[Wt,Xe,Vi,fr]=F.evaluate(u).rgb;return[255*Wt,255*Xe,255*Vi,fr]}],rgb:[xo,[co,co,co],Hr],rgba:[xo,[co,co,co,co],Hr],has:{type:go,overloads:[[[ho],(u,[F])=>Yr(F.evaluate(u),u.properties())],[[ho,Io],(u,[F,Wt])=>Yr(F.evaluate(u),Wt.evaluate(u))]]},get:{type:ko,overloads:[[[ho],(u,[F])=>Jr(F.evaluate(u),u.properties())],[[ho,Io],(u,[F,Wt])=>Jr(F.evaluate(u),Wt.evaluate(u))]]},"feature-state":[ko,[ho],(u,[F])=>Jr(F.evaluate(u),u.featureState||{})],properties:[Io,[],u=>u.properties()],"geometry-type":[ho,[],u=>u.geometryType()],id:[ko,[],u=>u.id()],zoom:[co,[],u=>u.globals.zoom],"heatmap-density":[co,[],u=>u.globals.heatmapDensity||0],"line-progress":[co,[],u=>u.globals.lineProgress||0],accumulated:[ko,[],u=>void 0===u.globals.accumulated?null:u.globals.accumulated],"+":[co,Wr(co),(u,F)=>{let Wt=0;for(const Xe of F)Wt+=Xe.evaluate(u);return Wt}],"*":[co,Wr(co),(u,F)=>{let Wt=1;for(const Xe of F)Wt*=Xe.evaluate(u);return Wt}],"-":{type:co,overloads:[[[co,co],(u,[F,Wt])=>F.evaluate(u)-Wt.evaluate(u)],[[co],(u,[F])=>-F.evaluate(u)]]},"/":[co,[co,co],(u,[F,Wt])=>F.evaluate(u)/Wt.evaluate(u)],"%":[co,[co,co],(u,[F,Wt])=>F.evaluate(u)%Wt.evaluate(u)],ln2:[co,[],()=>Math.LN2],pi:[co,[],()=>Math.PI],e:[co,[],()=>Math.E],"^":[co,[co,co],(u,[F,Wt])=>Math.pow(F.evaluate(u),Wt.evaluate(u))],sqrt:[co,[co],(u,[F])=>Math.sqrt(F.evaluate(u))],log10:[co,[co],(u,[F])=>Math.log(F.evaluate(u))/Math.LN10],ln:[co,[co],(u,[F])=>Math.log(F.evaluate(u))],log2:[co,[co],(u,[F])=>Math.log(F.evaluate(u))/Math.LN2],sin:[co,[co],(u,[F])=>Math.sin(F.evaluate(u))],cos:[co,[co],(u,[F])=>Math.cos(F.evaluate(u))],tan:[co,[co],(u,[F])=>Math.tan(F.evaluate(u))],asin:[co,[co],(u,[F])=>Math.asin(F.evaluate(u))],acos:[co,[co],(u,[F])=>Math.acos(F.evaluate(u))],atan:[co,[co],(u,[F])=>Math.atan(F.evaluate(u))],min:[co,Wr(co),(u,F)=>Math.min(...F.map((F=>F.evaluate(u))))],max:[co,Wr(co),(u,F)=>Math.max(...F.map((F=>F.evaluate(u))))],abs:[co,[co],(u,[F])=>Math.abs(F.evaluate(u))],round:[co,[co],(u,[F])=>{const Wt=F.evaluate(u);return Wt<0?-Math.round(-Wt):Math.round(Wt)}],floor:[co,[co],(u,[F])=>Math.floor(F.evaluate(u))],ceil:[co,[co],(u,[F])=>Math.ceil(F.evaluate(u))],"filter-==":[go,[ho,ko],(u,[F,Wt])=>u.properties()[F.value]===Wt.value],"filter-id-==":[go,[ko],(u,[F])=>u.id()===F.value],"filter-type-==":[go,[ho],(u,[F])=>u.geometryType()===F.value],"filter-<":[go,[ho,ko],(u,[F,Wt])=>{const Xe=u.properties()[F.value],Vi=Wt.value;return typeof Xe==typeof Vi&&Xe<Vi}],"filter-id-<":[go,[ko],(u,[F])=>{const Wt=u.id(),Xe=F.value;return typeof Wt==typeof Xe&&Wt<Xe}],"filter->":[go,[ho,ko],(u,[F,Wt])=>{const Xe=u.properties()[F.value],Vi=Wt.value;return typeof Xe==typeof Vi&&Xe>Vi}],"filter-id->":[go,[ko],(u,[F])=>{const Wt=u.id(),Xe=F.value;return typeof Wt==typeof Xe&&Wt>Xe}],"filter-<=":[go,[ho,ko],(u,[F,Wt])=>{const Xe=u.properties()[F.value],Vi=Wt.value;return typeof Xe==typeof Vi&&Xe<=Vi}],"filter-id-<=":[go,[ko],(u,[F])=>{const Wt=u.id(),Xe=F.value;return typeof Wt==typeof Xe&&Wt<=Xe}],"filter->=":[go,[ho,ko],(u,[F,Wt])=>{const Xe=u.properties()[F.value],Vi=Wt.value;return typeof Xe==typeof Vi&&Xe>=Vi}],"filter-id->=":[go,[ko],(u,[F])=>{const Wt=u.id(),Xe=F.value;return typeof Wt==typeof Xe&&Wt>=Xe}],"filter-has":[go,[ko],(u,[F])=>F.value in u.properties()],"filter-has-id":[go,[],u=>null!==u.id()&&void 0!==u.id()],"filter-type-in":[go,[bt(ho)],(u,[F])=>F.value.indexOf(u.geometryType())>=0],"filter-id-in":[go,[bt(ko)],(u,[F])=>F.value.indexOf(u.id())>=0],"filter-in-small":[go,[ho,bt(ko)],(u,[F,Wt])=>Wt.value.indexOf(u.properties()[F.value])>=0],"filter-in-large":[go,[ho,bt(ko)],(u,[F,Wt])=>function(u,F,Wt,Xe){for(;Wt<=Xe;){const Vi=Wt+Xe>>1;if(F[Vi]===u)return!0;F[Vi]>u?Xe=Vi-1:Wt=Vi+1}return!1}(u.properties()[F.value],Wt.value,0,Wt.value.length-1)],all:{type:go,overloads:[[[go,go],(u,[F,Wt])=>F.evaluate(u)&&Wt.evaluate(u)],[Wr(go),(u,F)=>{for(const Wt of F)if(!Wt.evaluate(u))return!1;return!0}]]},any:{type:go,overloads:[[[go,go],(u,[F,Wt])=>F.evaluate(u)||Wt.evaluate(u)],[Wr(go),(u,F)=>{for(const Wt of F)if(Wt.evaluate(u))return!0;return!1}]]},"!":[go,[go],(u,[F])=>!F.evaluate(u)],"is-supported-script":[go,[ho],(u,[F])=>{const Wt=u.globals&&u.globals.isSupportedScript;return!Wt||Wt(F.evaluate(u))}],upcase:[ho,[ho],(u,[F])=>F.evaluate(u).toUpperCase()],downcase:[ho,[ho],(u,[F])=>F.evaluate(u).toLowerCase()],concat:[ho,Wr(ko),(u,F)=>F.map((F=>ie(F.evaluate(u)))).join("")],"resolved-locale":[ho,[Co],(u,[F])=>F.evaluate(u).resolvedLocale()]});class xn{constructor(u,F){var Wt;this.expression=u,this._warningHistory={},this._evaluator=new pe,this._defaultValue=F?"color"===(Wt=F).type&&cn(Wt.default)?new Kt(0,0,0,0):"color"===Wt.type?Kt.parse(Wt.default)||null:"padding"===Wt.type?Jt.parse(Wt.default)||null:"variableAnchorOffsetCollection"===Wt.type?Qt.parse(Wt.default)||null:void 0===Wt.default?null:Wt.default:null,this._enumValues=F&&"enum"===F.type?F.values:null}evaluateWithoutErrorHandling(u,F,Wt,Xe,Vi,fr){return this._evaluator.globals=u,this._evaluator.feature=F,this._evaluator.featureState=Wt,this._evaluator.canonical=Xe,this._evaluator.availableImages=Vi||null,this._evaluator.formattedSection=fr,this.expression.evaluate(this._evaluator)}evaluate(u,F,Wt,Xe,Vi,fr){this._evaluator.globals=u,this._evaluator.feature=F||null,this._evaluator.featureState=Wt||null,this._evaluator.canonical=Xe,this._evaluator.availableImages=Vi||null,this._evaluator.formattedSection=fr||null;try{const u=this.expression.evaluate(this._evaluator);if(null==u||"number"==typeof u&&u!=u)return this._defaultValue;if(this._enumValues&&!(u in this._enumValues))throw new ae(`Expected value to be one of ${Object.keys(this._enumValues).map((u=>JSON.stringify(u))).join(", ")}, but found ${JSON.stringify(u)} instead.`);return u}catch(u){return this._warningHistory[u.message]||(this._warningHistory[u.message]=!0,"undefined"!=typeof console&&console.warn(u.message)),this._defaultValue}}}function vn(u){return Array.isArray(u)&&u.length>0&&"string"==typeof u[0]&&u[0]in ic}function bn(u,F){const Wt=new fe(ic,Qr,[],F?function(u){const F={color:xo,string:ho,number:co,enum:ho,boolean:go,formatted:zo,padding:Bo,resolvedImage:al,variableAnchorOffsetCollection:ol};return"array"===u.type?bt(F[u.value]||ko,u.length):F[u.type]}(F):void 0),Xe=Wt.parse(u,void 0,void 0,void 0,F&&"string"===F.type?{typeAnnotation:"coerce"}:void 0);return Xe?nn(new xn(Xe,F)):sn(Wt.errors)}class wn{constructor(u,F){this.kind=u,this._styleExpression=F,this.isStateDependent="constant"!==u&&!en(F.expression)}evaluateWithoutErrorHandling(u,F,Wt,Xe,Vi,fr){return this._styleExpression.evaluateWithoutErrorHandling(u,F,Wt,Xe,Vi,fr)}evaluate(u,F,Wt,Xe,Vi,fr){return this._styleExpression.evaluate(u,F,Wt,Xe,Vi,fr)}}class _n{constructor(u,F,Wt,Xe){this.kind=u,this.zoomStops=Wt,this._styleExpression=F,this.isStateDependent="camera"!==u&&!en(F.expression),this.interpolationType=Xe}evaluateWithoutErrorHandling(u,F,Wt,Xe,Vi,fr){return this._styleExpression.evaluateWithoutErrorHandling(u,F,Wt,Xe,Vi,fr)}evaluate(u,F,Wt,Xe,Vi,fr){return this._styleExpression.evaluate(u,F,Wt,Xe,Vi,fr)}interpolationFactor(u,F,Wt){return this.interpolationType?Be.interpolationFactor(this.interpolationType,u,F,Wt):0}}function An(u,F){const Wt=bn(u,F);if("error"===Wt.result)return Wt;const Xe=Wt.value.expression,Vi=tn(Xe);if(!Vi&&!an(F))return sn([new at("","data expressions not supported")]);const fr=rn(Xe,["zoom"]);if(!fr&&!on(F))return sn([new at("","zoom expressions not supported")]);const _r=kn(Xe);return _r||fr?_r instanceof at?sn([_r]):_r instanceof Be&&!ln(F)?sn([new at("",'"interpolate" expressions cannot be used with this property')]):nn(_r?new _n(Vi?"camera":"composite",Wt.value,_r.labels,_r instanceof Be?_r.interpolation:void 0):new wn(Vi?"constant":"source",Wt.value)):sn([new at("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Sn{constructor(u,F){this._parameters=u,this._specification=F,st(this,pn(this._parameters,this._specification))}static deserialize(u){return new Sn(u._parameters,u._specification)}static serialize(u){return{_parameters:u._parameters,_specification:u._specification}}}function kn(u){let F=null;if(u instanceof de)F=kn(u.result);else if(u instanceof Ee){for(const Wt of u.args)if(F=kn(Wt),F)break}else(u instanceof Ae||u instanceof Be)&&u.input instanceof Xr&&"zoom"===u.input.name&&(F=u);return F instanceof at||u.eachChild((u=>{const Wt=kn(u);Wt instanceof at?F=Wt:!F&&Wt?F=new at("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):F&&Wt&&F!==Wt&&(F=new at("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),F}function Mn(u){if(!0===u||!1===u)return!0;if(!Array.isArray(u)||0===u.length)return!1;switch(u[0]){case"has":return u.length>=2&&"$id"!==u[1]&&"$type"!==u[1];case"in":return u.length>=3&&("string"!=typeof u[1]||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==u.length||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const F of u.slice(1))if(!Mn(F)&&"boolean"!=typeof F)return!1;return!0;default:return!0}}const rc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function zn(u){if(null==u)return{filter:()=>!0,needGeometry:!1};Mn(u)||(u=Bn(u));const F=bn(u,rc);if("error"===F.result)throw new Error(F.value.map((u=>`${u.key}: ${u.message}`)).join(", "));return{filter:(u,Wt,Xe)=>F.value.evaluate(u,Wt,{},Xe),needGeometry:Cn(u)}}function Pn(u,F){return u<F?-1:u>F?1:0}function Cn(u){if(!Array.isArray(u))return!1;if("within"===u[0]||"distance"===u[0])return!0;for(let F=1;F<u.length;F++)if(Cn(u[F]))return!0;return!1}function Bn(u){if(!u)return!0;const F=u[0];return u.length<=1?"any"!==F:"=="===F?Vn(u[1],u[2],"=="):"!="===F?Tn(Vn(u[1],u[2],"==")):"<"===F||">"===F||"<="===F||">="===F?Vn(u[1],u[2],F):"any"===F?(Wt=u.slice(1),["any"].concat(Wt.map(Bn))):"all"===F?["all"].concat(u.slice(1).map(Bn)):"none"===F?["all"].concat(u.slice(1).map(Bn).map(Tn)):"in"===F?En(u[1],u.slice(2)):"!in"===F?Tn(En(u[1],u.slice(2))):"has"===F?Fn(u[1]):"!has"!==F||Tn(Fn(u[1]));var Wt}function Vn(u,F,Wt){switch(u){case"$type":return[`filter-type-${Wt}`,F];case"$id":return[`filter-id-${Wt}`,F];default:return[`filter-${Wt}`,u,F]}}function En(u,F){if(0===F.length)return!1;switch(u){case"$type":return["filter-type-in",["literal",F]];case"$id":return["filter-id-in",["literal",F]];default:return F.length>200&&!F.some((u=>typeof u!=typeof F[0]))?["filter-in-large",u,["literal",F.sort(Pn)]]:["filter-in-small",u,["literal",F]]}}function Fn(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Tn(u){return["!",u]}function $n(u){const F=typeof u;if("number"===F||"boolean"===F||"string"===F||null==u)return JSON.stringify(u);if(Array.isArray(u)){let F="[";for(const Wt of u)F+=`${$n(Wt)},`;return`${F}]`}const Wt=Object.keys(u).sort();let Xe="{";for(let F=0;F<Wt.length;F++)Xe+=`${JSON.stringify(Wt[F])}:${$n(u[Wt[F]])},`;return`${Xe}}`}function Ln(u){let F="";for(const Wt of ao)F+=`/${$n(u[Wt])}`;return F}function Dn(u){const F=u.value;return F?[new it(u.key,F,"constants have been deprecated as of v8")]:[]}function On(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function jn(u){if(Array.isArray(u))return u.map(jn);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const F={};for(const Wt in u)F[Wt]=jn(u[Wt]);return F}return On(u)}function Rn(u){const F=u.key,Wt=u.value,Xe=u.valueSpec||{},Vi=u.objectElementValidators||{},fr=u.style,_r=u.styleSpec,wr=u.validateSpec;let Ar=[];const Kr=un(Wt);if("object"!==Kr)return[new it(F,Wt,`object expected, ${Kr} found`)];for(const u in Wt){const Kr=u.split(".")[0],In=Xe[Kr]||Xe["*"];let ns;if(Vi[Kr])ns=Vi[Kr];else if(Xe[Kr])ns=wr;else if(Vi["*"])ns=Vi["*"];else{if(!Xe["*"]){Ar.push(new it(F,Wt[u],`unknown property "${u}"`));continue}ns=wr}Ar=Ar.concat(ns({key:(F?`${F}.`:F)+u,value:Wt[u],valueSpec:In,style:fr,styleSpec:_r,object:Wt,objectKey:u,validateSpec:wr},Wt))}for(const u in Xe)Vi[u]||Xe[u].required&&void 0===Xe[u].default&&void 0===Wt[u]&&Ar.push(new it(F,Wt,`missing required property "${u}"`));return Ar}function Un(u){const F=u.value,Wt=u.valueSpec,Xe=u.style,Vi=u.styleSpec,fr=u.key,_r=u.arrayElementValidator||u.validateSpec;if("array"!==un(F))return[new it(fr,F,`array expected, ${un(F)} found`)];if(Wt.length&&F.length!==Wt.length)return[new it(fr,F,`array length ${Wt.length} expected, length ${F.length} found`)];if(Wt["min-length"]&&F.length<Wt["min-length"])return[new it(fr,F,`array length at least ${Wt["min-length"]} expected, length ${F.length} found`)];let wr={type:Wt.value,values:Wt.values};Vi.$version<7&&(wr.function=Wt.function),"object"===un(Wt.value)&&(wr=Wt.value);let Ar=[];for(let Wt=0;Wt<F.length;Wt++)Ar=Ar.concat(_r({array:F,arrayIndex:Wt,value:F[Wt],valueSpec:wr,validateSpec:u.validateSpec,style:Xe,styleSpec:Vi,key:`${fr}[${Wt}]`}));return Ar}function qn(u){const F=u.key,Wt=u.value,Xe=u.valueSpec;let Vi=un(Wt);return"number"===Vi&&Wt!=Wt&&(Vi="NaN"),"number"!==Vi?[new it(F,Wt,`number expected, ${Vi} found`)]:"minimum"in Xe&&Wt<Xe.minimum?[new it(F,Wt,`${Wt} is less than the minimum value ${Xe.minimum}`)]:"maximum"in Xe&&Wt>Xe.maximum?[new it(F,Wt,`${Wt} is greater than the maximum value ${Xe.maximum}`)]:[]}function Nn(u){const F=u.valueSpec,Wt=On(u.value.type);let Xe,Vi,fr,_r={};const wr="categorical"!==Wt&&void 0===u.value.property,Ar=!wr,Kr="array"===un(u.value.stops)&&"array"===un(u.value.stops[0])&&"object"===un(u.value.stops[0][0]),In=Rn({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(u){if("identity"===Wt)return[new it(u.key,u.value,'identity function may not have a "stops" property')];let F=[];const Xe=u.value;return F=F.concat(Un({key:u.key,value:Xe,valueSpec:u.valueSpec,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,arrayElementValidator:h})),"array"===un(Xe)&&0===Xe.length&&F.push(new it(u.key,Xe,"array must have at least one stop")),F},default:function(u){return u.validateSpec({key:u.key,value:u.value,valueSpec:F,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec})}}});return"identity"===Wt&&wr&&In.push(new it(u.key,u.value,'missing required property "property"')),"identity"===Wt||u.value.stops||In.push(new it(u.key,u.value,'missing required property "stops"')),"exponential"===Wt&&u.valueSpec.expression&&!ln(u.valueSpec)&&In.push(new it(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(Ar&&!an(u.valueSpec)?In.push(new it(u.key,u.value,"property functions not supported")):wr&&!on(u.valueSpec)&&In.push(new it(u.key,u.value,"zoom functions not supported"))),"categorical"!==Wt&&!Kr||void 0!==u.value.property||In.push(new it(u.key,u.value,'"property" property is required')),In;function h(u){let Wt=[];const Xe=u.value,wr=u.key;if("array"!==un(Xe))return[new it(wr,Xe,`array expected, ${un(Xe)} found`)];if(2!==Xe.length)return[new it(wr,Xe,`array length 2 expected, length ${Xe.length} found`)];if(Kr){if("object"!==un(Xe[0]))return[new it(wr,Xe,`object expected, ${un(Xe[0])} found`)];if(void 0===Xe[0].zoom)return[new it(wr,Xe,"object stop key must have zoom")];if(void 0===Xe[0].value)return[new it(wr,Xe,"object stop key must have value")];if(fr&&fr>On(Xe[0].zoom))return[new it(wr,Xe[0].zoom,"stop zoom values must appear in ascending order")];On(Xe[0].zoom)!==fr&&(fr=On(Xe[0].zoom),Vi=void 0,_r={}),Wt=Wt.concat(Rn({key:`${wr}[0]`,value:Xe[0],valueSpec:{zoom:{}},validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{zoom:qn,value:p}}))}else Wt=Wt.concat(p({key:`${wr}[0]`,value:Xe[0],valueSpec:{},validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec},Xe));return vn(jn(Xe[1]))?Wt.concat([new it(`${wr}[1]`,Xe[1],"expressions are not allowed in function stops.")]):Wt.concat(u.validateSpec({key:`${wr}[1]`,value:Xe[1],valueSpec:F,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec}))}function p(u,fr){const wr=un(u.value),Ar=On(u.value),Kr=null!==u.value?u.value:fr;if(Xe){if(wr!==Xe)return[new it(u.key,Kr,`${wr} stop domain type must match previous stop domain type ${Xe}`)]}else Xe=wr;if("number"!==wr&&"string"!==wr&&"boolean"!==wr)return[new it(u.key,Kr,"stop domain value must be a number, string, or boolean")];if("number"!==wr&&"categorical"!==Wt){let Xe=`number expected, ${wr} found`;return an(F)&&void 0===Wt&&(Xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new it(u.key,Kr,Xe)]}return"categorical"!==Wt||"number"!==wr||isFinite(Ar)&&Math.floor(Ar)===Ar?"categorical"!==Wt&&"number"===wr&&void 0!==Vi&&Ar<Vi?[new it(u.key,Kr,"stop domain values must appear in ascending order")]:(Vi=Ar,"categorical"===Wt&&Ar in _r?[new it(u.key,Kr,"stop domain values must be unique")]:(_r[Ar]=!0,[])):[new it(u.key,Kr,`integer expected, found ${Ar}`)]}}function Zn(u){const F=("property"===u.expressionContext?An:bn)(jn(u.value),u.valueSpec);if("error"===F.result)return F.value.map((F=>new it(`${u.key}${F.key}`,u.value,F.message)));const Wt=F.value.expression||F.value._styleExpression.expression;if("property"===u.expressionContext&&"text-font"===u.propertyKey&&!Wt.outputDefined())return[new it(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===u.expressionContext&&"layout"===u.propertyType&&!en(Wt))return[new it(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===u.expressionContext&&!en(Wt))return[new it(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&0===u.expressionContext.indexOf("cluster")){if(!rn(Wt,["zoom","feature-state"]))return[new it(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===u.expressionContext&&!tn(Wt))return[new it(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Gn(u){const F=u.key,Wt=u.value,Xe=u.valueSpec,Vi=[];return Array.isArray(Xe.values)?-1===Xe.values.indexOf(On(Wt))&&Vi.push(new it(F,Wt,`expected one of [${Xe.values.join(", ")}], ${JSON.stringify(Wt)} found`)):-1===Object.keys(Xe.values).indexOf(On(Wt))&&Vi.push(new it(F,Wt,`expected one of [${Object.keys(Xe.values).join(", ")}], ${JSON.stringify(Wt)} found`)),Vi}function Kn(u){return Mn(jn(u.value))?Zn(st({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Xn(u)}function Xn(u){const F=u.value,Wt=u.key;if("array"!==un(F))return[new it(Wt,F,`array expected, ${un(F)} found`)];const Xe=u.styleSpec;let Vi,fr=[];if(F.length<1)return[new it(Wt,F,"filter array must have at least 1 element")];switch(fr=fr.concat(Gn({key:`${Wt}[0]`,value:F[0],valueSpec:Xe.filter_operator,style:u.style,styleSpec:u.styleSpec})),On(F[0])){case"<":case"<=":case">":case">=":F.length>=2&&"$type"===On(F[1])&&fr.push(new it(Wt,F,`"$type" cannot be use with operator "${F[0]}"`));case"==":case"!=":3!==F.length&&fr.push(new it(Wt,F,`filter array for operator "${F[0]}" must have 3 elements`));case"in":case"!in":F.length>=2&&(Vi=un(F[1]),"string"!==Vi&&fr.push(new it(`${Wt}[1]`,F[1],`string expected, ${Vi} found`)));for(let _r=2;_r<F.length;_r++)Vi=un(F[_r]),"$type"===On(F[1])?fr=fr.concat(Gn({key:`${Wt}[${_r}]`,value:F[_r],valueSpec:Xe.geometry_type,style:u.style,styleSpec:u.styleSpec})):"string"!==Vi&&"number"!==Vi&&"boolean"!==Vi&&fr.push(new it(`${Wt}[${_r}]`,F[_r],`string, number, or boolean expected, ${Vi} found`));break;case"any":case"all":case"none":for(let Xe=1;Xe<F.length;Xe++)fr=fr.concat(Xn({key:`${Wt}[${Xe}]`,value:F[Xe],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":Vi=un(F[1]),2!==F.length?fr.push(new it(Wt,F,`filter array for "${F[0]}" operator must have 2 elements`)):"string"!==Vi&&fr.push(new it(`${Wt}[1]`,F[1],`string expected, ${Vi} found`))}return fr}function Hn(u,F){const Wt=u.key,Xe=u.validateSpec,Vi=u.style,fr=u.styleSpec,_r=u.value,wr=u.objectKey,Ar=fr[`${F}_${u.layerType}`];if(!Ar)return[];const Kr=wr.match(/^(.*)-transition$/);if("paint"===F&&Kr&&Ar[Kr[1]]&&Ar[Kr[1]].transition)return Xe({key:Wt,value:_r,valueSpec:fr.transition,style:Vi,styleSpec:fr});const In=u.valueSpec||Ar[wr];if(!In)return[new it(Wt,_r,`unknown property "${wr}"`)];let ns;if("string"===un(_r)&&an(In)&&!In.tokens&&(ns=/^{([^}]+)}$/.exec(_r)))return[new it(Wt,_r,`"${wr}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(ns[1])} }\`.`)];const ca=[];return"symbol"===u.layerType&&("text-field"===wr&&Vi&&!Vi.glyphs&&ca.push(new it(Wt,_r,'use of "text-field" requires a style "glyphs" property')),"text-font"===wr&&cn(jn(_r))&&"identity"===On(_r.type)&&ca.push(new it(Wt,_r,'"text-font" does not support identity functions'))),ca.concat(Xe({key:u.key,value:_r,valueSpec:In,style:Vi,styleSpec:fr,expressionContext:"property",propertyType:F,propertyKey:wr}))}function Yn(u){return Hn(u,"paint")}function Jn(u){return Hn(u,"layout")}function Wn(u){let F=[];const Wt=u.value,Xe=u.key,Vi=u.style,fr=u.styleSpec;Wt.type||Wt.ref||F.push(new it(Xe,Wt,'either "type" or "ref" is required'));let _r=On(Wt.type);const wr=On(Wt.ref);if(Wt.id){const fr=On(Wt.id);for(let _r=0;_r<u.arrayIndex;_r++){const u=Vi.layers[_r];On(u.id)===fr&&F.push(new it(Xe,Wt.id,`duplicate layer id "${Wt.id}", previously used at line ${u.id.__line__}`))}}if("ref"in Wt){let u;["type","source","source-layer","filter","layout"].forEach((u=>{u in Wt&&F.push(new it(Xe,Wt[u],`"${u}" is prohibited for ref layers`))})),Vi.layers.forEach((F=>{On(F.id)===wr&&(u=F)})),u?u.ref?F.push(new it(Xe,Wt.ref,"ref cannot reference another ref layer")):_r=On(u.type):F.push(new it(Xe,Wt.ref,`ref layer "${wr}" not found`))}else if("background"!==_r)if(Wt.source){const u=Vi.sources&&Vi.sources[Wt.source],fr=u&&On(u.type);u?"vector"===fr&&"raster"===_r?F.push(new it(Xe,Wt.source,`layer "${Wt.id}" requires a raster source`)):"raster-dem"!==fr&&"hillshade"===_r?F.push(new it(Xe,Wt.source,`layer "${Wt.id}" requires a raster-dem source`)):"raster"===fr&&"raster"!==_r?F.push(new it(Xe,Wt.source,`layer "${Wt.id}" requires a vector source`)):"vector"!==fr||Wt["source-layer"]?"raster-dem"===fr&&"hillshade"!==_r?F.push(new it(Xe,Wt.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_r||!Wt.paint||!Wt.paint["line-gradient"]||"geojson"===fr&&u.lineMetrics||F.push(new it(Xe,Wt,`layer "${Wt.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):F.push(new it(Xe,Wt,`layer "${Wt.id}" must specify a "source-layer"`)):F.push(new it(Xe,Wt.source,`source "${Wt.source}" not found`))}else F.push(new it(Xe,Wt,'missing required property "source"'));return F=F.concat(Rn({key:Xe,value:Wt,valueSpec:fr.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${Xe}.type`,value:Wt.type,valueSpec:fr.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:Wt,objectKey:"type"}),filter:Kn,layout:u=>Rn({layer:Wt,key:u.key,value:u.value,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":u=>Jn(st({layerType:_r},u))}}),paint:u=>Rn({layer:Wt,key:u.key,value:u.value,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":u=>Yn(st({layerType:_r},u))}})}})),F}function Qn(u){const F=u.value,Wt=u.key,Xe=un(F);return"string"!==Xe?[new it(Wt,F,`string expected, ${Xe} found`)]:[]}const nc={promoteId:function({key:u,value:F}){if("string"===un(F))return Qn({key:u,value:F});{const Wt=[];for(const Xe in F)Wt.push(...Qn({key:`${u}.${Xe}`,value:F[Xe]}));return Wt}}};function ei(u){const F=u.value,Wt=u.key,Xe=u.styleSpec,Vi=u.style,fr=u.validateSpec;if(!F.type)return[new it(Wt,F,'"type" is required')];const _r=On(F.type);let wr;switch(_r){case"vector":case"raster":return wr=Rn({key:Wt,value:F,valueSpec:Xe[`source_${_r.replace("-","_")}`],style:u.style,styleSpec:Xe,objectElementValidators:nc,validateSpec:fr}),wr;case"raster-dem":return wr=function(u){var F;const Wt=null!==(F=u.sourceName)&&void 0!==F?F:"",Xe=u.value,Vi=u.styleSpec,fr=Vi.source_raster_dem,_r=u.style;let wr=[];const Ar=un(Xe);if(void 0===Xe)return wr;if("object"!==Ar)return wr.push(new it("source_raster_dem",Xe,`object expected, ${Ar} found`)),wr;const Kr="custom"===On(Xe.encoding),In=["redFactor","greenFactor","blueFactor","baseShift"],ns=u.value.encoding?`"${u.value.encoding}"`:"Default";for(const F in Xe)!Kr&&In.includes(F)?wr.push(new it(F,Xe[F],`In "${Wt}": "${F}" is only valid when "encoding" is set to "custom". ${ns} encoding found`)):fr[F]?wr=wr.concat(u.validateSpec({key:F,value:Xe[F],valueSpec:fr[F],validateSpec:u.validateSpec,style:_r,styleSpec:Vi})):wr.push(new it(F,Xe[F],`unknown property "${F}"`));return wr}({sourceName:Wt,value:F,style:u.style,styleSpec:Xe,validateSpec:fr}),wr;case"geojson":if(wr=Rn({key:Wt,value:F,valueSpec:Xe.source_geojson,style:Vi,styleSpec:Xe,validateSpec:fr,objectElementValidators:nc}),F.cluster)for(const u in F.clusterProperties){const[Xe,Vi]=F.clusterProperties[u],_r="string"==typeof Xe?[Xe,["accumulated"],["get",u]]:Xe;wr.push(...Zn({key:`${Wt}.${u}.map`,value:Vi,validateSpec:fr,expressionContext:"cluster-map"})),wr.push(...Zn({key:`${Wt}.${u}.reduce`,value:_r,validateSpec:fr,expressionContext:"cluster-reduce"}))}return wr;case"video":return Rn({key:Wt,value:F,valueSpec:Xe.source_video,style:Vi,validateSpec:fr,styleSpec:Xe});case"image":return Rn({key:Wt,value:F,valueSpec:Xe.source_image,style:Vi,validateSpec:fr,styleSpec:Xe});case"canvas":return[new it(Wt,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gn({key:`${Wt}.type`,value:F.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:Vi,validateSpec:fr,styleSpec:Xe})}}function ri(u){const F=u.value,Wt=u.styleSpec,Xe=Wt.light,Vi=u.style;let fr=[];const _r=un(F);if(void 0===F)return fr;if("object"!==_r)return fr=fr.concat([new it("light",F,`object expected, ${_r} found`)]),fr;for(const _r in F){const wr=_r.match(/^(.*)-transition$/);fr=fr.concat(wr&&Xe[wr[1]]&&Xe[wr[1]].transition?u.validateSpec({key:_r,value:F[_r],valueSpec:Wt.transition,validateSpec:u.validateSpec,style:Vi,styleSpec:Wt}):Xe[_r]?u.validateSpec({key:_r,value:F[_r],valueSpec:Xe[_r],validateSpec:u.validateSpec,style:Vi,styleSpec:Wt}):[new it(_r,F[_r],`unknown property "${_r}"`)])}return fr}function ni(u){const F=u.value,Wt=u.styleSpec,Xe=Wt.sky,Vi=u.style,fr=un(F);if(void 0===F)return[];if("object"!==fr)return[new it("sky",F,`object expected, ${fr} found`)];let _r=[];for(const fr in F)_r=_r.concat(Xe[fr]?u.validateSpec({key:fr,value:F[fr],valueSpec:Xe[fr],style:Vi,styleSpec:Wt}):[new it(fr,F[fr],`unknown property "${fr}"`)]);return _r}function ii(u){const F=u.value,Wt=u.styleSpec,Xe=Wt.terrain,Vi=u.style;let fr=[];const _r=un(F);if(void 0===F)return fr;if("object"!==_r)return fr=fr.concat([new it("terrain",F,`object expected, ${_r} found`)]),fr;for(const _r in F)fr=fr.concat(Xe[_r]?u.validateSpec({key:_r,value:F[_r],valueSpec:Xe[_r],validateSpec:u.validateSpec,style:Vi,styleSpec:Wt}):[new it(_r,F[_r],`unknown property "${_r}"`)]);return fr}function si(u){let F=[];const Wt=u.value,Xe=u.key;if(Array.isArray(Wt)){const Vi=[],fr=[];for(const _r in Wt)Wt[_r].id&&Vi.includes(Wt[_r].id)&&F.push(new it(Xe,Wt,`all the sprites' ids must be unique, but ${Wt[_r].id} is duplicated`)),Vi.push(Wt[_r].id),Wt[_r].url&&fr.includes(Wt[_r].url)&&F.push(new it(Xe,Wt,`all the sprites' URLs must be unique, but ${Wt[_r].url} is duplicated`)),fr.push(Wt[_r].url),F=F.concat(Rn({key:`${Xe}[${_r}]`,value:Wt[_r],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return F}return Qn({key:Xe,value:Wt})}const oc={"*":()=>[],array:Un,boolean:function(u){const F=u.value,Wt=u.key,Xe=un(F);return"boolean"!==Xe?[new it(Wt,F,`boolean expected, ${Xe} found`)]:[]},number:qn,color:function(u){const F=u.key,Wt=u.value,Xe=un(Wt);return"string"!==Xe?[new it(F,Wt,`color expected, ${Xe} found`)]:Kt.parse(String(Wt))?[]:[new it(F,Wt,`color expected, "${Wt}" found`)]},constants:Dn,enum:Gn,filter:Kn,function:Nn,layer:Wn,object:Rn,source:ei,light:ri,sky:ni,terrain:ii,projection:function(u){const F=u.value,Wt=u.styleSpec,Xe=Wt.projection,Vi=u.style,fr=un(F);if(void 0===F)return[];if("object"!==fr)return[new it("projection",F,`object expected, ${fr} found`)];let _r=[];for(const fr in F)_r=_r.concat(Xe[fr]?u.validateSpec({key:fr,value:F[fr],valueSpec:Xe[fr],style:Vi,styleSpec:Wt}):[new it(fr,F[fr],`unknown property "${fr}"`)]);return _r},string:Qn,formatted:function(u){return 0===Qn(u).length?[]:Zn(u)},resolvedImage:function(u){return 0===Qn(u).length?[]:Zn(u)},padding:function(u){const F=u.key,Wt=u.value;if("array"===un(Wt)){if(Wt.length<1||Wt.length>4)return[new it(F,Wt,`padding requires 1 to 4 values; ${Wt.length} values found`)];const Xe={type:"number"};let Vi=[];for(let fr=0;fr<Wt.length;fr++)Vi=Vi.concat(u.validateSpec({key:`${F}[${fr}]`,value:Wt[fr],validateSpec:u.validateSpec,valueSpec:Xe}));return Vi}return qn({key:F,value:Wt,valueSpec:{}})},variableAnchorOffsetCollection:function(u){const F=u.key,Wt=u.value,Xe=un(Wt),Vi=u.styleSpec;if("array"!==Xe||Wt.length<1||Wt.length%2!=0)return[new it(F,Wt,"variableAnchorOffsetCollection requires a non-empty array of even length")];let fr=[];for(let Xe=0;Xe<Wt.length;Xe+=2)fr=fr.concat(Gn({key:`${F}[${Xe}]`,value:Wt[Xe],valueSpec:Vi.layout_symbol["text-anchor"]})),fr=fr.concat(Un({key:`${F}[${Xe+1}]`,value:Wt[Xe+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:Vi}));return fr},sprite:si};function oi(u){const F=u.value,Wt=u.valueSpec,Xe=u.styleSpec;return u.validateSpec=oi,Wt.expression&&cn(On(F))?Nn(u):Wt.expression&&vn(jn(F))?Zn(u):Wt.type&&oc[Wt.type]?oc[Wt.type](u):Rn(st({},u,{valueSpec:Wt.type?Xe[Wt.type]:Wt}))}function li(u){const F=u.value,Wt=u.key,Xe=Qn(u);return Xe.length||(-1===F.indexOf("{fontstack}")&&Xe.push(new it(Wt,F,'"glyphs" url must include a "{fontstack}" token')),-1===F.indexOf("{range}")&&Xe.push(new it(Wt,F,'"glyphs" url must include a "{range}" token'))),Xe}function ui(u,F=so){let Wt=[];return Wt=Wt.concat(oi({key:"",value:u,valueSpec:F.$root,styleSpec:F,style:u,validateSpec:oi,objectElementValidators:{glyphs:li,"*":()=>[]}})),u.constants&&(Wt=Wt.concat(Dn({key:"constants",value:u.constants,style:u,styleSpec:F,validateSpec:oi}))),hi(Wt)}function ci(u){return function(F){return u({...F,validateSpec:oi})}}function hi(u){return[].concat(u).sort(((u,F)=>u.line-F.line))}function pi(F){return function(...Wt){return hi(F.apply(this||u,Wt))}}ui.source=pi(ci(ei)),ui.sprite=pi(ci(si)),ui.glyphs=pi(ci(li)),ui.light=pi(ci(ri)),ui.sky=pi(ci(ni)),ui.terrain=pi(ci(ii)),ui.layer=pi(ci(Wn)),ui.filter=pi(ci(Kn)),ui.paintProperty=pi(ci(Yn)),ui.layoutProperty=pi(ci(Jn));const lc=ui,mc=lc.light,gc=lc.sky,yc=lc.paintProperty,bc=lc.layoutProperty;function xi(u,F){let Wt=!1;if(F&&F.length)for(const Xe of F)u.fire(new N(new Error(Xe.message))),Wt=!0;return Wt}class vi{constructor(u,F,Wt){const Xe=this.cells=[];if(u instanceof ArrayBuffer){this.arrayBuffer=u;const Vi=new Int32Array(this.arrayBuffer);u=Vi[0],this.d=(F=Vi[1])+2*(Wt=Vi[2]);for(let u=0;u<this.d*this.d;u++){const F=Vi[3+u],Wt=Vi[3+u+1];Xe.push(F===Wt?null:Vi.subarray(F,Wt))}const fr=Vi[3+Xe.length+1];this.keys=Vi.subarray(Vi[3+Xe.length],fr),this.bboxes=Vi.subarray(fr),this.insert=this._insertReadonly}else{this.d=F+2*Wt;for(let u=0;u<this.d*this.d;u++)Xe.push([]);this.keys=[],this.bboxes=[]}this.n=F,this.extent=u,this.padding=Wt,this.scale=F/u,this.uid=0;const Vi=Wt/F*u;this.min=-Vi,this.max=u+Vi}insert(u,F,Wt,Xe,Vi){this._forEachCell(F,Wt,Xe,Vi,this._insertCell,this.uid++,void 0,void 0),this.keys.push(u),this.bboxes.push(F),this.bboxes.push(Wt),this.bboxes.push(Xe),this.bboxes.push(Vi)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(u,F,Wt,Xe,Vi,fr){this.cells[Vi].push(fr)}query(u,F,Wt,Xe,Vi){const fr=this.min,_r=this.max;if(u<=fr&&F<=fr&&_r<=Wt&&_r<=Xe&&!Vi)return Array.prototype.slice.call(this.keys);{const fr=[];return this._forEachCell(u,F,Wt,Xe,this._queryCell,fr,{},Vi),fr}}_queryCell(u,F,Wt,Xe,Vi,fr,_r,wr){const Ar=this.cells[Vi];if(null!==Ar){const Vi=this.keys,Kr=this.bboxes;for(let In=0;In<Ar.length;In++){const ns=Ar[In];if(void 0===_r[ns]){const Ar=4*ns;(wr?wr(Kr[Ar+0],Kr[Ar+1],Kr[Ar+2],Kr[Ar+3]):u<=Kr[Ar+2]&&F<=Kr[Ar+3]&&Wt>=Kr[Ar+0]&&Xe>=Kr[Ar+1])?(_r[ns]=!0,fr.push(Vi[ns])):_r[ns]=!1}}}}_forEachCell(u,F,Wt,Xe,Vi,fr,_r,wr){const Ar=this._convertToCellCoord(u),Kr=this._convertToCellCoord(F),In=this._convertToCellCoord(Wt),ns=this._convertToCellCoord(Xe);for(let ca=Ar;ca<=In;ca++)for(let Ar=Kr;Ar<=ns;Ar++){const Kr=this.d*Ar+ca;if((!wr||wr(this._convertFromCellCoord(ca),this._convertFromCellCoord(Ar),this._convertFromCellCoord(ca+1),this._convertFromCellCoord(Ar+1)))&&Vi.call(this,u,F,Wt,Xe,Kr,fr,_r,wr))return}}_convertFromCellCoord(u){return(u-this.padding)/this.scale}_convertToCellCoord(u){return Math.max(0,Math.min(this.d-1,Math.floor(u*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const u=this.cells,F=3+this.cells.length+1+1;let Wt=0;for(let u=0;u<this.cells.length;u++)Wt+=this.cells[u].length;const Xe=new Int32Array(F+Wt+this.keys.length+this.bboxes.length);Xe[0]=this.extent,Xe[1]=this.n,Xe[2]=this.padding;let Vi=F;for(let F=0;F<u.length;F++){const Wt=u[F];Xe[3+F]=Vi,Xe.set(Wt,Vi),Vi+=Wt.length}return Xe[3+u.length]=Vi,Xe.set(this.keys,Vi),Vi+=this.keys.length,Xe[3+u.length+1]=Vi,Xe.set(this.bboxes,Vi),Vi+=this.bboxes.length,Xe.buffer}static serialize(u,F){const Wt=u.toArrayBuffer();return F&&F.push(Wt),{buffer:Wt}}static deserialize(u){return new vi(u.buffer)}}const wc={};function wi(u,F,Wt={}){if(wc[u])throw new Error(`${u} is already registered.`);Object.defineProperty(F,"_classRegistryKey",{value:u,writeable:!1}),wc[u]={klass:F,omit:Wt.omit||[],shallow:Wt.shallow||[]}}wi("Object",Object),wi("TransferableGridIndex",vi),wi("Color",Kt),wi("Error",Error),wi("AJAXError",L),wi("ResolvedImage",te),wi("StylePropertyFunction",Sn),wi("StyleExpression",xn,{omit:["_evaluator"]}),wi("ZoomDependentExpression",_n),wi("ZoomConstantExpression",wn),wi("CompoundExpression",Xr,{omit:["_evaluate"]});for(const u in ic)ic[u]._classRegistryKey||wi(`Expression_${u}`,ic[u]);function _i(u){return u&&"undefined"!=typeof ArrayBuffer&&(u instanceof ArrayBuffer||u.constructor&&"ArrayBuffer"===u.constructor.name)}function Ai(u){return u.$name||u.constructor._classRegistryKey}function Si(u){return!function(u){if(null===u||"object"!=typeof u)return!1;const F=Ai(u);return!(!F||"Object"===F)}(u)&&(null==u||"boolean"==typeof u||"number"==typeof u||"string"==typeof u||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||_i(u)||I(u)||ArrayBuffer.isView(u)||u instanceof ImageData)}function ki(u,F){if(Si(u))return(_i(u)||I(u))&&F&&F.push(u),ArrayBuffer.isView(u)&&F&&F.push(u.buffer),u instanceof ImageData&&F&&F.push(u.data.buffer),u;if(Array.isArray(u)){const Wt=[];for(const Xe of u)Wt.push(ki(Xe,F));return Wt}if("object"!=typeof u)throw new Error("can't serialize object of type "+typeof u);const Wt=Ai(u);if(!Wt)throw new Error(`can't serialize object of unregistered class ${u.constructor.name}`);if(!wc[Wt])throw new Error(`${Wt} is not registered.`);const{klass:Xe}=wc[Wt],Vi=Xe.serialize?Xe.serialize(u,F):{};if(Xe.serialize){if(F&&Vi===F[F.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const Xe in u){if(!u.hasOwnProperty(Xe))continue;if(wc[Wt].omit.indexOf(Xe)>=0)continue;const fr=u[Xe];Vi[Xe]=wc[Wt].shallow.indexOf(Xe)>=0?fr:ki(fr,F)}u instanceof Error&&(Vi.message=u.message)}if(Vi.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==Wt&&(Vi.$name=Wt),Vi}function Mi(u){if(Si(u))return u;if(Array.isArray(u))return u.map(Mi);if("object"!=typeof u)throw new Error("can't deserialize object of type "+typeof u);const F=Ai(u)||"Object";if(!wc[F])throw new Error(`can't deserialize unregistered class ${F}`);const{klass:Wt}=wc[F];if(!Wt)throw new Error(`can't deserialize unregistered class ${F}`);if(Wt.deserialize)return Wt.deserialize(u);const Xe=Object.create(Wt.prototype);for(const Wt of Object.keys(u)){if("$name"===Wt)continue;const Vi=u[Wt];Xe[Wt]=wc[F].shallow.indexOf(Wt)>=0?Vi:Mi(Vi)}return Xe}class Ii{constructor(){this.first=!0}update(u,F){const Wt=Math.floor(u);return this.first?(this.first=!1,this.lastIntegerZoom=Wt,this.lastIntegerZoomTime=0,this.lastZoom=u,this.lastFloorZoom=Wt,!0):(this.lastFloorZoom>Wt?(this.lastIntegerZoom=Wt+1,this.lastIntegerZoomTime=F):this.lastFloorZoom<Wt&&(this.lastIntegerZoom=Wt,this.lastIntegerZoomTime=F),u!==this.lastZoom&&(this.lastZoom=u,this.lastFloorZoom=Wt,!0))}}const Sc={"Latin-1 Supplement":u=>u>=128&&u<=255,"Hangul Jamo":u=>u>=4352&&u<=4607,Khmer:u=>u>=6016&&u<=6143,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Katakana:u=>u>=12448&&u<=12543,Kanbun:u=>u>=12688&&u<=12703,"CJK Strokes":u=>u>=12736&&u<=12783,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"Private Use Area":u=>u>=57344&&u<=63743,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function Pi(u){for(const F of u)if(Ti(F.charCodeAt(0)))return!0;return!1}function Ci(u){for(const F of u)if(!Ei(F.charCodeAt(0)))return!1;return!0}function Bi(u){const F=u.map((u=>{try{return new RegExp(`\\p{sc=${u}}`,"u").source}catch(u){return null}})).filter((u=>u));return new RegExp(F.join("|"),"u")}const Ac=Bi(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ei(u){return!Ac.test(String.fromCodePoint(u))}const Cc=Bi(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Ti(u){return!(746!==u&&747!==u&&(u<4352||!(Sc["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Sc["CJK Compatibility"](u)||Sc["CJK Strokes"](u)||!(!Sc["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||12336===u)||Sc["Enclosed CJK Letters and Months"](u)||Sc["Ideographic Description Characters"](u)||Sc.Kanbun(u)||Sc.Katakana(u)&&12540!==u||!(!Sc["Halfwidth and Fullwidth Forms"](u)||65288===u||65289===u||65293===u||u>=65306&&u<=65310||65339===u||65341===u||65343===u||u>=65371&&u<=65503||65507===u||u>=65512&&u<=65519)||!(!Sc["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Sc["Vertical Forms"](u)||Sc["Yijing Hexagram Symbols"](u)||/\p{sc=Cans}/u.test(String.fromCodePoint(u))||/\p{sc=Hang}/u.test(String.fromCodePoint(u))||Cc.test(String.fromCodePoint(u)))))}function $i(u){return!(Ti(u)||function(u){return!!(Sc["Latin-1 Supplement"](u)&&(167===u||169===u||174===u||177===u||188===u||189===u||190===u||215===u||247===u)||Sc["General Punctuation"](u)&&(8214===u||8224===u||8225===u||8240===u||8241===u||8251===u||8252===u||8258===u||8263===u||8264===u||8265===u||8273===u)||Sc["Letterlike Symbols"](u)||Sc["Number Forms"](u)||Sc["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||9003===u||u>=9085&&u<=9114||u>=9150&&u<=9165||9167===u||u>=9169&&u<=9179||u>=9186&&u<=9215)||Sc["Control Pictures"](u)&&9251!==u||Sc["Optical Character Recognition"](u)||Sc["Enclosed Alphanumerics"](u)||Sc["Geometric Shapes"](u)||Sc["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||Sc["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||Sc["CJK Symbols and Punctuation"](u)||Sc.Katakana(u)||Sc["Private Use Area"](u)||Sc["CJK Compatibility Forms"](u)||Sc["Small Form Variants"](u)||Sc["Halfwidth and Fullwidth Forms"](u)||8734===u||8756===u||8757===u||u>=9984&&u<=10087||u>=10102&&u<=10131||65532===u||65533===u)}(u))}const zc=Bi(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Di(u){return zc.test(String.fromCodePoint(u))}function Oi(u,F){return!(!F&&Di(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Sc.Khmer(u))}function ji(u){for(const F of u)if(Di(F.charCodeAt(0)))return!0;return!1}const ih=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ui{constructor(u,F){this.zoom=u,F?(this.now=F.now,this.fadeDuration=F.fadeDuration,this.zoomHistory=F.zoomHistory,this.transition=F.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ii,this.transition={})}isSupportedScript(u){return function(u,F){for(const Wt of u)if(!Oi(Wt.charCodeAt(0),F))return!1;return!0}(u,"loaded"===ih.getRTLTextPluginStatus())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const u=this.zoom,F=u-Math.floor(u),Wt=this.crossFadingFactor();return u>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:F+(1-F)*Wt}:{fromScale:.5,toScale:1,t:1-(1-Wt)*F}}}class qi{constructor(u,F){this.property=u,this.value=F,this.expression=function(u,F){if(cn(u))return new Sn(u,F);if(vn(u)){const Wt=An(u,F);if("error"===Wt.result)throw new Error(Wt.value.map((u=>`${u.key}: ${u.message}`)).join(", "));return Wt.value}{let Wt=u;return"color"===F.type&&"string"==typeof u?Wt=Kt.parse(u):"padding"!==F.type||"number"!=typeof u&&!Array.isArray(u)?"variableAnchorOffsetCollection"===F.type&&Array.isArray(u)&&(Wt=Qt.parse(u)):Wt=Jt.parse(u),{kind:"constant",evaluate:()=>Wt}}}(void 0===F?u.specification.default:F,u.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(u,F,Wt){return this.property.possiblyEvaluate(this,u,F,Wt)}}class Ni{constructor(u){this.property=u,this.value=new qi(u,void 0)}transitioned(u,F){return new Gi(this.property,this.value,F,g({},u.transition,this.transition),u.now)}untransitioned(){return new Gi(this.property,this.value,null,{},0)}}class Zi{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitionablePropertyValues)}getValue(u){return w(this._values[u].value.value)}setValue(u,F){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Ni(this._values[u].property)),this._values[u].value=new qi(this._values[u].property,null===F?void 0:w(F))}getTransition(u){return w(this._values[u].transition)}setTransition(u,F){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Ni(this._values[u].property)),this._values[u].transition=w(F)||void 0}serialize(){const u={};for(const F of Object.keys(this._values)){const Wt=this.getValue(F);void 0!==Wt&&(u[F]=Wt);const Xe=this.getTransition(F);void 0!==Xe&&(u[`${F}-transition`]=Xe)}return u}transitioned(u,F){const Wt=new Ki(this._properties);for(const Xe of Object.keys(this._values))Wt._values[Xe]=this._values[Xe].transitioned(u,F._values[Xe]);return Wt}untransitioned(){const u=new Ki(this._properties);for(const F of Object.keys(this._values))u._values[F]=this._values[F].untransitioned();return u}}class Gi{constructor(u,F,Wt,Xe,Vi){this.property=u,this.value=F,this.begin=Vi+Xe.delay||0,this.end=this.begin+Xe.duration||0,u.specification.transition&&(Xe.delay||Xe.duration)&&(this.prior=Wt)}possiblyEvaluate(u,F,Wt){const Xe=u.now||0,Vi=this.value.possiblyEvaluate(u,F,Wt),fr=this.prior;if(fr){if(Xe>this.end)return this.prior=null,Vi;if(this.value.isDataDriven())return this.prior=null,Vi;if(Xe<this.begin)return fr.possiblyEvaluate(u,F,Wt);{const _r=(Xe-this.begin)/(this.end-this.begin);return this.property.interpolate(fr.possiblyEvaluate(u,F,Wt),Vi,function(u){if(u<=0)return 0;if(u>=1)return 1;const F=u*u,Wt=F*u;return 4*(u<.5?Wt:3*(u-F)+Wt-.75)}(_r))}}return Vi}}class Ki{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitioningPropertyValues)}possiblyEvaluate(u,F,Wt){const Xe=new Yi(this._properties);for(const Vi of Object.keys(this._values))Xe._values[Vi]=this._values[Vi].possiblyEvaluate(u,F,Wt);return Xe}hasTransition(){for(const u of Object.keys(this._values))if(this._values[u].prior)return!0;return!1}}class Xi{constructor(u){this._properties=u,this._values=Object.create(u.defaultPropertyValues)}hasValue(u){return void 0!==this._values[u].value}getValue(u){return w(this._values[u].value)}setValue(u,F){this._values[u]=new qi(this._values[u].property,null===F?void 0:w(F))}serialize(){const u={};for(const F of Object.keys(this._values)){const Wt=this.getValue(F);void 0!==Wt&&(u[F]=Wt)}return u}possiblyEvaluate(u,F,Wt){const Xe=new Yi(this._properties);for(const Vi of Object.keys(this._values))Xe._values[Vi]=this._values[Vi].possiblyEvaluate(u,F,Wt);return Xe}}class Hi{constructor(u,F,Wt){this.property=u,this.value=F,this.parameters=Wt}isConstant(){return"constant"===this.value.kind}constantOr(u){return"constant"===this.value.kind?this.value.value:u}evaluate(u,F,Wt,Xe){return this.property.evaluate(this.value,this.parameters,u,F,Wt,Xe)}}class Yi{constructor(u){this._properties=u,this._values=Object.create(u.defaultPossiblyEvaluatedValues)}get(u){return this._values[u]}}class Ji{constructor(u){this.specification=u}possiblyEvaluate(u,F){if(u.isDataDriven())throw new Error("Value should not be data driven");return u.expression.evaluate(F)}interpolate(u,F,Wt){const Xe=Ol[this.specification.type];return Xe?Xe(u,F,Wt):u}}class Wi{constructor(u,F){this.specification=u,this.overrides=F}possiblyEvaluate(u,F,Wt,Xe){return new Hi(this,"constant"===u.expression.kind||"camera"===u.expression.kind?{kind:"constant",value:u.expression.evaluate(F,null,{},Wt,Xe)}:u.expression,F)}interpolate(u,F,Wt){if("constant"!==u.value.kind||"constant"!==F.value.kind)return u;if(void 0===u.value.value||void 0===F.value.value)return new Hi(this,{kind:"constant",value:void 0},u.parameters);const Xe=Ol[this.specification.type];if(Xe){const Vi=Xe(u.value.value,F.value.value,Wt);return new Hi(this,{kind:"constant",value:Vi},u.parameters)}return u}evaluate(u,F,Wt,Xe,Vi,fr){return"constant"===u.kind?u.value:u.evaluate(F,Wt,Xe,Vi,fr)}}class Qi extends Wi{possiblyEvaluate(u,F,Wt,Xe){if(void 0===u.value)return new Hi(this,{kind:"constant",value:void 0},F);if("constant"===u.expression.kind){const Vi=u.expression.evaluate(F,null,{},Wt,Xe),fr="resolvedImage"===u.property.specification.type&&"string"!=typeof Vi?Vi.name:Vi,_r=this._calculate(fr,fr,fr,F);return new Hi(this,{kind:"constant",value:_r},F)}if("camera"===u.expression.kind){const Wt=this._calculate(u.expression.evaluate({zoom:F.zoom-1}),u.expression.evaluate({zoom:F.zoom}),u.expression.evaluate({zoom:F.zoom+1}),F);return new Hi(this,{kind:"constant",value:Wt},F)}return new Hi(this,u.expression,F)}evaluate(u,F,Wt,Xe,Vi,fr){if("source"===u.kind){const _r=u.evaluate(F,Wt,Xe,Vi,fr);return this._calculate(_r,_r,_r,F)}return"composite"===u.kind?this._calculate(u.evaluate({zoom:Math.floor(F.zoom)-1},Wt,Xe),u.evaluate({zoom:Math.floor(F.zoom)},Wt,Xe),u.evaluate({zoom:Math.floor(F.zoom)+1},Wt,Xe),F):u.value}_calculate(u,F,Wt,Xe){return Xe.zoom>Xe.zoomHistory.lastIntegerZoom?{from:u,to:F}:{from:Wt,to:F}}interpolate(u){return u}}class ts{constructor(u){this.specification=u}possiblyEvaluate(u,F,Wt,Xe){if(void 0!==u.value){if("constant"===u.expression.kind){const Vi=u.expression.evaluate(F,null,{},Wt,Xe);return this._calculate(Vi,Vi,Vi,F)}return this._calculate(u.expression.evaluate(new Ui(Math.floor(F.zoom-1),F)),u.expression.evaluate(new Ui(Math.floor(F.zoom),F)),u.expression.evaluate(new Ui(Math.floor(F.zoom+1),F)),F)}}_calculate(u,F,Wt,Xe){return Xe.zoom>Xe.zoomHistory.lastIntegerZoom?{from:u,to:F}:{from:Wt,to:F}}interpolate(u){return u}}class es{constructor(u){this.specification=u}possiblyEvaluate(u,F,Wt,Xe){return!!u.expression.evaluate(F,null,{},Wt,Xe)}interpolate(){return!1}}class rs{constructor(u){this.properties=u,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const F in u){const Wt=u[F];Wt.specification.overridable&&this.overridableProperties.push(F);const Xe=this.defaultPropertyValues[F]=new qi(Wt,void 0),Vi=this.defaultTransitionablePropertyValues[F]=new Ni(Wt);this.defaultTransitioningPropertyValues[F]=Vi.untransitioned(),this.defaultPossiblyEvaluatedValues[F]=Xe.possiblyEvaluate({})}}}wi("DataDrivenProperty",Wi),wi("DataConstantProperty",Ji),wi("CrossFadedDataDrivenProperty",Qi),wi("CrossFadedProperty",ts),wi("ColorRampProperty",es);const mh="-transition";class is extends Z{constructor(u,F){if(super(),this.id=u.id,this.type=u.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==u.type&&(this.metadata=u.metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,"background"!==u.type&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),F.layout&&(this._unevaluatedLayout=new Xi(F.layout)),F.paint)){this._transitionablePaint=new Zi(F.paint);for(const F in u.paint)this.setPaintProperty(F,u.paint[F],{validate:!1});for(const F in u.layout)this.setLayoutProperty(F,u.layout[F],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Yi(F.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(u){return"visibility"===u?this.visibility:this._unevaluatedLayout.getValue(u)}setLayoutProperty(u,F,Wt={}){null!=F&&this._validate(bc,`layers.${this.id}.layout.${u}`,u,F,Wt)||("visibility"!==u?this._unevaluatedLayout.setValue(u,F):this.visibility=F)}getPaintProperty(u){return u.endsWith(mh)?this._transitionablePaint.getTransition(u.slice(0,-11)):this._transitionablePaint.getValue(u)}setPaintProperty(u,F,Wt={}){if(null!=F&&this._validate(yc,`layers.${this.id}.paint.${u}`,u,F,Wt))return!1;if(u.endsWith(mh))return this._transitionablePaint.setTransition(u.slice(0,-11),F||void 0),!1;{const Wt=this._transitionablePaint._values[u],Xe="cross-faded-data-driven"===Wt.property.specification["property-type"],Vi=Wt.value.isDataDriven(),fr=Wt.value;this._transitionablePaint.setValue(u,F),this._handleSpecialPaintPropertyUpdate(u);const _r=this._transitionablePaint._values[u].value;return _r.isDataDriven()||Vi||Xe||this._handleOverridablePaintPropertyUpdate(u,fr,_r)}}_handleSpecialPaintPropertyUpdate(u){}_handleOverridablePaintPropertyUpdate(u,F,Wt){return!1}isHidden(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||"none"===this.visibility}updateTransitions(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(u,F){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,F)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,F)}serialize(){const u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),b(u,((u,F)=>!(void 0===u||"layout"===F&&!Object.keys(u).length||"paint"===F&&!Object.keys(u).length)))}_validate(u,F,Wt,Xe,Vi={}){return(!Vi||!1!==Vi.validate)&&xi(this,u.call(lc,{key:F,layerType:this.type,objectKey:Wt,value:Xe,styleSpec:so,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const u in this.paint._values){const F=this.paint.get(u);if(F instanceof Hi&&an(F.property.specification)&&("source"===F.value.kind||"composite"===F.value.kind)&&F.value.isStateDependent)return!0}return!1}}const gh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class as{constructor(u,F){this._structArray=u,this._pos1=F*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class os{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(u,F){return u._trim(),F&&(u.isTransferred=!0,F.push(u.arrayBuffer)),{length:u.length,arrayBuffer:u.arrayBuffer}}static deserialize(u){const F=Object.create(this.prototype);return F.arrayBuffer=u.arrayBuffer,F.length=u.length,F.capacity=u.arrayBuffer.byteLength/F.bytesPerElement,F._refreshViews(),F}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(u){this.reserve(u),this.length=u}reserve(u){if(u>this.capacity){this.capacity=Math.max(u,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const F=this.uint8;this._refreshViews(),F&&this.uint8.set(F)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ls(u,F=1){let Wt=0,Xe=0;return{members:u.map((u=>{const Vi=gh[u.type].BYTES_PER_ELEMENT,fr=Wt=us(Wt,Math.max(F,Vi)),_r=u.components||1;return Xe=Math.max(Xe,Vi),Wt+=Vi*_r,{name:u.name,type:u.type,components:_r,offset:fr}})),size:us(Wt,Math.max(Xe,F)),alignment:F}}function us(u,F){return Math.ceil(u/F)*F}class cs extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F){const Wt=this.length;return this.resize(Wt+1),this.emplace(Wt,u,F)}emplace(u,F,Wt){const Xe=2*u;return this.int16[Xe+0]=F,this.int16[Xe+1]=Wt,u}}cs.prototype.bytesPerElement=4,wi("StructArrayLayout2i4",cs);class hs extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F,Wt){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,u,F,Wt)}emplace(u,F,Wt,Xe){const Vi=3*u;return this.int16[Vi+0]=F,this.int16[Vi+1]=Wt,this.int16[Vi+2]=Xe,u}}hs.prototype.bytesPerElement=6,wi("StructArrayLayout3i6",hs);class ps extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F,Wt,Xe){const Vi=this.length;return this.resize(Vi+1),this.emplace(Vi,u,F,Wt,Xe)}emplace(u,F,Wt,Xe,Vi){const fr=4*u;return this.int16[fr+0]=F,this.int16[fr+1]=Wt,this.int16[fr+2]=Xe,this.int16[fr+3]=Vi,u}}ps.prototype.bytesPerElement=8,wi("StructArrayLayout4i8",ps);class fs extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F,Wt,Xe,Vi,fr){const _r=this.length;return this.resize(_r+1),this.emplace(_r,u,F,Wt,Xe,Vi,fr)}emplace(u,F,Wt,Xe,Vi,fr,_r){const wr=6*u;return this.int16[wr+0]=F,this.int16[wr+1]=Wt,this.int16[wr+2]=Xe,this.int16[wr+3]=Vi,this.int16[wr+4]=fr,this.int16[wr+5]=_r,u}}fs.prototype.bytesPerElement=12,wi("StructArrayLayout2i4i12",fs);class ds extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F,Wt,Xe,Vi,fr){const _r=this.length;return this.resize(_r+1),this.emplace(_r,u,F,Wt,Xe,Vi,fr)}emplace(u,F,Wt,Xe,Vi,fr,_r){const wr=4*u,Ar=8*u;return this.int16[wr+0]=F,this.int16[wr+1]=Wt,this.uint8[Ar+4]=Xe,this.uint8[Ar+5]=Vi,this.uint8[Ar+6]=fr,this.uint8[Ar+7]=_r,u}}ds.prototype.bytesPerElement=8,wi("StructArrayLayout2i4ub8",ds);class ys extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,F){const Wt=this.length;return this.resize(Wt+1),this.emplace(Wt,u,F)}emplace(u,F,Wt){const Xe=2*u;return this.float32[Xe+0]=F,this.float32[Xe+1]=Wt,u}}ys.prototype.bytesPerElement=8,wi("StructArrayLayout2f8",ys);class ms extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr){const In=this.length;return this.resize(In+1),this.emplace(In,u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr)}emplace(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In){const ns=10*u;return this.uint16[ns+0]=F,this.uint16[ns+1]=Wt,this.uint16[ns+2]=Xe,this.uint16[ns+3]=Vi,this.uint16[ns+4]=fr,this.uint16[ns+5]=_r,this.uint16[ns+6]=wr,this.uint16[ns+7]=Ar,this.uint16[ns+8]=Kr,this.uint16[ns+9]=In,u}}ms.prototype.bytesPerElement=20,wi("StructArrayLayout10ui20",ms);class gs extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns){const ca=this.length;return this.resize(ca+1),this.emplace(ca,u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns)}emplace(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca){const ha=12*u;return this.int16[ha+0]=F,this.int16[ha+1]=Wt,this.int16[ha+2]=Xe,this.int16[ha+3]=Vi,this.uint16[ha+4]=fr,this.uint16[ha+5]=_r,this.uint16[ha+6]=wr,this.uint16[ha+7]=Ar,this.int16[ha+8]=Kr,this.int16[ha+9]=In,this.int16[ha+10]=ns,this.int16[ha+11]=ca,u}}gs.prototype.bytesPerElement=24,wi("StructArrayLayout4i4ui4i24",gs);class xs extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,F,Wt){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,u,F,Wt)}emplace(u,F,Wt,Xe){const Vi=3*u;return this.float32[Vi+0]=F,this.float32[Vi+1]=Wt,this.float32[Vi+2]=Xe,u}}xs.prototype.bytesPerElement=12,wi("StructArrayLayout3f12",xs);class vs extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(u){const F=this.length;return this.resize(F+1),this.emplace(F,u)}emplace(u,F){return this.uint32[1*u+0]=F,u}}vs.prototype.bytesPerElement=4,wi("StructArrayLayout1ul4",vs);class bs extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,F,Wt,Xe,Vi,fr,_r,wr,Ar){const Kr=this.length;return this.resize(Kr+1),this.emplace(Kr,u,F,Wt,Xe,Vi,fr,_r,wr,Ar)}emplace(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr){const In=10*u,ns=5*u;return this.int16[In+0]=F,this.int16[In+1]=Wt,this.int16[In+2]=Xe,this.int16[In+3]=Vi,this.int16[In+4]=fr,this.int16[In+5]=_r,this.uint32[ns+3]=wr,this.uint16[In+8]=Ar,this.uint16[In+9]=Kr,u}}bs.prototype.bytesPerElement=20,wi("StructArrayLayout6i1ul2ui20",bs);class ws extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F,Wt,Xe,Vi,fr){const _r=this.length;return this.resize(_r+1),this.emplace(_r,u,F,Wt,Xe,Vi,fr)}emplace(u,F,Wt,Xe,Vi,fr,_r){const wr=6*u;return this.int16[wr+0]=F,this.int16[wr+1]=Wt,this.int16[wr+2]=Xe,this.int16[wr+3]=Vi,this.int16[wr+4]=fr,this.int16[wr+5]=_r,u}}ws.prototype.bytesPerElement=12,wi("StructArrayLayout2i2i2i12",ws);class _s extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F,Wt,Xe,Vi){const fr=this.length;return this.resize(fr+1),this.emplace(fr,u,F,Wt,Xe,Vi)}emplace(u,F,Wt,Xe,Vi,fr){const _r=4*u,wr=8*u;return this.float32[_r+0]=F,this.float32[_r+1]=Wt,this.float32[_r+2]=Xe,this.int16[wr+6]=Vi,this.int16[wr+7]=fr,u}}_s.prototype.bytesPerElement=16,wi("StructArrayLayout2f1f2i16",_s);class As extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F,Wt,Xe,Vi,fr){const _r=this.length;return this.resize(_r+1),this.emplace(_r,u,F,Wt,Xe,Vi,fr)}emplace(u,F,Wt,Xe,Vi,fr,_r){const wr=16*u,Ar=4*u,Kr=8*u;return this.uint8[wr+0]=F,this.uint8[wr+1]=Wt,this.float32[Ar+1]=Xe,this.float32[Ar+2]=Vi,this.int16[Kr+6]=fr,this.int16[Kr+7]=_r,u}}As.prototype.bytesPerElement=16,wi("StructArrayLayout2ub2f2i16",As);class Ss extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,F,Wt){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,u,F,Wt)}emplace(u,F,Wt,Xe){const Vi=3*u;return this.uint16[Vi+0]=F,this.uint16[Vi+1]=Wt,this.uint16[Vi+2]=Xe,u}}Ss.prototype.bytesPerElement=6,wi("StructArrayLayout3ui6",Ss);class ks extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua,Da,io){const no=this.length;return this.resize(no+1),this.emplace(no,u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua,Da,io)}emplace(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua,Da,io,no){const so=24*u,ao=12*u,oo=48*u;return this.int16[so+0]=F,this.int16[so+1]=Wt,this.uint16[so+2]=Xe,this.uint16[so+3]=Vi,this.uint32[ao+2]=fr,this.uint32[ao+3]=_r,this.uint32[ao+4]=wr,this.uint16[so+10]=Ar,this.uint16[so+11]=Kr,this.uint16[so+12]=In,this.float32[ao+7]=ns,this.float32[ao+8]=ca,this.uint8[oo+36]=ha,this.uint8[oo+37]=ua,this.uint8[oo+38]=Da,this.uint32[ao+10]=io,this.int16[so+22]=no,u}}ks.prototype.bytesPerElement=48,wi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ks);class Ms extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua,Da,io,no,so,ao,oo,co,ho,go,xo,Io,ko,Co){const zo=this.length;return this.resize(zo+1),this.emplace(zo,u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua,Da,io,no,so,ao,oo,co,ho,go,xo,Io,ko,Co)}emplace(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua,Da,io,no,so,ao,oo,co,ho,go,xo,Io,ko,Co,zo){const Bo=32*u,al=16*u;return this.int16[Bo+0]=F,this.int16[Bo+1]=Wt,this.int16[Bo+2]=Xe,this.int16[Bo+3]=Vi,this.int16[Bo+4]=fr,this.int16[Bo+5]=_r,this.int16[Bo+6]=wr,this.int16[Bo+7]=Ar,this.uint16[Bo+8]=Kr,this.uint16[Bo+9]=In,this.uint16[Bo+10]=ns,this.uint16[Bo+11]=ca,this.uint16[Bo+12]=ha,this.uint16[Bo+13]=ua,this.uint16[Bo+14]=Da,this.uint16[Bo+15]=io,this.uint16[Bo+16]=no,this.uint16[Bo+17]=so,this.uint16[Bo+18]=ao,this.uint16[Bo+19]=oo,this.uint16[Bo+20]=co,this.uint16[Bo+21]=ho,this.uint16[Bo+22]=go,this.uint32[al+12]=xo,this.float32[al+13]=Io,this.float32[al+14]=ko,this.uint16[Bo+30]=Co,this.uint16[Bo+31]=zo,u}}Ms.prototype.bytesPerElement=64,wi("StructArrayLayout8i15ui1ul2f2ui64",Ms);class Is extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u){const F=this.length;return this.resize(F+1),this.emplace(F,u)}emplace(u,F){return this.float32[1*u+0]=F,u}}Is.prototype.bytesPerElement=4,wi("StructArrayLayout1f4",Is);class zs extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,F,Wt){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,u,F,Wt)}emplace(u,F,Wt,Xe){const Vi=3*u;return this.uint16[6*u+0]=F,this.float32[Vi+1]=Wt,this.float32[Vi+2]=Xe,u}}zs.prototype.bytesPerElement=12,wi("StructArrayLayout1ui2f12",zs);class Ps extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,F,Wt){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,u,F,Wt)}emplace(u,F,Wt,Xe){const Vi=4*u;return this.uint32[2*u+0]=F,this.uint16[Vi+2]=Wt,this.uint16[Vi+3]=Xe,u}}Ps.prototype.bytesPerElement=8,wi("StructArrayLayout1ul2ui8",Ps);class Cs extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,F){const Wt=this.length;return this.resize(Wt+1),this.emplace(Wt,u,F)}emplace(u,F,Wt){const Xe=2*u;return this.uint16[Xe+0]=F,this.uint16[Xe+1]=Wt,u}}Cs.prototype.bytesPerElement=4,wi("StructArrayLayout2ui4",Cs);class Bs extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u){const F=this.length;return this.resize(F+1),this.emplace(F,u)}emplace(u,F){return this.uint16[1*u+0]=F,u}}Bs.prototype.bytesPerElement=2,wi("StructArrayLayout1ui2",Bs);class Vs extends os{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,F,Wt,Xe){const Vi=this.length;return this.resize(Vi+1),this.emplace(Vi,u,F,Wt,Xe)}emplace(u,F,Wt,Xe,Vi){const fr=4*u;return this.float32[fr+0]=F,this.float32[fr+1]=Wt,this.float32[fr+2]=Xe,this.float32[fr+3]=Vi,u}}Vs.prototype.bytesPerElement=16,wi("StructArrayLayout4f16",Vs);class Es extends as{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Xe(this.anchorPointX,this.anchorPointY)}}Es.prototype.size=20;class Fs extends bs{get(u){return new Es(this,u)}}wi("CollisionBoxArray",Fs);class Ts extends as{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(u){this._structArray.uint8[this._pos1+37]=u}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(u){this._structArray.uint8[this._pos1+38]=u}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(u){this._structArray.uint32[this._pos4+10]=u}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ts.prototype.size=48;class $s extends ks{get(u){return new Ts(this,u)}}wi("PlacedSymbolArray",$s);class Ls extends as{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(u){this._structArray.uint32[this._pos4+12]=u}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ls.prototype.size=64;class Ds extends Ms{get(u){return new Ls(this,u)}}wi("SymbolInstanceArray",Ds);class Os extends Is{getoffsetX(u){return this.float32[1*u+0]}}wi("GlyphOffsetArray",Os);class js extends hs{getx(u){return this.int16[3*u+0]}gety(u){return this.int16[3*u+1]}gettileUnitDistanceFromAnchor(u){return this.int16[3*u+2]}}wi("SymbolLineVertexArray",js);class Rs extends as{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Rs.prototype.size=12;class Us extends zs{get(u){return new Rs(this,u)}}wi("TextAnchorOffsetArray",Us);class qs extends as{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}qs.prototype.size=8;class Ns extends Ps{get(u){return new qs(this,u)}}wi("FeatureIndexArray",Ns);class Zs extends cs{}class Gs extends cs{}class Ks extends cs{}class Xs extends fs{}class Hs extends ds{}class Ys extends ys{}class Js extends ms{}class Ws extends gs{}class Qs extends xs{}class ta extends vs{}class ea extends ws{}class ra extends As{}class na extends Ss{}class ia extends Cs{}const yh=ls([{name:"a_pos",components:2,type:"Int16"}],4),{members:Th}=yh;class oa{constructor(u=[]){this.segments=u}prepareSegment(u,F,Wt,Xe){let Vi=this.segments[this.segments.length-1];return u>oa.MAX_VERTEX_ARRAY_LENGTH&&A(`Max vertices per segment is ${oa.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${u}`),(!Vi||Vi.vertexLength+u>oa.MAX_VERTEX_ARRAY_LENGTH||Vi.sortKey!==Xe)&&(Vi={vertexOffset:F.length,primitiveOffset:Wt.length,vertexLength:0,primitiveLength:0},void 0!==Xe&&(Vi.sortKey=Xe),this.segments.push(Vi)),Vi}get(){return this.segments}destroy(){for(const u of this.segments)for(const F in u.vaos)u.vaos[F].destroy()}static simpleSegment(u,F,Wt,Xe){return new oa([{vertexOffset:u,primitiveOffset:F,vertexLength:Wt,primitiveLength:Xe,vaos:{},sortKey:0}])}}function la(u,F){return 256*(u=y(Math.floor(u),0,255))+y(Math.floor(F),0,255)}oa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,wi("SegmentVector",oa);const kh=ls([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Eh={exports:{}},Dh={exports:{}};Dh.exports=function(u,F){var Wt,Xe,Vi,fr,_r,wr,Ar,Kr;for(Xe=u.length-(Wt=3&u.length),Vi=F,_r=3432918353,wr=461845907,Kr=0;Kr<Xe;)Ar=255&u.charCodeAt(Kr)|(255&u.charCodeAt(++Kr))<<8|(255&u.charCodeAt(++Kr))<<16|(255&u.charCodeAt(++Kr))<<24,++Kr,Vi=27492+(65535&(fr=5*(65535&(Vi=(Vi^=Ar=(65535&(Ar=(Ar=(65535&Ar)*_r+(((Ar>>>16)*_r&65535)<<16)&4294967295)<<15|Ar>>>17))*wr+(((Ar>>>16)*wr&65535)<<16)&4294967295)<<13|Vi>>>19))+((5*(Vi>>>16)&65535)<<16)&4294967295))+((58964+(fr>>>16)&65535)<<16);switch(Ar=0,Wt){case 3:Ar^=(255&u.charCodeAt(Kr+2))<<16;case 2:Ar^=(255&u.charCodeAt(Kr+1))<<8;case 1:Vi^=Ar=(65535&(Ar=(Ar=(65535&(Ar^=255&u.charCodeAt(Kr)))*_r+(((Ar>>>16)*_r&65535)<<16)&4294967295)<<15|Ar>>>17))*wr+(((Ar>>>16)*wr&65535)<<16)&4294967295}return Vi^=u.length,Vi=2246822507*(65535&(Vi^=Vi>>>16))+((2246822507*(Vi>>>16)&65535)<<16)&4294967295,Vi=3266489909*(65535&(Vi^=Vi>>>13))+((3266489909*(Vi>>>16)&65535)<<16)&4294967295,(Vi^=Vi>>>16)>>>0};var Lh=Dh.exports,Rh={exports:{}};Rh.exports=function(u,F){for(var Wt,Xe=u.length,Vi=F^Xe,fr=0;Xe>=4;)Wt=1540483477*(65535&(Wt=255&u.charCodeAt(fr)|(255&u.charCodeAt(++fr))<<8|(255&u.charCodeAt(++fr))<<16|(255&u.charCodeAt(++fr))<<24))+((1540483477*(Wt>>>16)&65535)<<16),Vi=1540483477*(65535&Vi)+((1540483477*(Vi>>>16)&65535)<<16)^(Wt=1540483477*(65535&(Wt^=Wt>>>24))+((1540483477*(Wt>>>16)&65535)<<16)),Xe-=4,++fr;switch(Xe){case 3:Vi^=(255&u.charCodeAt(fr+2))<<16;case 2:Vi^=(255&u.charCodeAt(fr+1))<<8;case 1:Vi=1540483477*(65535&(Vi^=255&u.charCodeAt(fr)))+((1540483477*(Vi>>>16)&65535)<<16)}return Vi=1540483477*(65535&(Vi^=Vi>>>13))+((1540483477*(Vi>>>16)&65535)<<16),(Vi^=Vi>>>15)>>>0};var Fh=Lh,Oh=Rh.exports;Eh.exports=Fh,Eh.exports.murmur3=Fh,Eh.exports.murmur2=Oh;var Vh=r(Eh.exports);class ga{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(u,F,Wt,Xe){this.ids.push(xa(u)),this.positions.push(F,Wt,Xe)}getPositions(u){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const F=xa(u);let Wt=0,Xe=this.ids.length-1;for(;Wt<Xe;){const u=Wt+Xe>>1;this.ids[u]>=F?Xe=u:Wt=u+1}const Vi=[];for(;this.ids[Wt]===F;)Vi.push({index:this.positions[3*Wt],start:this.positions[3*Wt+1],end:this.positions[3*Wt+2]}),Wt++;return Vi}static serialize(u,F){const Wt=new Float64Array(u.ids),Xe=new Uint32Array(u.positions);return va(Wt,Xe,0,Wt.length-1),F&&F.push(Wt.buffer,Xe.buffer),{ids:Wt,positions:Xe}}static deserialize(u){const F=new ga;return F.ids=u.ids,F.positions=u.positions,F.indexed=!0,F}}function xa(u){const F=+u;return!isNaN(F)&&F<=Number.MAX_SAFE_INTEGER?F:Vh(String(u))}function va(u,F,Wt,Xe){for(;Wt<Xe;){const Vi=u[Wt+Xe>>1];let fr=Wt-1,_r=Xe+1;for(;;){do{fr++}while(u[fr]<Vi);do{_r--}while(u[_r]>Vi);if(fr>=_r)break;ba(u,fr,_r),ba(F,3*fr,3*_r),ba(F,3*fr+1,3*_r+1),ba(F,3*fr+2,3*_r+2)}_r-Wt<Xe-_r?(va(u,F,Wt,_r),Wt=_r+1):(va(u,F,_r+1,Xe),Xe=_r)}}function ba(u,F,Wt){const Xe=u[F];u[F]=u[Wt],u[Wt]=Xe}wi("FeaturePositionMap",ga);class wa{constructor(u,F){this.gl=u.gl,this.location=F}}class _a extends wa{constructor(u,F){super(u,F),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Aa extends wa{constructor(u,F){super(u,F),this.current=[0,0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))}}class Sa extends wa{constructor(u,F){super(u,F),this.current=Kt.transparent}set(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))}}const jh=new Float32Array(16);function Ma(u){return[la(255*u.r,255*u.g),la(255*u.b,255*u.a)]}class Ia{constructor(u,F,Wt){this.value=u,this.uniformNames=F.map((u=>`u_${u}`)),this.type=Wt}setUniform(u,F,Wt){u.set(Wt.constantOr(this.value))}getBinding(u,F,Wt){return"color"===this.type?new Sa(u,F):new _a(u,F)}}class za{constructor(u,F){this.uniformNames=F.map((u=>`u_${u}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(u,F){this.pixelRatioFrom=F.pixelRatio,this.pixelRatioTo=u.pixelRatio,this.patternFrom=F.tlbr,this.patternTo=u.tlbr}setUniform(u,F,Wt,Xe){const Vi="u_pattern_to"===Xe?this.patternTo:"u_pattern_from"===Xe?this.patternFrom:"u_pixel_ratio_to"===Xe?this.pixelRatioTo:"u_pixel_ratio_from"===Xe?this.pixelRatioFrom:null;Vi&&u.set(Vi)}getBinding(u,F,Wt){return"u_pattern"===Wt.substr(0,9)?new Aa(u,F):new _a(u,F)}}class Pa{constructor(u,F,Wt,Xe){this.expression=u,this.type=Wt,this.maxValue=0,this.paintVertexAttributes=F.map((u=>({name:`a_${u}`,type:"Float32",components:"color"===Wt?2:1,offset:0}))),this.paintVertexArray=new Xe}populatePaintArray(u,F,Wt,Xe,Vi){const fr=this.paintVertexArray.length,_r=this.expression.evaluate(new Ui(0),F,{},Xe,[],Vi);this.paintVertexArray.resize(u),this._setPaintValue(fr,u,_r)}updatePaintArray(u,F,Wt,Xe){const Vi=this.expression.evaluate({zoom:0},Wt,Xe);this._setPaintValue(u,F,Vi)}_setPaintValue(u,F,Wt){if("color"===this.type){const Xe=Ma(Wt);for(let Wt=u;Wt<F;Wt++)this.paintVertexArray.emplace(Wt,Xe[0],Xe[1])}else{for(let Xe=u;Xe<F;Xe++)this.paintVertexArray.emplace(Xe,Wt);this.maxValue=Math.max(this.maxValue,Math.abs(Wt))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ca{constructor(u,F,Wt,Xe,Vi,fr){this.expression=u,this.uniformNames=F.map((u=>`u_${u}_t`)),this.type=Wt,this.useIntegerZoom=Xe,this.zoom=Vi,this.maxValue=0,this.paintVertexAttributes=F.map((u=>({name:`a_${u}`,type:"Float32",components:"color"===Wt?4:2,offset:0}))),this.paintVertexArray=new fr}populatePaintArray(u,F,Wt,Xe,Vi){const fr=this.expression.evaluate(new Ui(this.zoom),F,{},Xe,[],Vi),_r=this.expression.evaluate(new Ui(this.zoom+1),F,{},Xe,[],Vi),wr=this.paintVertexArray.length;this.paintVertexArray.resize(u),this._setPaintValue(wr,u,fr,_r)}updatePaintArray(u,F,Wt,Xe){const Vi=this.expression.evaluate({zoom:this.zoom},Wt,Xe),fr=this.expression.evaluate({zoom:this.zoom+1},Wt,Xe);this._setPaintValue(u,F,Vi,fr)}_setPaintValue(u,F,Wt,Xe){if("color"===this.type){const Vi=Ma(Wt),fr=Ma(Xe);for(let Wt=u;Wt<F;Wt++)this.paintVertexArray.emplace(Wt,Vi[0],Vi[1],fr[0],fr[1])}else{for(let Vi=u;Vi<F;Vi++)this.paintVertexArray.emplace(Vi,Wt,Xe);this.maxValue=Math.max(this.maxValue,Math.abs(Wt),Math.abs(Xe))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(u,F){const Wt=this.useIntegerZoom?Math.floor(F.zoom):F.zoom,Xe=y(this.expression.interpolationFactor(Wt,this.zoom,this.zoom+1),0,1);u.set(Xe)}getBinding(u,F,Wt){return new _a(u,F)}}class Ba{constructor(u,F,Wt,Xe,Vi,fr){this.expression=u,this.type=F,this.useIntegerZoom=Wt,this.zoom=Xe,this.layerId=fr,this.zoomInPaintVertexArray=new Vi,this.zoomOutPaintVertexArray=new Vi}populatePaintArray(u,F,Wt){const Xe=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(u),this.zoomOutPaintVertexArray.resize(u),this._setPaintValues(Xe,u,F.patterns&&F.patterns[this.layerId],Wt)}updatePaintArray(u,F,Wt,Xe,Vi){this._setPaintValues(u,F,Wt.patterns&&Wt.patterns[this.layerId],Vi)}_setPaintValues(u,F,Wt,Xe){if(!Xe||!Wt)return;const{min:Vi,mid:fr,max:_r}=Wt,wr=Xe[Vi],Ar=Xe[fr],Kr=Xe[_r];if(wr&&Ar&&Kr)for(let Wt=u;Wt<F;Wt++)this.zoomInPaintVertexArray.emplace(Wt,Ar.tl[0],Ar.tl[1],Ar.br[0],Ar.br[1],wr.tl[0],wr.tl[1],wr.br[0],wr.br[1],Ar.pixelRatio,wr.pixelRatio),this.zoomOutPaintVertexArray.emplace(Wt,Ar.tl[0],Ar.tl[1],Ar.br[0],Ar.br[1],Kr.tl[0],Kr.tl[1],Kr.br[0],Kr.br[1],Ar.pixelRatio,Kr.pixelRatio)}upload(u){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=u.createVertexBuffer(this.zoomInPaintVertexArray,kh.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=u.createVertexBuffer(this.zoomOutPaintVertexArray,kh.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Va{constructor(u,F,Wt){this.binders={},this._buffers=[];const Xe=[];for(const Vi in u.paint._values){if(!Wt(Vi))continue;const fr=u.paint.get(Vi);if(!(fr instanceof Hi&&an(fr.property.specification)))continue;const _r=Fa(Vi,u.type),wr=fr.value,Ar=fr.property.specification.type,Kr=fr.property.useIntegerZoom,In=fr.property.specification["property-type"],ns="cross-faded"===In||"cross-faded-data-driven"===In;if("constant"===wr.kind)this.binders[Vi]=ns?new za(wr.value,_r):new Ia(wr.value,_r,Ar),Xe.push(`/u_${Vi}`);else if("source"===wr.kind||ns){const Wt=Ta(Vi,Ar,"source");this.binders[Vi]=ns?new Ba(wr,Ar,Kr,F,Wt,u.id):new Pa(wr,_r,Ar,Wt),Xe.push(`/a_${Vi}`)}else{const u=Ta(Vi,Ar,"composite");this.binders[Vi]=new Ca(wr,_r,Ar,Kr,F,u),Xe.push(`/z_${Vi}`)}}this.cacheKey=Xe.sort().join("")}getMaxValue(u){const F=this.binders[u];return F instanceof Pa||F instanceof Ca?F.maxValue:0}populatePaintArrays(u,F,Wt,Xe,Vi){for(const fr in this.binders){const _r=this.binders[fr];(_r instanceof Pa||_r instanceof Ca||_r instanceof Ba)&&_r.populatePaintArray(u,F,Wt,Xe,Vi)}}setConstantPatternPositions(u,F){for(const Wt in this.binders){const Xe=this.binders[Wt];Xe instanceof za&&Xe.setConstantPatternPositions(u,F)}}updatePaintArrays(u,F,Wt,Xe,Vi){let fr=!1;for(const _r in u){const wr=F.getPositions(_r);for(const F of wr){const wr=Wt.feature(F.index);for(const Wt in this.binders){const Ar=this.binders[Wt];if((Ar instanceof Pa||Ar instanceof Ca||Ar instanceof Ba)&&!0===Ar.expression.isStateDependent){const Kr=Xe.paint.get(Wt);Ar.expression=Kr.value,Ar.updatePaintArray(F.start,F.end,wr,u[_r],Vi),fr=!0}}}}return fr}defines(){const u=[];for(const F in this.binders){const Wt=this.binders[F];(Wt instanceof Ia||Wt instanceof za)&&u.push(...Wt.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return u}getBinderAttributes(){const u=[];for(const F in this.binders){const Wt=this.binders[F];if(Wt instanceof Pa||Wt instanceof Ca)for(let F=0;F<Wt.paintVertexAttributes.length;F++)u.push(Wt.paintVertexAttributes[F].name);else if(Wt instanceof Ba)for(let F=0;F<kh.members.length;F++)u.push(kh.members[F].name)}return u}getBinderUniforms(){const u=[];for(const F in this.binders){const Wt=this.binders[F];if(Wt instanceof Ia||Wt instanceof za||Wt instanceof Ca)for(const F of Wt.uniformNames)u.push(F)}return u}getPaintVertexBuffers(){return this._buffers}getUniforms(u,F){const Wt=[];for(const Xe in this.binders){const Vi=this.binders[Xe];if(Vi instanceof Ia||Vi instanceof za||Vi instanceof Ca)for(const fr of Vi.uniformNames)if(F[fr]){const _r=Vi.getBinding(u,F[fr],fr);Wt.push({name:fr,property:Xe,binding:_r})}}return Wt}setUniforms(u,F,Wt,Xe){for(const{name:u,property:Vi,binding:fr}of F)this.binders[Vi].setUniform(fr,Xe,Wt.get(Vi),u)}updatePaintBuffers(u){this._buffers=[];for(const F in this.binders){const Wt=this.binders[F];if(u&&Wt instanceof Ba){const F=2===u.fromScale?Wt.zoomInPaintVertexBuffer:Wt.zoomOutPaintVertexBuffer;F&&this._buffers.push(F)}else(Wt instanceof Pa||Wt instanceof Ca)&&Wt.paintVertexBuffer&&this._buffers.push(Wt.paintVertexBuffer)}}upload(u){for(const F in this.binders){const Wt=this.binders[F];(Wt instanceof Pa||Wt instanceof Ca||Wt instanceof Ba)&&Wt.upload(u)}this.updatePaintBuffers()}destroy(){for(const u in this.binders){const F=this.binders[u];(F instanceof Pa||F instanceof Ca||F instanceof Ba)&&F.destroy()}}}class Ea{constructor(u,F,Wt=(()=>!0)){this.programConfigurations={};for(const Xe of u)this.programConfigurations[Xe.id]=new Va(Xe,F,Wt);this.needsUpload=!1,this._featureMap=new ga,this._bufferOffset=0}populatePaintArrays(u,F,Wt,Xe,Vi,fr){for(const Wt in this.programConfigurations)this.programConfigurations[Wt].populatePaintArrays(u,F,Xe,Vi,fr);void 0!==F.id&&this._featureMap.add(F.id,Wt,this._bufferOffset,u),this._bufferOffset=u,this.needsUpload=!0}updatePaintArrays(u,F,Wt,Xe){for(const Vi of Wt)this.needsUpload=this.programConfigurations[Vi.id].updatePaintArrays(u,this._featureMap,F,Vi,Xe)||this.needsUpload}get(u){return this.programConfigurations[u]}upload(u){if(this.needsUpload){for(const F in this.programConfigurations)this.programConfigurations[F].upload(u);this.needsUpload=!1}}destroy(){for(const u in this.programConfigurations)this.programConfigurations[u].destroy()}}function Fa(u,F){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${F}-`,"").replace(/-/g,"_")]}function Ta(u,F,Wt){const Xe={color:{source:ys,composite:Vs},number:{source:Is,composite:ys}},Vi=function(u){return{"line-pattern":{source:Js,composite:Js},"fill-pattern":{source:Js,composite:Js},"fill-extrusion-pattern":{source:Js,composite:Js}}[u]}(u);return Vi&&Vi[Wt]||Xe[F][Wt]}wi("ConstantBinder",Ia),wi("CrossFadedConstantBinder",za),wi("SourceExpressionBinder",Pa),wi("CrossFadedCompositeBinder",Ba),wi("CompositeExpressionBinder",Ca),wi("ProgramConfiguration",Va,{omit:["_buffers"]}),wi("ProgramConfigurationSet",Ea);const Nh=8192,Uh=Math.pow(2,14)-1,$h=-Uh-1;function Oa(u){const F=Nh/u.extent,Wt=u.loadGeometry();for(let u=0;u<Wt.length;u++){const Xe=Wt[u];for(let u=0;u<Xe.length;u++){const Wt=Xe[u],Vi=Math.round(Wt.x*F),fr=Math.round(Wt.y*F);Wt.x=y(Vi,$h,Uh),Wt.y=y(fr,$h,Uh),(Vi<Wt.x||Vi>Wt.x+1||fr<Wt.y||fr>Wt.y+1)&&A("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return Wt}function ja(u,F){return{type:u.type,id:u.id,properties:u.properties,geometry:F?Oa(u):[]}}function Ra(u,F,Wt,Xe,Vi){u.emplaceBack(2*F+(Xe+1)/2,2*Wt+(Vi+1)/2)}class Ua{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new Gs,this.indexArray=new na,this.segments=new oa,this.programConfigurations=new Ea(u.layers,u.zoom),this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(u,F,Wt){const Xe=this.layers[0],Vi=[];let fr=null,_r=!1;"circle"===Xe.type&&(fr=Xe.layout.get("circle-sort-key"),_r=!fr.isConstant());for(const{feature:F,id:Xe,index:wr,sourceLayerIndex:Ar}of u){const u=this.layers[0]._featureFilter.needGeometry,Kr=ja(F,u);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom),Kr,Wt))continue;const In=_r?fr.evaluate(Kr,{},Wt):void 0,ns={id:Xe,properties:F.properties,type:F.type,sourceLayerIndex:Ar,index:wr,geometry:u?Kr.geometry:Oa(F),patterns:{},sortKey:In};Vi.push(ns)}_r&&Vi.sort(((u,F)=>u.sortKey-F.sortKey));for(const Xe of Vi){const{geometry:Vi,index:fr,sourceLayerIndex:_r}=Xe,wr=u[fr].feature;this.addFeature(Xe,Vi,fr,Wt),F.featureIndex.insert(wr,Vi,fr,_r,this.index)}}update(u,F,Wt){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,F,this.stateDependentLayers,Wt)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,Th),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(u,F,Wt,Xe){for(const Wt of F)for(const F of Wt){const Wt=F.x,Xe=F.y;if(Wt<0||Wt>=Nh||Xe<0||Xe>=Nh)continue;const Vi=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,u.sortKey),fr=Vi.vertexLength;Ra(this.layoutVertexArray,Wt,Xe,-1,-1),Ra(this.layoutVertexArray,Wt,Xe,1,-1),Ra(this.layoutVertexArray,Wt,Xe,1,1),Ra(this.layoutVertexArray,Wt,Xe,-1,1),this.indexArray.emplaceBack(fr,fr+1,fr+2),this.indexArray.emplaceBack(fr,fr+3,fr+2),Vi.vertexLength+=4,Vi.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,Wt,{},Xe)}}function qa(u,F){for(let Wt=0;Wt<u.length;Wt++)if(Wa(F,u[Wt]))return!0;for(let Wt=0;Wt<F.length;Wt++)if(Wa(u,F[Wt]))return!0;return!!Ka(u,F)}function Na(u,F,Wt){return!!Wa(u,F)||!!Ha(F,u,Wt)}function Za(u,F){if(1===u.length)return Ja(F,u[0]);for(let Wt=0;Wt<F.length;Wt++){const Xe=F[Wt];for(let F=0;F<Xe.length;F++)if(Wa(u,Xe[F]))return!0}for(let Wt=0;Wt<u.length;Wt++)if(Ja(F,u[Wt]))return!0;for(let Wt=0;Wt<F.length;Wt++)if(Ka(u,F[Wt]))return!0;return!1}function Ga(u,F,Wt){if(u.length>1){if(Ka(u,F))return!0;for(let Xe=0;Xe<F.length;Xe++)if(Ha(F[Xe],u,Wt))return!0}for(let Xe=0;Xe<u.length;Xe++)if(Ha(u[Xe],F,Wt))return!0;return!1}function Ka(u,F){if(0===u.length||0===F.length)return!1;for(let Wt=0;Wt<u.length-1;Wt++){const Xe=u[Wt],Vi=u[Wt+1];for(let u=0;u<F.length-1;u++)if(Xa(Xe,Vi,F[u],F[u+1]))return!0}return!1}function Xa(u,F,Wt,Xe){return S(u,Wt,Xe)!==S(F,Wt,Xe)&&S(u,F,Wt)!==S(u,F,Xe)}function Ha(u,F,Wt){const Xe=Wt*Wt;if(1===F.length)return u.distSqr(F[0])<Xe;for(let Wt=1;Wt<F.length;Wt++)if(Ya(u,F[Wt-1],F[Wt])<Xe)return!0;return!1}function Ya(u,F,Wt){const Xe=F.distSqr(Wt);if(0===Xe)return u.distSqr(F);const Vi=((u.x-F.x)*(Wt.x-F.x)+(u.y-F.y)*(Wt.y-F.y))/Xe;return u.distSqr(Vi<0?F:Vi>1?Wt:Wt.sub(F)._mult(Vi)._add(F))}function Ja(u,F){let Wt,Xe,Vi,fr=!1;for(let _r=0;_r<u.length;_r++){Wt=u[_r];for(let u=0,_r=Wt.length-1;u<Wt.length;_r=u++)Xe=Wt[u],Vi=Wt[_r],Xe.y>F.y!=Vi.y>F.y&&F.x<(Vi.x-Xe.x)*(F.y-Xe.y)/(Vi.y-Xe.y)+Xe.x&&(fr=!fr)}return fr}function Wa(u,F){let Wt=!1;for(let Xe=0,Vi=u.length-1;Xe<u.length;Vi=Xe++){const fr=u[Xe],_r=u[Vi];fr.y>F.y!=_r.y>F.y&&F.x<(_r.x-fr.x)*(F.y-fr.y)/(_r.y-fr.y)+fr.x&&(Wt=!Wt)}return Wt}function Qa(u,F,Wt){const Xe=Wt[0],Vi=Wt[2];if(u.x<Xe.x&&F.x<Xe.x||u.x>Vi.x&&F.x>Vi.x||u.y<Xe.y&&F.y<Xe.y||u.y>Vi.y&&F.y>Vi.y)return!1;const fr=S(u,F,Wt[0]);return fr!==S(u,F,Wt[1])||fr!==S(u,F,Wt[2])||fr!==S(u,F,Wt[3])}function to(u,F,Wt){const Xe=F.paint.get(u).value;return"constant"===Xe.kind?Xe.value:Wt.programConfigurations.get(F.id).getMaxValue(u)}function eo(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function ro(u,F,Wt,Vi,fr){if(!F[0]&&!F[1])return u;const _r=Xe.convert(F)._mult(fr);"viewport"===Wt&&_r._rotate(-Vi);const wr=[];for(let F=0;F<u.length;F++)wr.push(u[F].sub(_r));return wr}let qh,Zh;wi("CircleBucket",Ua,{omit:["layers"]});var Gh={get paint(){return Zh=Zh||new rs({"circle-radius":new Wi(so.paint_circle["circle-radius"]),"circle-color":new Wi(so.paint_circle["circle-color"]),"circle-blur":new Wi(so.paint_circle["circle-blur"]),"circle-opacity":new Wi(so.paint_circle["circle-opacity"]),"circle-translate":new Ji(so.paint_circle["circle-translate"]),"circle-translate-anchor":new Ji(so.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ji(so.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ji(so.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wi(so.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wi(so.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wi(so.paint_circle["circle-stroke-opacity"])})},get layout(){return qh=qh||new rs({"circle-sort-key":new Wi(so.layout_circle["circle-sort-key"])})}},Hh=1e-6,Wh="undefined"!=typeof Float32Array?Float32Array:Array;function lo(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function uo(u,F,Wt){var Xe=F[0],Vi=F[1],fr=F[2],_r=F[3],wr=F[4],Ar=F[5],Kr=F[6],In=F[7],ns=F[8],ca=F[9],ha=F[10],ua=F[11],Da=F[12],io=F[13],no=F[14],so=F[15],ao=Wt[0],oo=Wt[1],co=Wt[2],ho=Wt[3];return u[0]=ao*Xe+oo*wr+co*ns+ho*Da,u[1]=ao*Vi+oo*Ar+co*ca+ho*io,u[2]=ao*fr+oo*Kr+co*ha+ho*no,u[3]=ao*_r+oo*In+co*ua+ho*so,u[4]=(ao=Wt[4])*Xe+(oo=Wt[5])*wr+(co=Wt[6])*ns+(ho=Wt[7])*Da,u[5]=ao*Vi+oo*Ar+co*ca+ho*io,u[6]=ao*fr+oo*Kr+co*ha+ho*no,u[7]=ao*_r+oo*In+co*ua+ho*so,u[8]=(ao=Wt[8])*Xe+(oo=Wt[9])*wr+(co=Wt[10])*ns+(ho=Wt[11])*Da,u[9]=ao*Vi+oo*Ar+co*ca+ho*io,u[10]=ao*fr+oo*Kr+co*ha+ho*no,u[11]=ao*_r+oo*In+co*ua+ho*so,u[12]=(ao=Wt[12])*Xe+(oo=Wt[13])*wr+(co=Wt[14])*ns+(ho=Wt[15])*Da,u[13]=ao*Vi+oo*Ar+co*ca+ho*io,u[14]=ao*fr+oo*Kr+co*ha+ho*no,u[15]=ao*_r+oo*In+co*ua+ho*so,u}Math.hypot||(Math.hypot=function(){for(var u=0,F=arguments.length;F--;)u+=arguments[F]*arguments[F];return Math.sqrt(u)});var Xh,Jh=uo;function po(u,F,Wt){var Xe=F[0],Vi=F[1],fr=F[2],_r=F[3];return u[0]=Wt[0]*Xe+Wt[4]*Vi+Wt[8]*fr+Wt[12]*_r,u[1]=Wt[1]*Xe+Wt[5]*Vi+Wt[9]*fr+Wt[13]*_r,u[2]=Wt[2]*Xe+Wt[6]*Vi+Wt[10]*fr+Wt[14]*_r,u[3]=Wt[3]*Xe+Wt[7]*Vi+Wt[11]*fr+Wt[15]*_r,u}Xh=new Wh(4),Wh!=Float32Array&&(Xh[0]=0,Xh[1]=0,Xh[2]=0,Xh[3]=0);class fo extends is{constructor(u){super(u,Gh)}createBucket(u){return new Ua(u)}queryRadius(u){const F=u;return to("circle-radius",this,F)+to("circle-stroke-width",this,F)+eo(this.paint.get("circle-translate"))}queryIntersectsFeature(u,F,Wt,Xe,Vi,fr,_r,wr){const Ar=ro(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),fr.angle,_r),Kr=this.paint.get("circle-radius").evaluate(F,Wt)+this.paint.get("circle-stroke-width").evaluate(F,Wt),In="map"===this.paint.get("circle-pitch-alignment"),ns=In?Ar:function(u,F){return u.map((u=>yo(u,F)))}(Ar,wr),ca=In?Kr*_r:Kr;for(const u of Xe)for(const F of u){const u=In?F:yo(F,wr);let Wt=ca;const Xe=po([],[F.x,F.y,0,1],wr);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?Wt*=Xe[3]/fr.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(Wt*=fr.cameraToCenterDistance/Xe[3]),Na(ns,u,Wt))return!0}return!1}}function yo(u,F){const Wt=po([],[u.x,u.y,0,1],F);return new Xe(Wt[0]/Wt[3],Wt[1]/Wt[3])}class mo extends Ua{}let Kh;wi("HeatmapBucket",mo,{omit:["layers"]});var Yh={get paint(){return Kh=Kh||new rs({"heatmap-radius":new Wi(so.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wi(so.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ji(so.paint_heatmap["heatmap-intensity"]),"heatmap-color":new es(so.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ji(so.paint_heatmap["heatmap-opacity"])})}};function vo(u,{width:F,height:Wt},Xe,Vi){if(Vi){if(Vi instanceof Uint8ClampedArray)Vi=new Uint8Array(Vi.buffer);else if(Vi.length!==F*Wt*Xe)throw new RangeError(`mismatched image size. expected: ${Vi.length} but got: ${F*Wt*Xe}`)}else Vi=new Uint8Array(F*Wt*Xe);return u.width=F,u.height=Wt,u.data=Vi,u}function bo(u,{width:F,height:Wt},Xe){if(F===u.width&&Wt===u.height)return;const Vi=vo({},{width:F,height:Wt},Xe);wo(u,Vi,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,F),height:Math.min(u.height,Wt)},Xe),u.width=F,u.height=Wt,u.data=Vi.data}function wo(u,F,Wt,Xe,Vi,fr){if(0===Vi.width||0===Vi.height)return F;if(Vi.width>u.width||Vi.height>u.height||Wt.x>u.width-Vi.width||Wt.y>u.height-Vi.height)throw new RangeError("out of range source coordinates for image copy");if(Vi.width>F.width||Vi.height>F.height||Xe.x>F.width-Vi.width||Xe.y>F.height-Vi.height)throw new RangeError("out of range destination coordinates for image copy");const _r=u.data,wr=F.data;if(_r===wr)throw new Error("srcData equals dstData, so image is already copied");for(let Ar=0;Ar<Vi.height;Ar++){const Kr=((Wt.y+Ar)*u.width+Wt.x)*fr,In=((Xe.y+Ar)*F.width+Xe.x)*fr;for(let u=0;u<Vi.width*fr;u++)wr[In+u]=_r[Kr+u]}return F}class _o{constructor(u,F){vo(this,u,1,F)}resize(u){bo(this,u,1)}clone(){return new _o({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,F,Wt,Xe,Vi){wo(u,F,Wt,Xe,Vi,1)}}class Ao{constructor(u,F){vo(this,u,4,F)}resize(u){bo(this,u,4)}replace(u,F){F?this.data.set(u):this.data=u instanceof Uint8ClampedArray?new Uint8Array(u.buffer):u}clone(){return new Ao({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,F,Wt,Xe,Vi){wo(u,F,Wt,Xe,Vi,4)}}function So(u){const F={},Wt=u.resolution||256,Xe=u.clips?u.clips.length:1,Vi=u.image||new Ao({width:Wt,height:Xe});if(Math.log(Wt)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${Wt}`);const s=(Wt,Xe,fr)=>{F[u.evaluationKey]=fr;const _r=u.expression.evaluate(F);Vi.data[Wt+Xe+0]=Math.floor(255*_r.r/_r.a),Vi.data[Wt+Xe+1]=Math.floor(255*_r.g/_r.a),Vi.data[Wt+Xe+2]=Math.floor(255*_r.b/_r.a),Vi.data[Wt+Xe+3]=Math.floor(255*_r.a)};if(u.clips)for(let F=0,Vi=0;F<Xe;++F,Vi+=4*Wt)for(let Xe=0,fr=0;Xe<Wt;Xe++,fr+=4){const _r=Xe/(Wt-1),{start:wr,end:Ar}=u.clips[F];s(Vi,fr,wr*(1-_r)+Ar*_r)}else for(let u=0,F=0;u<Wt;u++,F+=4)s(0,F,u/(Wt-1));return Vi}wi("AlphaImage",_o),wi("RGBAImage",Ao);const Qh="big-fb";class Mo extends is{createBucket(u){return new mo(u)}constructor(u){super(u,Yh),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){"heatmap-color"===u&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=So({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Qh)&&this.heatmapFbos.delete(Qh)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let tu;var eu={get paint(){return tu=tu||new rs({"hillshade-illumination-direction":new Ji(so.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ji(so.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ji(so.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ji(so.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ji(so.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ji(so.paint_hillshade["hillshade-accent-color"])})}};class Po extends is{constructor(u){super(u,eu)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}const iu=ls([{name:"a_pos",components:2,type:"Int16"}],4),{members:nu}=iu;function Vo(u,F,Wt=2){const Xe=F&&F.length,Vi=Xe?F[0]*Wt:u.length;let fr=Eo(u,0,Vi,Wt,!0);const _r=[];if(!fr||fr.next===fr.prev)return _r;let wr,Ar,Kr;if(Xe&&(fr=function(u,F,Wt,Xe){const Vi=[];for(let Wt=0,fr=F.length;Wt<fr;Wt++){const _r=Eo(u,F[Wt]*Xe,Wt<fr-1?F[Wt+1]*Xe:u.length,Xe,!1);_r===_r.next&&(_r.steiner=!0),Vi.push(No(_r))}Vi.sort(jo);for(let u=0;u<Vi.length;u++)Wt=Ro(Vi[u],Wt);return Wt}(u,F,fr,Wt)),u.length>80*Wt){wr=1/0,Ar=1/0;let F=-1/0,Xe=-1/0;for(let fr=Wt;fr<Vi;fr+=Wt){const Wt=u[fr],Vi=u[fr+1];Wt<wr&&(wr=Wt),Vi<Ar&&(Ar=Vi),Wt>F&&(F=Wt),Vi>Xe&&(Xe=Vi)}Kr=Math.max(F-wr,Xe-Ar),Kr=0!==Kr?32767/Kr:0}return To(fr,_r,Wt,wr,Ar,Kr,0),_r}function Eo(u,F,Wt,Xe,Vi){let fr;if(Vi===function(u,F,Wt,Xe){let Vi=0;for(let fr=F,_r=Wt-Xe;fr<Wt;fr+=Xe)Vi+=(u[_r]-u[fr])*(u[fr+1]+u[_r+1]),_r=fr;return Vi}(u,F,Wt,Xe)>0)for(let Vi=F;Vi<Wt;Vi+=Xe)fr=tl(Vi/Xe|0,u[Vi],u[Vi+1],fr);else for(let Vi=Wt-Xe;Vi>=F;Vi-=Xe)fr=tl(Vi/Xe|0,u[Vi],u[Vi+1],fr);return fr&&Xo(fr,fr.next)&&(el(fr),fr=fr.next),fr}function Fo(u,F){if(!u)return u;F||(F=u);let Wt,Xe=u;do{if(Wt=!1,Xe.steiner||!Xo(Xe,Xe.next)&&0!==Ko(Xe.prev,Xe,Xe.next))Xe=Xe.next;else{if(el(Xe),Xe=F=Xe.prev,Xe===Xe.next)break;Wt=!0}}while(Wt||Xe!==F);return F}function To(u,F,Wt,Xe,Vi,fr,_r){if(!u)return;!_r&&fr&&function(u,F,Wt,Xe){let Vi=u;do{0===Vi.z&&(Vi.z=qo(Vi.x,Vi.y,F,Wt,Xe)),Vi.prevZ=Vi.prev,Vi.nextZ=Vi.next,Vi=Vi.next}while(Vi!==u);Vi.prevZ.nextZ=null,Vi.prevZ=null,function(u){let F,Wt=1;do{let Xe,Vi=u;u=null;let fr=null;for(F=0;Vi;){F++;let _r=Vi,wr=0;for(let u=0;u<Wt&&(wr++,_r=_r.nextZ,_r);u++);let Ar=Wt;for(;wr>0||Ar>0&&_r;)0!==wr&&(0===Ar||!_r||Vi.z<=_r.z)?(Xe=Vi,Vi=Vi.nextZ,wr--):(Xe=_r,_r=_r.nextZ,Ar--),fr?fr.nextZ=Xe:u=Xe,Xe.prevZ=fr,fr=Xe;Vi=_r}fr.nextZ=null,Wt*=2}while(F>1)}(Vi)}(u,Xe,Vi,fr);let wr=u;for(;u.prev!==u.next;){const Ar=u.prev,Kr=u.next;if(fr?Lo(u,Xe,Vi,fr):$o(u))F.push(Ar.i,u.i,Kr.i),el(u),u=Kr.next,wr=Kr.next;else if((u=Kr)===wr){_r?1===_r?To(u=Do(Fo(u),F),F,Wt,Xe,Vi,fr,2):2===_r&&Oo(u,F,Wt,Xe,Vi,fr):To(Fo(u),F,Wt,Xe,Vi,fr,1);break}}}function $o(u){const F=u.prev,Wt=u,Xe=u.next;if(Ko(F,Wt,Xe)>=0)return!1;const Vi=F.x,fr=Wt.x,_r=Xe.x,wr=F.y,Ar=Wt.y,Kr=Xe.y,In=Vi<fr?Vi<_r?Vi:_r:fr<_r?fr:_r,ns=wr<Ar?wr<Kr?wr:Kr:Ar<Kr?Ar:Kr,ca=Vi>fr?Vi>_r?Vi:_r:fr>_r?fr:_r,ha=wr>Ar?wr>Kr?wr:Kr:Ar>Kr?Ar:Kr;let ua=Xe.next;for(;ua!==F;){if(ua.x>=In&&ua.x<=ca&&ua.y>=ns&&ua.y<=ha&&Zo(Vi,wr,fr,Ar,_r,Kr,ua.x,ua.y)&&Ko(ua.prev,ua,ua.next)>=0)return!1;ua=ua.next}return!0}function Lo(u,F,Wt,Xe){const Vi=u.prev,fr=u,_r=u.next;if(Ko(Vi,fr,_r)>=0)return!1;const wr=Vi.x,Ar=fr.x,Kr=_r.x,In=Vi.y,ns=fr.y,ca=_r.y,ha=wr<Ar?wr<Kr?wr:Kr:Ar<Kr?Ar:Kr,ua=In<ns?In<ca?In:ca:ns<ca?ns:ca,Da=wr>Ar?wr>Kr?wr:Kr:Ar>Kr?Ar:Kr,io=In>ns?In>ca?In:ca:ns>ca?ns:ca,no=qo(ha,ua,F,Wt,Xe),so=qo(Da,io,F,Wt,Xe);let ao=u.prevZ,oo=u.nextZ;for(;ao&&ao.z>=no&&oo&&oo.z<=so;){if(ao.x>=ha&&ao.x<=Da&&ao.y>=ua&&ao.y<=io&&ao!==Vi&&ao!==_r&&Zo(wr,In,Ar,ns,Kr,ca,ao.x,ao.y)&&Ko(ao.prev,ao,ao.next)>=0)return!1;if(ao=ao.prevZ,oo.x>=ha&&oo.x<=Da&&oo.y>=ua&&oo.y<=io&&oo!==Vi&&oo!==_r&&Zo(wr,In,Ar,ns,Kr,ca,oo.x,oo.y)&&Ko(oo.prev,oo,oo.next)>=0)return!1;oo=oo.nextZ}for(;ao&&ao.z>=no;){if(ao.x>=ha&&ao.x<=Da&&ao.y>=ua&&ao.y<=io&&ao!==Vi&&ao!==_r&&Zo(wr,In,Ar,ns,Kr,ca,ao.x,ao.y)&&Ko(ao.prev,ao,ao.next)>=0)return!1;ao=ao.prevZ}for(;oo&&oo.z<=so;){if(oo.x>=ha&&oo.x<=Da&&oo.y>=ua&&oo.y<=io&&oo!==Vi&&oo!==_r&&Zo(wr,In,Ar,ns,Kr,ca,oo.x,oo.y)&&Ko(oo.prev,oo,oo.next)>=0)return!1;oo=oo.nextZ}return!0}function Do(u,F){let Wt=u;do{const Xe=Wt.prev,Vi=Wt.next.next;!Xo(Xe,Vi)&&Ho(Xe,Wt,Wt.next,Vi)&&Wo(Xe,Vi)&&Wo(Vi,Xe)&&(F.push(Xe.i,Wt.i,Vi.i),el(Wt),el(Wt.next),Wt=u=Vi),Wt=Wt.next}while(Wt!==u);return Fo(Wt)}function Oo(u,F,Wt,Xe,Vi,fr){let _r=u;do{let u=_r.next.next;for(;u!==_r.prev;){if(_r.i!==u.i&&Go(_r,u)){let wr=Qo(_r,u);return _r=Fo(_r,_r.next),wr=Fo(wr,wr.next),To(_r,F,Wt,Xe,Vi,fr,0),void To(wr,F,Wt,Xe,Vi,fr,0)}u=u.next}_r=_r.next}while(_r!==u)}function jo(u,F){return u.x-F.x}function Ro(u,F){const Wt=function(u,F){let Wt=F;const Xe=u.x,Vi=u.y;let fr,_r=-1/0;do{if(Vi<=Wt.y&&Vi>=Wt.next.y&&Wt.next.y!==Wt.y){const u=Wt.x+(Vi-Wt.y)*(Wt.next.x-Wt.x)/(Wt.next.y-Wt.y);if(u<=Xe&&u>_r&&(_r=u,fr=Wt.x<Wt.next.x?Wt:Wt.next,u===Xe))return fr}Wt=Wt.next}while(Wt!==F);if(!fr)return null;const wr=fr,Ar=fr.x,Kr=fr.y;let In=1/0;Wt=fr;do{if(Xe>=Wt.x&&Wt.x>=Ar&&Xe!==Wt.x&&Zo(Vi<Kr?Xe:_r,Vi,Ar,Kr,Vi<Kr?_r:Xe,Vi,Wt.x,Wt.y)){const F=Math.abs(Vi-Wt.y)/(Xe-Wt.x);Wo(Wt,u)&&(F<In||F===In&&(Wt.x>fr.x||Wt.x===fr.x&&Uo(fr,Wt)))&&(fr=Wt,In=F)}Wt=Wt.next}while(Wt!==wr);return fr}(u,F);if(!Wt)return F;const Xe=Qo(Wt,u);return Fo(Xe,Xe.next),Fo(Wt,Wt.next)}function Uo(u,F){return Ko(u.prev,u,F.prev)<0&&Ko(F.next,u,u.next)<0}function qo(u,F,Wt,Xe,Vi){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-Wt)*Vi|0)|u<<8))|u<<4))|u<<2))|u<<1))|(F=1431655765&((F=858993459&((F=252645135&((F=16711935&((F=(F-Xe)*Vi|0)|F<<8))|F<<4))|F<<2))|F<<1))<<1}function No(u){let F=u,Wt=u;do{(F.x<Wt.x||F.x===Wt.x&&F.y<Wt.y)&&(Wt=F),F=F.next}while(F!==u);return Wt}function Zo(u,F,Wt,Xe,Vi,fr,_r,wr){return(Vi-_r)*(F-wr)>=(u-_r)*(fr-wr)&&(u-_r)*(Xe-wr)>=(Wt-_r)*(F-wr)&&(Wt-_r)*(fr-wr)>=(Vi-_r)*(Xe-wr)}function Go(u,F){return u.next.i!==F.i&&u.prev.i!==F.i&&!function(u,F){let Wt=u;do{if(Wt.i!==u.i&&Wt.next.i!==u.i&&Wt.i!==F.i&&Wt.next.i!==F.i&&Ho(Wt,Wt.next,u,F))return!0;Wt=Wt.next}while(Wt!==u);return!1}(u,F)&&(Wo(u,F)&&Wo(F,u)&&function(u,F){let Wt=u,Xe=!1;const Vi=(u.x+F.x)/2,fr=(u.y+F.y)/2;do{Wt.y>fr!=Wt.next.y>fr&&Wt.next.y!==Wt.y&&Vi<(Wt.next.x-Wt.x)*(fr-Wt.y)/(Wt.next.y-Wt.y)+Wt.x&&(Xe=!Xe),Wt=Wt.next}while(Wt!==u);return Xe}(u,F)&&(Ko(u.prev,u,F.prev)||Ko(u,F.prev,F))||Xo(u,F)&&Ko(u.prev,u,u.next)>0&&Ko(F.prev,F,F.next)>0)}function Ko(u,F,Wt){return(F.y-u.y)*(Wt.x-F.x)-(F.x-u.x)*(Wt.y-F.y)}function Xo(u,F){return u.x===F.x&&u.y===F.y}function Ho(u,F,Wt,Xe){const Vi=Jo(Ko(u,F,Wt)),fr=Jo(Ko(u,F,Xe)),_r=Jo(Ko(Wt,Xe,u)),wr=Jo(Ko(Wt,Xe,F));return Vi!==fr&&_r!==wr||!(0!==Vi||!Yo(u,Wt,F))||!(0!==fr||!Yo(u,Xe,F))||!(0!==_r||!Yo(Wt,u,Xe))||!(0!==wr||!Yo(Wt,F,Xe))}function Yo(u,F,Wt){return F.x<=Math.max(u.x,Wt.x)&&F.x>=Math.min(u.x,Wt.x)&&F.y<=Math.max(u.y,Wt.y)&&F.y>=Math.min(u.y,Wt.y)}function Jo(u){return u>0?1:u<0?-1:0}function Wo(u,F){return Ko(u.prev,u,u.next)<0?Ko(u,F,u.next)>=0&&Ko(u,u.prev,F)>=0:Ko(u,F,u.prev)<0||Ko(u,u.next,F)<0}function Qo(u,F){const Wt=rl(u.i,u.x,u.y),Xe=rl(F.i,F.x,F.y),Vi=u.next,fr=F.prev;return u.next=F,F.prev=u,Wt.next=Vi,Vi.prev=Wt,Xe.next=Wt,Wt.prev=Xe,fr.next=Xe,Xe.prev=fr,Xe}function tl(u,F,Wt,Xe){const Vi=rl(u,F,Wt);return Xe?(Vi.next=Xe.next,Vi.prev=Xe,Xe.next.prev=Vi,Xe.next=Vi):(Vi.prev=Vi,Vi.next=Vi),Vi}function el(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function rl(u,F,Wt){return{i:u,x:F,y:Wt,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function nl(u,F,Wt){const Xe=Wt.patternDependencies;let Vi=!1;for(const Wt of F){const F=Wt.paint.get(`${u}-pattern`);F.isConstant()||(Vi=!0);const fr=F.constantOr(null);fr&&(Vi=!0,Xe[fr.to]=!0,Xe[fr.from]=!0)}return Vi}function il(u,F,Wt,Xe,Vi){const fr=Vi.patternDependencies;for(const _r of F){const F=_r.paint.get(`${u}-pattern`).value;if("constant"!==F.kind){let u=F.evaluate({zoom:Xe-1},Wt,{},Vi.availableImages),wr=F.evaluate({zoom:Xe},Wt,{},Vi.availableImages),Ar=F.evaluate({zoom:Xe+1},Wt,{},Vi.availableImages);u=u&&u.name?u.name:u,wr=wr&&wr.name?wr.name:wr,Ar=Ar&&Ar.name?Ar.name:Ar,fr[u]=!0,fr[wr]=!0,fr[Ar]=!0,Wt.patterns[_r.id]={min:u,mid:wr,max:Ar}}}return Wt}class sl{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ks,this.indexArray=new na,this.indexArray2=new ia,this.programConfigurations=new Ea(u.layers,u.zoom),this.segments=new oa,this.segments2=new oa,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(u,F,Wt){this.hasPattern=nl("fill",this.layers,F);const Xe=this.layers[0].layout.get("fill-sort-key"),Vi=!Xe.isConstant(),fr=[];for(const{feature:_r,id:wr,index:Ar,sourceLayerIndex:Kr}of u){const u=this.layers[0]._featureFilter.needGeometry,In=ja(_r,u);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom),In,Wt))continue;const ns=Vi?Xe.evaluate(In,{},Wt,F.availableImages):void 0,ca={id:wr,properties:_r.properties,type:_r.type,sourceLayerIndex:Kr,index:Ar,geometry:u?In.geometry:Oa(_r),patterns:{},sortKey:ns};fr.push(ca)}Vi&&fr.sort(((u,F)=>u.sortKey-F.sortKey));for(const Xe of fr){const{geometry:Vi,index:fr,sourceLayerIndex:_r}=Xe;if(this.hasPattern){const u=il("fill",this.layers,Xe,this.zoom,F);this.patternFeatures.push(u)}else this.addFeature(Xe,Vi,fr,Wt,{});F.featureIndex.insert(u[fr].feature,Vi,fr,_r,this.index)}}update(u,F,Wt){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,F,this.stateDependentLayers,Wt)}addFeatures(u,F,Wt){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,F,Wt)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,nu),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.indexBuffer2=u.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(u,F,Wt,Xe,Vi){for(const u of xr(F,500)){let F=0;for(const Wt of u)F+=Wt.length;const Wt=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray),Xe=Wt.vertexLength,Vi=[],fr=[];for(const F of u){if(0===F.length)continue;F!==u[0]&&fr.push(Vi.length/2);const Wt=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),Xe=Wt.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(Xe+F.length-1,Xe),Vi.push(F[0].x),Vi.push(F[0].y);for(let u=1;u<F.length;u++)this.layoutVertexArray.emplaceBack(F[u].x,F[u].y),this.indexArray2.emplaceBack(Xe+u-1,Xe+u),Vi.push(F[u].x),Vi.push(F[u].y);Wt.vertexLength+=F.length,Wt.primitiveLength+=F.length}const _r=Vo(Vi,fr);for(let u=0;u<_r.length;u+=3)this.indexArray.emplaceBack(Xe+_r[u],Xe+_r[u+1],Xe+_r[u+2]);Wt.vertexLength+=F,Wt.primitiveLength+=_r.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,Wt,Vi,Xe)}}let su,cu;wi("FillBucket",sl,{omit:["layers","patternFeatures"]});var hu={get paint(){return cu=cu||new rs({"fill-antialias":new Ji(so.paint_fill["fill-antialias"]),"fill-opacity":new Wi(so.paint_fill["fill-opacity"]),"fill-color":new Wi(so.paint_fill["fill-color"]),"fill-outline-color":new Wi(so.paint_fill["fill-outline-color"]),"fill-translate":new Ji(so.paint_fill["fill-translate"]),"fill-translate-anchor":new Ji(so.paint_fill["fill-translate-anchor"]),"fill-pattern":new Qi(so.paint_fill["fill-pattern"])})},get layout(){return su=su||new rs({"fill-sort-key":new Wi(so.layout_fill["fill-sort-key"])})}};class ul extends is{constructor(u){super(u,hu)}recalculate(u,F){super.recalculate(u,F);const Wt=this.paint._values["fill-outline-color"];"constant"===Wt.value.kind&&void 0===Wt.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new sl(u)}queryRadius(){return eo(this.paint.get("fill-translate"))}queryIntersectsFeature(u,F,Wt,Xe,Vi,fr,_r){return Za(ro(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),fr.angle,_r),Xe)}isTileClipped(){return!0}}const uu=ls([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Iu=ls([{name:"a_centroid",components:2,type:"Int16"}],4),{members:zu}=uu;var Du={},Lu=Wt,Fu=ml;function ml(F,Wt,Xe,Vi,fr){(this||u).properties={},(this||u).extent=Xe,(this||u).type=0,(this||u)._pbf=F,(this||u)._geometry=-1,(this||u)._keys=Vi,(this||u)._values=fr,F.readFields(gl,this||u,Wt)}function gl(u,F,Wt){1==u?F.id=Wt.readVarint():2==u?function(u,F){for(var Wt=u.readVarint()+u.pos;u.pos<Wt;){var Xe=F._keys[u.readVarint()],Vi=F._values[u.readVarint()];F.properties[Xe]=Vi}}(Wt,F):3==u?F.type=Wt.readVarint():4==u&&(F._geometry=Wt.pos)}function xl(u){for(var F,Wt,Xe=0,Vi=0,fr=u.length,_r=fr-1;Vi<fr;_r=Vi++)Xe+=((Wt=u[_r]).x-(F=u[Vi]).x)*(F.y+Wt.y);return Xe}ml.types=["Unknown","Point","LineString","Polygon"],ml.prototype.loadGeometry=function(){var F=(this||u)._pbf;F.pos=(this||u)._geometry;for(var Wt,Xe=F.readVarint()+F.pos,Vi=1,fr=0,_r=0,wr=0,Ar=[];F.pos<Xe;){if(fr<=0){var Kr=F.readVarint();Vi=7&Kr,fr=Kr>>3}if(fr--,1===Vi||2===Vi)_r+=F.readSVarint(),wr+=F.readSVarint(),1===Vi&&(Wt&&Ar.push(Wt),Wt=[]),Wt.push(new Lu(_r,wr));else{if(7!==Vi)throw new Error("unknown command "+Vi);Wt&&Wt.push(Wt[0].clone())}}return Wt&&Ar.push(Wt),Ar},ml.prototype.bbox=function(){var F=(this||u)._pbf;F.pos=(this||u)._geometry;for(var Wt=F.readVarint()+F.pos,Xe=1,Vi=0,fr=0,_r=0,wr=1/0,Ar=-1/0,Kr=1/0,In=-1/0;F.pos<Wt;){if(Vi<=0){var ns=F.readVarint();Xe=7&ns,Vi=ns>>3}if(Vi--,1===Xe||2===Xe)(fr+=F.readSVarint())<wr&&(wr=fr),fr>Ar&&(Ar=fr),(_r+=F.readSVarint())<Kr&&(Kr=_r),_r>In&&(In=_r);else if(7!==Xe)throw new Error("unknown command "+Xe)}return[wr,Kr,Ar,In]},ml.prototype.toGeoJSON=function(F,Wt,Xe){var Vi,fr,_r=(this||u).extent*Math.pow(2,Xe),wr=(this||u).extent*F,Ar=(this||u).extent*Wt,Kr=this.loadGeometry(),In=ml.types[(this||u).type];function c(u){for(var F=0;F<u.length;F++){var Wt=u[F];u[F]=[360*(Wt.x+wr)/_r-180,360/Math.PI*Math.atan(Math.exp((180-360*(Wt.y+Ar)/_r)*Math.PI/180))-90]}}switch((this||u).type){case 1:var ns=[];for(Vi=0;Vi<Kr.length;Vi++)ns[Vi]=Kr[Vi][0];c(Kr=ns);break;case 2:for(Vi=0;Vi<Kr.length;Vi++)c(Kr[Vi]);break;case 3:for(Kr=function(u){var F=u.length;if(F<=1)return[u];for(var Wt,Xe,Vi=[],fr=0;fr<F;fr++){var _r=xl(u[fr]);0!==_r&&(void 0===Xe&&(Xe=_r<0),Xe===_r<0?(Wt&&Vi.push(Wt),Wt=[u[fr]]):Wt.push(u[fr]))}return Wt&&Vi.push(Wt),Vi}(Kr),Vi=0;Vi<Kr.length;Vi++)for(fr=0;fr<Kr[Vi].length;fr++)c(Kr[Vi][fr])}1===Kr.length?Kr=Kr[0]:In="Multi"+In;var ca={type:"Feature",geometry:{type:In,coordinates:Kr},properties:(this||u).properties};return"id"in(this||u)&&(ca.id=(this||u).id),ca};var Vu=Fu,Nu=wl;function wl(F,Wt){(this||u).version=1,(this||u).name=null,(this||u).extent=4096,(this||u).length=0,(this||u)._pbf=F,(this||u)._keys=[],(this||u)._values=[],(this||u)._features=[],F.readFields(_l,this||u,Wt),(this||u).length=(this||u)._features.length}function _l(u,F,Wt){15===u?F.version=Wt.readVarint():1===u?F.name=Wt.readString():5===u?F.extent=Wt.readVarint():2===u?F._features.push(Wt.pos):3===u?F._keys.push(Wt.readString()):4===u&&F._values.push(function(u){for(var F=null,Wt=u.readVarint()+u.pos;u.pos<Wt;){var Xe=u.readVarint()>>3;F=1===Xe?u.readString():2===Xe?u.readFloat():3===Xe?u.readDouble():4===Xe?u.readVarint64():5===Xe?u.readVarint():6===Xe?u.readSVarint():7===Xe?u.readBoolean():null}return F}(Wt))}wl.prototype.feature=function(F){if(F<0||F>=(this||u)._features.length)throw new Error("feature index out of bounds");(this||u)._pbf.pos=(this||u)._features[F];var Wt=(this||u)._pbf.readVarint()+(this||u)._pbf.pos;return new Vu((this||u)._pbf,Wt,(this||u).extent,(this||u)._keys,(this||u)._values)};var Uu=Nu;function Sl(u,F,Wt){if(3===u){var Xe=new Uu(Wt,Wt.readVarint()+Wt.pos);Xe.length&&(F[Xe.name]=Xe)}}Du.VectorTile=function(F,Wt){(this||u).layers=F.readFields(Sl,{},Wt)},Du.VectorTileFeature=Fu,Du.VectorTileLayer=Nu;const qu=Du.VectorTileFeature.types,td=Math.pow(2,13);function Il(u,F,Wt,Xe,Vi,fr,_r,wr){u.emplaceBack(F,Wt,2*Math.floor(Xe*td)+_r,Vi*td*2,fr*td*2,Math.round(wr))}class zl{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new Xs,this.centroidVertexArray=new Zs,this.indexArray=new na,this.programConfigurations=new Ea(u.layers,u.zoom),this.segments=new oa,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(u,F,Wt){this.features=[],this.hasPattern=nl("fill-extrusion",this.layers,F);for(const{feature:Xe,id:Vi,index:fr,sourceLayerIndex:_r}of u){const u=this.layers[0]._featureFilter.needGeometry,wr=ja(Xe,u);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom),wr,Wt))continue;const Ar={id:Vi,sourceLayerIndex:_r,index:fr,geometry:u?wr.geometry:Oa(Xe),properties:Xe.properties,type:Xe.type,patterns:{}};this.hasPattern?this.features.push(il("fill-extrusion",this.layers,Ar,this.zoom,F)):this.addFeature(Ar,Ar.geometry,fr,Wt,{}),F.featureIndex.insert(Xe,Ar.geometry,fr,_r,this.index,!0)}}addFeatures(u,F,Wt){for(const u of this.features){const{geometry:Xe}=u;this.addFeature(u,Xe,u.index,F,Wt)}}update(u,F,Wt){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,F,this.stateDependentLayers,Wt)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,zu),this.centroidVertexBuffer=u.createVertexBuffer(this.centroidVertexArray,Iu.members,!0),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(u,F,Wt,Xe,Vi){for(const Wt of xr(F,500)){const F={x:0,y:0,vertexCount:0};let Xe=0;for(const u of Wt)Xe+=u.length;let Vi=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const u of Wt){if(0===u.length)continue;if(Cl(u))continue;let Wt=0;for(let Xe=0;Xe<u.length;Xe++){const fr=u[Xe];if(Xe>=1){const _r=u[Xe-1];if(!Pl(fr,_r)){Vi.vertexLength+4>oa.MAX_VERTEX_ARRAY_LENGTH&&(Vi=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const u=fr.sub(_r)._perp()._unit(),Xe=_r.dist(fr);Wt+Xe>32768&&(Wt=0),Il(this.layoutVertexArray,fr.x,fr.y,u.x,u.y,0,0,Wt),Il(this.layoutVertexArray,fr.x,fr.y,u.x,u.y,0,1,Wt),F.x+=2*fr.x,F.y+=2*fr.y,F.vertexCount+=2,Wt+=Xe,Il(this.layoutVertexArray,_r.x,_r.y,u.x,u.y,0,0,Wt),Il(this.layoutVertexArray,_r.x,_r.y,u.x,u.y,0,1,Wt),F.x+=2*_r.x,F.y+=2*_r.y,F.vertexCount+=2;const wr=Vi.vertexLength;this.indexArray.emplaceBack(wr,wr+2,wr+1),this.indexArray.emplaceBack(wr+1,wr+2,wr+3),Vi.vertexLength+=4,Vi.primitiveLength+=2}}}}if(Vi.vertexLength+Xe>oa.MAX_VERTEX_ARRAY_LENGTH&&(Vi=this.segments.prepareSegment(Xe,this.layoutVertexArray,this.indexArray)),"Polygon"!==qu[u.type])continue;const fr=[],_r=[],wr=Vi.vertexLength;for(const u of Wt)if(0!==u.length){u!==Wt[0]&&_r.push(fr.length/2);for(let Wt=0;Wt<u.length;Wt++){const Xe=u[Wt];Il(this.layoutVertexArray,Xe.x,Xe.y,0,0,1,1,0),F.x+=Xe.x,F.y+=Xe.y,F.vertexCount+=1,fr.push(Xe.x),fr.push(Xe.y)}}const Ar=Vo(fr,_r);for(let u=0;u<Ar.length;u+=3)this.indexArray.emplaceBack(wr+Ar[u],wr+Ar[u+2],wr+Ar[u+1]);Vi.primitiveLength+=Ar.length/3,Vi.vertexLength+=Xe;for(let u=0;u<F.vertexCount;u++){const u=Math.floor(F.x/F.vertexCount),Wt=Math.floor(F.y/F.vertexCount);this.centroidVertexArray.emplaceBack(u,Wt)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,Wt,Vi,Xe)}}function Pl(u,F){return u.x===F.x&&(u.x<0||u.x>Nh)||u.y===F.y&&(u.y<0||u.y>Nh)}function Cl(u){return u.every((u=>u.x<0))||u.every((u=>u.x>Nh))||u.every((u=>u.y<0))||u.every((u=>u.y>Nh))}let ed;wi("FillExtrusionBucket",zl,{omit:["layers","features"]});var id={get paint(){return ed=ed||new rs({"fill-extrusion-opacity":new Ji(so["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wi(so["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ji(so["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ji(so["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Qi(so["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wi(so["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wi(so["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ji(so["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class El extends is{constructor(u){super(u,id)}createBucket(u){return new zl(u)}queryRadius(){return eo(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(u,F,Wt,Vi,fr,_r,wr,Ar){const Kr=ro(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_r.angle,wr),In=this.paint.get("fill-extrusion-height").evaluate(F,Wt),ns=this.paint.get("fill-extrusion-base").evaluate(F,Wt),ca=function(u,F,Wt,Vi){const fr=[];for(const Wt of u){const u=[Wt.x,Wt.y,0,1];po(u,u,F),fr.push(new Xe(u[0]/u[3],u[1]/u[3]))}return fr}(Kr,Ar),ha=function(u,F,Wt,Vi){const fr=[],_r=[],wr=Vi[8]*F,Ar=Vi[9]*F,Kr=Vi[10]*F,In=Vi[11]*F,ns=Vi[8]*Wt,ca=Vi[9]*Wt,ha=Vi[10]*Wt,ua=Vi[11]*Wt;for(const F of u){const u=[],Wt=[];for(const fr of F){const F=fr.x,_r=fr.y,Da=Vi[0]*F+Vi[4]*_r+Vi[12],io=Vi[1]*F+Vi[5]*_r+Vi[13],no=Vi[2]*F+Vi[6]*_r+Vi[14],so=Vi[3]*F+Vi[7]*_r+Vi[15],ao=no+Kr,oo=so+In,co=Da+ns,ho=io+ca,go=no+ha,xo=so+ua,Io=new Xe((Da+wr)/oo,(io+Ar)/oo);Io.z=ao/oo,u.push(Io);const ko=new Xe(co/xo,ho/xo);ko.z=go/xo,Wt.push(ko)}fr.push(u),_r.push(Wt)}return[fr,_r]}(Vi,ns,In,Ar);return function(u,F,Wt){let Xe=1/0;Za(Wt,F)&&(Xe=Tl(Wt,F[0]));for(let Vi=0;Vi<F.length;Vi++){const fr=F[Vi],_r=u[Vi];for(let u=0;u<fr.length-1;u++){const F=fr[u],Vi=[F,fr[u+1],_r[u+1],_r[u],F];qa(Wt,Vi)&&(Xe=Math.min(Xe,Tl(Wt,Vi)))}}return Xe!==1/0&&Xe}(ha[0],ha[1],ca)}}function Fl(u,F){return u.x*F.x+u.y*F.y}function Tl(u,F){if(1===u.length){let Wt=0;const Xe=F[Wt++];let Vi;for(;!Vi||Xe.equals(Vi);)if(Vi=F[Wt++],!Vi)return 1/0;for(;Wt<F.length;Wt++){const fr=F[Wt],_r=u[0],wr=Vi.sub(Xe),Ar=fr.sub(Xe),Kr=_r.sub(Xe),In=Fl(wr,wr),ns=Fl(wr,Ar),ca=Fl(Ar,Ar),ha=Fl(Kr,wr),ua=Fl(Kr,Ar),Da=In*ca-ns*ns,io=(ca*ha-ns*ua)/Da,no=(In*ua-ns*ha)/Da,so=Xe.z*(1-io-no)+Vi.z*io+fr.z*no;if(isFinite(so))return so}return 1/0}{let u=1/0;for(const Wt of F)u=Math.min(u,Wt.z);return u}}const rd=ls([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:nd}=rd,sd=ls([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:ad}=sd,od=Du.VectorTileFeature.types,ld=Math.cos(Math.PI/180*37.5),cd=Math.pow(2,14)/.5;class ql{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((u=>{this.gradients[u.id]={}})),this.layoutVertexArray=new Hs,this.layoutVertexArray2=new Ys,this.indexArray=new na,this.programConfigurations=new Ea(u.layers,u.zoom),this.segments=new oa,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(u,F,Wt){this.hasPattern=nl("line",this.layers,F);const Xe=this.layers[0].layout.get("line-sort-key"),Vi=!Xe.isConstant(),fr=[];for(const{feature:F,id:_r,index:wr,sourceLayerIndex:Ar}of u){const u=this.layers[0]._featureFilter.needGeometry,Kr=ja(F,u);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom),Kr,Wt))continue;const In=Vi?Xe.evaluate(Kr,{},Wt):void 0,ns={id:_r,properties:F.properties,type:F.type,sourceLayerIndex:Ar,index:wr,geometry:u?Kr.geometry:Oa(F),patterns:{},sortKey:In};fr.push(ns)}Vi&&fr.sort(((u,F)=>u.sortKey-F.sortKey));for(const Xe of fr){const{geometry:Vi,index:fr,sourceLayerIndex:_r}=Xe;if(this.hasPattern){const u=il("line",this.layers,Xe,this.zoom,F);this.patternFeatures.push(u)}else this.addFeature(Xe,Vi,fr,Wt,{});F.featureIndex.insert(u[fr].feature,Vi,fr,_r,this.index)}}update(u,F,Wt){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,F,this.stateDependentLayers,Wt)}addFeatures(u,F,Wt){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,F,Wt)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=u.createVertexBuffer(this.layoutVertexArray2,ad)),this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,nd),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(u){if(u.properties&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_end"))return{start:+u.properties.mapbox_clip_start,end:+u.properties.mapbox_clip_end}}addFeature(u,F,Wt,Xe,Vi){const fr=this.layers[0].layout,_r=fr.get("line-join").evaluate(u,{}),wr=fr.get("line-cap"),Ar=fr.get("line-miter-limit"),Kr=fr.get("line-round-limit");this.lineClips=this.lineFeatureClips(u);for(const Wt of F)this.addLine(Wt,u,_r,wr,Ar,Kr);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,Wt,Vi,Xe)}addLine(u,F,Wt,Xe,Vi,fr){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let F=0;F<u.length-1;F++)this.totalDistance+=u[F].dist(u[F+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _r="Polygon"===od[F.type];let wr=u.length;for(;wr>=2&&u[wr-1].equals(u[wr-2]);)wr--;let Ar=0;for(;Ar<wr-1&&u[Ar].equals(u[Ar+1]);)Ar++;if(wr<(_r?3:2))return;"bevel"===Wt&&(Vi=1.05);const Kr=this.overscaling<=16?15*Nh/(512*this.overscaling):0,In=this.segments.prepareSegment(10*wr,this.layoutVertexArray,this.indexArray);let ns,ca,ha,ua,Da;this.e1=this.e2=-1,_r&&(ns=u[wr-2],Da=u[Ar].sub(ns)._unit()._perp());for(let F=Ar;F<wr;F++){if(ha=F===wr-1?_r?u[Ar+1]:void 0:u[F+1],ha&&u[F].equals(ha))continue;Da&&(ua=Da),ns&&(ca=ns),ns=u[F],Da=ha?ha.sub(ns)._unit()._perp():ua,ua=ua||Da;let io=ua.add(Da);0===io.x&&0===io.y||io._unit();const no=ua.x*Da.x+ua.y*Da.y,so=io.x*Da.x+io.y*Da.y,ao=0!==so?1/so:1/0,oo=2*Math.sqrt(2-2*so),co=so<ld&&ca&&ha,ho=ua.x*Da.y-ua.y*Da.x>0;if(co&&F>Ar){const u=ns.dist(ca);if(u>2*Kr){const F=ns.sub(ns.sub(ca)._mult(Kr/u)._round());this.updateDistance(ca,F),this.addCurrentVertex(F,ua,0,0,In),ca=F}}const go=ca&&ha;let xo=go?Wt:_r?"butt":Xe;if(go&&"round"===xo&&(ao<fr?xo="miter":ao<=2&&(xo="fakeround")),"miter"===xo&&ao>Vi&&(xo="bevel"),"bevel"===xo&&(ao>2&&(xo="flipbevel"),ao<Vi&&(xo="miter")),ca&&this.updateDistance(ca,ns),"miter"===xo)io._mult(ao),this.addCurrentVertex(ns,io,0,0,In);else if("flipbevel"===xo){if(ao>100)io=Da.mult(-1);else{const u=ao*ua.add(Da).mag()/ua.sub(Da).mag();io._perp()._mult(u*(ho?-1:1))}this.addCurrentVertex(ns,io,0,0,In),this.addCurrentVertex(ns,io.mult(-1),0,0,In)}else if("bevel"===xo||"fakeround"===xo){const u=-Math.sqrt(ao*ao-1),F=ho?u:0,Wt=ho?0:u;if(ca&&this.addCurrentVertex(ns,ua,F,Wt,In),"fakeround"===xo){const u=Math.round(180*oo/Math.PI/20);for(let F=1;F<u;F++){let Wt=F/u;if(.5!==Wt){const u=Wt-.5;Wt+=Wt*u*(Wt-1)*((1.0904+no*(no*(3.55645-1.43519*no)-3.2452))*u*u+(.848013+no*(.215638*no-1.06021)))}const Xe=Da.sub(ua)._mult(Wt)._add(ua)._unit()._mult(ho?-1:1);this.addHalfVertex(ns,Xe.x,Xe.y,!1,ho,0,In)}}ha&&this.addCurrentVertex(ns,Da,-F,-Wt,In)}else if("butt"===xo)this.addCurrentVertex(ns,io,0,0,In);else if("square"===xo){const u=ca?1:-1;this.addCurrentVertex(ns,io,u,u,In)}else"round"===xo&&(ca&&(this.addCurrentVertex(ns,ua,0,0,In),this.addCurrentVertex(ns,ua,1,1,In,!0)),ha&&(this.addCurrentVertex(ns,Da,-1,-1,In,!0),this.addCurrentVertex(ns,Da,0,0,In)));if(co&&F<wr-1){const u=ns.dist(ha);if(u>2*Kr){const F=ns.add(ha.sub(ns)._mult(Kr/u)._round());this.updateDistance(ns,F),this.addCurrentVertex(F,Da,0,0,In),ns=F}}}}addCurrentVertex(u,F,Wt,Xe,Vi,fr=!1){const _r=F.y*Xe-F.x,wr=-F.y-F.x*Xe;this.addHalfVertex(u,F.x+F.y*Wt,F.y-F.x*Wt,fr,!1,Wt,Vi),this.addHalfVertex(u,_r,wr,fr,!0,-Xe,Vi),this.distance>cd/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(u,F,Wt,Xe,Vi,fr))}addHalfVertex({x:u,y:F},Wt,Xe,Vi,fr,_r,wr){const Ar=.5*(this.lineClips?this.scaledDistance*(cd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((u<<1)+(Vi?1:0),(F<<1)+(fr?1:0),Math.round(63*Wt)+128,Math.round(63*Xe)+128,1+(0===_r?0:_r<0?-1:1)|(63&Ar)<<2,Ar>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const Kr=wr.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Kr),wr.primitiveLength++),fr?this.e2=Kr:this.e1=Kr}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(u,F){this.distance+=u.dist(F),this.updateScaledDistance()}}let hd,ud;wi("LineBucket",ql,{omit:["layers","patternFeatures"]});var dd={get paint(){return ud=ud||new rs({"line-opacity":new Wi(so.paint_line["line-opacity"]),"line-color":new Wi(so.paint_line["line-color"]),"line-translate":new Ji(so.paint_line["line-translate"]),"line-translate-anchor":new Ji(so.paint_line["line-translate-anchor"]),"line-width":new Wi(so.paint_line["line-width"]),"line-gap-width":new Wi(so.paint_line["line-gap-width"]),"line-offset":new Wi(so.paint_line["line-offset"]),"line-blur":new Wi(so.paint_line["line-blur"]),"line-dasharray":new ts(so.paint_line["line-dasharray"]),"line-pattern":new Qi(so.paint_line["line-pattern"]),"line-gradient":new es(so.paint_line["line-gradient"])})},get layout(){return hd=hd||new rs({"line-cap":new Ji(so.layout_line["line-cap"]),"line-join":new Wi(so.layout_line["line-join"]),"line-miter-limit":new Ji(so.layout_line["line-miter-limit"]),"line-round-limit":new Ji(so.layout_line["line-round-limit"]),"line-sort-key":new Wi(so.layout_line["line-sort-key"])})}};class Kl extends Wi{possiblyEvaluate(u,F){return F=new Ui(Math.floor(F.zoom),{now:F.now,fadeDuration:F.fadeDuration,zoomHistory:F.zoomHistory,transition:F.transition}),super.possiblyEvaluate(u,F)}evaluate(u,F,Wt,Xe){return F=g({},F,{zoom:Math.floor(F.zoom)}),super.evaluate(u,F,Wt,Xe)}}let pd;class Hl extends is{constructor(u){super(u,dd),this.gradientVersion=0,pd||(pd=new Kl(dd.paint.properties["line-width"].specification),pd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(u){if("line-gradient"===u){const u=this.gradientExpression();this.stepInterpolant=!!function(u){return void 0!==u._styleExpression}(u)&&u._styleExpression.expression instanceof Ae,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(u,F){super.recalculate(u,F),this.paint._values["line-floorwidth"]=pd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new ql(u)}queryRadius(u){const F=u,Wt=Yl(to("line-width",this,F),to("line-gap-width",this,F)),Xe=to("line-offset",this,F);return Wt/2+Math.abs(Xe)+eo(this.paint.get("line-translate"))}queryIntersectsFeature(u,F,Wt,Vi,fr,_r,wr){const Ar=ro(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_r.angle,wr),Kr=wr/2*Yl(this.paint.get("line-width").evaluate(F,Wt),this.paint.get("line-gap-width").evaluate(F,Wt)),In=this.paint.get("line-offset").evaluate(F,Wt);return In&&(Vi=function(u,F){const Wt=[];for(let Vi=0;Vi<u.length;Vi++){const fr=u[Vi],_r=[];for(let u=0;u<fr.length;u++){const Wt=fr[u-1],Vi=fr[u],wr=fr[u+1],Ar=0===u?new Xe(0,0):Vi.sub(Wt)._unit()._perp(),Kr=u===fr.length-1?new Xe(0,0):wr.sub(Vi)._unit()._perp(),In=Ar._add(Kr)._unit(),ns=In.x*Kr.x+In.y*Kr.y;0!==ns&&In._mult(1/ns),_r.push(In._mult(F)._add(Vi))}Wt.push(_r)}return Wt}(Vi,In*wr)),function(u,F,Wt){for(let Xe=0;Xe<F.length;Xe++){const Vi=F[Xe];if(u.length>=3)for(let F=0;F<Vi.length;F++)if(Wa(u,Vi[F]))return!0;if(Ga(u,Vi,Wt))return!0}return!1}(Ar,Vi,Kr)}isTileClipped(){return!0}}function Yl(u,F){return F>0?F+2*u:u}const fd=ls([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),md=ls([{name:"a_projected_pos",components:3,type:"Float32"}],4);ls([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const _d=ls([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);ls([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const gd=ls([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),yd=ls([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ru(u,F,Wt){return u.sections.forEach((u=>{u.text=function(u,F,Wt){const Xe=F.layout.get("text-transform").evaluate(Wt,{});return"uppercase"===Xe?u=u.toLocaleUpperCase():"lowercase"===Xe&&(u=u.toLocaleLowerCase()),ih.applyArabicShaping&&(u=ih.applyArabicShaping(u)),u}(u.text,F,Wt)})),u}ls([{name:"triangle",components:3,type:"Uint16"}]),ls([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ls([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ls([{type:"Float32",name:"offsetX"}]),ls([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ls([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const xd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var vd=24,bd=lu,au=function(u,F,Wt,Xe,Vi){var fr,_r,wr=8*Vi-Xe-1,Ar=(1<<wr)-1,Kr=Ar>>1,In=-7,ns=Wt?Vi-1:0,ca=Wt?-1:1,ha=u[F+ns];for(ns+=ca,fr=ha&(1<<-In)-1,ha>>=-In,In+=wr;In>0;fr=256*fr+u[F+ns],ns+=ca,In-=8);for(_r=fr&(1<<-In)-1,fr>>=-In,In+=Xe;In>0;_r=256*_r+u[F+ns],ns+=ca,In-=8);if(0===fr)fr=1-Kr;else{if(fr===Ar)return _r?NaN:1/0*(ha?-1:1);_r+=Math.pow(2,Xe),fr-=Kr}return(ha?-1:1)*_r*Math.pow(2,fr-Xe)},ou=function(u,F,Wt,Xe,Vi,fr){var _r,wr,Ar,Kr=8*fr-Vi-1,In=(1<<Kr)-1,ns=In>>1,ca=23===Vi?Math.pow(2,-24)-Math.pow(2,-77):0,ha=Xe?0:fr-1,ua=Xe?1:-1,Da=F<0||0===F&&1/F<0?1:0;for(F=Math.abs(F),isNaN(F)||F===1/0?(wr=isNaN(F)?1:0,_r=In):(_r=Math.floor(Math.log(F)/Math.LN2),F*(Ar=Math.pow(2,-_r))<1&&(_r--,Ar*=2),(F+=_r+ns>=1?ca/Ar:ca*Math.pow(2,1-ns))*Ar>=2&&(_r++,Ar/=2),_r+ns>=In?(wr=0,_r=In):_r+ns>=1?(wr=(F*Ar-1)*Math.pow(2,Vi),_r+=ns):(wr=F*Math.pow(2,ns-1)*Math.pow(2,Vi),_r=0));Vi>=8;u[Wt+ha]=255&wr,ha+=ua,wr/=256,Vi-=8);for(_r=_r<<Vi|wr,Kr+=Vi;Kr>0;u[Wt+ha]=255&_r,ha+=ua,_r/=256,Kr-=8);u[Wt+ha-ua]|=128*Da};function lu(F){(this||u).buf=ArrayBuffer.isView&&ArrayBuffer.isView(F)?F:new Uint8Array(F||0),(this||u).pos=0,(this||u).type=0,(this||u).length=(this||u).buf.length}lu.Varint=0,lu.Fixed64=1,lu.Bytes=2,lu.Fixed32=5;var wd=4294967296,Td=1/wd,Sd="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");function pu(u){return u.type===lu.Bytes?u.readVarint()+u.pos:u.pos+1}function fu(u,F,Wt){return Wt?4294967296*F+(u>>>0):4294967296*(F>>>0)+(u>>>0)}function du(u,F,Wt){var Xe=F<=16383?1:F<=2097151?2:F<=268435455?3:Math.floor(Math.log(F)/(7*Math.LN2));Wt.realloc(Xe);for(var Vi=Wt.pos-1;Vi>=u;Vi--)Wt.buf[Vi+Xe]=Wt.buf[Vi]}function yu(u,F){for(var Wt=0;Wt<u.length;Wt++)F.writeVarint(u[Wt])}function mu(u,F){for(var Wt=0;Wt<u.length;Wt++)F.writeSVarint(u[Wt])}function gu(u,F){for(var Wt=0;Wt<u.length;Wt++)F.writeFloat(u[Wt])}function xu(u,F){for(var Wt=0;Wt<u.length;Wt++)F.writeDouble(u[Wt])}function vu(u,F){for(var Wt=0;Wt<u.length;Wt++)F.writeBoolean(u[Wt])}function bu(u,F){for(var Wt=0;Wt<u.length;Wt++)F.writeFixed32(u[Wt])}function wu(u,F){for(var Wt=0;Wt<u.length;Wt++)F.writeSFixed32(u[Wt])}function _u(u,F){for(var Wt=0;Wt<u.length;Wt++)F.writeFixed64(u[Wt])}function Au(u,F){for(var Wt=0;Wt<u.length;Wt++)F.writeSFixed64(u[Wt])}function Su(u,F){return(u[F]|u[F+1]<<8|u[F+2]<<16)+16777216*u[F+3]}function ku(u,F,Wt){u[Wt]=F,u[Wt+1]=F>>>8,u[Wt+2]=F>>>16,u[Wt+3]=F>>>24}function Mu(u,F){return(u[F]|u[F+1]<<8|u[F+2]<<16)+(u[F+3]<<24)}lu.prototype={destroy:function(){(this||u).buf=null},readFields:function(F,Wt,Xe){for(Xe=Xe||(this||u).length;(this||u).pos<Xe;){var Vi=this.readVarint(),fr=Vi>>3,_r=(this||u).pos;(this||u).type=7&Vi,F(fr,Wt,this||u),(this||u).pos===_r&&this.skip(Vi)}return Wt},readMessage:function(F,Wt){return this.readFields(F,Wt,this.readVarint()+(this||u).pos)},readFixed32:function(){var F=Su((this||u).buf,(this||u).pos);return(this||u).pos+=4,F},readSFixed32:function(){var F=Mu((this||u).buf,(this||u).pos);return(this||u).pos+=4,F},readFixed64:function(){var F=Su((this||u).buf,(this||u).pos)+Su((this||u).buf,(this||u).pos+4)*wd;return(this||u).pos+=8,F},readSFixed64:function(){var F=Su((this||u).buf,(this||u).pos)+Mu((this||u).buf,(this||u).pos+4)*wd;return(this||u).pos+=8,F},readFloat:function(){var F=au((this||u).buf,(this||u).pos,!0,23,4);return(this||u).pos+=4,F},readDouble:function(){var F=au((this||u).buf,(this||u).pos,!0,52,8);return(this||u).pos+=8,F},readVarint:function(F){var Wt,Xe,Vi=(this||u).buf;return Wt=127&(Xe=Vi[(this||u).pos++]),Xe<128?Wt:(Wt|=(127&(Xe=Vi[(this||u).pos++]))<<7,Xe<128?Wt:(Wt|=(127&(Xe=Vi[(this||u).pos++]))<<14,Xe<128?Wt:(Wt|=(127&(Xe=Vi[(this||u).pos++]))<<21,Xe<128?Wt:function(u,F,Wt){var Xe,Vi,fr=Wt.buf;if(Xe=(112&(Vi=fr[Wt.pos++]))>>4,Vi<128)return fu(u,Xe,F);if(Xe|=(127&(Vi=fr[Wt.pos++]))<<3,Vi<128)return fu(u,Xe,F);if(Xe|=(127&(Vi=fr[Wt.pos++]))<<10,Vi<128)return fu(u,Xe,F);if(Xe|=(127&(Vi=fr[Wt.pos++]))<<17,Vi<128)return fu(u,Xe,F);if(Xe|=(127&(Vi=fr[Wt.pos++]))<<24,Vi<128)return fu(u,Xe,F);if(Xe|=(1&(Vi=fr[Wt.pos++]))<<31,Vi<128)return fu(u,Xe,F);throw new Error("Expected varint not more than 10 bytes")}(Wt|=(15&(Xe=Vi[(this||u).pos]))<<28,F,this||u))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var F=this.readVarint()+(this||u).pos,Wt=(this||u).pos;return(this||u).pos=F,F-Wt>=12&&Sd?function(u,F,Wt){return Sd.decode(u.subarray(F,Wt))}((this||u).buf,Wt,F):function(u,F,Wt){for(var Xe="",Vi=F;Vi<Wt;){var fr,_r,wr,Ar=u[Vi],Kr=null,In=Ar>239?4:Ar>223?3:Ar>191?2:1;if(Vi+In>Wt)break;1===In?Ar<128&&(Kr=Ar):2===In?128==(192&(fr=u[Vi+1]))&&(Kr=(31&Ar)<<6|63&fr)<=127&&(Kr=null):3===In?(_r=u[Vi+2],128==(192&(fr=u[Vi+1]))&&128==(192&_r)&&((Kr=(15&Ar)<<12|(63&fr)<<6|63&_r)<=2047||Kr>=55296&&Kr<=57343)&&(Kr=null)):4===In&&(_r=u[Vi+2],wr=u[Vi+3],128==(192&(fr=u[Vi+1]))&&128==(192&_r)&&128==(192&wr)&&((Kr=(15&Ar)<<18|(63&fr)<<12|(63&_r)<<6|63&wr)<=65535||Kr>=1114112)&&(Kr=null)),null===Kr?(Kr=65533,In=1):Kr>65535&&(Kr-=65536,Xe+=String.fromCharCode(Kr>>>10&1023|55296),Kr=56320|1023&Kr),Xe+=String.fromCharCode(Kr),Vi+=In}return Xe}((this||u).buf,Wt,F)},readBytes:function(){var F=this.readVarint()+(this||u).pos,Wt=(this||u).buf.subarray((this||u).pos,F);return(this||u).pos=F,Wt},readPackedVarint:function(F,Wt){if((this||u).type!==lu.Bytes)return F.push(this.readVarint(Wt));var Xe=pu(this||u);for(F=F||[];(this||u).pos<Xe;)F.push(this.readVarint(Wt));return F},readPackedSVarint:function(F){if((this||u).type!==lu.Bytes)return F.push(this.readSVarint());var Wt=pu(this||u);for(F=F||[];(this||u).pos<Wt;)F.push(this.readSVarint());return F},readPackedBoolean:function(F){if((this||u).type!==lu.Bytes)return F.push(this.readBoolean());var Wt=pu(this||u);for(F=F||[];(this||u).pos<Wt;)F.push(this.readBoolean());return F},readPackedFloat:function(F){if((this||u).type!==lu.Bytes)return F.push(this.readFloat());var Wt=pu(this||u);for(F=F||[];(this||u).pos<Wt;)F.push(this.readFloat());return F},readPackedDouble:function(F){if((this||u).type!==lu.Bytes)return F.push(this.readDouble());var Wt=pu(this||u);for(F=F||[];(this||u).pos<Wt;)F.push(this.readDouble());return F},readPackedFixed32:function(F){if((this||u).type!==lu.Bytes)return F.push(this.readFixed32());var Wt=pu(this||u);for(F=F||[];(this||u).pos<Wt;)F.push(this.readFixed32());return F},readPackedSFixed32:function(F){if((this||u).type!==lu.Bytes)return F.push(this.readSFixed32());var Wt=pu(this||u);for(F=F||[];(this||u).pos<Wt;)F.push(this.readSFixed32());return F},readPackedFixed64:function(F){if((this||u).type!==lu.Bytes)return F.push(this.readFixed64());var Wt=pu(this||u);for(F=F||[];(this||u).pos<Wt;)F.push(this.readFixed64());return F},readPackedSFixed64:function(F){if((this||u).type!==lu.Bytes)return F.push(this.readSFixed64());var Wt=pu(this||u);for(F=F||[];(this||u).pos<Wt;)F.push(this.readSFixed64());return F},skip:function(F){var Wt=7&F;if(Wt===lu.Varint)for(;(this||u).buf[(this||u).pos++]>127;);else if(Wt===lu.Bytes)(this||u).pos=this.readVarint()+(this||u).pos;else if(Wt===lu.Fixed32)(this||u).pos+=4;else{if(Wt!==lu.Fixed64)throw new Error("Unimplemented type: "+Wt);(this||u).pos+=8}},writeTag:function(u,F){this.writeVarint(u<<3|F)},realloc:function(F){for(var Wt=(this||u).length||16;Wt<(this||u).pos+F;)Wt*=2;if(Wt!==(this||u).length){var Xe=new Uint8Array(Wt);Xe.set((this||u).buf),(this||u).buf=Xe,(this||u).length=Wt}},finish:function(){return(this||u).length=(this||u).pos,(this||u).pos=0,(this||u).buf.subarray(0,(this||u).length)},writeFixed32:function(F){this.realloc(4),ku((this||u).buf,F,(this||u).pos),(this||u).pos+=4},writeSFixed32:function(F){this.realloc(4),ku((this||u).buf,F,(this||u).pos),(this||u).pos+=4},writeFixed64:function(F){this.realloc(8),ku((this||u).buf,-1&F,(this||u).pos),ku((this||u).buf,Math.floor(F*Td),(this||u).pos+4),(this||u).pos+=8},writeSFixed64:function(F){this.realloc(8),ku((this||u).buf,-1&F,(this||u).pos),ku((this||u).buf,Math.floor(F*Td),(this||u).pos+4),(this||u).pos+=8},writeVarint:function(F){(F=+F||0)>268435455||F<0?function(u,F){var Wt,Xe;if(u>=0?(Wt=u%4294967296|0,Xe=u/4294967296|0):(Xe=~(-u/4294967296),4294967295^(Wt=~(-u%4294967296))?Wt=Wt+1|0:(Wt=0,Xe=Xe+1|0)),u>=0x10000000000000000||u<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");F.realloc(10),function(u,F,Wt){Wt.buf[Wt.pos++]=127&u|128,u>>>=7,Wt.buf[Wt.pos++]=127&u|128,u>>>=7,Wt.buf[Wt.pos++]=127&u|128,u>>>=7,Wt.buf[Wt.pos++]=127&u|128,Wt.buf[Wt.pos]=127&(u>>>=7)}(Wt,0,F),function(u,F){var Wt=(7&u)<<4;F.buf[F.pos++]|=Wt|((u>>>=3)?128:0),u&&(F.buf[F.pos++]=127&u|((u>>>=7)?128:0),u&&(F.buf[F.pos++]=127&u|((u>>>=7)?128:0),u&&(F.buf[F.pos++]=127&u|((u>>>=7)?128:0),u&&(F.buf[F.pos++]=127&u|((u>>>=7)?128:0),u&&(F.buf[F.pos++]=127&u)))))}(Xe,F)}(F,this||u):(this.realloc(4),(this||u).buf[(this||u).pos++]=127&F|(F>127?128:0),F<=127||((this||u).buf[(this||u).pos++]=127&(F>>>=7)|(F>127?128:0),F<=127||((this||u).buf[(this||u).pos++]=127&(F>>>=7)|(F>127?128:0),F<=127||((this||u).buf[(this||u).pos++]=F>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(Boolean(u))},writeString:function(F){F=String(F),this.realloc(4*F.length),(this||u).pos++;var Wt=(this||u).pos;(this||u).pos=function(u,F,Wt){for(var Xe,Vi,fr=0;fr<F.length;fr++){if((Xe=F.charCodeAt(fr))>55295&&Xe<57344){if(!Vi){Xe>56319||fr+1===F.length?(u[Wt++]=239,u[Wt++]=191,u[Wt++]=189):Vi=Xe;continue}if(Xe<56320){u[Wt++]=239,u[Wt++]=191,u[Wt++]=189,Vi=Xe;continue}Xe=Vi-55296<<10|Xe-56320|65536,Vi=null}else Vi&&(u[Wt++]=239,u[Wt++]=191,u[Wt++]=189,Vi=null);Xe<128?u[Wt++]=Xe:(Xe<2048?u[Wt++]=Xe>>6|192:(Xe<65536?u[Wt++]=Xe>>12|224:(u[Wt++]=Xe>>18|240,u[Wt++]=Xe>>12&63|128),u[Wt++]=Xe>>6&63|128),u[Wt++]=63&Xe|128)}return Wt}((this||u).buf,F,(this||u).pos);var Xe=(this||u).pos-Wt;Xe>=128&&du(Wt,Xe,this||u),(this||u).pos=Wt-1,this.writeVarint(Xe),(this||u).pos+=Xe},writeFloat:function(F){this.realloc(4),ou((this||u).buf,F,(this||u).pos,!0,23,4),(this||u).pos+=4},writeDouble:function(F){this.realloc(8),ou((this||u).buf,F,(this||u).pos,!0,52,8),(this||u).pos+=8},writeBytes:function(F){var Wt=F.length;this.writeVarint(Wt),this.realloc(Wt);for(var Xe=0;Xe<Wt;Xe++)(this||u).buf[(this||u).pos++]=F[Xe]},writeRawMessage:function(F,Wt){(this||u).pos++;var Xe=(this||u).pos;F(Wt,this||u);var Vi=(this||u).pos-Xe;Vi>=128&&du(Xe,Vi,this||u),(this||u).pos=Xe-1,this.writeVarint(Vi),(this||u).pos+=Vi},writeMessage:function(u,F,Wt){this.writeTag(u,lu.Bytes),this.writeRawMessage(F,Wt)},writePackedVarint:function(u,F){F.length&&this.writeMessage(u,yu,F)},writePackedSVarint:function(u,F){F.length&&this.writeMessage(u,mu,F)},writePackedBoolean:function(u,F){F.length&&this.writeMessage(u,vu,F)},writePackedFloat:function(u,F){F.length&&this.writeMessage(u,gu,F)},writePackedDouble:function(u,F){F.length&&this.writeMessage(u,xu,F)},writePackedFixed32:function(u,F){F.length&&this.writeMessage(u,bu,F)},writePackedSFixed32:function(u,F){F.length&&this.writeMessage(u,wu,F)},writePackedFixed64:function(u,F){F.length&&this.writeMessage(u,_u,F)},writePackedSFixed64:function(u,F){F.length&&this.writeMessage(u,Au,F)},writeBytesField:function(u,F){this.writeTag(u,lu.Bytes),this.writeBytes(F)},writeFixed32Field:function(u,F){this.writeTag(u,lu.Fixed32),this.writeFixed32(F)},writeSFixed32Field:function(u,F){this.writeTag(u,lu.Fixed32),this.writeSFixed32(F)},writeFixed64Field:function(u,F){this.writeTag(u,lu.Fixed64),this.writeFixed64(F)},writeSFixed64Field:function(u,F){this.writeTag(u,lu.Fixed64),this.writeSFixed64(F)},writeVarintField:function(u,F){this.writeTag(u,lu.Varint),this.writeVarint(F)},writeSVarintField:function(u,F){this.writeTag(u,lu.Varint),this.writeSVarint(F)},writeStringField:function(u,F){this.writeTag(u,lu.Bytes),this.writeString(F)},writeFloatField:function(u,F){this.writeTag(u,lu.Fixed32),this.writeFloat(F)},writeDoubleField:function(u,F){this.writeTag(u,lu.Fixed64),this.writeDouble(F)},writeBooleanField:function(u,F){this.writeVarintField(u,Boolean(F))}};var Id=r(bd);const Pd=3;function Pu(u,F,Wt){1===u&&Wt.readMessage(Cu,F)}function Cu(u,F,Wt){if(3===u){const{id:u,bitmap:Xe,width:Vi,height:fr,left:_r,top:wr,advance:Ar}=Wt.readMessage(Bu,{});F.push({id:u,bitmap:new _o({width:Vi+2*Pd,height:fr+2*Pd},Xe),metrics:{width:Vi,height:fr,left:_r,top:wr,advance:Ar}})}}function Bu(u,F,Wt){1===u?F.id=Wt.readVarint():2===u?F.bitmap=Wt.readBytes():3===u?F.width=Wt.readVarint():4===u?F.height=Wt.readVarint():5===u?F.left=Wt.readSVarint():6===u?F.top=Wt.readSVarint():7===u&&(F.advance=Wt.readVarint())}const Ad=Pd;function Eu(u){let F=0,Wt=0;for(const Xe of u)F+=Xe.w*Xe.h,Wt=Math.max(Wt,Xe.w);u.sort(((u,F)=>F.h-u.h));const Xe=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(F/.95)),Wt),h:1/0}];let Vi=0,fr=0;for(const F of u)for(let u=Xe.length-1;u>=0;u--){const Wt=Xe[u];if(!(F.w>Wt.w||F.h>Wt.h)){if(F.x=Wt.x,F.y=Wt.y,fr=Math.max(fr,F.y+F.h),Vi=Math.max(Vi,F.x+F.w),F.w===Wt.w&&F.h===Wt.h){const F=Xe.pop();u<Xe.length&&(Xe[u]=F)}else F.h===Wt.h?(Wt.x+=F.w,Wt.w-=F.w):F.w===Wt.w?(Wt.y+=F.h,Wt.h-=F.h):(Xe.push({x:Wt.x+F.w,y:Wt.y,w:Wt.w-F.w,h:F.h}),Wt.y+=F.h,Wt.h-=F.h);break}}return{w:Vi,h:fr,fill:F/(Vi*fr)||0}}const Md=1;class Tu{constructor(u,{pixelRatio:F,version:Wt,stretchX:Xe,stretchY:Vi,content:fr,textFitWidth:_r,textFitHeight:wr}){this.paddedRect=u,this.pixelRatio=F,this.stretchX=Xe,this.stretchY=Vi,this.content=fr,this.version=Wt,this.textFitWidth=_r,this.textFitHeight=wr}get tl(){return[this.paddedRect.x+Md,this.paddedRect.y+Md]}get br(){return[this.paddedRect.x+this.paddedRect.w-Md,this.paddedRect.y+this.paddedRect.h-Md]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Md)/this.pixelRatio,(this.paddedRect.h-2*Md)/this.pixelRatio]}}class $u{constructor(u,F){const Wt={},Xe={};this.haveRenderCallbacks=[];const Vi=[];this.addImages(u,Wt,Vi),this.addImages(F,Xe,Vi);const{w:fr,h:_r}=Eu(Vi),wr=new Ao({width:fr||1,height:_r||1});for(const F in u){const Xe=u[F],Vi=Wt[F].paddedRect;Ao.copy(Xe.data,wr,{x:0,y:0},{x:Vi.x+Md,y:Vi.y+Md},Xe.data)}for(const u in F){const Wt=F[u],Vi=Xe[u].paddedRect,fr=Vi.x+Md,_r=Vi.y+Md,Ar=Wt.data.width,Kr=Wt.data.height;Ao.copy(Wt.data,wr,{x:0,y:0},{x:fr,y:_r},Wt.data),Ao.copy(Wt.data,wr,{x:0,y:Kr-1},{x:fr,y:_r-1},{width:Ar,height:1}),Ao.copy(Wt.data,wr,{x:0,y:0},{x:fr,y:_r+Kr},{width:Ar,height:1}),Ao.copy(Wt.data,wr,{x:Ar-1,y:0},{x:fr-1,y:_r},{width:1,height:Kr}),Ao.copy(Wt.data,wr,{x:0,y:0},{x:fr+Ar,y:_r},{width:1,height:Kr})}this.image=wr,this.iconPositions=Wt,this.patternPositions=Xe}addImages(u,F,Wt){for(const Xe in u){const Vi=u[Xe],fr={x:0,y:0,w:Vi.data.width+2*Md,h:Vi.data.height+2*Md};Wt.push(fr),F[Xe]=new Tu(fr,Vi),Vi.hasRenderCallback&&this.haveRenderCallbacks.push(Xe)}}patchUpdatedImages(u,F){u.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const Wt in u.updatedImages)this.patchUpdatedImage(this.iconPositions[Wt],u.getImage(Wt),F),this.patchUpdatedImage(this.patternPositions[Wt],u.getImage(Wt),F)}patchUpdatedImage(u,F,Wt){if(!u||!F)return;if(u.version===F.version)return;u.version=F.version;const[Xe,Vi]=u.tl;Wt.update(F.data,void 0,{x:Xe,y:Vi})}}var kd;wi("ImagePosition",Tu),wi("ImageAtlas",$u),F.ah=void 0,(kd=F.ah||(F.ah={}))[kd.none=0]="none",kd[kd.horizontal=1]="horizontal",kd[kd.vertical=2]="vertical",kd[kd.horizontalOnly=3]="horizontalOnly";const Cd=-17;class Ou{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(u,F){const Wt=new Ou;return Wt.scale=u||1,Wt.fontStack=F,Wt}static forImage(u){const F=new Ou;return F.imageName=u,F}}class ju{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(u,F){const Wt=new ju;for(let Xe=0;Xe<u.sections.length;Xe++){const Vi=u.sections[Xe];Vi.image?Wt.addImageSection(Vi):Wt.addTextSection(Vi,F)}return Wt}length(){return this.text.length}getSection(u){return this.sections[this.sectionIndex[u]]}getSectionIndex(u){return this.sectionIndex[u]}getCharCode(u){return this.text.charCodeAt(u)}verticalizePunctuation(){this.text=function(u){let F="";for(let Wt=0;Wt<u.length;Wt++){const Xe=u.charCodeAt(Wt+1)||null,Vi=u.charCodeAt(Wt-1)||null;F+=Xe&&$i(Xe)&&!xd[u[Wt+1]]||Vi&&$i(Vi)&&!xd[u[Wt-1]]||!xd[u[Wt]]?u[Wt]:xd[u[Wt]]}return F}(this.text)}trim(){let u=0;for(let F=0;F<this.text.length&&Ed[this.text.charCodeAt(F)];F++)u++;let F=this.text.length;for(let Wt=this.text.length-1;Wt>=0&&Wt>=u&&Ed[this.text.charCodeAt(Wt)];Wt--)F--;this.text=this.text.substring(u,F),this.sectionIndex=this.sectionIndex.slice(u,F)}substring(u,F){const Wt=new ju;return Wt.text=this.text.substring(u,F),Wt.sectionIndex=this.sectionIndex.slice(u,F),Wt.sections=this.sections,Wt}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((u,F)=>Math.max(u,this.sections[F].scale)),0)}addTextSection(u,F){this.text+=u.text,this.sections.push(Ou.forText(u.scale,u.fontStack||F));const Wt=this.sections.length-1;for(let F=0;F<u.text.length;++F)this.sectionIndex.push(Wt)}addImageSection(u){const F=u.image?u.image.name:"";if(0===F.length)return void A("Can't add FormattedSection with an empty image.");const Wt=this.getNextImageSectionCharCode();Wt?(this.text+=String.fromCharCode(Wt),this.sections.push(Ou.forImage(F)),this.sectionIndex.push(this.sections.length-1)):A("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ru(u,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua,Da){const io=ju.fromFeature(u,fr);let no;ca===F.ah.vertical&&io.verticalizePunctuation();const{processBidirectionalText:so,processStyledBidirectionalText:ao}=ih;if(so&&1===io.sections.length){no=[];const u=so(io.toString(),Yu(io,In,_r,Wt,Vi,ua));for(const F of u){const u=new ju;u.text=F,u.sections=io.sections;for(let Wt=0;Wt<F.length;Wt++)u.sectionIndex.push(0);no.push(u)}}else if(ao){no=[];const u=ao(io.text,io.sectionIndex,Yu(io,In,_r,Wt,Vi,ua));for(const F of u){const u=new ju;u.text=F[0],u.sectionIndex=F[1],u.sections=io.sections,no.push(u)}}else no=function(u,F){const Wt=[],Xe=u.text;let Vi=0;for(const Xe of F)Wt.push(u.substring(Vi,Xe)),Vi=Xe;return Vi<Xe.length&&Wt.push(u.substring(Vi,Xe.length)),Wt}(io,Yu(io,In,_r,Wt,Vi,ua));const oo=[],co={positionedLines:oo,text:io.toString(),top:ns[1],bottom:ns[1],left:ns[0],right:ns[0],writingMode:ca,iconsInText:!1,verticalizable:!1};return function(u,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca){let ha=0,ua=Cd,Da=0,io=0;const no="right"===Ar?1:"left"===Ar?0:.5;let so=0;for(const wr of fr){wr.trim();const fr=wr.getMaxScale(),Ar=(fr-1)*vd,oo={positionedGlyphs:[],lineOffset:0};u.positionedLines[so]=oo;const co=oo.positionedGlyphs;let ho=0;if(!wr.length()){ua+=_r,++so;continue}for(let _r=0;_r<wr.length();_r++){const Da=wr.getSection(_r),io=wr.getSectionIndex(_r),no=wr.getCharCode(_r);let so=0,oo=null,go=null,xo=null,Io=vd;const ko=!(Kr===F.ah.horizontal||!ns&&!Ti(no)||ns&&(Ed[no]||(ao=no,/\p{sc=Arab}/u.test(String.fromCodePoint(ao)))));if(Da.imageName){const F=Vi[Da.imageName];if(!F)continue;xo=Da.imageName,u.iconsInText=u.iconsInText||!0,go=F.paddedRect;const Wt=F.displaySize;Da.scale=Da.scale*vd/ca,oo={width:Wt[0],height:Wt[1],left:Md,top:-Ad,advance:ko?Wt[1]:Wt[0]},so=Ar+(vd-Wt[1]*Da.scale),Io=oo.advance;const Xe=ko?Wt[0]*Da.scale-vd*fr:Wt[1]*Da.scale-vd*fr;Xe>0&&Xe>ho&&(ho=Xe)}else{const u=Xe[Da.fontStack],F=u&&u[no];if(F&&F.rect)go=F.rect,oo=F.metrics;else{const u=Wt[Da.fontStack],F=u&&u[no];if(!F)continue;oo=F.metrics}so=(fr-Da.scale)*vd}ko?(u.verticalizable=!0,co.push({glyph:no,imageName:xo,x:ha,y:ua+so,vertical:ko,scale:Da.scale,fontStack:Da.fontStack,sectionIndex:io,metrics:oo,rect:go}),ha+=Io*Da.scale+In):(co.push({glyph:no,imageName:xo,x:ha,y:ua+so,vertical:ko,scale:Da.scale,fontStack:Da.fontStack,sectionIndex:io,metrics:oo,rect:go}),ha+=oo.advance*Da.scale+In)}0!==co.length&&(Da=Math.max(ha-In,Da),Wu(co,0,co.length-1,no,ho)),ha=0;const go=_r*fr+ho;oo.lineOffset=Math.max(ho,Ar),ua+=go,io=Math.max(go,io),++so}var ao;const oo=ua-Cd,{horizontalAlign:co,verticalAlign:ho}=Ju(wr);(function(u,F,Wt,Xe,Vi,fr,_r,wr,Ar){const Kr=(F-Wt)*Vi;let In=0;In=fr!==_r?-wr*Xe-Cd:(-Xe*Ar+.5)*_r;for(const F of u)for(const u of F.positionedGlyphs)u.x+=Kr,u.y+=In})(u.positionedLines,no,co,ho,Da,io,_r,oo,fr.length),u.top+=-ho*oo,u.bottom=u.top+oo,u.left+=-co*Da,u.right=u.left+Da}(co,Wt,Xe,Vi,no,wr,Ar,Kr,ca,In,ha,Da),!function(u){for(const F of u)if(0!==F.positionedGlyphs.length)return!1;return!0}(oo)&&co}const Ed={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},zd={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Dd={40:!0};function Zu(u,F,Wt,Xe,Vi,fr){if(F.imageName){const u=Xe[F.imageName];return u?u.displaySize[0]*F.scale*vd/fr+Vi:0}{const Xe=Wt[F.fontStack],fr=Xe&&Xe[u];return fr?fr.metrics.advance*F.scale+Vi:0}}function Gu(u,F,Wt,Xe){const Vi=Math.pow(u-F,2);return Xe?u<F?Vi/2:2*Vi:Vi+Math.abs(Wt)*Wt}function Ku(u,F,Wt){let Xe=0;return 10===u&&(Xe-=1e4),Wt&&(Xe+=150),40!==u&&65288!==u||(Xe+=50),41!==F&&65289!==F||(Xe+=50),Xe}function Xu(u,F,Wt,Xe,Vi,fr){let _r=null,wr=Gu(F,Wt,Vi,fr);for(const u of Xe){const Xe=Gu(F-u.x,Wt,Vi,fr)+u.badness;Xe<=wr&&(_r=u,wr=Xe)}return{index:u,x:F,priorBreak:_r,badness:wr}}function Hu(u){return u?Hu(u.priorBreak).concat(u.index):[]}function Yu(u,F,Wt,Xe,Vi,fr){if(!u)return[];const _r=[],wr=function(u,F,Wt,Xe,Vi,fr){let _r=0;for(let Wt=0;Wt<u.length();Wt++){const wr=u.getSection(Wt);_r+=Zu(u.getCharCode(Wt),wr,Xe,Vi,F,fr)}return _r/Math.max(1,Math.ceil(_r/Wt))}(u,F,Wt,Xe,Vi,fr),Ar=u.text.indexOf("")>=0;let Kr=0;for(let Wt=0;Wt<u.length();Wt++){const ns=u.getSection(Wt),ca=u.getCharCode(Wt);if(Ed[ca]||(Kr+=Zu(ca,ns,Xe,Vi,F,fr)),Wt<u.length()-1){const F=!((In=ca)<11904)&&(!!Sc["CJK Compatibility Forms"](In)||!!Sc["CJK Compatibility"](In)||!!Sc["CJK Strokes"](In)||!!Sc["CJK Symbols and Punctuation"](In)||!!Sc["Enclosed CJK Letters and Months"](In)||!!Sc["Halfwidth and Fullwidth Forms"](In)||!!Sc["Ideographic Description Characters"](In)||!!Sc["Vertical Forms"](In)||Cc.test(String.fromCodePoint(In)));(zd[ca]||F||ns.imageName||Wt!==u.length()-2&&Dd[u.getCharCode(Wt+1)])&&_r.push(Xu(Wt+1,Kr,wr,_r,Ku(ca,u.getCharCode(Wt+1),F&&Ar),!1))}}var In;return Hu(Xu(u.length(),Kr,wr,_r,0,!0))}function Ju(u){let F=.5,Wt=.5;switch(u){case"right":case"top-right":case"bottom-right":F=1;break;case"left":case"top-left":case"bottom-left":F=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":Wt=1;break;case"top":case"top-right":case"top-left":Wt=0}return{horizontalAlign:F,verticalAlign:Wt}}function Wu(u,F,Wt,Xe,Vi){if(!Xe&&!Vi)return;const fr=u[Wt],_r=(u[Wt].x+fr.metrics.advance*fr.scale)*Xe;for(let Xe=F;Xe<=Wt;Xe++)u[Xe].x-=_r,u[Xe].y+=Vi}function Qu(u,F,Wt){const{horizontalAlign:Xe,verticalAlign:Vi}=Ju(Wt),fr=F[0]-u.displaySize[0]*Xe,_r=F[1]-u.displaySize[1]*Vi;return{image:u,top:_r,bottom:_r+u.displaySize[1],left:fr,right:fr+u.displaySize[0]}}function tc(u){var F,Wt;let Xe=u.left,Vi=u.top,fr=u.right-Xe,_r=u.bottom-Vi;const wr=null!==(F=u.image.textFitWidth)&&void 0!==F?F:"stretchOrShrink",Ar=null!==(Wt=u.image.textFitHeight)&&void 0!==Wt?Wt:"stretchOrShrink",Kr=(u.image.content[2]-u.image.content[0])/(u.image.content[3]-u.image.content[1]);if("proportional"===Ar){if("stretchOnly"===wr&&fr/_r<Kr||"proportional"===wr){const u=Math.ceil(_r*Kr);Xe*=u/fr,fr=u}}else if("proportional"===wr&&"stretchOnly"===Ar&&0!==Kr&&fr/_r>Kr){const u=Math.ceil(fr/Kr);Vi*=u/_r,_r=u}return{x1:Xe,y1:Vi,x2:Xe+fr,y2:Vi+_r}}function ec(u,F,Wt,Xe,Vi,fr){const _r=u.image;let wr;if(_r.content){const u=_r.content,F=_r.pixelRatio||1;wr=[u[0]/F,u[1]/F,_r.displaySize[0]-u[2]/F,_r.displaySize[1]-u[3]/F]}const Ar=F.left*fr,Kr=F.right*fr;let In,ns,ca,ha;"width"===Wt||"both"===Wt?(ha=Vi[0]+Ar-Xe[3],ns=Vi[0]+Kr+Xe[1]):(ha=Vi[0]+(Ar+Kr-_r.displaySize[0])/2,ns=ha+_r.displaySize[0]);const ua=F.top*fr,Da=F.bottom*fr;return"height"===Wt||"both"===Wt?(In=Vi[1]+ua-Xe[0],ca=Vi[1]+Da+Xe[2]):(In=Vi[1]+(ua+Da-_r.displaySize[1])/2,ca=In+_r.displaySize[1]),{image:_r,top:In,right:ns,bottom:ca,left:ha,collisionPadding:wr}}const Ld=255,Rd=128,Bd=Ld*Rd;function sc(u,F){const{expression:Wt}=F;if("constant"===Wt.kind)return{kind:"constant",layoutSize:Wt.evaluate(new Ui(u+1))};if("source"===Wt.kind)return{kind:"source"};{const{zoomStops:F,interpolationType:Xe}=Wt;let Vi=0;for(;Vi<F.length&&F[Vi]<=u;)Vi++;Vi=Math.max(0,Vi-1);let fr=Vi;for(;fr<F.length&&F[fr]<u+1;)fr++;fr=Math.min(F.length-1,fr);const _r=F[Vi],wr=F[fr];return"composite"===Wt.kind?{kind:"composite",minZoom:_r,maxZoom:wr,interpolationType:Xe}:{kind:"camera",minZoom:_r,maxZoom:wr,minSize:Wt.evaluate(new Ui(_r)),maxSize:Wt.evaluate(new Ui(wr)),interpolationType:Xe}}}function ac(u,F,Wt){let Xe="never";const Vi=u.get(F);return Vi?Xe=Vi:u.get(Wt)&&(Xe="always"),Xe}const Fd=Du.VectorTileFeature.types,Od=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function uc(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca){const ha=wr?Math.min(Bd,Math.round(wr[0])):0,ua=wr?Math.min(Bd,Math.round(wr[1])):0;u.emplaceBack(F,Wt,Math.round(32*Xe),Math.round(32*Vi),fr,_r,(ha<<1)+(Ar?1:0),ua,16*Kr,16*In,256*ns,256*ca)}function cc(u,F,Wt){u.emplaceBack(F.x,F.y,Wt),u.emplaceBack(F.x,F.y,Wt),u.emplaceBack(F.x,F.y,Wt),u.emplaceBack(F.x,F.y,Wt)}function hc(u){for(const F of u.sections)if(ji(F.text))return!0;return!1}class pc{constructor(u){this.layoutVertexArray=new Ws,this.indexArray=new na,this.programConfigurations=u,this.segments=new oa,this.dynamicLayoutVertexArray=new Qs,this.opacityVertexArray=new ta,this.hasVisibleVertices=!1,this.placedSymbolArray=new $s}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(u,F,Wt,Xe){this.isEmpty()||(Wt&&(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,fd.members),this.indexBuffer=u.createIndexBuffer(this.indexArray,F),this.dynamicLayoutVertexBuffer=u.createVertexBuffer(this.dynamicLayoutVertexArray,md.members,!0),this.opacityVertexBuffer=u.createVertexBuffer(this.opacityVertexArray,Od,!0),this.opacityVertexBuffer.itemSize=1),(Wt||Xe)&&this.programConfigurations.upload(u))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}wi("SymbolBuffers",pc);class fc{constructor(u,F,Wt){this.layoutVertexArray=new u,this.layoutAttributes=F,this.indexArray=new Wt,this.segments=new oa,this.collisionVertexArray=new ra}upload(u){this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=u.createVertexBuffer(this.collisionVertexArray,_d.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}wi("CollisionBuffers",fc);class dc{constructor(u){this.collisionBoxArray=u.collisionBoxArray,this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=u.index,this.pixelRatio=u.pixelRatio,this.sourceLayerIndex=u.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=lo([]),this.placementViewportMatrix=lo([]);const Wt=this.layers[0]._unevaluatedLayout._values;this.textSizeData=sc(this.zoom,Wt["text-size"]),this.iconSizeData=sc(this.zoom,Wt["icon-size"]);const Xe=this.layers[0].layout,Vi=Xe.get("symbol-sort-key"),fr=Xe.get("symbol-z-order");this.canOverlap="never"!==ac(Xe,"text-overlap","text-allow-overlap")||"never"!==ac(Xe,"icon-overlap","icon-allow-overlap")||Xe.get("text-ignore-placement")||Xe.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==fr&&!Vi.isConstant(),this.sortFeaturesByY=("viewport-y"===fr||"auto"===fr&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===Xe.get("symbol-placement")&&(this.writingModes=Xe.get("text-writing-mode").map((u=>F.ah[u]))),this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id)),this.sourceID=u.sourceID}createArrays(){this.text=new pc(new Ea(this.layers,this.zoom,(u=>/^text/.test(u)))),this.icon=new pc(new Ea(this.layers,this.zoom,(u=>/^icon/.test(u)))),this.glyphOffsetArray=new Os,this.lineVertexArray=new js,this.symbolInstances=new Ds,this.textAnchorOffsets=new Us}calculateGlyphDependencies(u,F,Wt,Xe,Vi){for(let fr=0;fr<u.length;fr++)if(F[u.charCodeAt(fr)]=!0,(Wt||Xe)&&Vi){const Wt=xd[u.charAt(fr)];Wt&&(F[Wt.charCodeAt(0)]=!0)}}populate(u,Wt,Xe){const Vi=this.layers[0],fr=Vi.layout,_r=fr.get("text-font"),wr=fr.get("text-field"),Ar=fr.get("icon-image"),Kr=("constant"!==wr.value.kind||wr.value.value instanceof Yt&&!wr.value.value.isEmpty()||wr.value.value.toString().length>0)&&("constant"!==_r.value.kind||_r.value.value.length>0),In="constant"!==Ar.value.kind||!!Ar.value.value||Object.keys(Ar.parameters).length>0,ns=fr.get("symbol-sort-key");if(this.features=[],!Kr&&!In)return;const ca=Wt.iconDependencies,ha=Wt.glyphDependencies,ua=Wt.availableImages,Da=new Ui(this.zoom);for(const{feature:Wt,id:wr,index:Ar,sourceLayerIndex:io}of u){const u=Vi._featureFilter.needGeometry,no=ja(Wt,u);if(!Vi._featureFilter.filter(Da,no,Xe))continue;let so,ao;if(u||(no.geometry=Oa(Wt)),Kr){const u=Vi.getValueAndResolveTokens("text-field",no,Xe,ua),F=Yt.factory(u),Wt=this.hasRTLText=this.hasRTLText||hc(F);(!Wt||"unavailable"===ih.getRTLTextPluginStatus()||Wt&&ih.isParsed())&&(so=ru(F,Vi,no))}if(In){const u=Vi.getValueAndResolveTokens("icon-image",no,Xe,ua);ao=u instanceof te?u:te.fromString(u)}if(!so&&!ao)continue;const oo=this.sortFeaturesByKey?ns.evaluate(no,{},Xe):void 0;if(this.features.push({id:wr,text:so,icon:ao,index:Ar,sourceLayerIndex:io,geometry:no.geometry,properties:Wt.properties,type:Fd[Wt.type],sortKey:oo}),ao&&(ca[ao.name]=!0),so){const u=_r.evaluate(no,{},Xe).join(","),Wt="viewport"!==fr.get("text-rotation-alignment")&&"point"!==fr.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(F.ah.vertical)>=0;for(const F of so.sections)if(F.image)ca[F.image.name]=!0;else{const Xe=Pi(so.toString()),Vi=F.fontStack||u,fr=ha[Vi]=ha[Vi]||{};this.calculateGlyphDependencies(F.text,fr,Wt,this.allowVerticalPlacement,Xe)}}}"line"===fr.get("symbol-placement")&&(this.features=function(u){const F={},Wt={},Xe=[];let Vi=0;function s(F){Xe.push(u[F]),Vi++}function a(u,F,Vi){const fr=Wt[u];return delete Wt[u],Wt[F]=fr,Xe[fr].geometry[0].pop(),Xe[fr].geometry[0]=Xe[fr].geometry[0].concat(Vi[0]),fr}function o(u,Wt,Vi){const fr=F[Wt];return delete F[Wt],F[u]=fr,Xe[fr].geometry[0].shift(),Xe[fr].geometry[0]=Vi[0].concat(Xe[fr].geometry[0]),fr}function l(u,F,Wt){const Xe=Wt?F[0][F[0].length-1]:F[0][0];return`${u}:${Xe.x}:${Xe.y}`}for(let fr=0;fr<u.length;fr++){const _r=u[fr],wr=_r.geometry,Ar=_r.text?_r.text.toString():null;if(!Ar){s(fr);continue}const Kr=l(Ar,wr),In=l(Ar,wr,!0);if(Kr in Wt&&In in F&&Wt[Kr]!==F[In]){const u=o(Kr,In,wr),Vi=a(Kr,In,Xe[u].geometry);delete F[Kr],delete Wt[In],Wt[l(Ar,Xe[Vi].geometry,!0)]=Vi,Xe[u].geometry=null}else Kr in Wt?a(Kr,In,wr):In in F?o(Kr,In,wr):(s(fr),F[Kr]=Vi-1,Wt[In]=Vi-1)}return Xe.filter((u=>u.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((u,F)=>u.sortKey-F.sortKey))}update(u,F,Wt){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(u,F,this.layers,Wt),this.icon.programConfigurations.updatePaintArrays(u,F,this.layers,Wt))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(u){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(u),this.iconCollisionBox.upload(u)),this.text.upload(u,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(u,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(u,F){const Wt=this.lineVertexArray.length;if(void 0!==u.segment){let Wt=u.dist(F[u.segment+1]),Xe=u.dist(F[u.segment]);const Vi={};for(let Xe=u.segment+1;Xe<F.length;Xe++)Vi[Xe]={x:F[Xe].x,y:F[Xe].y,tileUnitDistanceFromAnchor:Wt},Xe<F.length-1&&(Wt+=F[Xe+1].dist(F[Xe]));for(let Wt=u.segment||0;Wt>=0;Wt--)Vi[Wt]={x:F[Wt].x,y:F[Wt].y,tileUnitDistanceFromAnchor:Xe},Wt>0&&(Xe+=F[Wt-1].dist(F[Wt]));for(let u=0;u<F.length;u++){const F=Vi[u];this.lineVertexArray.emplaceBack(F.x,F.y,F.tileUnitDistanceFromAnchor)}}return{lineStartIndex:Wt,lineLength:this.lineVertexArray.length-Wt}}addSymbols(u,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca){const ha=u.indexArray,ua=u.layoutVertexArray,Da=u.segments.prepareSegment(4*Wt.length,ua,ha,this.canOverlap?_r.sortKey:void 0),io=this.glyphOffsetArray.length,no=Da.vertexLength,so=this.allowVerticalPlacement&&wr===F.ah.vertical?Math.PI/2:0,ao=_r.text&&_r.text.sections;for(let F=0;F<Wt.length;F++){const{tl:Vi,tr:fr,bl:wr,br:Kr,tex:In,pixelOffsetTL:ns,pixelOffsetBR:io,minFontScaleX:no,minFontScaleY:oo,glyphOffset:co,isSDF:ho,sectionIndex:go}=Wt[F],xo=Da.vertexLength,Io=co[1];uc(ua,Ar.x,Ar.y,Vi.x,Io+Vi.y,In.x,In.y,Xe,ho,ns.x,ns.y,no,oo),uc(ua,Ar.x,Ar.y,fr.x,Io+fr.y,In.x+In.w,In.y,Xe,ho,io.x,ns.y,no,oo),uc(ua,Ar.x,Ar.y,wr.x,Io+wr.y,In.x,In.y+In.h,Xe,ho,ns.x,io.y,no,oo),uc(ua,Ar.x,Ar.y,Kr.x,Io+Kr.y,In.x+In.w,In.y+In.h,Xe,ho,io.x,io.y,no,oo),cc(u.dynamicLayoutVertexArray,Ar,so),ha.emplaceBack(xo,xo+1,xo+2),ha.emplaceBack(xo+1,xo+2,xo+3),Da.vertexLength+=4,Da.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(co[0]),F!==Wt.length-1&&go===Wt[F+1].sectionIndex||u.programConfigurations.populatePaintArrays(ua.length,_r,_r.index,{},ca,ao&&ao[go])}u.placedSymbolArray.emplaceBack(Ar.x,Ar.y,io,this.glyphOffsetArray.length-io,no,Kr,In,Ar.segment,Xe?Xe[0]:0,Xe?Xe[1]:0,Vi[0],Vi[1],wr,0,!1,0,ns)}_addCollisionDebugVertex(u,F,Wt,Xe,Vi,fr){return F.emplaceBack(0,0),u.emplaceBack(Wt.x,Wt.y,Xe,Vi,Math.round(fr.x),Math.round(fr.y))}addCollisionDebugVertices(u,F,Wt,Vi,fr,_r,wr){const Ar=fr.segments.prepareSegment(4,fr.layoutVertexArray,fr.indexArray),Kr=Ar.vertexLength,In=fr.layoutVertexArray,ns=fr.collisionVertexArray,ca=wr.anchorX,ha=wr.anchorY;this._addCollisionDebugVertex(In,ns,_r,ca,ha,new Xe(u,F)),this._addCollisionDebugVertex(In,ns,_r,ca,ha,new Xe(Wt,F)),this._addCollisionDebugVertex(In,ns,_r,ca,ha,new Xe(Wt,Vi)),this._addCollisionDebugVertex(In,ns,_r,ca,ha,new Xe(u,Vi)),Ar.vertexLength+=4;const ua=fr.indexArray;ua.emplaceBack(Kr,Kr+1),ua.emplaceBack(Kr+1,Kr+2),ua.emplaceBack(Kr+2,Kr+3),ua.emplaceBack(Kr+3,Kr),Ar.primitiveLength+=4}addDebugCollisionBoxes(u,F,Wt,Xe){for(let Vi=u;Vi<F;Vi++){const u=this.collisionBoxArray.get(Vi);this.addCollisionDebugVertices(u.x1,u.y1,u.x2,u.y2,Xe?this.textCollisionBox:this.iconCollisionBox,u.anchorPoint,Wt)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fc(ea,gd.members,ia),this.iconCollisionBox=new fc(ea,gd.members,ia);for(let u=0;u<this.symbolInstances.length;u++){const F=this.symbolInstances.get(u);this.addDebugCollisionBoxes(F.textBoxStartIndex,F.textBoxEndIndex,F,!0),this.addDebugCollisionBoxes(F.verticalTextBoxStartIndex,F.verticalTextBoxEndIndex,F,!0),this.addDebugCollisionBoxes(F.iconBoxStartIndex,F.iconBoxEndIndex,F,!1),this.addDebugCollisionBoxes(F.verticalIconBoxStartIndex,F.verticalIconBoxEndIndex,F,!1)}}_deserializeCollisionBoxesForSymbol(u,F,Wt,Xe,Vi,fr,_r,wr,Ar){const Kr={};for(let Xe=F;Xe<Wt;Xe++){const F=u.get(Xe);Kr.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},Kr.textFeatureIndex=F.featureIndex;break}for(let F=Xe;F<Vi;F++){const Wt=u.get(F);Kr.verticalTextBox={x1:Wt.x1,y1:Wt.y1,x2:Wt.x2,y2:Wt.y2,anchorPointX:Wt.anchorPointX,anchorPointY:Wt.anchorPointY},Kr.verticalTextFeatureIndex=Wt.featureIndex;break}for(let F=fr;F<_r;F++){const Wt=u.get(F);Kr.iconBox={x1:Wt.x1,y1:Wt.y1,x2:Wt.x2,y2:Wt.y2,anchorPointX:Wt.anchorPointX,anchorPointY:Wt.anchorPointY},Kr.iconFeatureIndex=Wt.featureIndex;break}for(let F=wr;F<Ar;F++){const Wt=u.get(F);Kr.verticalIconBox={x1:Wt.x1,y1:Wt.y1,x2:Wt.x2,y2:Wt.y2,anchorPointX:Wt.anchorPointX,anchorPointY:Wt.anchorPointY},Kr.verticalIconFeatureIndex=Wt.featureIndex;break}return Kr}deserializeCollisionBoxes(u){this.collisionArrays=[];for(let F=0;F<this.symbolInstances.length;F++){const Wt=this.symbolInstances.get(F);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(u,Wt.textBoxStartIndex,Wt.textBoxEndIndex,Wt.verticalTextBoxStartIndex,Wt.verticalTextBoxEndIndex,Wt.iconBoxStartIndex,Wt.iconBoxEndIndex,Wt.verticalIconBoxStartIndex,Wt.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(u,F){const Wt=u.placedSymbolArray.get(F),Xe=Wt.vertexStartIndex+4*Wt.numGlyphs;for(let F=Wt.vertexStartIndex;F<Xe;F+=4)u.indexArray.emplaceBack(F,F+1,F+2),u.indexArray.emplaceBack(F+1,F+2,F+3)}getSortedSymbolIndexes(u){if(this.sortedAngle===u&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const F=Math.sin(u),Wt=Math.cos(u),Xe=[],Vi=[],fr=[];for(let u=0;u<this.symbolInstances.length;++u){fr.push(u);const _r=this.symbolInstances.get(u);Xe.push(0|Math.round(F*_r.anchorX+Wt*_r.anchorY)),Vi.push(_r.featureIndex)}return fr.sort(((u,F)=>Xe[u]-Xe[F]||Vi[F]-Vi[u])),fr}addToSortKeyRanges(u,F){const Wt=this.sortKeyRanges[this.sortKeyRanges.length-1];Wt&&Wt.sortKey===F?Wt.symbolInstanceEnd=u+1:this.sortKeyRanges.push({sortKey:F,symbolInstanceStart:u,symbolInstanceEnd:u+1})}sortFeatures(u){if(this.sortFeaturesByY&&this.sortedAngle!==u&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(u),this.sortedAngle=u,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const F=this.symbolInstances.get(u);this.featureSortOrder.push(F.featureIndex),[F.rightJustifiedTextSymbolIndex,F.centerJustifiedTextSymbolIndex,F.leftJustifiedTextSymbolIndex].forEach(((u,F,Wt)=>{u>=0&&Wt.indexOf(u)===F&&this.addIndicesForPlacedSymbol(this.text,u)})),F.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,F.verticalPlacedTextSymbolIndex),F.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,F.placedIconSymbolIndex),F.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,F.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Vd,jd;wi("SymbolBucket",dc,{omit:["layers","collisionBoxArray","features","compareText"]}),dc.MAX_GLYPHS=65535,dc.addDynamicAttributes=cc;var Nd={get paint(){return jd=jd||new rs({"icon-opacity":new Wi(so.paint_symbol["icon-opacity"]),"icon-color":new Wi(so.paint_symbol["icon-color"]),"icon-halo-color":new Wi(so.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wi(so.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wi(so.paint_symbol["icon-halo-blur"]),"icon-translate":new Ji(so.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ji(so.paint_symbol["icon-translate-anchor"]),"text-opacity":new Wi(so.paint_symbol["text-opacity"]),"text-color":new Wi(so.paint_symbol["text-color"],{runtimeType:xo,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Wi(so.paint_symbol["text-halo-color"]),"text-halo-width":new Wi(so.paint_symbol["text-halo-width"]),"text-halo-blur":new Wi(so.paint_symbol["text-halo-blur"]),"text-translate":new Ji(so.paint_symbol["text-translate"]),"text-translate-anchor":new Ji(so.paint_symbol["text-translate-anchor"])})},get layout(){return Vd=Vd||new rs({"symbol-placement":new Ji(so.layout_symbol["symbol-placement"]),"symbol-spacing":new Ji(so.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ji(so.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wi(so.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ji(so.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ji(so.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ji(so.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ji(so.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ji(so.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ji(so.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wi(so.layout_symbol["icon-size"]),"icon-text-fit":new Ji(so.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ji(so.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wi(so.layout_symbol["icon-image"]),"icon-rotate":new Wi(so.layout_symbol["icon-rotate"]),"icon-padding":new Wi(so.layout_symbol["icon-padding"]),"icon-keep-upright":new Ji(so.layout_symbol["icon-keep-upright"]),"icon-offset":new Wi(so.layout_symbol["icon-offset"]),"icon-anchor":new Wi(so.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ji(so.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ji(so.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ji(so.layout_symbol["text-rotation-alignment"]),"text-field":new Wi(so.layout_symbol["text-field"]),"text-font":new Wi(so.layout_symbol["text-font"]),"text-size":new Wi(so.layout_symbol["text-size"]),"text-max-width":new Wi(so.layout_symbol["text-max-width"]),"text-line-height":new Ji(so.layout_symbol["text-line-height"]),"text-letter-spacing":new Wi(so.layout_symbol["text-letter-spacing"]),"text-justify":new Wi(so.layout_symbol["text-justify"]),"text-radial-offset":new Wi(so.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ji(so.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Wi(so.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Wi(so.layout_symbol["text-anchor"]),"text-max-angle":new Ji(so.layout_symbol["text-max-angle"]),"text-writing-mode":new Ji(so.layout_symbol["text-writing-mode"]),"text-rotate":new Wi(so.layout_symbol["text-rotate"]),"text-padding":new Ji(so.layout_symbol["text-padding"]),"text-keep-upright":new Ji(so.layout_symbol["text-keep-upright"]),"text-transform":new Wi(so.layout_symbol["text-transform"]),"text-offset":new Wi(so.layout_symbol["text-offset"]),"text-allow-overlap":new Ji(so.layout_symbol["text-allow-overlap"]),"text-overlap":new Ji(so.layout_symbol["text-overlap"]),"text-ignore-placement":new Ji(so.layout_symbol["text-ignore-placement"]),"text-optional":new Ji(so.layout_symbol["text-optional"])})}};class xc{constructor(u){if(void 0===u.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=u.property.overrides?u.property.overrides.runtimeType:oo,this.defaultValue=u}evaluate(u){if(u.formattedSection){const F=this.defaultValue.property.overrides;if(F&&F.hasOverride(u.formattedSection))return F.getOverride(u.formattedSection)}return u.feature&&u.featureState?this.defaultValue.evaluate(u.feature,u.featureState):this.defaultValue.property.specification.default}eachChild(u){this.defaultValue.isConstant()||u(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}wi("FormatSectionOverride",xc,{omit:["defaultValue"]});class vc extends is{constructor(u){super(u,Nd)}recalculate(u,F){if(super.recalculate(u,F),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const u=this.layout.get("text-writing-mode");if(u){const F=[];for(const Wt of u)F.indexOf(Wt)<0&&F.push(Wt);this.layout._values["text-writing-mode"]=F}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(u,F,Wt,Xe){const Vi=this.layout.get(u).evaluate(F,{},Wt,Xe),fr=this._unevaluatedLayout._values[u];return fr.isDataDriven()||vn(fr.value)||!Vi?Vi:function(u,F){return F.replace(/{([^{}]+)}/g,((F,Wt)=>u&&Wt in u?String(u[Wt]):""))}(F.properties,Vi)}createBucket(u){return new dc(u)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const u of Nd.paint.overridableProperties){if(!vc.hasPaintOverride(this.layout,u))continue;const F=this.paint.get(u),Wt=new xc(F),Xe=new xn(Wt,F.property.specification);let Vi=null;Vi="constant"===F.value.kind||"source"===F.value.kind?new wn("source",Xe):new _n("composite",Xe,F.value.zoomStops),this.paint._values[u]=new Hi(F.property,Vi,F.parameters)}}_handleOverridablePaintPropertyUpdate(u,F,Wt){return!(!this.layout||F.isDataDriven()||Wt.isDataDriven())&&vc.hasPaintOverride(this.layout,u)}static hasPaintOverride(u,F){const Wt=u.get("text-field"),Xe=Nd.paint.properties[F];let Vi=!1;const s=u=>{for(const F of u)if(Xe.overrides&&Xe.overrides.hasOverride(F))return void(Vi=!0)};if("constant"===Wt.value.kind&&Wt.value.value instanceof Yt)s(Wt.value.value.sections);else if("source"===Wt.value.kind){const t=u=>{Vi||(u instanceof se&&ne(u.value)===zo?s(u.value.sections):u instanceof Ze?s(u.sections):u.eachChild(t))},u=Wt.value;u._styleExpression&&t(u._styleExpression.expression)}return Vi}}let Ud;var $d={get paint(){return Ud=Ud||new rs({"background-color":new Ji(so.paint_background["background-color"]),"background-pattern":new ts(so.paint_background["background-pattern"]),"background-opacity":new Ji(so.paint_background["background-opacity"])})}};class _c extends is{constructor(u){super(u,$d)}}let qd;var Zd={get paint(){return qd=qd||new rs({"raster-opacity":new Ji(so.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ji(so.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ji(so.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ji(so.paint_raster["raster-brightness-max"]),"raster-saturation":new Ji(so.paint_raster["raster-saturation"]),"raster-contrast":new Ji(so.paint_raster["raster-contrast"]),"raster-resampling":new Ji(so.paint_raster["raster-resampling"]),"raster-fade-duration":new Ji(so.paint_raster["raster-fade-duration"])})}};class kc extends is{constructor(u){super(u,Zd)}}class Mc extends is{constructor(u){super(u,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=u}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Ic{constructor(u){this._methodToThrottle=u,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Gd=6371008.8;class Pc{constructor(u,F){if(isNaN(u)||isNaN(F))throw new Error(`Invalid LngLat object: (${u}, ${F})`);if(this.lng=+u,this.lat=+F,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Pc(m(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(u){const F=Math.PI/180,Wt=this.lat*F,Xe=u.lat*F,Vi=Math.sin(Wt)*Math.sin(Xe)+Math.cos(Wt)*Math.cos(Xe)*Math.cos((u.lng-this.lng)*F);return Gd*Math.acos(Math.min(Vi,1))}static convert(u){if(u instanceof Pc)return u;if(Array.isArray(u)&&(2===u.length||3===u.length))return new Pc(Number(u[0]),Number(u[1]));if(!Array.isArray(u)&&"object"==typeof u&&null!==u)return new Pc(Number("lng"in u?u.lng:u.lon),Number(u.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Hd=2*Math.PI*Gd;function Bc(u){return Hd*Math.cos(u*Math.PI/180)}function Vc(u){return(180+u)/360}function Ec(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Fc(u,F){return u/Bc(F)}function Tc(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}class $c{constructor(u,F,Wt=0){this.x=+u,this.y=+F,this.z=+Wt}static fromLngLat(u,F=0){const Wt=Pc.convert(u);return new $c(Vc(Wt.lng),Ec(Wt.lat),Fc(F,Wt.lat))}toLngLat(){return new Pc(360*this.x-180,Tc(this.y))}toAltitude(){return this.z*Bc(Tc(this.y))}meterInMercatorCoordinateUnits(){return 1/Hd*(u=Tc(this.y),1/Math.cos(u*Math.PI/180));var u}}function Lc(u,F,Wt){var Xe=2*Math.PI*6378137/256/Math.pow(2,Wt);return[u*Xe-2*Math.PI*6378137/2,F*Xe-2*Math.PI*6378137/2]}class Dc{constructor(u,F,Wt){if(!function(u,F,Wt){return!(u<0||u>25||Wt<0||Wt>=Math.pow(2,u)||F<0||F>=Math.pow(2,u))}(u,F,Wt))throw new Error(`x=${F}, y=${Wt}, z=${u} outside of bounds. 0<=x<${Math.pow(2,u)}, 0<=y<${Math.pow(2,u)} 0<=z<=25 `);this.z=u,this.x=F,this.y=Wt,this.key=Rc(0,u,u,F,Wt)}equals(u){return this.z===u.z&&this.x===u.x&&this.y===u.y}url(u,F,Wt){const Xe=(fr=this.y,_r=this.z,wr=Lc(256*(Vi=this.x),256*(fr=Math.pow(2,_r)-fr-1),_r),Ar=Lc(256*(Vi+1),256*(fr+1),_r),wr[0]+","+wr[1]+","+Ar[0]+","+Ar[1]);var Vi,fr,_r,wr,Ar;const Kr=function(u,F,Wt){let Xe,Vi="";for(let fr=u;fr>0;fr--)Xe=1<<fr-1,Vi+=(F&Xe?1:0)+(Wt&Xe?2:0);return Vi}(this.z,this.x,this.y);return u[(this.x+this.y)%u.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===Wt?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,F>1?"@2x":"").replace(/{quadkey}/g,Kr).replace(/{bbox-epsg-3857}/g,Xe)}isChildOf(u){const F=this.z-u.z;return F>0&&u.x===this.x>>F&&u.y===this.y>>F}getTilePoint(u){const F=Math.pow(2,this.z);return new Xe((u.x*F-this.x)*Nh,(u.y*F-this.y)*Nh)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Oc{constructor(u,F){this.wrap=u,this.canonical=F,this.key=Rc(u,F.z,F.z,F.x,F.y)}}class jc{constructor(u,F,Wt,Xe,Vi){if(u<Wt)throw new Error(`overscaledZ should be >= z; overscaledZ = ${u}; z = ${Wt}`);this.overscaledZ=u,this.wrap=F,this.canonical=new Dc(Wt,+Xe,+Vi),this.key=Rc(F,u,Wt,Xe,Vi)}clone(){return new jc(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(u){return this.overscaledZ===u.overscaledZ&&this.wrap===u.wrap&&this.canonical.equals(u.canonical)}scaledTo(u){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const F=this.canonical.z-u;return u>this.canonical.z?new jc(u,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new jc(u,this.wrap,u,this.canonical.x>>F,this.canonical.y>>F)}calculateScaledKey(u,F){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const Wt=this.canonical.z-u;return u>this.canonical.z?Rc(this.wrap*+F,u,this.canonical.z,this.canonical.x,this.canonical.y):Rc(this.wrap*+F,u,u,this.canonical.x>>Wt,this.canonical.y>>Wt)}isChildOf(u){if(u.wrap!==this.wrap)return!1;const F=this.canonical.z-u.canonical.z;return 0===u.overscaledZ||u.overscaledZ<this.overscaledZ&&u.canonical.x===this.canonical.x>>F&&u.canonical.y===this.canonical.y>>F}children(u){if(this.overscaledZ>=u)return[new jc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const F=this.canonical.z+1,Wt=2*this.canonical.x,Xe=2*this.canonical.y;return[new jc(F,this.wrap,F,Wt,Xe),new jc(F,this.wrap,F,Wt+1,Xe),new jc(F,this.wrap,F,Wt,Xe+1),new jc(F,this.wrap,F,Wt+1,Xe+1)]}isLessThan(u){return this.wrap<u.wrap||!(this.wrap>u.wrap)&&(this.overscaledZ<u.overscaledZ||!(this.overscaledZ>u.overscaledZ)&&(this.canonical.x<u.canonical.x||!(this.canonical.x>u.canonical.x)&&this.canonical.y<u.canonical.y))}wrapped(){return new jc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(u){return new jc(this.overscaledZ,u,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Oc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(u){return this.canonical.getTilePoint(new $c(u.x-this.wrap,u.y))}}function Rc(u,F,Wt,Xe,Vi){(u*=2)<0&&(u=-1*u-1);const fr=1<<Wt;return(fr*fr*u+fr*Vi+Xe).toString(36)+Wt.toString(36)+F.toString(36)}wi("CanonicalTileID",Dc),wi("OverscaledTileID",jc,{omit:["posMatrix"]});class Uc{constructor(u,F,Wt,Xe=1,Vi=1,fr=1,_r=0){if(this.uid=u,F.height!==F.width)throw new RangeError("DEM tiles must be square");if(Wt&&!["mapbox","terrarium","custom"].includes(Wt))return void A(`"${Wt}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=F.height;const wr=this.dim=F.height-2;switch(this.data=new Uint32Array(F.data.buffer),Wt){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=Xe,this.greenFactor=Vi,this.blueFactor=fr,this.baseShift=_r;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let u=0;u<wr;u++)this.data[this._idx(-1,u)]=this.data[this._idx(0,u)],this.data[this._idx(wr,u)]=this.data[this._idx(wr-1,u)],this.data[this._idx(u,-1)]=this.data[this._idx(u,0)],this.data[this._idx(u,wr)]=this.data[this._idx(u,wr-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(wr,-1)]=this.data[this._idx(wr-1,0)],this.data[this._idx(-1,wr)]=this.data[this._idx(0,wr-1)],this.data[this._idx(wr,wr)]=this.data[this._idx(wr-1,wr-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let u=0;u<wr;u++)for(let F=0;F<wr;F++){const Wt=this.get(u,F);Wt>this.max&&(this.max=Wt),Wt<this.min&&(this.min=Wt)}}get(u,F){const Wt=new Uint8Array(this.data.buffer),Xe=4*this._idx(u,F);return this.unpack(Wt[Xe],Wt[Xe+1],Wt[Xe+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(u,F){if(u<-1||u>=this.dim+1||F<-1||F>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(F+1)*this.stride+(u+1)}unpack(u,F,Wt){return u*this.redFactor+F*this.greenFactor+Wt*this.blueFactor-this.baseShift}getPixels(){return new Ao({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(u,F,Wt){if(this.dim!==u.dim)throw new Error("dem dimension mismatch");let Xe=F*this.dim,Vi=F*this.dim+this.dim,fr=Wt*this.dim,_r=Wt*this.dim+this.dim;switch(F){case-1:Xe=Vi-1;break;case 1:Vi=Xe+1}switch(Wt){case-1:fr=_r-1;break;case 1:_r=fr+1}const wr=-F*this.dim,Ar=-Wt*this.dim;for(let F=fr;F<_r;F++)for(let Wt=Xe;Wt<Vi;Wt++)this.data[this._idx(Wt,F)]=u.data[this._idx(Wt+wr,F+Ar)]}}wi("DEMData",Uc);class qc{constructor(u){this._stringToNumber={},this._numberToString=[];for(let F=0;F<u.length;F++){const Wt=u[F];this._stringToNumber[Wt]=F,this._numberToString[F]=Wt}}encode(u){return this._stringToNumber[u]}decode(u){if(u>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${u} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[u]}}class Nc{constructor(u,F,Wt,Xe,Vi){this.type="Feature",this._vectorTileFeature=u,u._z=F,u._x=Wt,u._y=Xe,this.properties=u.properties,this.id=Vi}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(u){this._geometry=u}toJSON(){const u={geometry:this.geometry};for(const F in this)"_geometry"!==F&&"_vectorTileFeature"!==F&&(u[F]=this[F]);return u}}class Zc{constructor(u,F){this.tileID=u,this.x=u.canonical.x,this.y=u.canonical.y,this.z=u.canonical.z,this.grid=new vi(Nh,16,0),this.grid3D=new vi(Nh,16,0),this.featureIndexArray=new Ns,this.promoteId=F}insert(u,F,Wt,Xe,Vi,fr){const _r=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(Wt,Xe,Vi);const wr=fr?this.grid3D:this.grid;for(let u=0;u<F.length;u++){const Wt=F[u],Xe=[1/0,1/0,-1/0,-1/0];for(let u=0;u<Wt.length;u++){const F=Wt[u];Xe[0]=Math.min(Xe[0],F.x),Xe[1]=Math.min(Xe[1],F.y),Xe[2]=Math.max(Xe[2],F.x),Xe[3]=Math.max(Xe[3],F.y)}Xe[0]<Nh&&Xe[1]<Nh&&Xe[2]>=0&&Xe[3]>=0&&wr.insert(_r,Xe[0],Xe[1],Xe[2],Xe[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Du.VectorTile(new Id(this.rawTileData)).layers,this.sourceLayerCoder=new qc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(u,F,Wt,Vi){this.loadVTLayers();const fr=u.params||{},_r=Nh/u.tileSize/u.scale,wr=zn(fr.filter),Ar=u.queryGeometry,Kr=u.queryPadding*_r,In=Kc(Ar),ns=this.grid.query(In.minX-Kr,In.minY-Kr,In.maxX+Kr,In.maxY+Kr),ca=Kc(u.cameraQueryGeometry),ha=this.grid3D.query(ca.minX-Kr,ca.minY-Kr,ca.maxX+Kr,ca.maxY+Kr,((F,Wt,Vi,fr)=>function(u,F,Wt,Vi,fr){for(const Xe of u)if(F<=Xe.x&&Wt<=Xe.y&&Vi>=Xe.x&&fr>=Xe.y)return!0;const _r=[new Xe(F,Wt),new Xe(F,fr),new Xe(Vi,fr),new Xe(Vi,Wt)];if(u.length>2)for(const F of _r)if(Wa(u,F))return!0;for(let F=0;F<u.length-1;F++)if(Qa(u[F],u[F+1],_r))return!0;return!1}(u.cameraQueryGeometry,F-Kr,Wt-Kr,Vi+Kr,fr+Kr)));for(const u of ha)ns.push(u);ns.sort(Xc);const ua={};let Da;for(let Xe=0;Xe<ns.length;Xe++){const Kr=ns[Xe];if(Kr===Da)continue;Da=Kr;const In=this.featureIndexArray.get(Kr);let ca=null;this.loadMatchingFeature(ua,In.bucketIndex,In.sourceLayerIndex,In.featureIndex,wr,fr.layers,fr.availableImages,F,Wt,Vi,((F,Wt,Xe)=>(ca||(ca=Oa(F)),Wt.queryIntersectsFeature(Ar,F,Xe,ca,this.z,u.transform,_r,u.pixelPosMatrix))))}return ua}loadMatchingFeature(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In){const ns=this.bucketLayerIDs[F];if(fr&&!function(u,F){for(let Wt=0;Wt<u.length;Wt++)if(F.indexOf(u[Wt])>=0)return!0;return!1}(fr,ns))return;const ca=this.sourceLayerCoder.decode(Wt),ha=this.vtLayers[ca].feature(Xe);if(Vi.needGeometry){const u=ja(ha,!0);if(!Vi.filter(new Ui(this.tileID.overscaledZ),u,this.tileID.canonical))return}else if(!Vi.filter(new Ui(this.tileID.overscaledZ),ha))return;const ua=this.getId(ha,ca);for(let F=0;F<ns.length;F++){const Wt=ns[F];if(fr&&fr.indexOf(Wt)<0)continue;const Vi=wr[Wt];if(!Vi)continue;let ca={};ua&&Kr&&(ca=Kr.getState(Vi.sourceLayer||"_geojsonTileLayer",ua));const Da=g({},Ar[Wt]);Da.paint=Gc(Da.paint,Vi.paint,ha,ca,_r),Da.layout=Gc(Da.layout,Vi.layout,ha,ca,_r);const io=!In||In(ha,Vi,ca);if(!io)continue;const no=new Nc(ha,this.z,this.x,this.y,ua);no.layer=Da;let so=u[Wt];void 0===so&&(so=u[Wt]=[]),so.push({featureIndex:Xe,feature:no,intersectionZ:io})}}lookupSymbolFeatures(u,F,Wt,Xe,Vi,fr,_r,wr){const Ar={};this.loadVTLayers();const Kr=zn(Vi);for(const Vi of u)this.loadMatchingFeature(Ar,Wt,Xe,Vi,Kr,fr,_r,wr,F);return Ar}hasLayer(u){for(const F of this.bucketLayerIDs)for(const Wt of F)if(u===Wt)return!0;return!1}getId(u,F){let Wt=u.id;return this.promoteId&&(Wt=u.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[F]],"boolean"==typeof Wt&&(Wt=Number(Wt))),Wt}}function Gc(u,F,Wt,Xe,Vi){return v(u,((u,fr)=>{const _r=F instanceof Yi?F.get(fr):null;return _r&&_r.evaluate?_r.evaluate(Wt,Xe,Vi):_r}))}function Kc(u){let F=1/0,Wt=1/0,Xe=-1/0,Vi=-1/0;for(const fr of u)F=Math.min(F,fr.x),Wt=Math.min(Wt,fr.y),Xe=Math.max(Xe,fr.x),Vi=Math.max(Vi,fr.y);return{minX:F,minY:Wt,maxX:Xe,maxY:Vi}}function Xc(u,F){return F-u}function Hc(u,F,Wt,Vi,fr){const _r=[];for(let wr=0;wr<u.length;wr++){const Ar=u[wr];let Kr;for(let u=0;u<Ar.length-1;u++){let wr=Ar[u],In=Ar[u+1];wr.x<F&&In.x<F||(wr.x<F?wr=new Xe(F,wr.y+(F-wr.x)/(In.x-wr.x)*(In.y-wr.y))._round():In.x<F&&(In=new Xe(F,wr.y+(F-wr.x)/(In.x-wr.x)*(In.y-wr.y))._round()),wr.y<Wt&&In.y<Wt||(wr.y<Wt?wr=new Xe(wr.x+(Wt-wr.y)/(In.y-wr.y)*(In.x-wr.x),Wt)._round():In.y<Wt&&(In=new Xe(wr.x+(Wt-wr.y)/(In.y-wr.y)*(In.x-wr.x),Wt)._round()),wr.x>=Vi&&In.x>=Vi||(wr.x>=Vi?wr=new Xe(Vi,wr.y+(Vi-wr.x)/(In.x-wr.x)*(In.y-wr.y))._round():In.x>=Vi&&(In=new Xe(Vi,wr.y+(Vi-wr.x)/(In.x-wr.x)*(In.y-wr.y))._round()),wr.y>=fr&&In.y>=fr||(wr.y>=fr?wr=new Xe(wr.x+(fr-wr.y)/(In.y-wr.y)*(In.x-wr.x),fr)._round():In.y>=fr&&(In=new Xe(wr.x+(fr-wr.y)/(In.y-wr.y)*(In.x-wr.x),fr)._round()),Kr&&wr.equals(Kr[Kr.length-1])||(Kr=[wr],_r.push(Kr)),Kr.push(In)))))}}return _r}wi("FeatureIndex",Zc,{omit:["rawTileData","sourceLayerCoder"]});class Yc extends Xe{constructor(u,F,Wt,Xe){super(u,F),this.angle=Wt,void 0!==Xe&&(this.segment=Xe)}clone(){return new Yc(this.x,this.y,this.angle,this.segment)}}function Jc(u,F,Wt,Xe,Vi){if(void 0===F.segment||0===Wt)return!0;let fr=F,_r=F.segment+1,wr=0;for(;wr>-Wt/2;){if(_r--,_r<0)return!1;wr-=u[_r].dist(fr),fr=u[_r]}wr+=u[_r].dist(u[_r+1]),_r++;const Ar=[];let Kr=0;for(;wr<Wt/2;){const F=u[_r],Wt=u[_r+1];if(!Wt)return!1;let fr=u[_r-1].angleTo(F)-F.angleTo(Wt);for(fr=Math.abs((fr+3*Math.PI)%(2*Math.PI)-Math.PI),Ar.push({distance:wr,angleDelta:fr}),Kr+=fr;wr-Ar[0].distance>Xe;)Kr-=Ar.shift().angleDelta;if(Kr>Vi)return!1;_r++,wr+=F.dist(Wt)}return!0}function Wc(u){let F=0;for(let Wt=0;Wt<u.length-1;Wt++)F+=u[Wt].dist(u[Wt+1]);return F}function Qc(u,F,Wt){return u?.6*F*Wt:0}function th(u,F){return Math.max(u?u.right-u.left:0,F?F.right-F.left:0)}function eh(u,F,Wt,Xe,Vi,fr){const _r=Qc(Wt,Vi,fr),wr=th(Wt,Xe)*fr;let Ar=0;const Kr=Wc(u)/2;for(let Wt=0;Wt<u.length-1;Wt++){const Xe=u[Wt],Vi=u[Wt+1],fr=Xe.dist(Vi);if(Ar+fr>Kr){const In=(Kr-Ar)/fr,ns=Ol.number(Xe.x,Vi.x,In),ca=Ol.number(Xe.y,Vi.y,In),ha=new Yc(ns,ca,Vi.angleTo(Xe),Wt);return ha._round(),!_r||Jc(u,ha,wr,_r,F)?ha:void 0}Ar+=fr}}function rh(u,F,Wt,Xe,Vi,fr,_r,wr,Ar){const Kr=Qc(Xe,fr,_r),In=th(Xe,Vi),ns=In*_r,ca=0===u[0].x||u[0].x===Ar||0===u[0].y||u[0].y===Ar;return F-ns<F/4&&(F=ns+F/4),nh(u,ca?F/2*wr%F:(In/2+2*fr)*_r*wr%F,F,Kr,Wt,ns,ca,!1,Ar)}function nh(u,F,Wt,Xe,Vi,fr,_r,wr,Ar){const Kr=fr/2,In=Wc(u);let ns=0,ca=F-Wt,ha=[];for(let F=0;F<u.length-1;F++){const _r=u[F],wr=u[F+1],ua=_r.dist(wr),Da=wr.angleTo(_r);for(;ca+Wt<ns+ua;){ca+=Wt;const io=(ca-ns)/ua,no=Ol.number(_r.x,wr.x,io),so=Ol.number(_r.y,wr.y,io);if(no>=0&&no<Ar&&so>=0&&so<Ar&&ca-Kr>=0&&ca+Kr<=In){const Wt=new Yc(no,so,Da,F);Wt._round(),Xe&&!Jc(u,Wt,fr,Xe,Vi)||ha.push(Wt)}}ns+=ua}return wr||ha.length||_r||(ha=nh(u,ns/2,Wt,Xe,Vi,fr,_r,!0,Ar)),ha}wi("Anchor",Yc);const Wd=Md;function sh(u,F,Wt,Vi){const fr=[],_r=u.image,wr=_r.pixelRatio,Ar=_r.paddedRect.w-2*Wd,Kr=_r.paddedRect.h-2*Wd;let In={x1:u.left,y1:u.top,x2:u.right,y2:u.bottom};const ns=_r.stretchX||[[0,Ar]],ca=_r.stretchY||[[0,Kr]],f=(u,F)=>u+F[1]-F[0],ha=ns.reduce(f,0),ua=ca.reduce(f,0),Da=Ar-ha,io=Kr-ua;let no=0,so=ha,ao=0,oo=ua,co=0,ho=Da,go=0,xo=io;if(_r.content&&Vi){const F=_r.content,Wt=F[2]-F[0],Xe=F[3]-F[1];(_r.textFitWidth||_r.textFitHeight)&&(In=tc(u)),no=ah(ns,0,F[0]),ao=ah(ca,0,F[1]),so=ah(ns,F[0],F[2]),oo=ah(ca,F[1],F[3]),co=F[0]-no,go=F[1]-ao,ho=Wt-so,xo=Xe-oo}const Io=In.x1,ko=In.y1,Co=In.x2-Io,zo=In.y2-ko,C=(u,Vi,fr,Ar)=>{const Kr=lh(u.stretch-no,so,Co,Io),In=uh(u.fixed-co,ho,u.stretch,ha),ns=lh(Vi.stretch-ao,oo,zo,ko),ca=uh(Vi.fixed-go,xo,Vi.stretch,ua),Da=lh(fr.stretch-no,so,Co,Io),io=uh(fr.fixed-co,ho,fr.stretch,ha),Bo=lh(Ar.stretch-ao,oo,zo,ko),al=uh(Ar.fixed-go,xo,Ar.stretch,ua),ol=new Xe(Kr,ns),ll=new Xe(Da,ns),cl=new Xe(Da,Bo),hl=new Xe(Kr,Bo),dl=new Xe(In/wr,ca/wr),pl=new Xe(io/wr,al/wr),fl=F*Math.PI/180;if(fl){const u=Math.sin(fl),F=Math.cos(fl),Wt=[F,-u,u,F];ol._matMult(Wt),ll._matMult(Wt),hl._matMult(Wt),cl._matMult(Wt)}const yl=u.stretch+u.fixed,vl=Vi.stretch+Vi.fixed;return{tl:ol,tr:ll,bl:hl,br:cl,tex:{x:_r.paddedRect.x+Wd+yl,y:_r.paddedRect.y+Wd+vl,w:fr.stretch+fr.fixed-yl,h:Ar.stretch+Ar.fixed-vl},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:dl,pixelOffsetBR:pl,minFontScaleX:ho/wr/Co,minFontScaleY:xo/wr/zo,isSDF:Wt}};if(Vi&&(_r.stretchX||_r.stretchY)){const u=oh(ns,Da,ha),F=oh(ca,io,ua);for(let Wt=0;Wt<u.length-1;Wt++){const Xe=u[Wt],Vi=u[Wt+1];for(let u=0;u<F.length-1;u++)fr.push(C(Xe,F[u],Vi,F[u+1]))}}else fr.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:Ar+1},{fixed:0,stretch:Kr+1}));return fr}function ah(u,F,Wt){let Xe=0;for(const Vi of u)Xe+=Math.max(F,Math.min(Wt,Vi[1]))-Math.max(F,Math.min(Wt,Vi[0]));return Xe}function oh(u,F,Wt){const Xe=[{fixed:-Wd,stretch:0}];for(const[F,Wt]of u){const u=Xe[Xe.length-1];Xe.push({fixed:F-u.stretch,stretch:u.stretch}),Xe.push({fixed:F-u.stretch,stretch:u.stretch+(Wt-F)})}return Xe.push({fixed:F+Wd,stretch:Wt}),Xe}function lh(u,F,Wt,Xe){return u/F*Wt+Xe}function uh(u,F,Wt,Xe){return u-F*Wt/Xe}class ch{constructor(u,F,Wt,Vi,fr,_r,wr,Ar,Kr,In){var ns;if(this.boxStartIndex=u.length,Kr){let u=_r.top,F=_r.bottom;const Wt=_r.collisionPadding;Wt&&(u-=Wt[1],F+=Wt[3]);let Xe=F-u;Xe>0&&(Xe=Math.max(10,Xe),this.circleDiameter=Xe)}else{const Kr=(null===(ns=_r.image)||void 0===ns?void 0:ns.content)&&(_r.image.textFitWidth||_r.image.textFitHeight)?tc(_r):{x1:_r.left,y1:_r.top,x2:_r.right,y2:_r.bottom};Kr.y1=Kr.y1*wr-Ar[0],Kr.y2=Kr.y2*wr+Ar[2],Kr.x1=Kr.x1*wr-Ar[3],Kr.x2=Kr.x2*wr+Ar[1];const ca=_r.collisionPadding;if(ca&&(Kr.x1-=ca[0]*wr,Kr.y1-=ca[1]*wr,Kr.x2+=ca[2]*wr,Kr.y2+=ca[3]*wr),In){const u=new Xe(Kr.x1,Kr.y1),F=new Xe(Kr.x2,Kr.y1),Wt=new Xe(Kr.x1,Kr.y2),Vi=new Xe(Kr.x2,Kr.y2),fr=In*Math.PI/180;u._rotate(fr),F._rotate(fr),Wt._rotate(fr),Vi._rotate(fr),Kr.x1=Math.min(u.x,F.x,Wt.x,Vi.x),Kr.x2=Math.max(u.x,F.x,Wt.x,Vi.x),Kr.y1=Math.min(u.y,F.y,Wt.y,Vi.y),Kr.y2=Math.max(u.y,F.y,Wt.y,Vi.y)}u.emplaceBack(F.x,F.y,Kr.x1,Kr.y1,Kr.x2,Kr.y2,Wt,Vi,fr)}this.boxEndIndex=u.length}}class hh{constructor(u=[],F=((u,F)=>u<F?-1:u>F?1:0)){if(this.data=u,this.length=this.data.length,this.compare=F,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(u){this.data.push(u),this._up(this.length++)}pop(){if(0===this.length)return;const u=this.data[0],F=this.data.pop();return--this.length>0&&(this.data[0]=F,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:F,compare:Wt}=this,Xe=F[u];for(;u>0;){const Vi=u-1>>1,fr=F[Vi];if(Wt(Xe,fr)>=0)break;F[u]=fr,u=Vi}F[u]=Xe}_down(u){const{data:F,compare:Wt}=this,Xe=this.length>>1,Vi=F[u];for(;u<Xe;){let Xe=1+(u<<1);const fr=Xe+1;if(fr<this.length&&Wt(F[fr],F[Xe])<0&&(Xe=fr),Wt(F[Xe],Vi)>=0)break;F[u]=F[Xe],u=Xe}F[u]=Vi}}function ph(u,F=1,Wt=!1){let Vi=1/0,fr=1/0,_r=-1/0,wr=-1/0;const Ar=u[0];for(let u=0;u<Ar.length;u++){const F=Ar[u];(!u||F.x<Vi)&&(Vi=F.x),(!u||F.y<fr)&&(fr=F.y),(!u||F.x>_r)&&(_r=F.x),(!u||F.y>wr)&&(wr=F.y)}const Kr=Math.min(_r-Vi,wr-fr);let In=Kr/2;const ns=new hh([],fh);if(0===Kr)return new Xe(Vi,fr);for(let F=Vi;F<_r;F+=Kr)for(let Wt=fr;Wt<wr;Wt+=Kr)ns.push(new dh(F+In,Wt+In,In,u));let ca=function(u){let F=0,Wt=0,Xe=0;const Vi=u[0];for(let u=0,fr=Vi.length,_r=fr-1;u<fr;_r=u++){const fr=Vi[u],wr=Vi[_r],Ar=fr.x*wr.y-wr.x*fr.y;Wt+=(fr.x+wr.x)*Ar,Xe+=(fr.y+wr.y)*Ar,F+=3*Ar}return new dh(Wt/F,Xe/F,0,u)}(u),ha=ns.length;for(;ns.length;){const Xe=ns.pop();(Xe.d>ca.d||!ca.d)&&(ca=Xe,Wt&&console.log("found best %d after %d probes",Math.round(1e4*Xe.d)/1e4,ha)),Xe.max-ca.d<=F||(In=Xe.h/2,ns.push(new dh(Xe.p.x-In,Xe.p.y-In,In,u)),ns.push(new dh(Xe.p.x+In,Xe.p.y-In,In,u)),ns.push(new dh(Xe.p.x-In,Xe.p.y+In,In,u)),ns.push(new dh(Xe.p.x+In,Xe.p.y+In,In,u)),ha+=4)}return Wt&&(console.log(`num probes: ${ha}`),console.log(`best distance: ${ca.d}`)),ca.p}function fh(u,F){return F.max-u.max}function dh(F,Wt,Vi,fr){(this||u).p=new Xe(F,Wt),(this||u).h=Vi,(this||u).d=function(u,F){let Wt=!1,Xe=1/0;for(let Vi=0;Vi<F.length;Vi++){const fr=F[Vi];for(let F=0,Vi=fr.length,_r=Vi-1;F<Vi;_r=F++){const Vi=fr[F],wr=fr[_r];Vi.y>u.y!=wr.y>u.y&&u.x<(wr.x-Vi.x)*(u.y-Vi.y)/(wr.y-Vi.y)+Vi.x&&(Wt=!Wt),Xe=Math.min(Xe,Ya(u,Vi,wr))}}return(Wt?1:-1)*Math.sqrt(Xe)}((this||u).p,fr),(this||u).max=(this||u).d+(this||u).h*Math.SQRT2}var Xd;F.aq=void 0,(Xd=F.aq||(F.aq={}))[Xd.center=1]="center",Xd[Xd.left=2]="left",Xd[Xd.right=3]="right",Xd[Xd.top=4]="top",Xd[Xd.bottom=5]="bottom",Xd[Xd["top-left"]=6]="top-left",Xd[Xd["top-right"]=7]="top-right",Xd[Xd["bottom-left"]=8]="bottom-left",Xd[Xd["bottom-right"]=9]="bottom-right";const Jd=7,Kd=Number.POSITIVE_INFINITY;function xh(u,F){return F[1]!==Kd?function(u,F,Wt){let Xe=0,Vi=0;switch(F=Math.abs(F),Wt=Math.abs(Wt),u){case"top-right":case"top-left":case"top":Vi=Wt-Jd;break;case"bottom-right":case"bottom-left":case"bottom":Vi=-Wt+Jd}switch(u){case"top-right":case"bottom-right":case"right":Xe=-F;break;case"top-left":case"bottom-left":case"left":Xe=F}return[Xe,Vi]}(u,F[0],F[1]):function(u,F){let Wt=0,Xe=0;F<0&&(F=0);const Vi=F/Math.SQRT2;switch(u){case"top-right":case"top-left":Xe=Vi-Jd;break;case"bottom-right":case"bottom-left":Xe=-Vi+Jd;break;case"bottom":Xe=-F+Jd;break;case"top":Xe=F-Jd}switch(u){case"top-right":case"bottom-right":Wt=-Vi;break;case"top-left":case"bottom-left":Wt=Vi;break;case"left":Wt=F;break;case"right":Wt=-F}return[Wt,Xe]}(u,F[0])}function vh(u,F,Wt){var Xe;const Vi=u.layout,fr=null===(Xe=Vi.get("text-variable-anchor-offset"))||void 0===Xe?void 0:Xe.evaluate(F,{},Wt);if(fr){const u=fr.values,F=[];for(let Wt=0;Wt<u.length;Wt+=2){const Xe=F[Wt]=u[Wt],Vi=u[Wt+1].map((u=>u*vd));Xe.startsWith("top")?Vi[1]-=Jd:Xe.startsWith("bottom")&&(Vi[1]+=Jd),F[Wt+1]=Vi}return new Qt(F)}const _r=Vi.get("text-variable-anchor");if(_r){let Xe;Xe=void 0!==u._unevaluatedLayout.getValue("text-radial-offset")?[Vi.get("text-radial-offset").evaluate(F,{},Wt)*vd,Kd]:Vi.get("text-offset").evaluate(F,{},Wt).map((u=>u*vd));const fr=[];for(const u of _r)fr.push(u,xh(u,Xe));return new Qt(fr)}return null}function bh(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wh(u,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns){let ca=_r.textMaxSize.evaluate(Wt,{});void 0===ca&&(ca=wr);const ha=u.layers[0].layout,ua=ha.get("icon-offset").evaluate(Wt,{},ns),Da=Ah(Xe.horizontal),io=wr/24,no=u.tilePixelRatio*io,so=u.tilePixelRatio*ca/24,ao=u.tilePixelRatio*Ar,oo=u.tilePixelRatio*ha.get("symbol-spacing"),co=ha.get("text-padding")*u.tilePixelRatio,ho=function(u,F,Wt,Xe=1){const Vi=u.get("icon-padding").evaluate(F,{},Wt),fr=Vi&&Vi.values;return[fr[0]*Xe,fr[1]*Xe,fr[2]*Xe,fr[3]*Xe]}(ha,Wt,ns,u.tilePixelRatio),go=ha.get("text-max-angle")/180*Math.PI,xo="viewport"!==ha.get("text-rotation-alignment")&&"point"!==ha.get("symbol-placement"),Io="map"===ha.get("icon-rotation-alignment")&&"point"!==ha.get("symbol-placement"),ko=ha.get("symbol-placement"),Co=oo/2,zo=ha.get("icon-text-fit");let Bo;Vi&&"none"!==zo&&(u.allowVerticalPlacement&&Xe.vertical&&(Bo=ec(Vi,Xe.vertical,zo,ha.get("icon-text-fit-padding"),ua,io)),Da&&(Vi=ec(Vi,Da,zo,ha.get("icon-text-fit-padding"),ua,io)));const B=(Ar,ca)=>{ca.x<0||ca.x>=Nh||ca.y<0||ca.y>=Nh||function(u,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua,Da,io,no,so,ao,oo,co,ho,go,xo,Io){const ko=u.addToLineVertexArray(Wt,Xe);let Co,zo,Bo,al,ol=0,ll=0,cl=0,hl=0,dl=-1,pl=-1;const fl={};let yl=Vh("");if(u.allowVerticalPlacement&&Vi.vertical){const u=Ar.layout.get("text-rotate").evaluate(co,{},xo)+90;Bo=new ch(Kr,Wt,In,ns,ca,Vi.vertical,ha,ua,Da,u),wr&&(al=new ch(Kr,Wt,In,ns,ca,wr,no,so,Da,u))}if(fr){const Xe=Ar.layout.get("icon-rotate").evaluate(co,{}),Vi="none"!==Ar.layout.get("icon-text-fit"),_r=sh(fr,Xe,go,Vi),ha=wr?sh(wr,Xe,go,Vi):void 0;zo=new ch(Kr,Wt,In,ns,ca,fr,no,so,!1,Xe),ol=4*_r.length;const ua=u.iconSizeData;let Da=null;"source"===ua.kind?(Da=[Rd*Ar.layout.get("icon-size").evaluate(co,{})],Da[0]>Bd&&A(`${u.layerIds[0]}: Value for "icon-size" is >= ${Ld}. Reduce your "icon-size".`)):"composite"===ua.kind&&(Da=[Rd*ho.compositeIconSizes[0].evaluate(co,{},xo),Rd*ho.compositeIconSizes[1].evaluate(co,{},xo)],(Da[0]>Bd||Da[1]>Bd)&&A(`${u.layerIds[0]}: Value for "icon-size" is >= ${Ld}. Reduce your "icon-size".`)),u.addSymbols(u.icon,_r,Da,oo,ao,co,F.ah.none,Wt,ko.lineStartIndex,ko.lineLength,-1,xo),dl=u.icon.placedSymbolArray.length-1,ha&&(ll=4*ha.length,u.addSymbols(u.icon,ha,Da,oo,ao,co,F.ah.vertical,Wt,ko.lineStartIndex,ko.lineLength,-1,xo),pl=u.icon.placedSymbolArray.length-1)}const vl=Object.keys(Vi.horizontal);for(const Xe of vl){const fr=Vi.horizontal[Xe];if(!Co){yl=Vh(fr.text);const u=Ar.layout.get("text-rotate").evaluate(co,{},xo);Co=new ch(Kr,Wt,In,ns,ca,fr,ha,ua,Da,u)}const wr=1===fr.positionedLines.length;if(cl+=_h(u,Wt,fr,_r,Ar,Da,co,io,ko,Vi.vertical?F.ah.horizontal:F.ah.horizontalOnly,wr?vl:[Xe],fl,dl,ho,xo),wr)break}Vi.vertical&&(hl+=_h(u,Wt,Vi.vertical,_r,Ar,Da,co,io,ko,F.ah.vertical,["vertical"],fl,pl,ho,xo));const bl=Co?Co.boxStartIndex:u.collisionBoxArray.length,Al=Co?Co.boxEndIndex:u.collisionBoxArray.length,Ml=Bo?Bo.boxStartIndex:u.collisionBoxArray.length,kl=Bo?Bo.boxEndIndex:u.collisionBoxArray.length,Dl=zo?zo.boxStartIndex:u.collisionBoxArray.length,Ll=zo?zo.boxEndIndex:u.collisionBoxArray.length,Rl=al?al.boxStartIndex:u.collisionBoxArray.length,Bl=al?al.boxEndIndex:u.collisionBoxArray.length;let Ol=-1;const Y=(u,F)=>u&&u.circleDiameter?Math.max(u.circleDiameter,F):F;Ol=Y(Co,Ol),Ol=Y(Bo,Ol),Ol=Y(zo,Ol),Ol=Y(al,Ol);const Vl=Ol>-1?1:0;Vl&&(Ol*=Io/vd),u.glyphOffsetArray.length>=dc.MAX_GLYPHS&&A("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==co.sortKey&&u.addToSortKeyRanges(u.symbolInstances.length,co.sortKey);const jl=vh(Ar,co,xo),[Nl,Ul]=function(u,Wt){const Xe=u.length,Vi=null==Wt?void 0:Wt.values;if((null==Vi?void 0:Vi.length)>0)for(let Wt=0;Wt<Vi.length;Wt+=2){const Xe=Vi[Wt+1];u.emplaceBack(F.aq[Vi[Wt]],Xe[0],Xe[1])}return[Xe,u.length]}(u.textAnchorOffsets,jl);u.symbolInstances.emplaceBack(Wt.x,Wt.y,fl.right>=0?fl.right:-1,fl.center>=0?fl.center:-1,fl.left>=0?fl.left:-1,fl.vertical||-1,dl,pl,yl,bl,Al,Ml,kl,Dl,Ll,Rl,Bl,In,cl,hl,ol,ll,Vl,0,ha,Ol,Nl,Ul)}(u,ca,Ar,Xe,Vi,fr,Bo,u.layers[0],u.collisionBoxArray,Wt.index,Wt.sourceLayerIndex,u.index,no,[co,co,co,co],xo,Kr,ao,ho,Io,ua,Wt,_r,In,ns,wr)};if("line"===ko)for(const F of Hc(Wt.geometry,0,0,Nh,Nh)){const Wt=rh(F,oo,go,Xe.vertical||Da,Vi,24,so,u.overscaling,Nh);for(const Xe of Wt)Da&&Sh(u,Da.text,Co,Xe)||B(F,Xe)}else if("line-center"===ko){for(const u of Wt.geometry)if(u.length>1){const F=eh(u,go,Xe.vertical||Da,Vi,24,so);F&&B(u,F)}}else if("Polygon"===Wt.type)for(const u of xr(Wt.geometry,0)){const F=ph(u,16);B(u[0],new Yc(F.x,F.y,0))}else if("LineString"===Wt.type)for(const u of Wt.geometry)B(u,new Yc(u[0].x,u[0].y,0));else if("Point"===Wt.type)for(const u of Wt.geometry)for(const F of u)B([F],new Yc(F.x,F.y,0))}function _h(u,F,Wt,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua,Da){const io=function(u,F,Wt,Vi,fr,_r,wr,Ar){const Kr=Vi.layout.get("text-rotate").evaluate(_r,{})*Math.PI/180,In=[];for(const u of F.positionedLines)for(const Vi of u.positionedGlyphs){if(!Vi.rect)continue;const _r=Vi.rect||{};let ns=Ad+1,ca=!0,ha=1,ua=0;const Da=(fr||Ar)&&Vi.vertical,io=Vi.metrics.advance*Vi.scale/2;if(Ar&&F.verticalizable&&(ua=u.lineOffset/2-(Vi.imageName?-(vd-Vi.metrics.width*Vi.scale)/2:(Vi.scale-1)*vd)),Vi.imageName){const u=wr[Vi.imageName];ca=u.sdf,ha=u.pixelRatio,ns=Md/ha}const no=fr?[Vi.x+io,Vi.y]:[0,0];let so=fr?[0,0]:[Vi.x+io+Wt[0],Vi.y+Wt[1]-ua],ao=[0,0];Da&&(ao=so,so=[0,0]);const oo=Vi.metrics.isDoubleResolution?2:1,co=(Vi.metrics.left-ns)*Vi.scale-io+so[0],ho=(-Vi.metrics.top-ns)*Vi.scale+so[1],go=co+_r.w/oo*Vi.scale/ha,xo=ho+_r.h/oo*Vi.scale/ha,Io=new Xe(co,ho),ko=new Xe(go,ho),Co=new Xe(co,xo),zo=new Xe(go,xo);if(Da){const u=new Xe(-io,io-Cd),F=-Math.PI/2,Wt=vd/2-io,fr=new Xe(5-Cd-Wt,-(Vi.imageName?Wt:0)),_r=new Xe(...ao);Io._rotateAround(F,u)._add(fr)._add(_r),ko._rotateAround(F,u)._add(fr)._add(_r),Co._rotateAround(F,u)._add(fr)._add(_r),zo._rotateAround(F,u)._add(fr)._add(_r)}if(Kr){const u=Math.sin(Kr),F=Math.cos(Kr),Wt=[F,-u,u,F];Io._matMult(Wt),ko._matMult(Wt),Co._matMult(Wt),zo._matMult(Wt)}const Bo=new Xe(0,0),al=new Xe(0,0);In.push({tl:Io,tr:ko,bl:Co,br:zo,tex:_r,writingMode:F.writingMode,glyphOffset:no,sectionIndex:Vi.sectionIndex,isSDF:ca,pixelOffsetTL:Bo,pixelOffsetBR:al,minFontScaleX:0,minFontScaleY:0})}return In}(0,Wt,Ar,fr,_r,wr,Vi,u.allowVerticalPlacement),no=u.textSizeData;let so=null;"source"===no.kind?(so=[Rd*fr.layout.get("text-size").evaluate(wr,{})],so[0]>Bd&&A(`${u.layerIds[0]}: Value for "text-size" is >= ${Ld}. Reduce your "text-size".`)):"composite"===no.kind&&(so=[Rd*ua.compositeTextSizes[0].evaluate(wr,{},Da),Rd*ua.compositeTextSizes[1].evaluate(wr,{},Da)],(so[0]>Bd||so[1]>Bd)&&A(`${u.layerIds[0]}: Value for "text-size" is >= ${Ld}. Reduce your "text-size".`)),u.addSymbols(u.text,io,so,Ar,_r,wr,In,F,Kr.lineStartIndex,Kr.lineLength,ha,Da);for(const F of ns)ca[F]=u.text.placedSymbolArray.length-1;return 4*io.length}function Ah(u){for(const F in u)return u[F];return null}function Sh(u,F,Wt,Xe){const Vi=u.compareText;if(F in Vi){const u=Vi[F];for(let F=u.length-1;F>=0;F--)if(Xe.dist(u[F])<Wt)return!0}else Vi[F]=[];return Vi[F].push(Xe),!1}const Yd=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Mh{static from(u){if(!(u instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[F,Wt]=new Uint8Array(u,0,2);if(219!==F)throw new Error("Data does not appear to be in a KDBush format.");const Xe=Wt>>4;if(1!==Xe)throw new Error(`Got v${Xe} data when expected v1.`);const Vi=Yd[15&Wt];if(!Vi)throw new Error("Unrecognized array type.");const[fr]=new Uint16Array(u,2,1),[_r]=new Uint32Array(u,4,1);return new Mh(_r,fr,Vi,u)}constructor(u,F=64,Wt=Float64Array,Xe){if(isNaN(u)||u<0)throw new Error(`Unpexpected numItems value: ${u}.`);this.numItems=+u,this.nodeSize=Math.min(Math.max(+F,2),65535),this.ArrayType=Wt,this.IndexArrayType=u<65536?Uint16Array:Uint32Array;const Vi=Yd.indexOf(this.ArrayType),fr=2*u*this.ArrayType.BYTES_PER_ELEMENT,_r=u*this.IndexArrayType.BYTES_PER_ELEMENT,wr=(8-_r%8)%8;if(Vi<0)throw new Error(`Unexpected typed array class: ${Wt}.`);Xe&&Xe instanceof ArrayBuffer?(this.data=Xe,this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+_r+wr,2*u),this._pos=2*u,this._finished=!0):(this.data=new ArrayBuffer(8+fr+_r+wr),this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+_r+wr,2*u),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+Vi]),new Uint16Array(this.data,2,1)[0]=F,new Uint32Array(this.data,4,1)[0]=u)}add(u,F){const Wt=this._pos>>1;return this.ids[Wt]=Wt,this.coords[this._pos++]=u,this.coords[this._pos++]=F,Wt}finish(){const u=this._pos>>1;if(u!==this.numItems)throw new Error(`Added ${u} items when expected ${this.numItems}.`);return Ih(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(u,F,Wt,Xe){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:Vi,coords:fr,nodeSize:_r}=this,wr=[0,Vi.length-1,0],Ar=[];for(;wr.length;){const Kr=wr.pop()||0,In=wr.pop()||0,ns=wr.pop()||0;if(In-ns<=_r){for(let _r=ns;_r<=In;_r++){const wr=fr[2*_r],Kr=fr[2*_r+1];wr>=u&&wr<=Wt&&Kr>=F&&Kr<=Xe&&Ar.push(Vi[_r])}continue}const ca=ns+In>>1,ha=fr[2*ca],ua=fr[2*ca+1];ha>=u&&ha<=Wt&&ua>=F&&ua<=Xe&&Ar.push(Vi[ca]),(0===Kr?u<=ha:F<=ua)&&(wr.push(ns),wr.push(ca-1),wr.push(1-Kr)),(0===Kr?Wt>=ha:Xe>=ua)&&(wr.push(ca+1),wr.push(In),wr.push(1-Kr))}return Ar}within(u,F,Wt){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:Xe,coords:Vi,nodeSize:fr}=this,_r=[0,Xe.length-1,0],wr=[],Ar=Wt*Wt;for(;_r.length;){const Kr=_r.pop()||0,In=_r.pop()||0,ns=_r.pop()||0;if(In-ns<=fr){for(let Wt=ns;Wt<=In;Wt++)Bh(Vi[2*Wt],Vi[2*Wt+1],u,F)<=Ar&&wr.push(Xe[Wt]);continue}const ca=ns+In>>1,ha=Vi[2*ca],ua=Vi[2*ca+1];Bh(ha,ua,u,F)<=Ar&&wr.push(Xe[ca]),(0===Kr?u-Wt<=ha:F-Wt<=ua)&&(_r.push(ns),_r.push(ca-1),_r.push(1-Kr)),(0===Kr?u+Wt>=ha:F+Wt>=ua)&&(_r.push(ca+1),_r.push(In),_r.push(1-Kr))}return wr}}function Ih(u,F,Wt,Xe,Vi,fr){if(Vi-Xe<=Wt)return;const _r=Xe+Vi>>1;zh(u,F,_r,Xe,Vi,fr),Ih(u,F,Wt,Xe,_r-1,1-fr),Ih(u,F,Wt,_r+1,Vi,1-fr)}function zh(u,F,Wt,Xe,Vi,fr){for(;Vi>Xe;){if(Vi-Xe>600){const _r=Vi-Xe+1,wr=Wt-Xe+1,Ar=Math.log(_r),Kr=.5*Math.exp(2*Ar/3),In=.5*Math.sqrt(Ar*Kr*(_r-Kr)/_r)*(wr-_r/2<0?-1:1);zh(u,F,Wt,Math.max(Xe,Math.floor(Wt-wr*Kr/_r+In)),Math.min(Vi,Math.floor(Wt+(_r-wr)*Kr/_r+In)),fr)}const _r=F[2*Wt+fr];let wr=Xe,Ar=Vi;for(Ph(u,F,Xe,Wt),F[2*Vi+fr]>_r&&Ph(u,F,Xe,Vi);wr<Ar;){for(Ph(u,F,wr,Ar),wr++,Ar--;F[2*wr+fr]<_r;)wr++;for(;F[2*Ar+fr]>_r;)Ar--}F[2*Xe+fr]===_r?Ph(u,F,Xe,Ar):(Ar++,Ph(u,F,Ar,Vi)),Ar<=Wt&&(Xe=Ar+1),Wt<=Ar&&(Vi=Ar-1)}}function Ph(u,F,Wt,Xe){Ch(u,Wt,Xe),Ch(F,2*Wt,2*Xe),Ch(F,2*Wt+1,2*Xe+1)}function Ch(u,F,Wt){const Xe=u[F];u[F]=u[Wt],u[Wt]=Xe}function Bh(u,F,Wt,Xe){const Vi=u-Wt,fr=F-Xe;return Vi*Vi+fr*fr}var Qd;F.bg=void 0,(Qd=F.bg||(F.bg={})).create="create",Qd.load="load",Qd.fullLoad="fullLoad";let tp=null,ep=[];const ip=1e3/60,rp="loadTime",np="fullLoadTime",sp={mark(u){performance.mark(u)},frame(u){const F=u;null!=tp&&ep.push(F-tp),tp=F},clearMetrics(){tp=null,ep=[],performance.clearMeasures(rp),performance.clearMeasures(np);for(const u in F.bg)performance.clearMarks(F.bg[u])},getPerformanceMetrics(){performance.measure(rp,F.bg.create,F.bg.load),performance.measure(np,F.bg.create,F.bg.fullLoad);const u=performance.getEntriesByName(rp)[0].duration,Wt=performance.getEntriesByName(np)[0].duration,Xe=ep.length,Vi=1/(ep.reduce(((u,F)=>u+F),0)/Xe/1e3),fr=ep.filter((u=>u>ip)).reduce(((u,F)=>u+(F-ip)/ip),0);return{loadTime:u,fullLoadTime:Wt,fps:Vi,percentDroppedFrames:fr/(Xe+fr)*100,totalFrames:Xe}}};F.$=class extends ps{},F.A=Wh,F.B=gc,F.C=function(u){if(null==ns){const F=u.navigator?u.navigator.userAgent:null;ns=!!u.safari||!(!F||!(/\b(iPad|iPhone|iPod)\b/.test(F)||F.match("Safari")&&!F.match("Chrome")))}return ns},F.D=Ji,F.E=Z,F.F=class{constructor(u,F){this.target=u,this.mapId=F,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Ic((()=>this.process())),this.subscription=function(u,F,Wt,Xe){return u.addEventListener(F,Wt,!1),{unsubscribe:()=>{u.removeEventListener(F,Wt,!1)}}}(this.target,"message",(u=>this.receive(u))),this.globalScope=k(self)?u:window}registerMessageHandler(u,F){this.messageHandlers[u]=F}sendAsync(u,F){return new Promise(((Wt,Xe)=>{const Vi=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[Vi]={resolve:Wt,reject:Xe},F&&F.signal.addEventListener("abort",(()=>{delete this.resolveRejects[Vi];const F={id:Vi,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(F)}),{once:!0});const fr=[],_r=Object.assign(Object.assign({},u),{id:Vi,sourceMapId:this.mapId,origin:location.origin,data:ki(u.data,fr)});this.target.postMessage(_r,{transfer:fr})}))}receive(u){const F=u.data,Wt=F.id;if(!("file://"!==F.origin&&"file://"!==location.origin&&"resource://android"!==F.origin&&"resource://android"!==location.origin&&F.origin!==location.origin||F.targetMapId&&this.mapId!==F.targetMapId)){if("<cancel>"===F.type){delete this.tasks[Wt];const u=this.abortControllers[Wt];return delete this.abortControllers[Wt],void(u&&u.abort())}if(k(self)||F.mustQueue)return this.tasks[Wt]=F,this.taskQueue.push(Wt),void this.invoker.trigger();this.processTask(Wt,F)}}process(){if(0===this.taskQueue.length)return;const u=this.taskQueue.shift(),F=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),F&&this.processTask(u,F)}processTask(u,F){return e(this,void 0,void 0,(function*(){if("<response>"===F.type){const Wt=this.resolveRejects[u];if(delete this.resolveRejects[u],!Wt)return;return void(F.error?Wt.reject(Mi(F.error)):Wt.resolve(Mi(F.data)))}if(!this.messageHandlers[F.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${F.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const Wt=Mi(F.data),Xe=new AbortController;this.abortControllers[u]=Xe;try{const Vi=yield this.messageHandlers[F.type](F.sourceMapId,Wt,Xe);this.completeTask(u,null,Vi)}catch(Wt){this.completeTask(u,Wt)}}))}completeTask(u,F,Wt){const Xe=[];delete this.abortControllers[u];const Vi={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:F?ki(F):null,data:ki(Wt,Xe)};this.target.postMessage(Vi,{transfer:Xe})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},F.G=no,F.H=function(){var u=new Wh(16);return Wh!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},F.I=Tu,F.J=function(u,F,Wt){var Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua,Da=Wt[0],io=Wt[1],no=Wt[2];return F===u?(u[12]=F[0]*Da+F[4]*io+F[8]*no+F[12],u[13]=F[1]*Da+F[5]*io+F[9]*no+F[13],u[14]=F[2]*Da+F[6]*io+F[10]*no+F[14],u[15]=F[3]*Da+F[7]*io+F[11]*no+F[15]):(Vi=F[1],fr=F[2],_r=F[3],wr=F[4],Ar=F[5],Kr=F[6],In=F[7],ns=F[8],ca=F[9],ha=F[10],ua=F[11],u[0]=Xe=F[0],u[1]=Vi,u[2]=fr,u[3]=_r,u[4]=wr,u[5]=Ar,u[6]=Kr,u[7]=In,u[8]=ns,u[9]=ca,u[10]=ha,u[11]=ua,u[12]=Xe*Da+wr*io+ns*no+F[12],u[13]=Vi*Da+Ar*io+ca*no+F[13],u[14]=fr*Da+Kr*io+ha*no+F[14],u[15]=_r*Da+In*io+ua*no+F[15]),u},F.K=function(u,F,Wt){var Xe=Wt[0],Vi=Wt[1],fr=Wt[2];return u[0]=F[0]*Xe,u[1]=F[1]*Xe,u[2]=F[2]*Xe,u[3]=F[3]*Xe,u[4]=F[4]*Vi,u[5]=F[5]*Vi,u[6]=F[6]*Vi,u[7]=F[7]*Vi,u[8]=F[8]*fr,u[9]=F[9]*fr,u[10]=F[10]*fr,u[11]=F[11]*fr,u[12]=F[12],u[13]=F[13],u[14]=F[14],u[15]=F[15],u},F.L=uo,F.M=function(u,F){const Wt={};for(let Xe=0;Xe<F.length;Xe++){const Vi=F[Xe];Vi in u&&(Wt[Vi]=u[Vi])}return Wt},F.N=Pc,F.O=Vc,F.P=Xe,F.Q=Ec,F.R=Ao,F.S=jc,F.T=Zi,F.U=h,F.V=p,F.W=P,F.X=Nh,F.Y=ls,F.Z=$c,F._=e,F.a=io,F.a$=function(u,F){var Wt=u[0],Xe=u[1],Vi=u[2],fr=u[3],_r=u[4],wr=u[5],Ar=u[6],Kr=u[7],In=u[8],ns=u[9],ca=u[10],ha=u[11],ua=u[12],Da=u[13],io=u[14],no=u[15],so=F[0],ao=F[1],oo=F[2],co=F[3],ho=F[4],go=F[5],xo=F[6],Io=F[7],ko=F[8],Co=F[9],zo=F[10],Bo=F[11],al=F[12],ol=F[13],ll=F[14],cl=F[15];return Math.abs(Wt-so)<=Hh*Math.max(1,Math.abs(Wt),Math.abs(so))&&Math.abs(Xe-ao)<=Hh*Math.max(1,Math.abs(Xe),Math.abs(ao))&&Math.abs(Vi-oo)<=Hh*Math.max(1,Math.abs(Vi),Math.abs(oo))&&Math.abs(fr-co)<=Hh*Math.max(1,Math.abs(fr),Math.abs(co))&&Math.abs(_r-ho)<=Hh*Math.max(1,Math.abs(_r),Math.abs(ho))&&Math.abs(wr-go)<=Hh*Math.max(1,Math.abs(wr),Math.abs(go))&&Math.abs(Ar-xo)<=Hh*Math.max(1,Math.abs(Ar),Math.abs(xo))&&Math.abs(Kr-Io)<=Hh*Math.max(1,Math.abs(Kr),Math.abs(Io))&&Math.abs(In-ko)<=Hh*Math.max(1,Math.abs(In),Math.abs(ko))&&Math.abs(ns-Co)<=Hh*Math.max(1,Math.abs(ns),Math.abs(Co))&&Math.abs(ca-zo)<=Hh*Math.max(1,Math.abs(ca),Math.abs(zo))&&Math.abs(ha-Bo)<=Hh*Math.max(1,Math.abs(ha),Math.abs(Bo))&&Math.abs(ua-al)<=Hh*Math.max(1,Math.abs(ua),Math.abs(al))&&Math.abs(Da-ol)<=Hh*Math.max(1,Math.abs(Da),Math.abs(ol))&&Math.abs(io-ll)<=Hh*Math.max(1,Math.abs(io),Math.abs(ll))&&Math.abs(no-cl)<=Hh*Math.max(1,Math.abs(no),Math.abs(cl))},F.a0=oa,F.a1=Dc,F.a2=it,F.a3=u=>{const F=window.document.createElement("video");return F.muted=!0,new Promise((Wt=>{F.onloadstart=()=>{Wt(F)};for(const Wt of u){const u=window.document.createElement("source");j(Wt)||(F.crossOrigin="Anonymous"),u.src=Wt,F.appendChild(u)}}))},F.a4=function(){return Kr++},F.a5=Fs,F.a6=dc,F.a7=zn,F.a8=ja,F.a9=Nc,F.aA=function(u){if("custom"===u.type)return new Mc(u);switch(u.type){case"background":return new _c(u);case"circle":return new fo(u);case"fill":return new ul(u);case"fill-extrusion":return new El(u);case"heatmap":return new Mo(u);case"hillshade":return new Po(u);case"line":return new Hl(u);case"raster":return new kc(u);case"symbol":return new vc(u)}},F.aB=w,F.aC=function(u,F){if(!u)return[{command:"setStyle",args:[F]}];let Wt=[];try{if(!H(u.version,F.version))return[{command:"setStyle",args:[F]}];H(u.center,F.center)||Wt.push({command:"setCenter",args:[F.center]}),H(u.zoom,F.zoom)||Wt.push({command:"setZoom",args:[F.zoom]}),H(u.bearing,F.bearing)||Wt.push({command:"setBearing",args:[F.bearing]}),H(u.pitch,F.pitch)||Wt.push({command:"setPitch",args:[F.pitch]}),H(u.sprite,F.sprite)||Wt.push({command:"setSprite",args:[F.sprite]}),H(u.glyphs,F.glyphs)||Wt.push({command:"setGlyphs",args:[F.glyphs]}),H(u.transition,F.transition)||Wt.push({command:"setTransition",args:[F.transition]}),H(u.light,F.light)||Wt.push({command:"setLight",args:[F.light]}),H(u.terrain,F.terrain)||Wt.push({command:"setTerrain",args:[F.terrain]}),H(u.sky,F.sky)||Wt.push({command:"setSky",args:[F.sky]}),H(u.projection,F.projection)||Wt.push({command:"setProjection",args:[F.projection]});const Xe={},Vi=[];!function(u,F,Wt,Xe){let Vi;for(Vi in F=F||{},u=u||{})Object.prototype.hasOwnProperty.call(u,Vi)&&(Object.prototype.hasOwnProperty.call(F,Vi)||W(Vi,Wt,Xe));for(Vi in F)Object.prototype.hasOwnProperty.call(F,Vi)&&(Object.prototype.hasOwnProperty.call(u,Vi)?H(u[Vi],F[Vi])||("geojson"===u[Vi].type&&"geojson"===F[Vi].type&&tt(u,F,Vi)?Y(Wt,{command:"setGeoJSONSourceData",args:[Vi,F[Vi].data]}):Q(Vi,F,Wt,Xe)):J(Vi,F,Wt))}(u.sources,F.sources,Vi,Xe);const fr=[];u.layers&&u.layers.forEach((u=>{"source"in u&&Xe[u.source]?Wt.push({command:"removeLayer",args:[u.id]}):fr.push(u)})),Wt=Wt.concat(Vi),function(u,F,Wt){F=F||[];const Xe=(u=u||[]).map(rt),Vi=F.map(rt),fr=u.reduce(nt,{}),_r=F.reduce(nt,{}),wr=Xe.slice(),Ar=Object.create(null);let Kr,In,ns,ca,ha;for(let u=0,F=0;u<Xe.length;u++)Kr=Xe[u],Object.prototype.hasOwnProperty.call(_r,Kr)?F++:(Y(Wt,{command:"removeLayer",args:[Kr]}),wr.splice(wr.indexOf(Kr,F),1));for(let u=0,F=0;u<Vi.length;u++)Kr=Vi[Vi.length-1-u],wr[wr.length-1-u]!==Kr&&(Object.prototype.hasOwnProperty.call(fr,Kr)?(Y(Wt,{command:"removeLayer",args:[Kr]}),wr.splice(wr.lastIndexOf(Kr,wr.length-F),1)):F++,ca=wr[wr.length-u],Y(Wt,{command:"addLayer",args:[_r[Kr],ca]}),wr.splice(wr.length-u,0,Kr),Ar[Kr]=!0);for(let u=0;u<Vi.length;u++)if(Kr=Vi[u],In=fr[Kr],ns=_r[Kr],!Ar[Kr]&&!H(In,ns))if(H(In.source,ns.source)&&H(In["source-layer"],ns["source-layer"])&&H(In.type,ns.type)){for(ha in et(In.layout,ns.layout,Wt,Kr,null,"setLayoutProperty"),et(In.paint,ns.paint,Wt,Kr,null,"setPaintProperty"),H(In.filter,ns.filter)||Y(Wt,{command:"setFilter",args:[Kr,ns.filter]}),H(In.minzoom,ns.minzoom)&&H(In.maxzoom,ns.maxzoom)||Y(Wt,{command:"setLayerZoomRange",args:[Kr,ns.minzoom,ns.maxzoom]}),In)Object.prototype.hasOwnProperty.call(In,ha)&&"layout"!==ha&&"paint"!==ha&&"filter"!==ha&&"metadata"!==ha&&"minzoom"!==ha&&"maxzoom"!==ha&&(0===ha.indexOf("paint.")?et(In[ha],ns[ha],Wt,Kr,ha.slice(6),"setPaintProperty"):H(In[ha],ns[ha])||Y(Wt,{command:"setLayerProperty",args:[Kr,ha,ns[ha]]}));for(ha in ns)Object.prototype.hasOwnProperty.call(ns,ha)&&!Object.prototype.hasOwnProperty.call(In,ha)&&"layout"!==ha&&"paint"!==ha&&"filter"!==ha&&"metadata"!==ha&&"minzoom"!==ha&&"maxzoom"!==ha&&(0===ha.indexOf("paint.")?et(In[ha],ns[ha],Wt,Kr,ha.slice(6),"setPaintProperty"):H(In[ha],ns[ha])||Y(Wt,{command:"setLayerProperty",args:[Kr,ha,ns[ha]]}))}else Y(Wt,{command:"removeLayer",args:[Kr]}),ca=wr[wr.lastIndexOf(Kr)+1],Y(Wt,{command:"addLayer",args:[ns,ca]})}(fr,F.layers,Wt)}catch(u){console.warn("Unable to compute style diff:",u),Wt=[{command:"setStyle",args:[F]}]}return Wt},F.aD=function(u){const F=[],Wt=u.id;return void 0===Wt&&F.push({message:`layers.${Wt}: missing required property "id"`}),void 0===u.render&&F.push({message:`layers.${Wt}: missing required method "render"`}),u.renderingMode&&"2d"!==u.renderingMode&&"3d"!==u.renderingMode&&F.push({message:`layers.${Wt}: property "renderingMode" must be either "2d" or "3d"`}),F},F.aE=function t(u,F){if(Array.isArray(u)){if(!Array.isArray(F)||u.length!==F.length)return!1;for(let Wt=0;Wt<u.length;Wt++)if(!t(u[Wt],F[Wt]))return!1;return!0}if("object"==typeof u&&null!==u&&null!==F){if("object"!=typeof F)return!1;if(Object.keys(u).length!==Object.keys(F).length)return!1;for(const Wt in u)if(!t(u[Wt],F[Wt]))return!1;return!0}return u===F},F.aF=v,F.aG=b,F.aH=class extends wa{constructor(u,F){super(u,F),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},F.aI=_a,F.aJ=class extends wa{constructor(u,F){super(u,F),this.current=jh}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let F=1;F<16;F++)if(u[F]!==this.current[F]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},F.aK=Aa,F.aL=Sa,F.aM=Kt,F.aN=class extends wa{constructor(u,F){super(u,F),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},F.aO=class extends wa{constructor(u,F){super(u,F),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},F.aP=function(u,F,Wt,Xe,Vi,fr,_r){var wr=1/(F-Wt),Ar=1/(Xe-Vi),Kr=1/(fr-_r);return u[0]=-2*wr,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*Ar,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*Kr,u[11]=0,u[12]=(F+Wt)*wr,u[13]=(Vi+Xe)*Ar,u[14]=(_r+fr)*Kr,u[15]=1,u},F.aQ=Jh,F.aR=class extends _s{},F.aS=yd,F.aT=class extends Ss{},F.aU=Qh,F.aV=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},F.aW=So,F.aX=Zs,F.aY=na,F.aZ=class extends Bs{},F.a_=function(u,F){return u[0]===F[0]&&u[1]===F[1]&&u[2]===F[2]&&u[3]===F[3]&&u[4]===F[4]&&u[5]===F[5]&&u[6]===F[6]&&u[7]===F[7]&&u[8]===F[8]&&u[9]===F[9]&&u[10]===F[10]&&u[11]===F[11]&&u[12]===F[12]&&u[13]===F[13]&&u[14]===F[14]&&u[15]===F[15]},F.aa=function(u){const F={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((u,Wt,Xe,Vi)=>{const fr=Xe||Vi;return F[Wt]=!fr||fr.toLowerCase(),""})),F["max-age"]){const u=parseInt(F["max-age"],10);isNaN(u)?delete F["max-age"]:F["max-age"]=u}return F},F.ab=function(u,F){const Wt=[];for(const Xe in u)Xe in F||Wt.push(Xe);return Wt},F.ac=y,F.ad=function(u,F,Wt){var Xe=Math.sin(Wt),Vi=Math.cos(Wt),fr=F[0],_r=F[1],wr=F[2],Ar=F[3],Kr=F[4],In=F[5],ns=F[6],ca=F[7];return F!==u&&(u[8]=F[8],u[9]=F[9],u[10]=F[10],u[11]=F[11],u[12]=F[12],u[13]=F[13],u[14]=F[14],u[15]=F[15]),u[0]=fr*Vi+Kr*Xe,u[1]=_r*Vi+In*Xe,u[2]=wr*Vi+ns*Xe,u[3]=Ar*Vi+ca*Xe,u[4]=Kr*Vi-fr*Xe,u[5]=In*Vi-_r*Xe,u[6]=ns*Vi-wr*Xe,u[7]=ca*Vi-Ar*Xe,u},F.ae=function(u){var F=new Wh(16);return F[0]=u[0],F[1]=u[1],F[2]=u[2],F[3]=u[3],F[4]=u[4],F[5]=u[5],F[6]=u[6],F[7]=u[7],F[8]=u[8],F[9]=u[9],F[10]=u[10],F[11]=u[11],F[12]=u[12],F[13]=u[13],F[14]=u[14],F[15]=u[15],F},F.af=po,F.ag=function(u,F){let Wt=0,Xe=0;if("constant"===u.kind)Xe=u.layoutSize;else if("source"!==u.kind){const{interpolationType:Vi,minZoom:fr,maxZoom:_r}=u,wr=Vi?y(Be.interpolationFactor(Vi,F,fr,_r),0,1):0;"camera"===u.kind?Xe=Ol.number(u.minSize,u.maxSize,wr):Wt=wr}return{uSizeT:Wt,uSize:Xe}},F.ai=function(u,{uSize:F,uSizeT:Wt},{lowerSize:Xe,upperSize:Vi}){return"source"===u.kind?Xe/Rd:"composite"===u.kind?Ol.number(Xe/Rd,Vi/Rd,Wt):F},F.aj=cc,F.ak=function(u,F,Wt,Vi){const fr=F.y-u.y,_r=F.x-u.x,wr=Vi.y-Wt.y,Ar=Vi.x-Wt.x,Kr=wr*_r-Ar*fr;if(0===Kr)return null;const In=(Ar*(u.y-Wt.y)-wr*(u.x-Wt.x))/Kr;return new Xe(u.x+In*_r,u.y+In*fr)},F.al=Hc,F.am=qa,F.an=lo,F.ao=function(u){let F=1/0,Wt=1/0,Xe=-1/0,Vi=-1/0;for(const fr of u)F=Math.min(F,fr.x),Wt=Math.min(Wt,fr.y),Xe=Math.max(Xe,fr.x),Vi=Math.max(Vi,fr.y);return[F,Wt,Xe,Vi]},F.ap=vd,F.ar=ac,F.as=function(u,F){var Wt=F[0],Xe=F[1],Vi=F[2],fr=F[3],_r=F[4],wr=F[5],Ar=F[6],Kr=F[7],In=F[8],ns=F[9],ca=F[10],ha=F[11],ua=F[12],Da=F[13],io=F[14],no=F[15],so=Wt*wr-Xe*_r,ao=Wt*Ar-Vi*_r,oo=Wt*Kr-fr*_r,co=Xe*Ar-Vi*wr,ho=Xe*Kr-fr*wr,go=Vi*Kr-fr*Ar,xo=In*Da-ns*ua,Io=In*io-ca*ua,ko=In*no-ha*ua,Co=ns*io-ca*Da,zo=ns*no-ha*Da,Bo=ca*no-ha*io,al=so*Bo-ao*zo+oo*Co+co*ko-ho*Io+go*xo;return al?(u[0]=(wr*Bo-Ar*zo+Kr*Co)*(al=1/al),u[1]=(Vi*zo-Xe*Bo-fr*Co)*al,u[2]=(Da*go-io*ho+no*co)*al,u[3]=(ca*ho-ns*go-ha*co)*al,u[4]=(Ar*ko-_r*Bo-Kr*Io)*al,u[5]=(Wt*Bo-Vi*ko+fr*Io)*al,u[6]=(io*oo-ua*go-no*ao)*al,u[7]=(In*go-ca*oo+ha*ao)*al,u[8]=(_r*zo-wr*ko+Kr*xo)*al,u[9]=(Xe*ko-Wt*zo-fr*xo)*al,u[10]=(ua*ho-Da*oo+no*so)*al,u[11]=(ns*oo-In*ho-ha*so)*al,u[12]=(wr*Io-_r*Co-Ar*xo)*al,u[13]=(Wt*Co-Xe*Io+Vi*xo)*al,u[14]=(Da*ao-ua*co-io*so)*al,u[15]=(In*co-ns*ao+ca*so)*al,u):null},F.at=bh,F.au=Ju,F.av=Mh,F.aw=function(){const u={},F=so.$version;for(const Wt in so.$root){const Xe=so.$root[Wt];if(Xe.required){let Vi=null;Vi="version"===Wt?F:"array"===Xe.type?[]:{},null!=Vi&&(u[Wt]=Vi)}}return u},F.ax=Ii,F.ay=D,F.az=function(u){u=u.slice();const F=Object.create(null);for(let Wt=0;Wt<u.length;Wt++)F[u[Wt].id]=u[Wt];for(let Wt=0;Wt<u.length;Wt++)"ref"in u[Wt]&&(u[Wt]=X(u[Wt],F[u[Wt].ref]));return u},F.b=I,F.b0=function(u,F){return u[0]=F[0],u[1]=F[1],u[2]=F[2],u[3]=F[3],u[4]=F[4],u[5]=F[5],u[6]=F[6],u[7]=F[7],u[8]=F[8],u[9]=F[9],u[10]=F[10],u[11]=F[11],u[12]=F[12],u[13]=F[13],u[14]=F[14],u[15]=F[15],u},F.b1=function(u,F,Wt){return u[0]=F[0]*Wt[0],u[1]=F[1]*Wt[1],u[2]=F[2]*Wt[2],u[3]=F[3]*Wt[3],u},F.b2=function(u,F){return u[0]*F[0]+u[1]*F[1]+u[2]*F[2]+u[3]*F[3]},F.b3=m,F.b4=Oc,F.b5=Fc,F.b6=function(u,F,Wt,Xe,Vi){var fr,_r=1/Math.tan(F/2);return u[0]=_r/Wt,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=_r,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,null!=Vi&&Vi!==1/0?(u[10]=(Vi+Xe)*(fr=1/(Xe-Vi)),u[14]=2*Vi*Xe*fr):(u[10]=-1,u[14]=-2*Xe),u},F.b7=function(u,F,Wt){var Xe=Math.sin(Wt),Vi=Math.cos(Wt),fr=F[4],_r=F[5],wr=F[6],Ar=F[7],Kr=F[8],In=F[9],ns=F[10],ca=F[11];return F!==u&&(u[0]=F[0],u[1]=F[1],u[2]=F[2],u[3]=F[3],u[12]=F[12],u[13]=F[13],u[14]=F[14],u[15]=F[15]),u[4]=fr*Vi+Kr*Xe,u[5]=_r*Vi+In*Xe,u[6]=wr*Vi+ns*Xe,u[7]=Ar*Vi+ca*Xe,u[8]=Kr*Vi-fr*Xe,u[9]=In*Vi-_r*Xe,u[10]=ns*Vi-wr*Xe,u[11]=ca*Vi-Ar*Xe,u},F.b8=f,F.b9=Ar,F.bA=bd,F.bB=function(u){return u.message===Da},F.bC=bn,F.bD=ih,F.ba=function(u){return u*Math.PI/180},F.bb=function(u,F){const{x:Wt,y:Xe}=$c.fromLngLat(F);return!(u<0||u>25||Xe<0||Xe>=1||Wt<0||Wt>=1)},F.bc=function(u,F){return u[0]=F[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=F[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=F[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},F.bd=class extends hs{},F.be=Gd,F.bf=sp,F.bh=L,F.bi=function(u,F){io.REGISTERED_PROTOCOLS[u]=F},F.bj=function(u){delete io.REGISTERED_PROTOCOLS[u]},F.bk=function(u,F){const Wt={};for(let Xe=0;Xe<u.length;Xe++){const Vi=F&&F[u[Xe].id]||Ln(u[Xe]);F&&(F[u[Xe].id]=Vi);let fr=Wt[Vi];fr||(fr=Wt[Vi]=[]),fr.push(u[Xe])}const Xe=[];for(const u in Wt)Xe.push(Wt[u]);return Xe},F.bl=wi,F.bm=qc,F.bn=Zc,F.bo=$u,F.bp=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=Nh/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const Wt=u.bucket.layers[0],Xe=Wt.layout,Vi=Wt._unevaluatedLayout._values,fr={layoutIconSize:Vi["icon-size"].possiblyEvaluate(new Ui(u.bucket.zoom+1),u.canonical),layoutTextSize:Vi["text-size"].possiblyEvaluate(new Ui(u.bucket.zoom+1),u.canonical),textMaxSize:Vi["text-size"].possiblyEvaluate(new Ui(18))};if("composite"===u.bucket.textSizeData.kind){const{minZoom:F,maxZoom:Wt}=u.bucket.textSizeData;fr.compositeTextSizes=[Vi["text-size"].possiblyEvaluate(new Ui(F),u.canonical),Vi["text-size"].possiblyEvaluate(new Ui(Wt),u.canonical)]}if("composite"===u.bucket.iconSizeData.kind){const{minZoom:F,maxZoom:Wt}=u.bucket.iconSizeData;fr.compositeIconSizes=[Vi["icon-size"].possiblyEvaluate(new Ui(F),u.canonical),Vi["icon-size"].possiblyEvaluate(new Ui(Wt),u.canonical)]}const _r=Xe.get("text-line-height")*vd,wr="viewport"!==Xe.get("text-rotation-alignment")&&"point"!==Xe.get("symbol-placement"),Ar=Xe.get("text-keep-upright"),Kr=Xe.get("text-size");for(const Vi of u.bucket.features){const In=Xe.get("text-font").evaluate(Vi,{},u.canonical).join(","),ns=Kr.evaluate(Vi,{},u.canonical),ca=fr.layoutTextSize.evaluate(Vi,{},u.canonical),ha=fr.layoutIconSize.evaluate(Vi,{},u.canonical),ua={horizontal:{},vertical:void 0},Da=Vi.text;let io,no=[0,0];if(Da){const fr=Da.toString(),Kr=Xe.get("text-letter-spacing").evaluate(Vi,{},u.canonical)*vd,ha=Ci(fr)?Kr:0,io=Xe.get("text-anchor").evaluate(Vi,{},u.canonical),so=vh(Wt,Vi,u.canonical);if(!so){const F=Xe.get("text-radial-offset").evaluate(Vi,{},u.canonical);no=F?xh(io,[F*vd,Kd]):Xe.get("text-offset").evaluate(Vi,{},u.canonical).map((u=>u*vd))}let ao=wr?"center":Xe.get("text-justify").evaluate(Vi,{},u.canonical);const oo="point"===Xe.get("symbol-placement")?Xe.get("text-max-width").evaluate(Vi,{},u.canonical)*vd:1/0,w=()=>{u.bucket.allowVerticalPlacement&&Pi(fr)&&(ua.vertical=Ru(Da,u.glyphMap,u.glyphPositions,u.imagePositions,In,oo,_r,io,"left",ha,no,F.ah.vertical,!0,ca,ns))};if(!wr&&so){const Wt=new Set;if("auto"===ao)for(let u=0;u<so.values.length;u+=2)Wt.add(bh(so.values[u]));else Wt.add(ao);let Xe=!1;for(const Vi of Wt)if(!ua.horizontal[Vi])if(Xe)ua.horizontal[Vi]=ua.horizontal[0];else{const Wt=Ru(Da,u.glyphMap,u.glyphPositions,u.imagePositions,In,oo,_r,"center",Vi,ha,no,F.ah.horizontal,!1,ca,ns);Wt&&(ua.horizontal[Vi]=Wt,Xe=1===Wt.positionedLines.length)}w()}else{"auto"===ao&&(ao=bh(io));const Wt=Ru(Da,u.glyphMap,u.glyphPositions,u.imagePositions,In,oo,_r,io,ao,ha,no,F.ah.horizontal,!1,ca,ns);Wt&&(ua.horizontal[ao]=Wt),w(),Pi(fr)&&wr&&Ar&&(ua.vertical=Ru(Da,u.glyphMap,u.glyphPositions,u.imagePositions,In,oo,_r,io,ao,ha,no,F.ah.vertical,!1,ca,ns))}}let so=!1;if(Vi.icon&&Vi.icon.name){const F=u.imageMap[Vi.icon.name];F&&(io=Qu(u.imagePositions[Vi.icon.name],Xe.get("icon-offset").evaluate(Vi,{},u.canonical),Xe.get("icon-anchor").evaluate(Vi,{},u.canonical)),so=!!F.sdf,void 0===u.bucket.sdfIcons?u.bucket.sdfIcons=so:u.bucket.sdfIcons!==so&&A("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(F.pixelRatio!==u.bucket.pixelRatio||0!==Xe.get("icon-rotate").constantOr(1))&&(u.bucket.iconsNeedLinear=!0))}const ao=Ah(ua.horizontal)||ua.vertical;u.bucket.iconsInText=!!ao&&ao.iconsInText,(ao||io)&&wh(u.bucket,Vi,ua,io,u.imageMap,fr,ca,ha,no,so,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},F.bq=ql,F.br=sl,F.bs=zl,F.bt=Du,F.bu=Id,F.bv=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return 0===u.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},F.bw=function(F,Wt,Xe,Vi,fr){return e(this||u,void 0,void 0,(function*(){if(p())try{return yield P(F,Wt,Xe,Vi,fr)}catch(u){}return function(u,F,Wt,Xe,Vi){const fr=u.width,_r=u.height;ha&&ua||(ha=new OffscreenCanvas(fr,_r),ua=ha.getContext("2d",{willReadFrequently:!0})),ha.width=fr,ha.height=_r,ua.drawImage(u,0,0,fr,_r);const wr=ua.getImageData(F,Wt,Xe,Vi);return ua.clearRect(0,0,fr,_r),wr.data}(F,Wt,Xe,Vi,fr)}))},F.bx=Uc,F.by=r,F.bz=Wt,F.c=E,F.d=u=>e(void 0,void 0,void 0,(function*(){if(0===u.byteLength)return createImageBitmap(new ImageData(1,1));const F=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(F)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),F.e=g,F.f=u=>new Promise(((F,Wt)=>{const Xe=new Image;Xe.onload=()=>{F(Xe),URL.revokeObjectURL(Xe.src),Xe.onload=null,window.requestAnimationFrame((()=>{Xe.src=ca}))},Xe.onerror=()=>Wt(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Vi=new Blob([new Uint8Array(u)],{type:"image/png"});Xe.src=u.byteLength?URL.createObjectURL(Vi):ca})),F.g=T,F.h=(u,F)=>O(g(u,{type:"json"}),F),F.i=k,F.j=N,F.k=q,F.l=(u,F)=>O(g(u,{type:"arrayBuffer"}),F),F.m=O,F.n=function(u){return new Id(u).readFields(Pu,[])},F.o=_o,F.p=Eu,F.q=rs,F.r=mc,F.s=j,F.t=xi,F.u=lc,F.v=so,F.w=A,F.x=function([u,F,Wt]){return F+=90,F*=Math.PI/180,Wt*=Math.PI/180,{x:u*Math.cos(F)*Math.sin(Wt),y:u*Math.sin(F)*Math.sin(Wt),z:u*Math.cos(Wt)}},F.y=Ol,F.z=Ui}));define("worker",["./shared"],(function(F){class t{constructor(u){this.keyCache={},u&&this.replace(u)}replace(u){this._layerConfigs={},this._layers={},this.update(u,[])}update(u,Wt){for(const Wt of u){this._layerConfigs[Wt.id]=Wt;const u=this._layers[Wt.id]=F.aA(Wt);u._featureFilter=F.a7(u.filter),this.keyCache[Wt.id]&&delete this.keyCache[Wt.id]}for(const u of Wt)delete this.keyCache[u],delete this._layerConfigs[u],delete this._layers[u];this.familiesBySource={};const Xe=F.bk(Object.values(this._layerConfigs),this.keyCache);for(const u of Xe){const F=u.map((u=>this._layers[u.id])),Wt=F[0];if("none"===Wt.visibility)continue;const Xe=Wt.source||"";let Vi=this.familiesBySource[Xe];Vi||(Vi=this.familiesBySource[Xe]={});const fr=Wt.sourceLayer||"_geojsonTileLayer";let _r=Vi[fr];_r||(_r=Vi[fr]=[]),_r.push(F)}}}class o{constructor(u){const Wt={},Xe=[];for(const F in u){const Vi=u[F],fr=Wt[F]={};for(const u in Vi){const F=Vi[+u];if(!F||0===F.bitmap.width||0===F.bitmap.height)continue;const Wt={x:0,y:0,w:F.bitmap.width+2,h:F.bitmap.height+2};Xe.push(Wt),fr[u]={rect:Wt,metrics:F.metrics}}}const{w:Vi,h:fr}=F.p(Xe),_r=new F.o({width:Vi||1,height:fr||1});for(const Xe in u){const Vi=u[Xe];for(const u in Vi){const fr=Vi[+u];if(!fr||0===fr.bitmap.width||0===fr.bitmap.height)continue;const wr=Wt[Xe][u].rect;F.o.copy(fr.bitmap,_r,{x:0,y:0},{x:wr.x+1,y:wr.y+1},fr.bitmap)}}this.image=_r,this.positions=Wt}}F.bl("GlyphAtlas",o);class i{constructor(u){this.tileID=new F.S(u.tileID.overscaledZ,u.tileID.wrap,u.tileID.canonical.z,u.tileID.canonical.x,u.tileID.canonical.y),this.uid=u.uid,this.zoom=u.zoom,this.pixelRatio=u.pixelRatio,this.tileSize=u.tileSize,this.source=u.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=u.showCollisionBoxes,this.collectResourceTiming=!!u.collectResourceTiming,this.returnDependencies=!!u.returnDependencies,this.promoteId=u.promoteId,this.inFlightDependencies=[]}parse(u,Wt,Xe,Vi){return F._(this,void 0,void 0,(function*(){this.status="parsing",this.data=u,this.collisionBoxArray=new F.a5;const fr=new F.bm(Object.keys(u.layers).sort()),_r=new F.bn(this.tileID,this.promoteId);_r.bucketLayerIDs=[];const wr={},Ar={featureIndex:_r,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Xe},Kr=Wt.familiesBySource[this.source];for(const Wt in Kr){const Vi=u.layers[Wt];if(!Vi)continue;1===Vi.version&&F.w(`Vector tile source "${this.source}" layer "${Wt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const In=fr.encode(Wt),ns=[];for(let u=0;u<Vi.length;u++){const F=Vi.feature(u),Xe=_r.getId(F,Wt);ns.push({feature:F,id:Xe,index:u,sourceLayerIndex:In})}for(const u of Kr[Wt]){const Wt=u[0];Wt.source!==this.source&&F.w(`layer.source = ${Wt.source} does not equal this.source = ${this.source}`),Wt.minzoom&&this.zoom<Math.floor(Wt.minzoom)||Wt.maxzoom&&this.zoom>=Wt.maxzoom||"none"!==Wt.visibility&&(s(u,this.zoom,Xe),(wr[Wt.id]=Wt.createBucket({index:_r.bucketLayerIDs.length,layers:u,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:In,sourceID:this.source})).populate(ns,Ar,this.tileID.canonical),_r.bucketLayerIDs.push(u.map((u=>u.id))))}}const In=F.aF(Ar.glyphDependencies,(u=>Object.keys(u).map(Number)));this.inFlightDependencies.forEach((u=>null==u?void 0:u.abort())),this.inFlightDependencies=[];let ns=Promise.resolve({});if(Object.keys(In).length){const u=new AbortController;this.inFlightDependencies.push(u),ns=Vi.sendAsync({type:"GG",data:{stacks:In,source:this.source,tileID:this.tileID,type:"glyphs"}},u)}const ca=Object.keys(Ar.iconDependencies);let ha=Promise.resolve({});if(ca.length){const u=new AbortController;this.inFlightDependencies.push(u),ha=Vi.sendAsync({type:"GI",data:{icons:ca,source:this.source,tileID:this.tileID,type:"icons"}},u)}const ua=Object.keys(Ar.patternDependencies);let Da=Promise.resolve({});if(ua.length){const u=new AbortController;this.inFlightDependencies.push(u),Da=Vi.sendAsync({type:"GI",data:{icons:ua,source:this.source,tileID:this.tileID,type:"patterns"}},u)}const[io,no,so]=yield Promise.all([ns,ha,Da]),ao=new o(io),oo=new F.bo(no,so);for(const u in wr){const Wt=wr[u];Wt instanceof F.a6?(s(Wt.layers,this.zoom,Xe),F.bp({bucket:Wt,glyphMap:io,glyphPositions:ao.positions,imageMap:no,imagePositions:oo.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Wt.hasPattern&&(Wt instanceof F.bq||Wt instanceof F.br||Wt instanceof F.bs)&&(s(Wt.layers,this.zoom,Xe),Wt.addFeatures(Ar,this.tileID.canonical,oo.patternPositions))}return this.status="done",{buckets:Object.values(wr).filter((u=>!u.isEmpty())),featureIndex:_r,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ao.image,imageAtlas:oo,glyphMap:this.returnDependencies?io:null,iconMap:this.returnDependencies?no:null,glyphPositions:this.returnDependencies?ao.positions:null}}))}}function s(u,Wt,Xe){const Vi=new F.z(Wt);for(const F of u)F.recalculate(Vi,Xe)}class r{constructor(u,F,Wt){this.actor=u,this.layerIndex=F,this.availableImages=Wt,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(u,Wt){return F._(this,void 0,void 0,(function*(){const Xe=yield F.l(u.request,Wt);try{return{vectorTile:new F.bt.VectorTile(new F.bu(Xe.data)),rawData:Xe.data,cacheControl:Xe.cacheControl,expires:Xe.expires}}catch(F){const Wt=new Uint8Array(Xe.data);let Vi=`Unable to parse the tile at ${u.request.url}, `;throw Vi+=31===Wt[0]&&139===Wt[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${F.message}`,new Error(Vi)}}))}loadTile(u){return F._(this,void 0,void 0,(function*(){const Wt=u.uid,Xe=!!(u&&u.request&&u.request.collectResourceTiming)&&new F.bv(u.request),Vi=new i(u);this.loading[Wt]=Vi;const fr=new AbortController;Vi.abort=fr;try{const _r=yield this.loadVectorTile(u,fr);if(delete this.loading[Wt],!_r)return null;const wr=_r.rawData,Ar={};_r.expires&&(Ar.expires=_r.expires),_r.cacheControl&&(Ar.cacheControl=_r.cacheControl);const Kr={};if(Xe){const u=Xe.finish();u&&(Kr.resourceTiming=JSON.parse(JSON.stringify(u)))}Vi.vectorTile=_r.vectorTile;const In=Vi.parse(_r.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[Wt]=Vi,this.fetching[Wt]={rawTileData:wr,cacheControl:Ar,resourceTiming:Kr};try{const u=yield In;return F.e({rawTileData:wr.slice(0)},u,Ar,Kr)}finally{delete this.fetching[Wt]}}catch(u){throw delete this.loading[Wt],Vi.status="done",this.loaded[Wt]=Vi,u}}))}reloadTile(u){return F._(this,void 0,void 0,(function*(){const Wt=u.uid;if(!this.loaded||!this.loaded[Wt])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Xe=this.loaded[Wt];if(Xe.showCollisionBoxes=u.showCollisionBoxes,"parsing"===Xe.status){const u=yield Xe.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.actor);let Vi;if(this.fetching[Wt]){const{rawTileData:Xe,cacheControl:fr,resourceTiming:_r}=this.fetching[Wt];delete this.fetching[Wt],Vi=F.e({rawTileData:Xe.slice(0)},u,fr,_r)}else Vi=u;return Vi}if("done"===Xe.status&&Xe.vectorTile)return Xe.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.actor)}))}abortTile(u){return F._(this,void 0,void 0,(function*(){const F=this.loading,Wt=u.uid;F&&F[Wt]&&F[Wt].abort&&(F[Wt].abort.abort(),delete F[Wt])}))}removeTile(u){return F._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[u.uid]&&delete this.loaded[u.uid]}))}}class n{constructor(){this.loaded={}}loadTile(u){return F._(this,void 0,void 0,(function*(){const{uid:Wt,encoding:Xe,rawImageData:Vi,redFactor:fr,greenFactor:_r,blueFactor:wr,baseShift:Ar}=u,Kr=Vi.width+2,In=Vi.height+2,ns=F.b(Vi)?new F.R({width:Kr,height:In},yield F.bw(Vi,-1,-1,Kr,In)):Vi,ca=new F.bx(Wt,ns,Xe,fr,_r,wr,Ar);return this.loaded=this.loaded||{},this.loaded[Wt]=ca,ca}))}removeTile(u){const F=this.loaded,Wt=u.uid;F&&F[Wt]&&delete F[Wt]}}function a(u,F){if(0!==u.length){l(u[0],F);for(var Wt=1;Wt<u.length;Wt++)l(u[Wt],!F)}}function l(u,F){for(var Wt=0,Xe=0,Vi=0,fr=u.length,_r=fr-1;Vi<fr;_r=Vi++){var wr=(u[Vi][0]-u[_r][0])*(u[_r][1]+u[Vi][1]),Ar=Wt+wr;Xe+=Math.abs(Wt)>=Math.abs(wr)?Wt-Ar+wr:wr-Ar+Wt,Wt=Ar}Wt+Xe>=0!=!!F&&u.reverse()}var Wt=F.by((function e(u,F){var Wt,Xe=u&&u.type;if("FeatureCollection"===Xe)for(Wt=0;Wt<u.features.length;Wt++)e(u.features[Wt],F);else if("GeometryCollection"===Xe)for(Wt=0;Wt<u.geometries.length;Wt++)e(u.geometries[Wt],F);else if("Feature"===Xe)e(u.geometry,F);else if("Polygon"===Xe)a(u.coordinates,F);else if("MultiPolygon"===Xe)for(Wt=0;Wt<u.coordinates.length;Wt++)a(u.coordinates[Wt],F);return u}));const Xe=F.bt.VectorTileFeature.prototype.toGeoJSON;var Vi={exports:{}},fr=F.bz,_r=F.bt.VectorTileFeature,wr=p;function p(F,Wt){(this||u).options=Wt||{},(this||u).features=F,(this||u).length=F.length}function m(F,Wt){(this||u).id="number"==typeof F.id?F.id:void 0,(this||u).type=F.type,(this||u).rawGeometry=1===F.type?[F.geometry]:F.geometry,(this||u).properties=F.tags,(this||u).extent=Wt||4096}p.prototype.feature=function(F){return new m((this||u).features[F],(this||u).options.extent)},m.prototype.loadGeometry=function(){var F=(this||u).rawGeometry;(this||u).geometry=[];for(var Wt=0;Wt<F.length;Wt++){for(var Xe=F[Wt],Vi=[],_r=0;_r<Xe.length;_r++)Vi.push(new fr(Xe[_r][0],Xe[_r][1]));(this||u).geometry.push(Vi)}return(this||u).geometry},m.prototype.bbox=function(){(this||u).geometry||this.loadGeometry();for(var F=(this||u).geometry,Wt=1/0,Xe=-1/0,Vi=1/0,fr=-1/0,_r=0;_r<F.length;_r++)for(var wr=F[_r],Ar=0;Ar<wr.length;Ar++){var Kr=wr[Ar];Wt=Math.min(Wt,Kr.x),Xe=Math.max(Xe,Kr.x),Vi=Math.min(Vi,Kr.y),fr=Math.max(fr,Kr.y)}return[Wt,Vi,Xe,fr]},m.prototype.toGeoJSON=_r.prototype.toGeoJSON;var Ar=F.bA,Kr=wr;function w(u){var F=new Ar;return function(u,F){for(var Wt in u.layers)F.writeMessage(3,x,u.layers[Wt])}(u,F),F.finish()}function x(u,F){var Wt;F.writeVarintField(15,u.version||1),F.writeStringField(1,u.name||""),F.writeVarintField(5,u.extent||4096);var Xe={keys:[],values:[],keycache:{},valuecache:{}};for(Wt=0;Wt<u.length;Wt++)Xe.feature=u.feature(Wt),F.writeMessage(2,b,Xe);var Vi=Xe.keys;for(Wt=0;Wt<Vi.length;Wt++)F.writeStringField(3,Vi[Wt]);var fr=Xe.values;for(Wt=0;Wt<fr.length;Wt++)F.writeMessage(4,P,fr[Wt])}function b(u,F){var Wt=u.feature;void 0!==Wt.id&&F.writeVarintField(1,Wt.id),F.writeMessage(2,S,u),F.writeVarintField(3,Wt.type),F.writeMessage(4,I,Wt)}function S(u,F){var Wt=u.feature,Xe=u.keys,Vi=u.values,fr=u.keycache,_r=u.valuecache;for(var wr in Wt.properties){var Ar=Wt.properties[wr],Kr=fr[wr];if(null!==Ar){void 0===Kr&&(Xe.push(wr),fr[wr]=Kr=Xe.length-1),F.writeVarint(Kr);var In=typeof Ar;"string"!==In&&"boolean"!==In&&"number"!==In&&(Ar=JSON.stringify(Ar));var ns=In+":"+Ar,ca=_r[ns];void 0===ca&&(Vi.push(Ar),_r[ns]=ca=Vi.length-1),F.writeVarint(ca)}}}function _(u,F){return(F<<3)+(7&u)}function M(u){return u<<1^u>>31}function I(u,F){for(var Wt=u.loadGeometry(),Xe=u.type,Vi=0,fr=0,_r=Wt.length,wr=0;wr<_r;wr++){var Ar=Wt[wr],Kr=1;1===Xe&&(Kr=Ar.length),F.writeVarint(_(1,Kr));for(var In=3===Xe?Ar.length-1:Ar.length,ns=0;ns<In;ns++){1===ns&&1!==Xe&&F.writeVarint(_(2,In-1));var ca=Ar[ns].x-Vi,ha=Ar[ns].y-fr;F.writeVarint(M(ca)),F.writeVarint(M(ha)),Vi+=ca,fr+=ha}3===Xe&&F.writeVarint(_(7,1))}}function P(u,F){var Wt=typeof u;"string"===Wt?F.writeStringField(1,u):"boolean"===Wt?F.writeBooleanField(7,u):"number"===Wt&&(u%1!=0?F.writeDoubleField(3,u):u<0?F.writeSVarintField(6,u):F.writeVarintField(5,u))}Vi.exports=w,Vi.exports.fromVectorTileJs=w,Vi.exports.fromGeojsonVt=function(u,F){F=F||{};var Wt={};for(var Xe in u)Wt[Xe]=new Kr(u[Xe].features,F),Wt[Xe].name=Xe,Wt[Xe].version=F.version,Wt[Xe].extent=F.extent;return w({layers:Wt})},Vi.exports.GeoJSONWrapper=Kr;var In=F.by(Vi.exports);const ns={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:u=>u},ca=Math.fround||(ha=new Float32Array(1),u=>(ha[0]=+u,ha[0]));var ha;const ua=3,Da=5,io=6;class z{constructor(u){this.options=Object.assign(Object.create(ns),u),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(u){const{log:F,minZoom:Wt,maxZoom:Xe}=this.options;F&&console.time("total time");const Vi=`prepare ${u.length} points`;F&&console.time(Vi),this.points=u;const fr=[];for(let F=0;F<u.length;F++){const Wt=u[F];if(!Wt.geometry)continue;const[Xe,Vi]=Wt.geometry.coordinates,_r=ca(G(Xe)),wr=ca(j(Vi));fr.push(_r,wr,1/0,F,-1,1),this.options.reduce&&fr.push(0)}let _r=this.trees[Xe+1]=this._createTree(fr);F&&console.timeEnd(Vi);for(let u=Xe;u>=Wt;u--){const Wt=+Date.now();_r=this.trees[u]=this._createTree(this._cluster(_r,u)),F&&console.log("z%d: %d clusters in %dms",u,_r.numItems,+Date.now()-Wt)}return F&&console.timeEnd("total time"),this}getClusters(u,F){let Wt=((u[0]+180)%360+360)%360-180;const Xe=Math.max(-90,Math.min(90,u[1]));let Vi=180===u[2]?180:((u[2]+180)%360+360)%360-180;const fr=Math.max(-90,Math.min(90,u[3]));if(u[2]-u[0]>=360)Wt=-180,Vi=180;else if(Wt>Vi){const u=this.getClusters([Wt,Xe,180,fr],F),_r=this.getClusters([-180,Xe,Vi,fr],F);return u.concat(_r)}const _r=this.trees[this._limitZoom(F)],wr=_r.range(G(Wt),j(fr),G(Vi),j(Xe)),Ar=_r.data,Kr=[];for(const u of wr){const F=this.stride*u;Kr.push(Ar[F+Da]>1?A(Ar,F,this.clusterProps):this.points[Ar[F+ua]])}return Kr}getChildren(u){const F=this._getOriginId(u),Wt=this._getOriginZoom(u),Xe="No cluster with the specified id.",Vi=this.trees[Wt];if(!Vi)throw new Error(Xe);const fr=Vi.data;if(F*this.stride>=fr.length)throw new Error(Xe);const _r=this.options.radius/(this.options.extent*Math.pow(2,Wt-1)),wr=Vi.within(fr[F*this.stride],fr[F*this.stride+1],_r),Ar=[];for(const F of wr){const Wt=F*this.stride;fr[Wt+4]===u&&Ar.push(fr[Wt+Da]>1?A(fr,Wt,this.clusterProps):this.points[fr[Wt+ua]])}if(0===Ar.length)throw new Error(Xe);return Ar}getLeaves(u,F,Wt){const Xe=[];return this._appendLeaves(Xe,u,F=F||10,Wt=Wt||0,0),Xe}getTile(u,F,Wt){const Xe=this.trees[this._limitZoom(u)],Vi=Math.pow(2,u),{extent:fr,radius:_r}=this.options,wr=_r/fr,Ar=(Wt-wr)/Vi,Kr=(Wt+1+wr)/Vi,In={features:[]};return this._addTileFeatures(Xe.range((F-wr)/Vi,Ar,(F+1+wr)/Vi,Kr),Xe.data,F,Wt,Vi,In),0===F&&this._addTileFeatures(Xe.range(1-wr/Vi,Ar,1,Kr),Xe.data,Vi,Wt,Vi,In),F===Vi-1&&this._addTileFeatures(Xe.range(0,Ar,wr/Vi,Kr),Xe.data,-1,Wt,Vi,In),In.features.length?In:null}getClusterExpansionZoom(u){let F=this._getOriginZoom(u)-1;for(;F<=this.options.maxZoom;){const Wt=this.getChildren(u);if(F++,1!==Wt.length)break;u=Wt[0].properties.cluster_id}return F}_appendLeaves(u,F,Wt,Xe,Vi){const fr=this.getChildren(F);for(const F of fr){const fr=F.properties;if(fr&&fr.cluster?Vi+fr.point_count<=Xe?Vi+=fr.point_count:Vi=this._appendLeaves(u,fr.cluster_id,Wt,Xe,Vi):Vi<Xe?Vi++:u.push(F),u.length===Wt)break}return Vi}_createTree(u){const Wt=new F.av(u.length/this.stride|0,this.options.nodeSize,Float32Array);for(let F=0;F<u.length;F+=this.stride)Wt.add(u[F],u[F+1]);return Wt.finish(),Wt.data=u,Wt}_addTileFeatures(u,F,Wt,Xe,Vi,fr){for(const _r of u){const u=_r*this.stride,wr=F[u+Da]>1;let Ar,Kr,In;if(wr)Ar=E(F,u,this.clusterProps),Kr=F[u],In=F[u+1];else{const Wt=this.points[F[u+ua]];Ar=Wt.properties;const[Xe,Vi]=Wt.geometry.coordinates;Kr=G(Xe),In=j(Vi)}const ns={type:1,geometry:[[Math.round(this.options.extent*(Kr*Vi-Wt)),Math.round(this.options.extent*(In*Vi-Xe))]],tags:Ar};let ca;ca=wr||this.options.generateId?F[u+ua]:this.points[F[u+ua]].id,void 0!==ca&&(ns.id=ca),fr.features.push(ns)}}_limitZoom(u){return Math.max(this.options.minZoom,Math.min(Math.floor(+u),this.options.maxZoom+1))}_cluster(u,F){const{radius:Wt,extent:Xe,reduce:Vi,minPoints:fr}=this.options,_r=Wt/(Xe*Math.pow(2,F)),wr=u.data,Ar=[],Kr=this.stride;for(let Wt=0;Wt<wr.length;Wt+=Kr){if(wr[Wt+2]<=F)continue;wr[Wt+2]=F;const Xe=wr[Wt],In=wr[Wt+1],ns=u.within(wr[Wt],wr[Wt+1],_r),ca=wr[Wt+Da];let ha=ca;for(const u of ns){const Wt=u*Kr;wr[Wt+2]>F&&(ha+=wr[Wt+Da])}if(ha>ca&&ha>=fr){let u,fr=Xe*ca,_r=In*ca,ua=-1;const io=(Wt/Kr<<5)+(F+1)+this.points.length;for(const Xe of ns){const Ar=Xe*Kr;if(wr[Ar+2]<=F)continue;wr[Ar+2]=F;const In=wr[Ar+Da];fr+=wr[Ar]*In,_r+=wr[Ar+1]*In,wr[Ar+4]=io,Vi&&(u||(u=this._map(wr,Wt,!0),ua=this.clusterProps.length,this.clusterProps.push(u)),Vi(u,this._map(wr,Ar)))}wr[Wt+4]=io,Ar.push(fr/ha,_r/ha,1/0,io,-1,ha),Vi&&Ar.push(ua)}else{for(let u=0;u<Kr;u++)Ar.push(wr[Wt+u]);if(ha>1)for(const u of ns){const Wt=u*Kr;if(!(wr[Wt+2]<=F)){wr[Wt+2]=F;for(let u=0;u<Kr;u++)Ar.push(wr[Wt+u])}}}}return Ar}_getOriginId(u){return u-this.points.length>>5}_getOriginZoom(u){return(u-this.points.length)%32}_map(u,F,Wt){if(u[F+Da]>1){const Xe=this.clusterProps[u[F+io]];return Wt?Object.assign({},Xe):Xe}const Xe=this.points[u[F+ua]].properties,Vi=this.options.map(Xe);return Wt&&Vi===Xe?Object.assign({},Vi):Vi}}function A(u,F,Wt){return{type:"Feature",id:u[F+ua],properties:E(u,F,Wt),geometry:{type:"Point",coordinates:[(Xe=u[F],360*(Xe-.5)),R(u[F+1])]}};var Xe}function E(u,F,Wt){const Xe=u[F+Da],Vi=Xe>=1e4?`${Math.round(Xe/1e3)}k`:Xe>=1e3?Math.round(Xe/100)/10+"k":Xe,fr=u[F+io],_r=-1===fr?{}:Object.assign({},Wt[fr]);return Object.assign(_r,{cluster:!0,cluster_id:u[F+ua],point_count:Xe,point_count_abbreviated:Vi})}function G(u){return u/360+.5}function j(u){const F=Math.sin(u*Math.PI/180),Wt=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return Wt<0?0:Wt>1?1:Wt}function R(u){const F=(180-360*u)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function Z(u,F,Wt,Xe){let Vi=Xe;const fr=F+(Wt-F>>1);let _r,wr=Wt-F;const Ar=u[F],Kr=u[F+1],In=u[Wt],ns=u[Wt+1];for(let Xe=F+3;Xe<Wt;Xe+=3){const F=N(u[Xe],u[Xe+1],Ar,Kr,In,ns);if(F>Vi)_r=Xe,Vi=F;else if(F===Vi){const u=Math.abs(Xe-fr);u<wr&&(_r=Xe,wr=u)}}Vi>Xe&&(_r-F>3&&Z(u,F,_r,Xe),u[_r+2]=Vi,Wt-_r>3&&Z(u,_r,Wt,Xe))}function N(u,F,Wt,Xe,Vi,fr){let _r=Vi-Wt,wr=fr-Xe;if(0!==_r||0!==wr){const Ar=((u-Wt)*_r+(F-Xe)*wr)/(_r*_r+wr*wr);Ar>1?(Wt=Vi,Xe=fr):Ar>0&&(Wt+=_r*Ar,Xe+=wr*Ar)}return _r=u-Wt,wr=F-Xe,_r*_r+wr*wr}function J(u,F,Wt,Xe){const Vi={id:null==u?null:u,type:F,geometry:Wt,tags:Xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===F||"MultiPoint"===F||"LineString"===F)W(Vi,Wt);else if("Polygon"===F)W(Vi,Wt[0]);else if("MultiLineString"===F)for(const u of Wt)W(Vi,u);else if("MultiPolygon"===F)for(const u of Wt)W(Vi,u[0]);return Vi}function W(u,F){for(let Wt=0;Wt<F.length;Wt+=3)u.minX=Math.min(u.minX,F[Wt]),u.minY=Math.min(u.minY,F[Wt+1]),u.maxX=Math.max(u.maxX,F[Wt]),u.maxY=Math.max(u.maxY,F[Wt+1])}function Y(u,F,Wt,Xe){if(!F.geometry)return;const Vi=F.geometry.coordinates;if(Vi&&0===Vi.length)return;const fr=F.geometry.type,_r=Math.pow(Wt.tolerance/((1<<Wt.maxZoom)*Wt.extent),2);let wr=[],Ar=F.id;if(Wt.promoteId?Ar=F.properties[Wt.promoteId]:Wt.generateId&&(Ar=Xe||0),"Point"===fr)V(Vi,wr);else if("MultiPoint"===fr)for(const u of Vi)V(u,wr);else if("LineString"===fr)X(Vi,wr,_r,!1);else if("MultiLineString"===fr){if(Wt.lineMetrics){for(const Wt of Vi)wr=[],X(Wt,wr,_r,!1),u.push(J(Ar,"LineString",wr,F.properties));return}q(Vi,wr,_r,!1)}else if("Polygon"===fr)q(Vi,wr,_r,!0);else{if("MultiPolygon"!==fr){if("GeometryCollection"===fr){for(const Vi of F.geometry.geometries)Y(u,{id:Ar,geometry:Vi,properties:F.properties},Wt,Xe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const u of Vi){const F=[];q(u,F,_r,!0),wr.push(F)}}u.push(J(Ar,fr,wr,F.properties))}function V(u,F){F.push(H(u[0]),B(u[1]),0)}function X(u,F,Wt,Xe){let Vi,fr,_r=0;for(let Wt=0;Wt<u.length;Wt++){const wr=H(u[Wt][0]),Ar=B(u[Wt][1]);F.push(wr,Ar,0),Wt>0&&(_r+=Xe?(Vi*Ar-wr*fr)/2:Math.sqrt(Math.pow(wr-Vi,2)+Math.pow(Ar-fr,2))),Vi=wr,fr=Ar}const wr=F.length-3;F[2]=1,Z(F,0,wr,Wt),F[wr+2]=1,F.size=Math.abs(_r),F.start=0,F.end=F.size}function q(u,F,Wt,Xe){for(let Vi=0;Vi<u.length;Vi++){const fr=[];X(u[Vi],fr,Wt,Xe),F.push(fr)}}function H(u){return u/360+.5}function B(u){const F=Math.sin(u*Math.PI/180),Wt=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return Wt<0?0:Wt>1?1:Wt}function U(u,F,Wt,Xe,Vi,fr,_r,wr){if(Xe/=F,fr>=(Wt/=F)&&_r<Xe)return u;if(_r<Wt||fr>=Xe)return null;const Ar=[];for(const F of u){const u=F.geometry;let fr=F.type;const _r=0===Vi?F.minX:F.minY,Kr=0===Vi?F.maxX:F.maxY;if(_r>=Wt&&Kr<Xe){Ar.push(F);continue}if(Kr<Wt||_r>=Xe)continue;let In=[];if("Point"===fr||"MultiPoint"===fr)$(u,In,Wt,Xe,Vi);else if("LineString"===fr)K(u,In,Wt,Xe,Vi,!1,wr.lineMetrics);else if("MultiLineString"===fr)ee(u,In,Wt,Xe,Vi,!1);else if("Polygon"===fr)ee(u,In,Wt,Xe,Vi,!0);else if("MultiPolygon"===fr)for(const F of u){const u=[];ee(F,u,Wt,Xe,Vi,!0),u.length&&In.push(u)}if(In.length){if(wr.lineMetrics&&"LineString"===fr){for(const u of In)Ar.push(J(F.id,fr,u,F.tags));continue}"LineString"!==fr&&"MultiLineString"!==fr||(1===In.length?(fr="LineString",In=In[0]):fr="MultiLineString"),"Point"!==fr&&"MultiPoint"!==fr||(fr=3===In.length?"Point":"MultiPoint"),Ar.push(J(F.id,fr,In,F.tags))}}return Ar.length?Ar:null}function $(u,F,Wt,Xe,Vi){for(let fr=0;fr<u.length;fr+=3){const _r=u[fr+Vi];_r>=Wt&&_r<=Xe&&te(F,u[fr],u[fr+1],u[fr+2])}}function K(u,F,Wt,Xe,Vi,fr,_r){let wr=Q(u);const Ar=0===Vi?oe:ie;let Kr,In,ns=u.start;for(let ca=0;ca<u.length-3;ca+=3){const ha=u[ca],ua=u[ca+1],Da=u[ca+2],io=u[ca+3],no=u[ca+4],so=0===Vi?ha:ua,ao=0===Vi?io:no;let oo=!1;_r&&(Kr=Math.sqrt(Math.pow(ha-io,2)+Math.pow(ua-no,2))),so<Wt?ao>Wt&&(In=Ar(wr,ha,ua,io,no,Wt),_r&&(wr.start=ns+Kr*In)):so>Xe?ao<Xe&&(In=Ar(wr,ha,ua,io,no,Xe),_r&&(wr.start=ns+Kr*In)):te(wr,ha,ua,Da),ao<Wt&&so>=Wt&&(In=Ar(wr,ha,ua,io,no,Wt),oo=!0),ao>Xe&&so<=Xe&&(In=Ar(wr,ha,ua,io,no,Xe),oo=!0),!fr&&oo&&(_r&&(wr.end=ns+Kr*In),F.push(wr),wr=Q(u)),_r&&(ns+=Kr)}let ca=u.length-3;const ha=u[ca],ua=u[ca+1],Da=0===Vi?ha:ua;Da>=Wt&&Da<=Xe&&te(wr,ha,ua,u[ca+2]),ca=wr.length-3,fr&&ca>=3&&(wr[ca]!==wr[0]||wr[ca+1]!==wr[1])&&te(wr,wr[0],wr[1],wr[2]),wr.length&&F.push(wr)}function Q(u){const F=[];return F.size=u.size,F.start=u.start,F.end=u.end,F}function ee(u,F,Wt,Xe,Vi,fr){for(const _r of u)K(_r,F,Wt,Xe,Vi,fr,!1)}function te(u,F,Wt,Xe){u.push(F,Wt,Xe)}function oe(u,F,Wt,Xe,Vi,fr){const _r=(fr-F)/(Xe-F);return te(u,fr,Wt+(Vi-Wt)*_r,1),_r}function ie(u,F,Wt,Xe,Vi,fr){const _r=(fr-Wt)/(Vi-Wt);return te(u,F+(Xe-F)*_r,fr,1),_r}function se(u,F){const Wt=[];for(let Xe=0;Xe<u.length;Xe++){const Vi=u[Xe],fr=Vi.type;let _r;if("Point"===fr||"MultiPoint"===fr||"LineString"===fr)_r=re(Vi.geometry,F);else if("MultiLineString"===fr||"Polygon"===fr){_r=[];for(const u of Vi.geometry)_r.push(re(u,F))}else if("MultiPolygon"===fr){_r=[];for(const u of Vi.geometry){const Wt=[];for(const Xe of u)Wt.push(re(Xe,F));_r.push(Wt)}}Wt.push(J(Vi.id,fr,_r,Vi.tags))}return Wt}function re(u,F){const Wt=[];Wt.size=u.size,void 0!==u.start&&(Wt.start=u.start,Wt.end=u.end);for(let Xe=0;Xe<u.length;Xe+=3)Wt.push(u[Xe]+F,u[Xe+1],u[Xe+2]);return Wt}function ne(u,F){if(u.transformed)return u;const Wt=1<<u.z,Xe=u.x,Vi=u.y;for(const fr of u.features){const u=fr.geometry,_r=fr.type;if(fr.geometry=[],1===_r)for(let _r=0;_r<u.length;_r+=2)fr.geometry.push(ae(u[_r],u[_r+1],F,Wt,Xe,Vi));else for(let _r=0;_r<u.length;_r++){const wr=[];for(let fr=0;fr<u[_r].length;fr+=2)wr.push(ae(u[_r][fr],u[_r][fr+1],F,Wt,Xe,Vi));fr.geometry.push(wr)}}return u.transformed=!0,u}function ae(u,F,Wt,Xe,Vi,fr){return[Math.round(Wt*(u*Xe-Vi)),Math.round(Wt*(F*Xe-fr))]}function le(u,F,Wt,Xe,Vi){const fr=F===Vi.maxZoom?0:Vi.tolerance/((1<<F)*Vi.extent),_r={features:[],numPoints:0,numSimplified:0,numFeatures:u.length,source:null,x:Wt,y:Xe,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const F of u)ce(_r,F,fr,Vi);return _r}function ce(u,F,Wt,Xe){const Vi=F.geometry,fr=F.type,_r=[];if(u.minX=Math.min(u.minX,F.minX),u.minY=Math.min(u.minY,F.minY),u.maxX=Math.max(u.maxX,F.maxX),u.maxY=Math.max(u.maxY,F.maxY),"Point"===fr||"MultiPoint"===fr)for(let F=0;F<Vi.length;F+=3)_r.push(Vi[F],Vi[F+1]),u.numPoints++,u.numSimplified++;else if("LineString"===fr)ue(_r,Vi,u,Wt,!1,!1);else if("MultiLineString"===fr||"Polygon"===fr)for(let F=0;F<Vi.length;F++)ue(_r,Vi[F],u,Wt,"Polygon"===fr,0===F);else if("MultiPolygon"===fr)for(let F=0;F<Vi.length;F++){const Xe=Vi[F];for(let F=0;F<Xe.length;F++)ue(_r,Xe[F],u,Wt,!0,0===F)}if(_r.length){let Wt=F.tags||null;if("LineString"===fr&&Xe.lineMetrics){Wt={};for(const u in F.tags)Wt[u]=F.tags[u];Wt.mapbox_clip_start=Vi.start/Vi.size,Wt.mapbox_clip_end=Vi.end/Vi.size}const wr={geometry:_r,type:"Polygon"===fr||"MultiPolygon"===fr?3:"LineString"===fr||"MultiLineString"===fr?2:1,tags:Wt};null!==F.id&&(wr.id=F.id),u.features.push(wr)}}function ue(u,F,Wt,Xe,Vi,fr){const _r=Xe*Xe;if(Xe>0&&F.size<(Vi?_r:Xe))return void(Wt.numPoints+=F.length/3);const wr=[];for(let u=0;u<F.length;u+=3)(0===Xe||F[u+2]>_r)&&(Wt.numSimplified++,wr.push(F[u],F[u+1])),Wt.numPoints++;Vi&&function(u,F){let Wt=0;for(let F=0,Xe=u.length,Vi=Xe-2;F<Xe;Vi=F,F+=2)Wt+=(u[F]-u[Vi])*(u[F+1]+u[Vi+1]);if(Wt>0===F)for(let F=0,Wt=u.length;F<Wt/2;F+=2){const Xe=u[F],Vi=u[F+1];u[F]=u[Wt-2-F],u[F+1]=u[Wt-1-F],u[Wt-2-F]=Xe,u[Wt-1-F]=Vi}}(wr,fr),u.push(wr)}const no={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class de{constructor(u,F){const Wt=(F=this.options=function(u,F){for(const Wt in F)u[Wt]=F[Wt];return u}(Object.create(no),F)).debug;if(Wt&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");let Xe=function(u,F){const Wt=[];if("FeatureCollection"===u.type)for(let Xe=0;Xe<u.features.length;Xe++)Y(Wt,u.features[Xe],F,Xe);else Y(Wt,"Feature"===u.type?u:{geometry:u},F);return Wt}(u,F);this.tiles={},this.tileCoords=[],Wt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Xe=function(u,F){const Wt=F.buffer/F.extent;let Xe=u;const Vi=U(u,1,-1-Wt,Wt,0,-1,2,F),fr=U(u,1,1-Wt,2+Wt,0,-1,2,F);return(Vi||fr)&&(Xe=U(u,1,-Wt,1+Wt,0,-1,2,F)||[],Vi&&(Xe=se(Vi,1).concat(Xe)),fr&&(Xe=Xe.concat(se(fr,-1)))),Xe}(Xe,F),Xe.length&&this.splitTile(Xe,0,0,0),Wt&&(Xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(u,F,Wt,Xe,Vi,fr,_r){const wr=[u,F,Wt,Xe],Ar=this.options,Kr=Ar.debug;for(;wr.length;){Xe=wr.pop(),Wt=wr.pop(),F=wr.pop(),u=wr.pop();const In=1<<F,ns=fe(F,Wt,Xe);let ca=this.tiles[ns];if(!ca&&(Kr>1&&console.time("creation"),ca=this.tiles[ns]=le(u,F,Wt,Xe,Ar),this.tileCoords.push({z:F,x:Wt,y:Xe}),Kr)){Kr>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,Wt,Xe,ca.numFeatures,ca.numPoints,ca.numSimplified),console.timeEnd("creation"));const u=`z${F}`;this.stats[u]=(this.stats[u]||0)+1,this.total++}if(ca.source=u,null==Vi){if(F===Ar.indexMaxZoom||ca.numPoints<=Ar.indexMaxPoints)continue}else{if(F===Ar.maxZoom||F===Vi)continue;if(null!=Vi){const u=Vi-F;if(Wt!==fr>>u||Xe!==_r>>u)continue}}if(ca.source=null,0===u.length)continue;Kr>1&&console.time("clipping");const ha=.5*Ar.buffer/Ar.extent,ua=.5-ha,Da=.5+ha,io=1+ha;let no=null,so=null,ao=null,oo=null,co=U(u,In,Wt-ha,Wt+Da,0,ca.minX,ca.maxX,Ar),ho=U(u,In,Wt+ua,Wt+io,0,ca.minX,ca.maxX,Ar);u=null,co&&(no=U(co,In,Xe-ha,Xe+Da,1,ca.minY,ca.maxY,Ar),so=U(co,In,Xe+ua,Xe+io,1,ca.minY,ca.maxY,Ar),co=null),ho&&(ao=U(ho,In,Xe-ha,Xe+Da,1,ca.minY,ca.maxY,Ar),oo=U(ho,In,Xe+ua,Xe+io,1,ca.minY,ca.maxY,Ar),ho=null),Kr>1&&console.timeEnd("clipping"),wr.push(no||[],F+1,2*Wt,2*Xe),wr.push(so||[],F+1,2*Wt,2*Xe+1),wr.push(ao||[],F+1,2*Wt+1,2*Xe),wr.push(oo||[],F+1,2*Wt+1,2*Xe+1)}}getTile(u,F,Wt){u=+u,F=+F,Wt=+Wt;const Xe=this.options,{extent:Vi,debug:fr}=Xe;if(u<0||u>24)return null;const _r=1<<u,wr=fe(u,F=F+_r&_r-1,Wt);if(this.tiles[wr])return ne(this.tiles[wr],Vi);fr>1&&console.log("drilling down to z%d-%d-%d",u,F,Wt);let Ar,Kr=u,In=F,ns=Wt;for(;!Ar&&Kr>0;)Kr--,In>>=1,ns>>=1,Ar=this.tiles[fe(Kr,In,ns)];return Ar&&Ar.source?(fr>1&&(console.log("found parent tile z%d-%d-%d",Kr,In,ns),console.time("drilling down")),this.splitTile(Ar.source,Kr,In,ns,u,F,Wt),fr>1&&console.timeEnd("drilling down"),this.tiles[wr]?ne(this.tiles[wr],Vi):null):null}}function fe(u,F,Wt){return 32*((1<<u)*Wt+F)+u}function ge(u,F){return F?u.properties[F]:u.id}function pe(u,F){if(null==u)return!0;if("Feature"===u.type)return null!=ge(u,F);if("FeatureCollection"===u.type){const Wt=new Set;for(const Xe of u.features){const u=ge(Xe,F);if(null==u)return!1;if(Wt.has(u))return!1;Wt.add(u)}return!0}return!1}function me(u,F){const Wt=new Map;if(null==u);else if("Feature"===u.type)Wt.set(ge(u,F),u);else for(const Xe of u.features)Wt.set(ge(Xe,F),Xe);return Wt}class ye extends r{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(u,Wt){return F._(this,void 0,void 0,(function*(){const Wt=u.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Vi=this._geoJSONIndex.getTile(Wt.z,Wt.x,Wt.y);if(!Vi)return null;const fr=new class{constructor(u){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=F.X,this.length=u.length,this._features=u}feature(u){return new class{constructor(u){this._feature=u,this.extent=F.X,this.type=u.type,this.properties=u.tags,"id"in u&&!isNaN(u.id)&&(this.id=parseInt(u.id,10))}loadGeometry(){if(1===this._feature.type){const u=[];for(const Wt of this._feature.geometry)u.push([new F.P(Wt[0],Wt[1])]);return u}{const u=[];for(const Wt of this._feature.geometry){const Xe=[];for(const u of Wt)Xe.push(new F.P(u[0],u[1]));u.push(Xe)}return u}}toGeoJSON(u,F,Wt){return Xe.call(this,u,F,Wt)}}(this._features[u])}}(Vi.features);let _r=In(fr);return 0===_r.byteOffset&&_r.byteLength===_r.buffer.byteLength||(_r=new Uint8Array(_r)),{vectorTile:fr,rawData:_r.buffer}}))}loadData(u){return F._(this,void 0,void 0,(function*(){var Wt;null===(Wt=this._pendingRequest)||void 0===Wt||Wt.abort();const Xe=!!(u&&u.request&&u.request.collectResourceTiming)&&new F.bv(u.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(u,this._pendingRequest),this._geoJSONIndex=u.cluster?new z(function({superclusterOptions:u,clusterProperties:Wt}){if(!Wt||!u)return u;const Xe={},Vi={},fr={accumulated:null,zoom:0},_r={properties:null},wr=Object.keys(Wt);for(const u of wr){const[fr,_r]=Wt[u],wr=F.bC(_r),Ar=F.bC("string"==typeof fr?[fr,["accumulated"],["get",u]]:fr);Xe[u]=wr.value,Vi[u]=Ar.value}return u.map=u=>{_r.properties=u;const F={};for(const u of wr)F[u]=Xe[u].evaluate(fr,_r);return F},u.reduce=(u,F)=>{_r.properties=F;for(const F of wr)fr.accumulated=u[F],u[F]=Vi[F].evaluate(fr,_r)},u}(u)).load((yield this._pendingData).features):(Vi=yield this._pendingData,new de(Vi,u.geojsonVtOptions)),this.loaded={};const Wt={};if(Xe){const F=Xe.finish();F&&(Wt.resourceTiming={},Wt.resourceTiming[u.source]=JSON.parse(JSON.stringify(F)))}return Wt}catch(u){if(delete this._pendingRequest,F.bB(u))return{abandoned:!0};throw u}var Vi}))}getData(){return F._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(u){const F=this.loaded;return F&&F[u.uid]?super.reloadTile(u):this.loadTile(u)}loadAndProcessGeoJSON(u,Xe){return F._(this,void 0,void 0,(function*(){let Vi=yield this.loadGeoJSON(u,Xe);if(delete this._pendingRequest,"object"!=typeof Vi)throw new Error(`Input data given to '${u.source}' is not a valid GeoJSON object.`);if(Wt(Vi,!0),u.filter){const Wt=F.bC(u.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Wt.result)throw new Error(Wt.value.map((u=>`${u.key}: ${u.message}`)).join(", "));const Xe=Vi.features.filter((u=>Wt.value.evaluate({zoom:0},u)));Vi={type:"FeatureCollection",features:Xe}}return Vi}))}loadGeoJSON(u,Wt){return F._(this,void 0,void 0,(function*(){const{promoteId:Xe}=u;if(u.request){const Vi=yield F.h(u.request,Wt);return this._dataUpdateable=pe(Vi.data,Xe)?me(Vi.data,Xe):void 0,Vi.data}if("string"==typeof u.data)try{const F=JSON.parse(u.data);return this._dataUpdateable=pe(F,Xe)?me(F,Xe):void 0,F}catch(F){throw new Error(`Input data given to '${u.source}' is not a valid GeoJSON object.`)}if(!u.dataDiff)throw new Error(`Input data given to '${u.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${u.source}`);return function(u,F,Wt){var Xe,Vi,fr,_r;if(F.removeAll&&u.clear(),F.remove)for(const Wt of F.remove)u.delete(Wt);if(F.add)for(const Xe of F.add){const F=ge(Xe,Wt);null!=F&&u.set(F,Xe)}if(F.update)for(const Wt of F.update){let F=u.get(Wt.id);if(null==F)continue;const wr=!Wt.removeAllProperties&&((null===(Xe=Wt.removeProperties)||void 0===Xe?void 0:Xe.length)>0||(null===(Vi=Wt.addOrUpdateProperties)||void 0===Vi?void 0:Vi.length)>0);if((Wt.newGeometry||Wt.removeAllProperties||wr)&&(F=Object.assign({},F),u.set(Wt.id,F),wr&&(F.properties=Object.assign({},F.properties))),Wt.newGeometry&&(F.geometry=Wt.newGeometry),Wt.removeAllProperties)F.properties={};else if((null===(fr=Wt.removeProperties)||void 0===fr?void 0:fr.length)>0)for(const u of Wt.removeProperties)Object.prototype.hasOwnProperty.call(F.properties,u)&&delete F.properties[u];if((null===(_r=Wt.addOrUpdateProperties)||void 0===_r?void 0:_r.length)>0)for(const{key:u,value:Xe}of Wt.addOrUpdateProperties)F.properties[u]=Xe}}(this._dataUpdateable,u.dataDiff,Xe),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(u){return F._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(u){return this._geoJSONIndex.getClusterExpansionZoom(u.clusterId)}getClusterChildren(u){return this._geoJSONIndex.getChildren(u.clusterId)}getClusterLeaves(u){return this._geoJSONIndex.getLeaves(u.clusterId,u.limit,u.offset)}}class ve{constructor(u){this.self=u,this.actor=new F.F(u),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(u,F)=>{if(this.externalWorkerSourceTypes[u])throw new Error(`Worker source with name "${u}" already registered.`);this.externalWorkerSourceTypes[u]=F},this.self.addProtocol=F.bi,this.self.removeProtocol=F.bj,this.self.registerRTLTextPlugin=u=>{if(F.bD.isParsed())throw new Error("RTL text plugin already registered.");F.bD.setMethods(u)},this.actor.registerMessageHandler("LDT",((u,F)=>this._getDEMWorkerSource(u,F.source).loadTile(F))),this.actor.registerMessageHandler("RDT",((u,Wt)=>F._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(u,Wt.source).removeTile(Wt)})))),this.actor.registerMessageHandler("GCEZ",((u,Wt)=>F._(this,void 0,void 0,(function*(){return this._getWorkerSource(u,Wt.type,Wt.source).getClusterExpansionZoom(Wt)})))),this.actor.registerMessageHandler("GCC",((u,Wt)=>F._(this,void 0,void 0,(function*(){return this._getWorkerSource(u,Wt.type,Wt.source).getClusterChildren(Wt)})))),this.actor.registerMessageHandler("GCL",((u,Wt)=>F._(this,void 0,void 0,(function*(){return this._getWorkerSource(u,Wt.type,Wt.source).getClusterLeaves(Wt)})))),this.actor.registerMessageHandler("LD",((u,F)=>this._getWorkerSource(u,F.type,F.source).loadData(F))),this.actor.registerMessageHandler("GD",((u,F)=>this._getWorkerSource(u,F.type,F.source).getData())),this.actor.registerMessageHandler("LT",((u,F)=>this._getWorkerSource(u,F.type,F.source).loadTile(F))),this.actor.registerMessageHandler("RT",((u,F)=>this._getWorkerSource(u,F.type,F.source).reloadTile(F))),this.actor.registerMessageHandler("AT",((u,F)=>this._getWorkerSource(u,F.type,F.source).abortTile(F))),this.actor.registerMessageHandler("RMT",((u,F)=>this._getWorkerSource(u,F.type,F.source).removeTile(F))),this.actor.registerMessageHandler("RS",((u,Wt)=>F._(this,void 0,void 0,(function*(){if(!this.workerSources[u]||!this.workerSources[u][Wt.type]||!this.workerSources[u][Wt.type][Wt.source])return;const F=this.workerSources[u][Wt.type][Wt.source];delete this.workerSources[u][Wt.type][Wt.source],void 0!==F.removeSource&&F.removeSource(Wt)})))),this.actor.registerMessageHandler("RM",(u=>F._(this,void 0,void 0,(function*(){delete this.layerIndexes[u],delete this.availableImages[u],delete this.workerSources[u],delete this.demWorkerSources[u]})))),this.actor.registerMessageHandler("SR",((u,Wt)=>F._(this,void 0,void 0,(function*(){this.referrer=Wt})))),this.actor.registerMessageHandler("SRPS",((u,F)=>this._syncRTLPluginState(u,F))),this.actor.registerMessageHandler("IS",((u,Wt)=>F._(this,void 0,void 0,(function*(){this.self.importScripts(Wt)})))),this.actor.registerMessageHandler("SI",((u,F)=>this._setImages(u,F))),this.actor.registerMessageHandler("UL",((u,Wt)=>F._(this,void 0,void 0,(function*(){this._getLayerIndex(u).update(Wt.layers,Wt.removedIds)})))),this.actor.registerMessageHandler("SL",((u,Wt)=>F._(this,void 0,void 0,(function*(){this._getLayerIndex(u).replace(Wt)}))))}_setImages(u,Wt){return F._(this,void 0,void 0,(function*(){this.availableImages[u]=Wt;for(const F in this.workerSources[u]){const Xe=this.workerSources[u][F];for(const u in Xe)Xe[u].availableImages=Wt}}))}_syncRTLPluginState(u,Wt){return F._(this,void 0,void 0,(function*(){if(F.bD.isParsed())return F.bD.getState();if("loading"!==Wt.pluginStatus)return F.bD.setState(Wt),Wt;const u=Wt.pluginURL;if(this.self.importScripts(u),F.bD.isParsed()){const Wt={pluginStatus:"loaded",pluginURL:u};return F.bD.setState(Wt),Wt}throw F.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${u}`)}))}_getAvailableImages(u){let F=this.availableImages[u];return F||(F=[]),F}_getLayerIndex(u){let F=this.layerIndexes[u];return F||(F=this.layerIndexes[u]=new t),F}_getWorkerSource(u,F,Wt){if(this.workerSources[u]||(this.workerSources[u]={}),this.workerSources[u][F]||(this.workerSources[u][F]={}),!this.workerSources[u][F][Wt]){const Xe={sendAsync:(F,Wt)=>(F.targetMapId=u,this.actor.sendAsync(F,Wt))};switch(F){case"vector":this.workerSources[u][F][Wt]=new r(Xe,this._getLayerIndex(u),this._getAvailableImages(u));break;case"geojson":this.workerSources[u][F][Wt]=new ye(Xe,this._getLayerIndex(u),this._getAvailableImages(u));break;default:this.workerSources[u][F][Wt]=new this.externalWorkerSourceTypes[F](Xe,this._getLayerIndex(u),this._getAvailableImages(u))}}return this.workerSources[u][F][Wt]}_getDEMWorkerSource(u,F){return this.demWorkerSources[u]||(this.demWorkerSources[u]={}),this.demWorkerSources[u][F]||(this.demWorkerSources[u][F]=new n),this.demWorkerSources[u][F]}}return F.i(self)&&(self.worker=new ve(self)),ve}));define("index",["exports","./shared"],(function(F,Wt){var Xe="4.7.1";let Vi,fr;const _r={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:u=>new Promise(((F,Xe)=>{const Vi=requestAnimationFrame(F);u.signal.addEventListener("abort",(()=>{cancelAnimationFrame(Vi),Xe(Wt.c())}))})),getImageData(u,F=0){return this.getImageCanvasContext(u).getImageData(-F,-F,u.width+2*F,u.height+2*F)},getImageCanvasContext(u){const F=window.document.createElement("canvas"),Wt=F.getContext("2d",{willReadFrequently:!0});if(!Wt)throw new Error("failed to create canvas 2d context");return F.width=u.width,F.height=u.height,Wt.drawImage(u,0,0,u.width,u.height),Wt},resolveURL:u=>(Vi||(Vi=document.createElement("a")),Vi.href=u,Vi.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==fr&&(fr=matchMedia("(prefers-reduced-motion: reduce)")),fr.matches)}};class r{static testProp(u){if(!r.docStyle)return u[0];for(let F=0;F<u.length;F++)if(u[F]in r.docStyle)return u[F];return u[0]}static create(u,F,Wt){const Xe=window.document.createElement(u);return void 0!==F&&(Xe.className=F),Wt&&Wt.appendChild(Xe),Xe}static createNS(u,F){return window.document.createElementNS(u,F)}static disableDrag(){r.docStyle&&r.selectProp&&(r.userSelect=r.docStyle[r.selectProp],r.docStyle[r.selectProp]="none")}static enableDrag(){r.docStyle&&r.selectProp&&(r.docStyle[r.selectProp]=r.userSelect)}static setTransform(u,F){u.style[r.transformProp]=F}static addEventListener(u,F,Wt,Xe={}){u.addEventListener(F,Wt,"passive"in Xe?Xe:Xe.capture)}static removeEventListener(u,F,Wt,Xe={}){u.removeEventListener(F,Wt,"passive"in Xe?Xe:Xe.capture)}static suppressClickInternal(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",r.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",r.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",r.suppressClickInternal,!0)}),0)}static getScale(u){const F=u.getBoundingClientRect();return{x:F.width/u.offsetWidth||1,y:F.height/u.offsetHeight||1,boundingClientRect:F}}static getPoint(u,F,Xe){const Vi=F.boundingClientRect;return new Wt.P((Xe.clientX-Vi.left)/F.x-u.clientLeft,(Xe.clientY-Vi.top)/F.y-u.clientTop)}static mousePos(u,F){const Wt=r.getScale(u);return r.getPoint(u,Wt,F)}static touchPos(u,F){const Wt=[],Xe=r.getScale(u);for(let Vi=0;Vi<F.length;Vi++)Wt.push(r.getPoint(u,Xe,F[Vi]));return Wt}static mouseButton(u){return u.button}static remove(u){u.parentNode&&u.parentNode.removeChild(u)}}r.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,r.selectProp=r.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),r.transformProp=r.testProp(["transform","WebkitTransform"]);const wr={supported:!1,testSupport:function(u){!In&&Kr&&(ns?d(u):Ar=u)}};let Ar,Kr,In=!1,ns=!1;function d(u){const F=u.createTexture();u.bindTexture(u.TEXTURE_2D,F);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,Kr),u.isContextLost())return;wr.supported=!0}catch(u){}u.deleteTexture(F),In=!0}var ca;"undefined"!=typeof document&&(Kr=document.createElement("img"),Kr.onload=()=>{Ar&&d(Ar),Ar=null,ns=!0},Kr.onerror=()=>{In=!0,Ar=null},Kr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(F){let Xe,Vi,fr,_r;F.resetRequestQueue=()=>{Xe=[],Vi=0,fr=0,_r={}},F.addThrottleControl=u=>{const F=fr++;return _r[F]=u,F},F.removeThrottleControl=u=>{delete _r[u],l()},F.getImage=(u,F,Vi=!0)=>new Promise(((fr,_r)=>{wr.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),Wt.e(u,{type:"image"}),Xe.push({abortController:F,requestParameters:u,supportImageRefresh:Vi,state:"queued",onError:u=>{_r(u)},onSuccess:u=>{fr(u)}}),l()}));const r=F=>Wt._(this||u,void 0,void 0,(function*(){F.state="running";const{requestParameters:u,supportImageRefresh:Xe,onError:fr,onSuccess:_r,abortController:wr}=F,Ar=!1===Xe&&!Wt.i(self)&&!Wt.g(u.url)&&(!u.headers||Object.keys(u.headers).reduce(((u,F)=>u&&"accept"===F),!0));Vi++;const Kr=Ar?h(u,wr):Wt.m(u,wr);try{const u=yield Kr;delete F.abortController,F.state="completed",u.data instanceof HTMLImageElement||Wt.b(u.data)?_r(u):u.data&&_r({data:yield(In=u.data,"function"==typeof createImageBitmap?Wt.d(In):Wt.f(In)),cacheControl:u.cacheControl,expires:u.expires})}catch(u){delete F.abortController,fr(u)}finally{Vi--,l()}var In})),l=()=>{const u=(()=>{for(const u of Object.keys(_r))if(_r[u]())return!0;return!1})()?Wt.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:Wt.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let F=Vi;F<u&&Xe.length>0;F++){const u=Xe.shift();u.abortController.signal.aborted?F--:r(u)}},h=(u,F)=>new Promise(((Xe,Vi)=>{const fr=new Image,_r=u.url,wr=u.credentials;wr&&"include"===wr?fr.crossOrigin="use-credentials":(wr&&"same-origin"===wr||!Wt.s(_r))&&(fr.crossOrigin="anonymous"),F.signal.addEventListener("abort",(()=>{fr.src="",Vi(Wt.c())})),fr.fetchPriority="high",fr.onload=()=>{fr.onerror=fr.onload=null,Xe({data:fr})},fr.onerror=()=>{fr.onerror=fr.onload=null,F.signal.aborted||Vi(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},fr.src=_r}))}(ca||(ca={})),ca.resetRequestQueue();class p{constructor(u){this._transformRequestFn=u}transformRequest(u,F){return this._transformRequestFn&&this._transformRequestFn(u,F)||{url:u}}setTransformRequest(u){this._transformRequestFn=u}}function m(u){var F=new Wt.A(3);return F[0]=u[0],F[1]=u[1],F[2]=u[2],F}var ha,g=function(u,F,Wt){return u[0]=F[0]-Wt[0],u[1]=F[1]-Wt[1],u[2]=F[2]-Wt[2],u};ha=new Wt.A(3),Wt.A!=Float32Array&&(ha[0]=0,ha[1]=0,ha[2]=0);var v=function(u){var F=u[0],Wt=u[1];return F*F+Wt*Wt};function x(u){const F=[];if("string"==typeof u)F.push({id:"default",url:u});else if(u&&u.length>0){const Wt=[];for(const{id:Xe,url:Vi}of u){const u=`${Xe}${Vi}`;-1===Wt.indexOf(u)&&(Wt.push(u),F.push({id:Xe,url:Vi}))}}return F}function y(u,F,Wt){const Xe=u.split("?");return Xe[0]+=`${F}${Wt}`,Xe.join("?")}!function(){var u=new Wt.A(2);Wt.A!=Float32Array&&(u[0]=0,u[1]=0)}();class b{constructor(u,F,Wt,Xe){this.context=u,this.format=Wt,this.texture=u.gl.createTexture(),this.update(F,Xe)}update(u,F,Xe){const{width:Vi,height:fr}=u,_r=!(this.size&&this.size[0]===Vi&&this.size[1]===fr||Xe),{context:wr}=this,{gl:Ar}=wr;if(this.useMipmap=Boolean(F&&F.useMipmap),Ar.bindTexture(Ar.TEXTURE_2D,this.texture),wr.pixelStoreUnpackFlipY.set(!1),wr.pixelStoreUnpack.set(1),wr.pixelStoreUnpackPremultiplyAlpha.set(this.format===Ar.RGBA&&(!F||!1!==F.premultiply)),_r)this.size=[Vi,fr],u instanceof HTMLImageElement||u instanceof HTMLCanvasElement||u instanceof HTMLVideoElement||u instanceof ImageData||Wt.b(u)?Ar.texImage2D(Ar.TEXTURE_2D,0,this.format,this.format,Ar.UNSIGNED_BYTE,u):Ar.texImage2D(Ar.TEXTURE_2D,0,this.format,Vi,fr,0,this.format,Ar.UNSIGNED_BYTE,u.data);else{const{x:F,y:_r}=Xe||{x:0,y:0};u instanceof HTMLImageElement||u instanceof HTMLCanvasElement||u instanceof HTMLVideoElement||u instanceof ImageData||Wt.b(u)?Ar.texSubImage2D(Ar.TEXTURE_2D,0,F,_r,Ar.RGBA,Ar.UNSIGNED_BYTE,u):Ar.texSubImage2D(Ar.TEXTURE_2D,0,F,_r,Vi,fr,Ar.RGBA,Ar.UNSIGNED_BYTE,u.data)}this.useMipmap&&this.isSizePowerOfTwo()&&Ar.generateMipmap(Ar.TEXTURE_2D)}bind(u,F,Wt){const{context:Xe}=this,{gl:Vi}=Xe;Vi.bindTexture(Vi.TEXTURE_2D,this.texture),Wt!==Vi.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(Wt=Vi.LINEAR),u!==this.filter&&(Vi.texParameteri(Vi.TEXTURE_2D,Vi.TEXTURE_MAG_FILTER,u),Vi.texParameteri(Vi.TEXTURE_2D,Vi.TEXTURE_MIN_FILTER,Wt||u),this.filter=u),F!==this.wrap&&(Vi.texParameteri(Vi.TEXTURE_2D,Vi.TEXTURE_WRAP_S,F),Vi.texParameteri(Vi.TEXTURE_2D,Vi.TEXTURE_WRAP_T,F),this.wrap=F)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}}function w(u){const{userImage:F}=u;return!!(F&&F.render&&F.render())&&(u.data.replace(new Uint8Array(F.data.buffer)),!0)}class T extends Wt.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new Wt.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(u){if(this.loaded!==u&&(this.loaded=u,u)){for(const{ids:u,promiseResolve:F}of this.requestors)F(this._getImagesForIds(u));this.requestors=[]}}getImage(u){const F=this.images[u];if(F&&!F.data&&F.spriteData){const u=F.spriteData;F.data=new Wt.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),F.spriteData=null}return F}addImage(u,F){if(this.images[u])throw new Error(`Image id ${u} already exist, use updateImage instead`);this._validate(u,F)&&(this.images[u]=F)}_validate(u,F){let Xe=!0;const Vi=F.data||F.spriteData;return this._validateStretch(F.stretchX,Vi&&Vi.width)||(this.fire(new Wt.j(new Error(`Image "${u}" has invalid "stretchX" value`))),Xe=!1),this._validateStretch(F.stretchY,Vi&&Vi.height)||(this.fire(new Wt.j(new Error(`Image "${u}" has invalid "stretchY" value`))),Xe=!1),this._validateContent(F.content,F)||(this.fire(new Wt.j(new Error(`Image "${u}" has invalid "content" value`))),Xe=!1),Xe}_validateStretch(u,F){if(!u)return!0;let Wt=0;for(const Xe of u){if(Xe[0]<Wt||Xe[1]<Xe[0]||F<Xe[1])return!1;Wt=Xe[1]}return!0}_validateContent(u,F){if(!u)return!0;if(4!==u.length)return!1;const Wt=F.spriteData,Xe=Wt&&Wt.width||F.data.width,Vi=Wt&&Wt.height||F.data.height;return!(u[0]<0||Xe<u[0]||u[1]<0||Vi<u[1]||u[2]<0||Xe<u[2]||u[3]<0||Vi<u[3]||u[2]<u[0]||u[3]<u[1])}updateImage(u,F,Wt=!0){const Xe=this.getImage(u);if(Wt&&(Xe.data.width!==F.data.width||Xe.data.height!==F.data.height))throw new Error(`size mismatch between old image (${Xe.data.width}x${Xe.data.height}) and new image (${F.data.width}x${F.data.height}).`);F.version=Xe.version+1,this.images[u]=F,this.updatedImages[u]=!0}removeImage(u){const F=this.images[u];delete this.images[u],delete this.patterns[u],F.userImage&&F.userImage.onRemove&&F.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(u){return new Promise(((F,Wt)=>{let Xe=!0;if(!this.isLoaded())for(const F of u)this.images[F]||(Xe=!1);this.isLoaded()||Xe?F(this._getImagesForIds(u)):this.requestors.push({ids:u,promiseResolve:F})}))}_getImagesForIds(u){const F={};for(const Xe of u){let u=this.getImage(Xe);u||(this.fire(new Wt.k("styleimagemissing",{id:Xe})),u=this.getImage(Xe)),u?F[Xe]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:Boolean(u.userImage&&u.userImage.render)}:Wt.w(`Image "${Xe}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return F}getPixelSize(){const{width:u,height:F}=this.atlasImage;return{width:u,height:F}}getPattern(u){const F=this.patterns[u],Xe=this.getImage(u);if(!Xe)return null;if(F&&F.position.version===Xe.version)return F.position;if(F)F.position.version=Xe.version;else{const F={w:Xe.data.width+2,h:Xe.data.height+2,x:0,y:0},Vi=new Wt.I(F,Xe);this.patterns[u]={bin:F,position:Vi}}return this._updatePatternAtlas(),this.patterns[u].position}bind(u){const F=u.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new b(u,this.atlasImage,F.RGBA),this.atlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE)}_updatePatternAtlas(){const u=[];for(const F in this.patterns)u.push(this.patterns[F].bin);const{w:F,h:Xe}=Wt.p(u),Vi=this.atlasImage;Vi.resize({width:F||1,height:Xe||1});for(const u in this.patterns){const{bin:F}=this.patterns[u],Xe=F.x+1,fr=F.y+1,_r=this.getImage(u).data,wr=_r.width,Ar=_r.height;Wt.R.copy(_r,Vi,{x:0,y:0},{x:Xe,y:fr},{width:wr,height:Ar}),Wt.R.copy(_r,Vi,{x:0,y:Ar-1},{x:Xe,y:fr-1},{width:wr,height:1}),Wt.R.copy(_r,Vi,{x:0,y:0},{x:Xe,y:fr+Ar},{width:wr,height:1}),Wt.R.copy(_r,Vi,{x:wr-1,y:0},{x:Xe-1,y:fr},{width:1,height:Ar}),Wt.R.copy(_r,Vi,{x:0,y:0},{x:Xe+wr,y:fr},{width:1,height:Ar})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(u){for(const F of u){if(this.callbackDispatchedThisFrame[F])continue;this.callbackDispatchedThisFrame[F]=!0;const u=this.getImage(F);u||Wt.w(`Image with ID: "${F}" was not found`),w(u)&&this.updateImage(F,u)}}}const ua=1e20;function E(u,F,Wt,Xe,Vi,fr,_r,wr,Ar){for(let Kr=F;Kr<F+Xe;Kr++)P(u,Wt*fr+Kr,fr,Vi,_r,wr,Ar);for(let Kr=Wt;Kr<Wt+Vi;Kr++)P(u,Kr*fr+F,1,Xe,_r,wr,Ar)}function P(u,F,Wt,Xe,Vi,fr,_r){fr[0]=0,_r[0]=-ua,_r[1]=ua,Vi[0]=u[F];for(let wr=1,Ar=0,Kr=0;wr<Xe;wr++){Vi[wr]=u[F+wr*Wt];const Xe=wr*wr;do{const u=fr[Ar];Kr=(Vi[wr]-Vi[u]+Xe-u*u)/(wr-u)/2}while(Kr<=_r[Ar]&&--Ar>-1);Ar++,fr[Ar]=wr,_r[Ar]=Kr,_r[Ar+1]=ua}for(let wr=0,Ar=0;wr<Xe;wr++){for(;_r[Ar+1]<wr;)Ar++;const Xe=fr[Ar],Kr=wr-Xe;u[F+wr*Wt]=Vi[Xe]+Kr*Kr}}class C{constructor(u,F){this.requestManager=u,this.localIdeographFontFamily=F,this.entries={}}setURL(u){this.url=u}getGlyphs(u){return Wt._(this,void 0,void 0,(function*(){const F=[];for(const Wt in u)for(const Xe of u[Wt])F.push(this._getAndCacheGlyphsPromise(Wt,Xe));const Wt=yield Promise.all(F),Xe={};for(const{stack:u,id:F,glyph:Vi}of Wt)Xe[u]||(Xe[u]={}),Xe[u][F]=Vi&&{id:Vi.id,bitmap:Vi.bitmap.clone(),metrics:Vi.metrics};return Xe}))}_getAndCacheGlyphsPromise(u,F){return Wt._(this,void 0,void 0,(function*(){let Wt=this.entries[u];Wt||(Wt=this.entries[u]={glyphs:{},requests:{},ranges:{}});let Xe=Wt.glyphs[F];if(void 0!==Xe)return{stack:u,id:F,glyph:Xe};if(Xe=this._tinySDF(Wt,u,F),Xe)return Wt.glyphs[F]=Xe,{stack:u,id:F,glyph:Xe};const Vi=Math.floor(F/256);if(256*Vi>65535)throw new Error("glyphs > 65535 not supported");if(Wt.ranges[Vi])return{stack:u,id:F,glyph:Xe};if(!this.url)throw new Error("glyphsUrl is not set");if(!Wt.requests[Vi]){const F=C.loadGlyphRange(u,Vi,this.url,this.requestManager);Wt.requests[Vi]=F}const fr=yield Wt.requests[Vi];for(const u in fr)this._doesCharSupportLocalGlyph(+u)||(Wt.glyphs[+u]=fr[+u]);return Wt.ranges[Vi]=!0,{stack:u,id:F,glyph:fr[F]||null}}))}_doesCharSupportLocalGlyph(u){return!!this.localIdeographFontFamily&&/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(u))}_tinySDF(u,F,Xe){const Vi=this.localIdeographFontFamily;if(!Vi)return;if(!this._doesCharSupportLocalGlyph(Xe))return;let fr=u.tinySDF;if(!fr){let Wt="400";/bold/i.test(F)?Wt="900":/medium/i.test(F)?Wt="500":/light/i.test(F)&&(Wt="200"),fr=u.tinySDF=new C.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:Vi,fontWeight:Wt})}const _r=fr.draw(String.fromCharCode(Xe));return{id:Xe,bitmap:new Wt.o({width:_r.width||60,height:_r.height||60},_r.data),metrics:{width:_r.glyphWidth/2||24,height:_r.glyphHeight/2||24,left:_r.glyphLeft/2+.5||0,top:_r.glyphTop/2-27.5||-8,advance:_r.glyphAdvance/2||24,isDoubleResolution:!0}}}}C.loadGlyphRange=function(F,Xe,Vi,fr){return Wt._(this||u,void 0,void 0,(function*(){const u=256*Xe,_r=u+255,wr=fr.transformRequest(Vi.replace("{fontstack}",F).replace("{range}",`${u}-${_r}`),"Glyphs"),Ar=yield Wt.l(wr,new AbortController);if(!Ar||!Ar.data)throw new Error(`Could not load glyph range. range: ${Xe}, ${u}-${_r}`);const Kr={};for(const u of Wt.n(Ar.data))Kr[u.id]=u;return Kr}))},C.TinySDF=class{constructor({fontSize:u=24,buffer:F=3,radius:Wt=8,cutoff:Xe=.25,fontFamily:Vi="sans-serif",fontWeight:fr="normal",fontStyle:_r="normal"}={}){this.buffer=F,this.cutoff=Xe,this.radius=Wt;const wr=this.size=u+4*F,Ar=this._createCanvas(wr),Kr=this.ctx=Ar.getContext("2d",{willReadFrequently:!0});Kr.font=`${_r} ${fr} ${u}px ${Vi}`,Kr.textBaseline="alphabetic",Kr.textAlign="left",Kr.fillStyle="black",this.gridOuter=new Float64Array(wr*wr),this.gridInner=new Float64Array(wr*wr),this.f=new Float64Array(wr),this.z=new Float64Array(wr+1),this.v=new Uint16Array(wr)}_createCanvas(u){const F=document.createElement("canvas");return F.width=F.height=u,F}draw(u){const{width:F,actualBoundingBoxAscent:Wt,actualBoundingBoxDescent:Xe,actualBoundingBoxLeft:Vi,actualBoundingBoxRight:fr}=this.ctx.measureText(u),_r=Math.ceil(Wt),wr=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(fr-Vi))),Ar=Math.min(this.size-this.buffer,_r+Math.ceil(Xe)),Kr=wr+2*this.buffer,In=Ar+2*this.buffer,ns=Math.max(Kr*In,0),ca=new Uint8ClampedArray(ns),ha={data:ca,width:Kr,height:In,glyphWidth:wr,glyphHeight:Ar,glyphTop:_r,glyphLeft:0,glyphAdvance:F};if(0===wr||0===Ar)return ha;const{ctx:Da,buffer:io,gridInner:no,gridOuter:so}=this;Da.clearRect(io,io,wr,Ar),Da.fillText(u,io,io+_r);const ao=Da.getImageData(io,io,wr,Ar);so.fill(ua,0,ns),no.fill(0,0,ns);for(let u=0;u<Ar;u++)for(let F=0;F<wr;F++){const Wt=ao.data[4*(u*wr+F)+3]/255;if(0===Wt)continue;const Xe=(u+io)*Kr+F+io;if(1===Wt)so[Xe]=0,no[Xe]=ua;else{const u=.5-Wt;so[Xe]=u>0?u*u:0,no[Xe]=u<0?u*u:0}}E(so,0,0,Kr,In,Kr,this.f,this.v,this.z),E(no,io,io,wr,Ar,Kr,this.f,this.v,this.z);for(let u=0;u<ns;u++){const F=Math.sqrt(so[u])-Math.sqrt(no[u]);ca[u]=Math.round(255-255*(F/this.radius+this.cutoff))}return ha}};class S{constructor(){this.specification=Wt.v.light.position}possiblyEvaluate(u,F){return Wt.x(u.expression.evaluate(F))}interpolate(u,F,Xe){return{x:Wt.y.number(u.x,F.x,Xe),y:Wt.y.number(u.y,F.y,Xe),z:Wt.y.number(u.z,F.z,Xe)}}}let Da;class D extends Wt.E{constructor(u){super(),Da=Da||new Wt.q({anchor:new Wt.D(Wt.v.light.anchor),position:new S,color:new Wt.D(Wt.v.light.color),intensity:new Wt.D(Wt.v.light.intensity)}),this._transitionable=new Wt.T(Da),this.setLight(u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(u,F={}){if(!this._validate(Wt.r,u,F))for(const F in u){const Wt=u[F];F.endsWith("-transition")?this._transitionable.setTransition(F.slice(0,-11),Wt):this._transitionable.setValue(F,Wt)}}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,F,Xe){return(!Xe||!1!==Xe.validate)&&Wt.t(this,u.call(Wt.u,{value:F,style:{glyphs:!0,sprite:!0},styleSpec:Wt.v}))}}const io=new Wt.q({"sky-color":new Wt.D(Wt.v.sky["sky-color"]),"horizon-color":new Wt.D(Wt.v.sky["horizon-color"]),"fog-color":new Wt.D(Wt.v.sky["fog-color"]),"fog-ground-blend":new Wt.D(Wt.v.sky["fog-ground-blend"]),"horizon-fog-blend":new Wt.D(Wt.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new Wt.D(Wt.v.sky["sky-horizon-blend"]),"atmosphere-blend":new Wt.D(Wt.v.sky["atmosphere-blend"])});class A extends Wt.E{constructor(u){super(),this._transitionable=new Wt.T(io),this.setSky(u),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new Wt.z(0))}setSky(u,F={}){if(!this._validate(Wt.B,u,F)){u||(u={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const F in u){const Wt=u[F];F.endsWith("-transition")?this._transitionable.setTransition(F.slice(0,-11),Wt):this._transitionable.setValue(F,Wt)}}}getSky(){return this._transitionable.serialize()}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,F,Xe={}){return!1!==(null==Xe?void 0:Xe.validate)&&Wt.t(this,u.call(Wt.u,Wt.e({value:F,style:{glyphs:!0,sprite:!0},styleSpec:Wt.v})))}calculateFogBlendOpacity(u){return u<60?0:u<70?(u-60)/10:1}}class R{constructor(u,F){this.width=u,this.height=F,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(u,F){const Wt=u.join(",")+String(F);return this.dashEntry[Wt]||(this.dashEntry[Wt]=this.addDash(u,F)),this.dashEntry[Wt]}getDashRanges(u,F,Wt){const Xe=[];let Vi=u.length%2==1?-u[u.length-1]*Wt:0,fr=u[0]*Wt,_r=!0;Xe.push({left:Vi,right:fr,isDash:_r,zeroLength:0===u[0]});let wr=u[0];for(let F=1;F<u.length;F++){_r=!_r;const Ar=u[F];Vi=wr*Wt,wr+=Ar,fr=wr*Wt,Xe.push({left:Vi,right:fr,isDash:_r,zeroLength:0===Ar})}return Xe}addRoundDash(u,F,Wt){const Xe=F/2;for(let F=-Wt;F<=Wt;F++){const Vi=this.width*(this.nextRow+Wt+F);let fr=0,_r=u[fr];for(let wr=0;wr<this.width;wr++){wr/_r.right>1&&(_r=u[++fr]);const Ar=Math.abs(wr-_r.left),Kr=Math.abs(wr-_r.right),In=Math.min(Ar,Kr);let ns;const ca=F/Wt*(Xe+1);if(_r.isDash){const u=Xe-Math.abs(ca);ns=Math.sqrt(In*In+u*u)}else ns=Xe-Math.sqrt(In*In+ca*ca);this.data[Vi+wr]=Math.max(0,Math.min(255,ns+128))}}}addRegularDash(u){for(let F=u.length-1;F>=0;--F){const Wt=u[F],Xe=u[F+1];Wt.zeroLength?u.splice(F,1):Xe&&Xe.isDash===Wt.isDash&&(Xe.left=Wt.left,u.splice(F,1))}const F=u[0],Wt=u[u.length-1];F.isDash===Wt.isDash&&(F.left=Wt.left-this.width,Wt.right=F.right+this.width);const Xe=this.width*this.nextRow;let Vi=0,fr=u[Vi];for(let F=0;F<this.width;F++){F/fr.right>1&&(fr=u[++Vi]);const Wt=Math.abs(F-fr.left),_r=Math.abs(F-fr.right),wr=Math.min(Wt,_r);this.data[Xe+F]=Math.max(0,Math.min(255,(fr.isDash?wr:-wr)+128))}}addDash(u,F){const Xe=F?7:0,Vi=2*Xe+1;if(this.nextRow+Vi>this.height)return Wt.w("LineAtlas out of space"),null;let fr=0;for(let F=0;F<u.length;F++)fr+=u[F];if(0!==fr){const Wt=this.width/fr,Vi=this.getDashRanges(u,this.width,Wt);F?this.addRoundDash(Vi,Wt,Xe):this.addRegularDash(Vi)}const _r={y:(this.nextRow+Xe+.5)/this.height,height:2*Xe/this.height,width:fr};return this.nextRow+=Vi,this.dirty=!0,_r}bind(u){const F=u.gl;this.texture?(F.bindTexture(F.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,F.texSubImage2D(F.TEXTURE_2D,0,0,0,this.width,this.height,F.ALPHA,F.UNSIGNED_BYTE,this.data))):(this.texture=F.createTexture(),F.bindTexture(F.TEXTURE_2D,this.texture),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.REPEAT),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.REPEAT),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),F.texImage2D(F.TEXTURE_2D,0,F.ALPHA,this.width,this.height,0,F.ALPHA,F.UNSIGNED_BYTE,this.data))}}const no="maplibre_preloaded_worker_pool";class L{constructor(){this.active={}}acquire(u){if(!this.workers)for(this.workers=[];this.workers.length<L.workerCount;)this.workers.push(new Worker(Wt.a.WORKER_URL));return this.active[u]=!0,this.workers.slice()}release(u){delete this.active[u],0===this.numActive()&&(this.workers.forEach((u=>{u.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[no]}numActive(){return Object.keys(this.active).length}}const so=Math.floor(_r.hardwareConcurrency/2);let ao,oo;function N(){return ao||(ao=new L),ao}L.workerCount=Wt.C(globalThis)?Math.max(Math.min(so,3),1):1;class U{constructor(u,F){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=F;const Xe=this.workerPool.acquire(F);for(let u=0;u<Xe.length;u++){const Vi=new Wt.F(Xe[u],F);Vi.name=`Worker ${u}`,this.actors.push(Vi)}if(!this.actors.length)throw new Error("No actors found")}broadcast(u,F){const Wt=[];for(const Xe of this.actors)Wt.push(Xe.sendAsync({type:u,data:F}));return Promise.all(Wt)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(u=!0){this.actors.forEach((u=>{u.remove()})),this.actors=[],u&&this.workerPool.release(this.id)}registerMessageHandler(u,F){for(const Wt of this.actors)Wt.registerMessageHandler(u,F)}}function j(){return oo||(oo=new U(N(),Wt.G),oo.registerMessageHandler("GR",((u,F,Xe)=>Wt.m(F,Xe)))),oo}function Z(u,F){const Xe=Wt.H();return Wt.J(Xe,Xe,[1,1,0]),Wt.K(Xe,Xe,[.5*u.width,.5*u.height,1]),Wt.L(Xe,Xe,u.calculatePosMatrix(F.toUnwrapped()))}function q(u,F,Wt,Xe,Vi,fr){const _r=function(u,F,Wt){if(u)for(const Xe of u){const u=F[Xe];if(u&&u.source===Wt&&"fill-extrusion"===u.type)return!0}else for(const u in F){const Xe=F[u];if(Xe.source===Wt&&"fill-extrusion"===Xe.type)return!0}return!1}(Vi&&Vi.layers,F,u.id),wr=fr.maxPitchScaleFactor(),Ar=u.tilesIn(Xe,wr,_r);Ar.sort(V);const Kr=[];for(const Xe of Ar)Kr.push({wrappedTileID:Xe.tileID.wrapped().key,queryResults:Xe.tile.queryRenderedFeatures(F,Wt,u._state,Xe.queryGeometry,Xe.cameraQueryGeometry,Xe.scale,Vi,fr,wr,Z(u.transform,Xe.tileID))});const In=function(u){const F={},Wt={};for(const Xe of u){const u=Xe.queryResults,Vi=Xe.wrappedTileID,fr=Wt[Vi]=Wt[Vi]||{};for(const Wt in u){const Xe=u[Wt],Vi=fr[Wt]=fr[Wt]||{},_r=F[Wt]=F[Wt]||[];for(const u of Xe)Vi[u.featureIndex]||(Vi[u.featureIndex]=!0,_r.push(u))}}return F}(Kr);for(const F in In)In[F].forEach((F=>{const Wt=F.feature,Xe=u.getFeatureState(Wt.layer["source-layer"],Wt.id);Wt.source=Wt.layer.source,Wt.layer["source-layer"]&&(Wt.sourceLayer=Wt.layer["source-layer"]),Wt.state=Xe}));return In}function V(u,F){const Wt=u.tileID,Xe=F.tileID;return Wt.overscaledZ-Xe.overscaledZ||Wt.canonical.y-Xe.canonical.y||Wt.wrap-Xe.wrap||Wt.canonical.x-Xe.canonical.x}function G(F,Xe,Vi){return Wt._(this||u,void 0,void 0,(function*(){let u=F;if(F.url?u=(yield Wt.h(Xe.transformRequest(F.url,"Source"),Vi)).data:yield _r.frameAsync(Vi),!u)return null;const fr=Wt.M(Wt.e(u,F),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(fr.vectorLayerIds=u.vector_layers.map((u=>u.id))),fr}))}class H{constructor(u,F){u&&(F?this.setSouthWest(u).setNorthEast(F):Array.isArray(u)&&(4===u.length?this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]]):this.setSouthWest(u[0]).setNorthEast(u[1])))}setNorthEast(u){return this._ne=u instanceof Wt.N?new Wt.N(u.lng,u.lat):Wt.N.convert(u),this}setSouthWest(u){return this._sw=u instanceof Wt.N?new Wt.N(u.lng,u.lat):Wt.N.convert(u),this}extend(u){const F=this._sw,Xe=this._ne;let Vi,fr;if(u instanceof Wt.N)Vi=u,fr=u;else{if(!(u instanceof H))return Array.isArray(u)?4===u.length||u.every(Array.isArray)?this.extend(H.convert(u)):this.extend(Wt.N.convert(u)):u&&("lng"in u||"lon"in u)&&"lat"in u?this.extend(Wt.N.convert(u)):this;if(Vi=u._sw,fr=u._ne,!Vi||!fr)return this}return F||Xe?(F.lng=Math.min(Vi.lng,F.lng),F.lat=Math.min(Vi.lat,F.lat),Xe.lng=Math.max(fr.lng,Xe.lng),Xe.lat=Math.max(fr.lat,Xe.lat)):(this._sw=new Wt.N(Vi.lng,Vi.lat),this._ne=new Wt.N(fr.lng,fr.lat)),this}getCenter(){return new Wt.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Wt.N(this.getWest(),this.getNorth())}getSouthEast(){return new Wt.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(u){const{lng:F,lat:Xe}=Wt.N.convert(u);let Vi=this._sw.lng<=F&&F<=this._ne.lng;return this._sw.lng>this._ne.lng&&(Vi=this._sw.lng>=F&&F>=this._ne.lng),this._sw.lat<=Xe&&Xe<=this._ne.lat&&Vi}static convert(u){return u instanceof H?u:u?new H(u):u}static fromLngLat(u,F=0){const Xe=360*F/40075017,Vi=Xe/Math.cos(Math.PI/180*u.lat);return new H(new Wt.N(u.lng-Vi,u.lat-Xe),new Wt.N(u.lng+Vi,u.lat+Xe))}adjustAntiMeridian(){const u=new Wt.N(this._sw.lng,this._sw.lat),F=new Wt.N(this._ne.lng,this._ne.lat);return new H(u,u.lng>F.lng?new Wt.N(F.lng+360,F.lat):F)}}class W{constructor(u,F,Wt){this.bounds=H.convert(this.validateBounds(u)),this.minzoom=F||0,this.maxzoom=Wt||24}validateBounds(u){return Array.isArray(u)&&4===u.length?[Math.max(-180,u[0]),Math.max(-90,u[1]),Math.min(180,u[2]),Math.min(90,u[3])]:[-180,-90,180,90]}contains(u){const F=Math.pow(2,u.z),Xe=Math.floor(Wt.O(this.bounds.getWest())*F),Vi=Math.floor(Wt.Q(this.bounds.getNorth())*F),fr=Math.ceil(Wt.O(this.bounds.getEast())*F),_r=Math.ceil(Wt.Q(this.bounds.getSouth())*F);return u.x>=Xe&&u.x<fr&&u.y>=Vi&&u.y<_r}}class $ extends Wt.E{constructor(u,F,Xe,Vi){if(super(),this.id=u,this.dispatcher=Xe,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Wt.e(this,Wt.M(F,["url","scheme","tileSize","promoteId"])),this._options=Wt.e({type:"vector"},F),this._collectResourceTiming=F.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(Vi)}load(){return Wt._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new Wt.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const u=yield G(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),u&&(Wt.e(this,u),u.bounds&&(this.tileBounds=new W(u.bounds,this.minzoom,this.maxzoom)),this.fire(new Wt.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Wt.k("data",{dataType:"source",sourceDataType:"content"})))}catch(u){this._tileJSONRequest=null,this.fire(new Wt.j(u))}}))}loaded(){return this._loaded}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}onAdd(u){this.map=u,this.load()}setSourceProperty(u){this._tileJSONRequest&&this._tileJSONRequest.abort(),u(),this.load()}setTiles(u){return this.setSourceProperty((()=>{this._options.tiles=u})),this}setUrl(u){return this.setSourceProperty((()=>{this.url=u,this._options.url=u})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return Wt.e({},this._options)}loadTile(u){return Wt._(this,void 0,void 0,(function*(){const F=u.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),Wt={request:this.map._requestManager.transformRequest(F,"Tile"),uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};Wt.request.collectResourceTiming=this._collectResourceTiming;let Xe="RT";if(u.actor&&"expired"!==u.state){if("loading"===u.state)return new Promise(((F,Wt)=>{u.reloadPromise={resolve:F,reject:Wt}}))}else u.actor=this.dispatcher.getActor(),Xe="LT";u.abortController=new AbortController;try{const F=yield u.actor.sendAsync({type:Xe,data:Wt},u.abortController);if(delete u.abortController,u.aborted)return;this._afterTileLoadWorkerResponse(u,F)}catch(F){if(delete u.abortController,u.aborted)return;if(F&&404!==F.status)throw F;this._afterTileLoadWorkerResponse(u,null)}}))}_afterTileLoadWorkerResponse(u,F){if(F&&F.resourceTiming&&(u.resourceTiming=F.resourceTiming),F&&this.map._refreshExpiredTiles&&u.setExpiryData(F),u.loadVectorData(F,this.map.painter),u.reloadPromise){const F=u.reloadPromise;u.reloadPromise=null,this.loadTile(u).then(F.resolve).catch(F.reject)}}abortTile(u){return Wt._(this,void 0,void 0,(function*(){u.abortController&&(u.abortController.abort(),delete u.abortController),u.actor&&(yield u.actor.sendAsync({type:"AT",data:{uid:u.uid,type:this.type,source:this.id}}))}))}unloadTile(u){return Wt._(this,void 0,void 0,(function*(){u.unloadVectorData(),u.actor&&(yield u.actor.sendAsync({type:"RMT",data:{uid:u.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class X extends Wt.E{constructor(u,F,Xe,Vi){super(),this.id=u,this.dispatcher=Xe,this.setEventedParent(Vi),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Wt.e({type:"raster"},F),Wt.e(this,Wt.M(F,["url","scheme","tileSize"]))}load(){return Wt._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new Wt.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const u=yield G(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,u&&(Wt.e(this,u),u.bounds&&(this.tileBounds=new W(u.bounds,this.minzoom,this.maxzoom)),this.fire(new Wt.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Wt.k("data",{dataType:"source",sourceDataType:"content"})))}catch(u){this._tileJSONRequest=null,this.fire(new Wt.j(u))}}))}loaded(){return this._loaded}onAdd(u){this.map=u,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(u){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),u(),this.load()}setTiles(u){return this.setSourceProperty((()=>{this._options.tiles=u})),this}setUrl(u){return this.setSourceProperty((()=>{this.url=u,this._options.url=u})),this}serialize(){return Wt.e({},this._options)}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u){return Wt._(this,void 0,void 0,(function*(){const F=u.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);u.abortController=new AbortController;try{const Wt=yield ca.getImage(this.map._requestManager.transformRequest(F,"Tile"),u.abortController,this.map._refreshExpiredTiles);if(delete u.abortController,u.aborted)return void(u.state="unloaded");if(Wt&&Wt.data){this.map._refreshExpiredTiles&&Wt.cacheControl&&Wt.expires&&u.setExpiryData({cacheControl:Wt.cacheControl,expires:Wt.expires});const F=this.map.painter.context,Xe=F.gl,Vi=Wt.data;u.texture=this.map.painter.getTileTexture(Vi.width),u.texture?u.texture.update(Vi,{useMipmap:!0}):(u.texture=new b(F,Vi,Xe.RGBA,{useMipmap:!0}),u.texture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE,Xe.LINEAR_MIPMAP_NEAREST)),u.state="loaded"}}catch(F){if(delete u.abortController,u.aborted)u.state="unloaded";else if(F)throw u.state="errored",F}}))}abortTile(u){return Wt._(this,void 0,void 0,(function*(){u.abortController&&(u.abortController.abort(),delete u.abortController)}))}unloadTile(u){return Wt._(this,void 0,void 0,(function*(){u.texture&&this.map.painter.saveTileTexture(u.texture)}))}hasTransition(){return!1}}class K extends X{constructor(u,F,Xe,Vi){super(u,F,Xe,Vi),this.type="raster-dem",this.maxzoom=22,this._options=Wt.e({type:"raster-dem"},F),this.encoding=F.encoding||"mapbox",this.redFactor=F.redFactor,this.greenFactor=F.greenFactor,this.blueFactor=F.blueFactor,this.baseShift=F.baseShift}loadTile(u){return Wt._(this,void 0,void 0,(function*(){const F=u.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),Xe=this.map._requestManager.transformRequest(F,"Tile");u.neighboringTiles=this._getNeighboringTiles(u.tileID),u.abortController=new AbortController;try{const F=yield ca.getImage(Xe,u.abortController,this.map._refreshExpiredTiles);if(delete u.abortController,u.aborted)return void(u.state="unloaded");if(F&&F.data){const Xe=F.data;this.map._refreshExpiredTiles&&F.cacheControl&&F.expires&&u.setExpiryData({cacheControl:F.cacheControl,expires:F.expires});const Vi=Wt.b(Xe)&&Wt.U()?Xe:yield this.readImageNow(Xe),fr={type:this.type,uid:u.uid,source:this.id,rawImageData:Vi,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!u.actor||"expired"===u.state){u.actor=this.dispatcher.getActor();const F=yield u.actor.sendAsync({type:"LDT",data:fr});u.dem=F,u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0,u.state="loaded"}}}catch(F){if(delete u.abortController,u.aborted)u.state="unloaded";else if(F)throw u.state="errored",F}}))}readImageNow(u){return Wt._(this,void 0,void 0,(function*(){if("undefined"!=typeof VideoFrame&&Wt.V()){const F=u.width+2,Xe=u.height+2;try{return new Wt.R({width:F,height:Xe},yield Wt.W(u,-1,-1,F,Xe))}catch(u){}}return _r.getImageData(u,1)}))}_getNeighboringTiles(u){const F=u.canonical,Xe=Math.pow(2,F.z),Vi=(F.x-1+Xe)%Xe,fr=0===F.x?u.wrap-1:u.wrap,_r=(F.x+1+Xe)%Xe,wr=F.x+1===Xe?u.wrap+1:u.wrap,Ar={};return Ar[new Wt.S(u.overscaledZ,fr,F.z,Vi,F.y).key]={backfilled:!1},Ar[new Wt.S(u.overscaledZ,wr,F.z,_r,F.y).key]={backfilled:!1},F.y>0&&(Ar[new Wt.S(u.overscaledZ,fr,F.z,Vi,F.y-1).key]={backfilled:!1},Ar[new Wt.S(u.overscaledZ,u.wrap,F.z,F.x,F.y-1).key]={backfilled:!1},Ar[new Wt.S(u.overscaledZ,wr,F.z,_r,F.y-1).key]={backfilled:!1}),F.y+1<Xe&&(Ar[new Wt.S(u.overscaledZ,fr,F.z,Vi,F.y+1).key]={backfilled:!1},Ar[new Wt.S(u.overscaledZ,u.wrap,F.z,F.x,F.y+1).key]={backfilled:!1},Ar[new Wt.S(u.overscaledZ,wr,F.z,_r,F.y+1).key]={backfilled:!1}),Ar}unloadTile(u){return Wt._(this,void 0,void 0,(function*(){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded",u.actor&&(yield u.actor.sendAsync({type:"RDT",data:{type:this.type,uid:u.uid,source:this.id}}))}))}}class J extends Wt.E{constructor(u,F,Xe,Vi){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=Xe.getActor(),this.setEventedParent(Vi),this._data=F.data,this._options=Wt.e({},F),this._collectResourceTiming=F.collectResourceTiming,void 0!==F.maxzoom&&(this.maxzoom=F.maxzoom),F.type&&(this.type=F.type),F.attribution&&(this.attribution=F.attribution),this.promoteId=F.promoteId;const fr=Wt.X/this.tileSize;void 0!==F.clusterMaxZoom&&this.maxzoom<=F.clusterMaxZoom&&Wt.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${F.clusterMaxZoom}".`),this.workerOptions=Wt.e({source:this.id,cluster:F.cluster||!1,geojsonVtOptions:{buffer:(void 0!==F.buffer?F.buffer:128)*fr,tolerance:(void 0!==F.tolerance?F.tolerance:.375)*fr,extent:Wt.X,maxZoom:this.maxzoom,lineMetrics:F.lineMetrics||!1,generateId:F.generateId||!1},superclusterOptions:{maxZoom:void 0!==F.clusterMaxZoom?F.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,F.clusterMinPoints||2),extent:Wt.X,radius:(F.clusterRadius||50)*fr,log:!1,generateId:F.generateId||!1},clusterProperties:F.clusterProperties,filter:F.filter},F.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}load(){return Wt._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(u){this.map=u,this.load()}setData(u){return this._data=u,this._updateWorkerData(),this}updateData(u){return this._updateWorkerData(u),this}getData(){return Wt._(this,void 0,void 0,(function*(){const u=Wt.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:u})}))}setClusterOptions(u){return this.workerOptions.cluster=u.cluster,u&&(void 0!==u.clusterRadius&&(this.workerOptions.superclusterOptions.radius=u.clusterRadius),void 0!==u.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=u.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(u){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:u,source:this.id}})}getClusterChildren(u){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:u,source:this.id}})}getClusterLeaves(u,F,Wt){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:u,limit:F,offset:Wt}})}_updateWorkerData(u){return Wt._(this,void 0,void 0,(function*(){const F=Wt.e({type:this.type},this.workerOptions);u?F.dataDiff=u:"string"==typeof this._data?(F.request=this.map._requestManager.transformRequest(_r.resolveURL(this._data),"Source"),F.request.collectResourceTiming=this._collectResourceTiming):F.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new Wt.k("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:F});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new Wt.k("dataabort",{dataType:"source"}));let Xe=null;u.resourceTiming&&u.resourceTiming[this.id]&&(Xe=u.resourceTiming[this.id].slice(0));const Vi={dataType:"source"};this._collectResourceTiming&&Xe&&Xe.length>0&&Wt.e(Vi,{resourceTiming:Xe}),this.fire(new Wt.k("data",Object.assign(Object.assign({},Vi),{sourceDataType:"metadata"}))),this.fire(new Wt.k("data",Object.assign(Object.assign({},Vi),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new Wt.k("dataabort",{dataType:"source"}));this.fire(new Wt.j(u))}}))}loaded(){return 0===this._pendingLoads}loadTile(u){return Wt._(this,void 0,void 0,(function*(){const F=u.actor?"RT":"LT";u.actor=this.actor;const Wt={type:this.type,uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.abortController=new AbortController;const Xe=yield this.actor.sendAsync({type:F,data:Wt},u.abortController);delete u.abortController,u.unloadVectorData(),u.aborted||u.loadVectorData(Xe,this.map.painter,"RT"===F)}))}abortTile(u){return Wt._(this,void 0,void 0,(function*(){u.abortController&&(u.abortController.abort(),delete u.abortController),u.aborted=!0}))}unloadTile(u){return Wt._(this,void 0,void 0,(function*(){u.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:u.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return Wt.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var co=Wt.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Q extends Wt.E{constructor(u,F,Wt,Xe){super(),this.id=u,this.dispatcher=Wt,this.coordinates=F.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(Xe),this.options=F}load(u){return Wt._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new Wt.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const F=yield ca.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,F&&F.data&&(this.image=F.data,u&&(this.coordinates=u),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,this.fire(new Wt.j(u))}}))}loaded(){return this._loaded}updateImage(u){return u.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=u.url,this.load(u.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Wt.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(u){this.map=u,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(u){this.coordinates=u;const F=u.map(Wt.Z.fromLngLat);this.tileID=function(u){let F=1/0,Xe=1/0,Vi=-1/0,fr=-1/0;for(const Wt of u)F=Math.min(F,Wt.x),Xe=Math.min(Xe,Wt.y),Vi=Math.max(Vi,Wt.x),fr=Math.max(fr,Wt.y);const _r=Math.max(Vi-F,fr-Xe),wr=Math.max(0,Math.floor(-Math.log(_r)/Math.LN2)),Ar=Math.pow(2,wr);return new Wt.a1(wr,Math.floor((F+Vi)/2*Ar),Math.floor((Xe+fr)/2*Ar))}(F),this.minzoom=this.maxzoom=this.tileID.z;const Xe=F.map((u=>this.tileID.getTilePoint(u)._round()));return this._boundsArray=new Wt.$,this._boundsArray.emplaceBack(Xe[0].x,Xe[0].y,0,0),this._boundsArray.emplaceBack(Xe[1].x,Xe[1].y,Wt.X,0),this._boundsArray.emplaceBack(Xe[3].x,Xe[3].y,0,Wt.X),this._boundsArray.emplaceBack(Xe[2].x,Xe[2].y,Wt.X,Wt.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new Wt.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const u=this.map.painter.context,F=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,co.members)),this.boundsSegments||(this.boundsSegments=Wt.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new b(u,this.image,F.RGBA),this.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE));let Xe=!1;for(const u in this.tiles){const F=this.tiles[u];"loaded"!==F.state&&(F.state="loaded",F.texture=this.texture,Xe=!0)}Xe&&this.fire(new Wt.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(u){return Wt._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(u.tileID.canonical)?(this.tiles[String(u.tileID.wrap)]=u,u.buckets={}):u.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class tt extends Q{constructor(u,F,Wt,Xe){super(u,F,Wt,Xe),this.roundZoom=!0,this.type="video",this.options=F}load(){return Wt._(this,void 0,void 0,(function*(){this._loaded=!1;const u=this.options;this.urls=[];for(const F of u.urls)this.urls.push(this.map._requestManager.transformRequest(F,"Source").url);try{const u=yield Wt.a3(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new Wt.j(u))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const F=this.video.seekable;u<F.start(0)||u>F.end(0)?this.fire(new Wt.j(new Wt.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${F.start(0)} and ${F.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const u=this.map.painter.context,F=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,co.members)),this.boundsSegments||(this.boundsSegments=Wt.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.texSubImage2D(F.TEXTURE_2D,0,0,0,F.RGBA,F.UNSIGNED_BYTE,this.video)):(this.texture=new b(u,this.video,F.RGBA),this.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE));let Xe=!1;for(const u in this.tiles){const F=this.tiles[u];"loaded"!==F.state&&(F.state="loaded",F.texture=this.texture,Xe=!0)}Xe&&this.fire(new Wt.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class et extends Q{constructor(u,F,Xe,Vi){super(u,F,Xe,Vi),F.coordinates?Array.isArray(F.coordinates)&&4===F.coordinates.length&&!F.coordinates.some((u=>!Array.isArray(u)||2!==u.length||u.some((u=>"number"!=typeof u))))||this.fire(new Wt.j(new Wt.a2(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new Wt.j(new Wt.a2(`sources.${u}`,null,'missing required property "coordinates"'))),F.animate&&"boolean"!=typeof F.animate&&this.fire(new Wt.j(new Wt.a2(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),F.canvas?"string"==typeof F.canvas||F.canvas instanceof HTMLCanvasElement||this.fire(new Wt.j(new Wt.a2(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new Wt.j(new Wt.a2(`sources.${u}`,null,'missing required property "canvas"'))),this.options=F,this.animate=void 0===F.animate||F.animate}load(){return Wt._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new Wt.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const F=this.map.painter.context,Xe=F.gl;this.boundsBuffer||(this.boundsBuffer=F.createVertexBuffer(this._boundsArray,co.members)),this.boundsSegments||(this.boundsSegments=Wt.a0.simpleSegment(0,0,4,2)),this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new b(F,this.canvas,Xe.RGBA,{premultiply:!0});let Vi=!1;for(const u in this.tiles){const F=this.tiles[u];"loaded"!==F.state&&(F.state="loaded",F.texture=this.texture,Vi=!0)}Vi&&this.fire(new Wt.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}}const ho={},at=u=>{switch(u){case"geojson":return J;case"image":return Q;case"raster":return X;case"raster-dem":return K;case"vector":return $;case"video":return tt;case"canvas":return et}return ho[u]},go="RTLPluginLoaded";class ot extends Wt.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=j()}_syncState(u){return this.status=u,this.dispatcher.broadcast("SRPS",{pluginStatus:u,pluginURL:this.url}).catch((u=>{throw this.status="error",u}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(u){return Wt._(this,arguments,void 0,(function*(u,F=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=_r.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if("unavailable"===this.status){if(!F)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if("requested"===this.status)return this._requestImport()}))}_requestImport(){return Wt._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new Wt.k(go))}))}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let xo=null;function nt(){return xo||(xo=new ot),xo}class lt{constructor(u,F){this.timeAdded=0,this.fadeEndTime=0,this.tileID=u,this.uid=Wt.a4(),this.uses=0,this.tileSize=F,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(u){const F=u+this.timeAdded;F<this.fadeEndTime||(this.fadeEndTime=F)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(u){this.demTexture&&u.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(u,F,Xe){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",u){u.featureIndex&&(this.latestFeatureIndex=u.featureIndex,u.rawTileData?(this.latestRawTileData=u.rawTileData,this.latestFeatureIndex.rawTileData=u.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=u.collisionBoxArray,this.buckets=function(u,F){const Wt={};if(!F)return Wt;for(const Xe of u){const u=Xe.layerIds.map((u=>F.getLayer(u))).filter(Boolean);if(0!==u.length){Xe.layers=u,Xe.stateDependentLayerIds&&(Xe.stateDependentLayers=Xe.stateDependentLayerIds.map((F=>u.filter((u=>u.id===F))[0])));for(const F of u)Wt[F.id]=Xe}}return Wt}(u.buckets,F.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const F=this.buckets[u];if(F instanceof Wt.a6){if(this.hasSymbolBuckets=!0,!Xe)break;F.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const F=this.buckets[u];if(F instanceof Wt.a6&&F.hasRTLText){this.hasRTLText=!0,nt().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const Wt=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,F.style.getLayer(u).queryRadius(Wt))}u.imageAtlas&&(this.imageAtlas=u.imageAtlas),u.glyphAtlasImage&&(this.glyphAtlasImage=u.glyphAtlasImage)}else this.collisionBoxArray=new Wt.a5}unloadVectorData(){for(const u in this.buckets)this.buckets[u].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(u){return this.buckets[u.id]}upload(u){for(const F in this.buckets){const Wt=this.buckets[F];Wt.uploadPending()&&Wt.upload(u)}const F=u.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new b(u,this.imageAtlas.image,F.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new b(u,this.glyphAtlasImage,F.ALPHA),this.glyphAtlasImage=null)}prepare(u){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(u,this.imageAtlasTexture)}queryRenderedFeatures(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:Xe,cameraQueryGeometry:Vi,scale:fr,tileSize:this.tileSize,pixelPosMatrix:Kr,transform:wr,params:_r,queryPadding:this.queryPadding*Ar},u,F,Wt):{}}querySourceFeatures(u,F){const Xe=this.latestFeatureIndex;if(!Xe||!Xe.rawTileData)return;const Vi=Xe.loadVTLayers(),fr=F&&F.sourceLayer?F.sourceLayer:"",_r=Vi._geojsonTileLayer||Vi[fr];if(!_r)return;const wr=Wt.a7(F&&F.filter),{z:Ar,x:Kr,y:In}=this.tileID.canonical,ns={z:Ar,x:Kr,y:In};for(let F=0;F<_r.length;F++){const Vi=_r.feature(F);if(wr.needGeometry){const u=Wt.a8(Vi,!0);if(!wr.filter(new Wt.z(this.tileID.overscaledZ),u,this.tileID.canonical))continue}else if(!wr.filter(new Wt.z(this.tileID.overscaledZ),Vi))continue;const ca=Xe.getId(Vi,fr),ha=new Wt.a9(Vi,Ar,Kr,In,ca);ha.tile=ns,u.push(ha)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(u){const F=this.expirationTime;if(u.cacheControl){const F=Wt.aa(u.cacheControl);F["max-age"]&&(this.expirationTime=Date.now()+1e3*F["max-age"])}else u.expires&&(this.expirationTime=new Date(u.expires).getTime());if(this.expirationTime){const u=Date.now();let Wt=!1;if(this.expirationTime>u)Wt=!1;else if(F)if(this.expirationTime<F)Wt=!0;else{const Xe=this.expirationTime-F;Xe?this.expirationTime=u+Math.max(Xe,3e4):Wt=!0}else Wt=!0;Wt?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(u,F){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(u).length)return;const Wt=this.latestFeatureIndex.loadVTLayers();for(const Xe in this.buckets){if(!F.style.hasLayer(Xe))continue;const Vi=this.buckets[Xe],fr=Vi.layers[0].sourceLayer||"_geojsonTileLayer",_r=Wt[fr],wr=u[fr];if(!_r||!wr||0===Object.keys(wr).length)continue;Vi.update(wr,_r,this.imageAtlas&&this.imageAtlas.patternPositions||{});const Ar=F&&F.style&&F.style.getLayer(Xe);Ar&&(this.queryPadding=Math.max(this.queryPadding,Ar.queryRadius(Vi)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_r.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(u){this.symbolFadeHoldUntil=_r.now()+u}setDependencies(u,F){const Wt={};for(const u of F)Wt[u]=!0;this.dependencies[u]=Wt}hasDependency(u,F){for(const Wt of u){const u=this.dependencies[Wt];if(u)for(const Wt of F)if(u[Wt])return!0}return!1}}class ht{constructor(u,F){this.max=u,this.onRemove=F,this.reset()}reset(){for(const u in this.data)for(const F of this.data[u])F.timeout&&clearTimeout(F.timeout),this.onRemove(F.value);return this.data={},this.order=[],this}add(u,F,Wt){const Xe=u.wrapped().key;void 0===this.data[Xe]&&(this.data[Xe]=[]);const Vi={value:F,timeout:void 0};if(void 0!==Wt&&(Vi.timeout=setTimeout((()=>{this.remove(u,Vi)}),Wt)),this.data[Xe].push(Vi),this.order.push(Xe),this.order.length>this.max){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}has(u){return u.wrapped().key in this.data}getAndRemove(u){return this.has(u)?this._getAndRemoveByKey(u.wrapped().key):null}_getAndRemoveByKey(u){const F=this.data[u].shift();return F.timeout&&clearTimeout(F.timeout),0===this.data[u].length&&delete this.data[u],this.order.splice(this.order.indexOf(u),1),F.value}getByKey(u){const F=this.data[u];return F?F[0].value:null}get(u){return this.has(u)?this.data[u.wrapped().key][0].value:null}remove(u,F){if(!this.has(u))return this;const Wt=u.wrapped().key,Xe=void 0===F?0:this.data[Wt].indexOf(F),Vi=this.data[Wt][Xe];return this.data[Wt].splice(Xe,1),Vi.timeout&&clearTimeout(Vi.timeout),0===this.data[Wt].length&&delete this.data[Wt],this.onRemove(Vi.value),this.order.splice(this.order.indexOf(Wt),1),this}setMaxSize(u){for(this.max=u;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(u){const F=[];for(const Wt in this.data)for(const Xe of this.data[Wt])u(Xe.value)||F.push(Xe);for(const u of F)this.remove(u.value.tileID,u)}}class ct{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(u,F,Xe){const Vi=String(F);if(this.stateChanges[u]=this.stateChanges[u]||{},this.stateChanges[u][Vi]=this.stateChanges[u][Vi]||{},Wt.e(this.stateChanges[u][Vi],Xe),null===this.deletedStates[u]){this.deletedStates[u]={};for(const F in this.state[u])F!==Vi&&(this.deletedStates[u][F]=null)}else if(this.deletedStates[u]&&null===this.deletedStates[u][Vi]){this.deletedStates[u][Vi]={};for(const F in this.state[u][Vi])Xe[F]||(this.deletedStates[u][Vi][F]=null)}else for(const F in Xe)this.deletedStates[u]&&this.deletedStates[u][Vi]&&null===this.deletedStates[u][Vi][F]&&delete this.deletedStates[u][Vi][F]}removeFeatureState(u,F,Wt){if(null===this.deletedStates[u])return;const Xe=String(F);if(this.deletedStates[u]=this.deletedStates[u]||{},Wt&&void 0!==F)null!==this.deletedStates[u][Xe]&&(this.deletedStates[u][Xe]=this.deletedStates[u][Xe]||{},this.deletedStates[u][Xe][Wt]=null);else if(void 0!==F)if(this.stateChanges[u]&&this.stateChanges[u][Xe])for(Wt in this.deletedStates[u][Xe]={},this.stateChanges[u][Xe])this.deletedStates[u][Xe][Wt]=null;else this.deletedStates[u][Xe]=null;else this.deletedStates[u]=null}getState(u,F){const Xe=String(F),Vi=Wt.e({},(this.state[u]||{})[Xe],(this.stateChanges[u]||{})[Xe]);if(null===this.deletedStates[u])return{};if(this.deletedStates[u]){const Wt=this.deletedStates[u][F];if(null===Wt)return{};for(const u in Wt)delete Vi[u]}return Vi}initializeTileState(u,F){u.setFeatureState(this.state,F)}coalesceChanges(u,F){const Xe={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const F={};for(const Xe in this.stateChanges[u])this.state[u][Xe]||(this.state[u][Xe]={}),Wt.e(this.state[u][Xe],this.stateChanges[u][Xe]),F[Xe]=this.state[u][Xe];Xe[u]=F}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const F={};if(null===this.deletedStates[u])for(const Wt in this.state[u])F[Wt]={},this.state[u][Wt]={};else for(const Wt in this.deletedStates[u]){if(null===this.deletedStates[u][Wt])this.state[u][Wt]={};else for(const F of Object.keys(this.deletedStates[u][Wt]))delete this.state[u][Wt][F];F[Wt]=this.state[u][Wt]}Xe[u]=Xe[u]||{},Wt.e(Xe[u],F)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(Xe).length)for(const Wt in u)u[Wt].setFeatureState(Xe,F)}}class ut extends Wt.E{constructor(u,F,Wt){super(),this.id=u,this.dispatcher=Wt,this.on("data",(u=>this._dataHandler(u))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((u,F,Wt,Xe)=>{const Vi=new(at(F.type))(u,F,Wt,Xe);if(Vi.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${Vi.id}`);return Vi})(u,F,Wt,this),this._tiles={},this._cache=new ht(0,(u=>this._unloadTile(u))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ct,this._didEmitContent=!1,this._updated=!1}onAdd(u){this.map=u,this._maxTileCacheSize=u?u._maxTileCacheSize:null,this._maxTileCacheZoomLevels=u?u._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(u)}onRemove(u){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(u)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const u in this._tiles){const F=this._tiles[u];if("loaded"!==F.state&&"errored"!==F.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const u=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,u&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(u,F,Xe){return Wt._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(u),this._tileLoaded(u,F,Xe)}catch(F){u.state="errored",404!==F.status?this._source.fire(new Wt.j(F,{tile:u})):this.update(this.transform,this.terrain)}}))}_unloadTile(u){this._source.unloadTile&&this._source.unloadTile(u)}_abortTile(u){this._source.abortTile&&this._source.abortTile(u),this._source.fire(new Wt.k("dataabort",{tile:u,coord:u.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(u){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const F in this._tiles){const Wt=this._tiles[F];Wt.upload(u),Wt.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((u=>u.tileID)).sort(dt).map((u=>u.key))}getRenderableIds(u){const F=[];for(const Wt in this._tiles)this._isIdRenderable(Wt,u)&&F.push(this._tiles[Wt]);return u?F.sort(((u,F)=>{const Xe=u.tileID,Vi=F.tileID,fr=new Wt.P(Xe.canonical.x,Xe.canonical.y)._rotate(this.transform.angle),_r=new Wt.P(Vi.canonical.x,Vi.canonical.y)._rotate(this.transform.angle);return Xe.overscaledZ-Vi.overscaledZ||_r.y-fr.y||_r.x-fr.x})).map((u=>u.tileID.key)):F.map((u=>u.tileID)).sort(dt).map((u=>u.key))}hasRenderableParent(u){const F=this.findLoadedParent(u,0);return!!F&&this._isIdRenderable(F.tileID.key)}_isIdRenderable(u,F){return this._tiles[u]&&this._tiles[u].hasData()&&!this._coveredTiles[u]&&(F||!this._tiles[u].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const u in this._tiles)"errored"!==this._tiles[u].state&&this._reloadTile(u,"reloading")}}_reloadTile(u,F){return Wt._(this,void 0,void 0,(function*(){const Wt=this._tiles[u];Wt&&("loading"!==Wt.state&&(Wt.state=F),yield this._loadTile(Wt,u,F))}))}_tileLoaded(u,F,Xe){u.timeAdded=_r.now(),"expired"===Xe&&(u.refreshedUponExpiration=!0),this._setTileReloadTimer(F,u),"raster-dem"===this.getSource().type&&u.dem&&this._backfillDEM(u),this._state.initializeTileState(u,this.map?this.map.painter:null),u.aborted||this._source.fire(new Wt.k("data",{dataType:"source",tile:u,coord:u.tileID}))}_backfillDEM(u){const F=this.getRenderableIds();for(let Wt=0;Wt<F.length;Wt++){const Xe=F[Wt];if(u.neighboringTiles&&u.neighboringTiles[Xe]){const F=this.getTileByID(Xe);i(u,F),i(F,u)}}function i(u,F){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let Wt=F.tileID.canonical.x-u.tileID.canonical.x;const Xe=F.tileID.canonical.y-u.tileID.canonical.y,Vi=Math.pow(2,u.tileID.canonical.z),fr=F.tileID.key;0===Wt&&0===Xe||Math.abs(Xe)>1||(Math.abs(Wt)>1&&(1===Math.abs(Wt+Vi)?Wt+=Vi:1===Math.abs(Wt-Vi)&&(Wt-=Vi)),F.dem&&u.dem&&(u.dem.backfillBorder(F.dem,Wt,Xe),u.neighboringTiles&&u.neighboringTiles[fr]&&(u.neighboringTiles[fr].backfilled=!0)))}}getTile(u){return this.getTileByID(u.key)}getTileByID(u){return this._tiles[u]}_retainLoadedChildren(u,F,Wt,Xe){for(const Vi in this._tiles){let fr=this._tiles[Vi];if(Xe[Vi]||!fr.hasData()||fr.tileID.overscaledZ<=F||fr.tileID.overscaledZ>Wt)continue;let _r=fr.tileID;for(;fr&&fr.tileID.overscaledZ>F+1;){const u=fr.tileID.scaledTo(fr.tileID.overscaledZ-1);fr=this._tiles[u.key],fr&&fr.hasData()&&(_r=u)}let wr=_r;for(;wr.overscaledZ>F;)if(wr=wr.scaledTo(wr.overscaledZ-1),u[wr.key]){Xe[_r.key]=_r;break}}}findLoadedParent(u,F){if(u.key in this._loadedParentTiles){const Wt=this._loadedParentTiles[u.key];return Wt&&Wt.tileID.overscaledZ>=F?Wt:null}for(let Wt=u.overscaledZ-1;Wt>=F;Wt--){const F=u.scaledTo(Wt),Xe=this._getLoadedTile(F);if(Xe)return Xe}}findLoadedSibling(u){return this._getLoadedTile(u)}_getLoadedTile(u){const F=this._tiles[u.key];return F&&F.hasData()?F:this._cache.getByKey(u.wrapped().key)}updateCacheSize(u){const F=Math.ceil(u.width/this._source.tileSize)+1,Xe=Math.ceil(u.height/this._source.tileSize)+1,Vi=Math.floor(F*Xe*(null===this._maxTileCacheZoomLevels?Wt.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),fr="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,Vi):Vi;this._cache.setMaxSize(fr)}handleWrapJump(u){const F=Math.round((u-(void 0===this._prevLng?u:this._prevLng))/360);if(this._prevLng=u,F){const u={};for(const Wt in this._tiles){const Xe=this._tiles[Wt];Xe.tileID=Xe.tileID.unwrapTo(Xe.tileID.wrap+F),u[Xe.tileID.key]=Xe}this._tiles=u;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(u,F,Wt,Xe,Vi,fr){const wr={},Ar={},Kr=Object.keys(u),In=_r.now();for(const Wt of Kr){const Xe=u[Wt],Vi=this._tiles[Wt];if(!Vi||0!==Vi.fadeEndTime&&Vi.fadeEndTime<=In)continue;const fr=this.findLoadedParent(Xe,F),_r=this.findLoadedSibling(Xe),Kr=fr||_r||null;Kr&&(this._addTile(Kr.tileID),wr[Kr.tileID.key]=Kr.tileID),Ar[Wt]=Xe}this._retainLoadedChildren(Ar,Xe,Wt,u);for(const F in wr)u[F]||(this._coveredTiles[F]=!0,u[F]=wr[F]);if(fr){const F={},Wt={};for(const u of Vi)this._tiles[u.key].hasData()?F[u.key]=u:Wt[u.key]=u;for(const Xe in Wt){const Vi=Wt[Xe].children(this._source.maxzoom);this._tiles[Vi[0].key]&&this._tiles[Vi[1].key]&&this._tiles[Vi[2].key]&&this._tiles[Vi[3].key]&&(F[Vi[0].key]=u[Vi[0].key]=Vi[0],F[Vi[1].key]=u[Vi[1].key]=Vi[1],F[Vi[2].key]=u[Vi[2].key]=Vi[2],F[Vi[3].key]=u[Vi[3].key]=Vi[3],delete Wt[Xe])}for(const Xe in Wt){const Vi=Wt[Xe],fr=this.findLoadedParent(Vi,this._source.minzoom),_r=this.findLoadedSibling(Vi),wr=fr||_r||null;if(wr){F[wr.tileID.key]=u[wr.tileID.key]=wr.tileID;for(const u in F)F[u].isChildOf(wr.tileID)&&delete F[u]}}for(const u in this._tiles)F[u]||(this._coveredTiles[u]=!0)}}update(u,F){if(!this._sourceLoaded||this._paused)return;let Xe;this.transform=u,this.terrain=F,this.updateCacheSize(u),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?Xe=u.getVisibleUnwrappedCoordinates(this._source.tileID).map((u=>new Wt.S(u.canonical.z,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y))):(Xe=u.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:F}),this._source.hasTile&&(Xe=Xe.filter((u=>this._source.hasTile(u))))):Xe=[];const Vi=u.coveringZoomLevel(this._source),fr=Math.max(Vi-ut.maxOverzooming,this._source.minzoom),_r=Math.max(Vi+ut.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const u={};for(const F of Xe)if(F.canonical.z>this._source.minzoom){const Wt=F.scaledTo(F.canonical.z-1);u[Wt.key]=Wt;const Xe=F.scaledTo(Math.max(this._source.minzoom,Math.min(F.canonical.z,5)));u[Xe.key]=Xe}Xe=Xe.concat(Object.values(u))}const wr=0===Xe.length&&!this._updated&&this._didEmitContent;this._updated=!0,wr&&this.fire(new Wt.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const Ar=this._updateRetainedTiles(Xe,Vi);_t(this._source.type)&&this._updateCoveredAndRetainedTiles(Ar,fr,_r,Vi,Xe,F);for(const u in Ar)this._tiles[u].clearFadeHold();const Kr=Wt.ab(this._tiles,Ar);for(const u of Kr){const F=this._tiles[u];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(u)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const u in this._tiles)this._tiles[u].holdingForFade()&&this._removeTile(u)}_updateRetainedTiles(u,F){var Wt;const Xe={},Vi={},fr=Math.max(F-ut.maxOverzooming,this._source.minzoom),_r=Math.max(F+ut.maxUnderzooming,this._source.minzoom),wr={};for(const Wt of u){const u=this._addTile(Wt);Xe[Wt.key]=Wt,u.hasData()||F<this._source.maxzoom&&(wr[Wt.key]=Wt)}this._retainLoadedChildren(wr,F,_r,Xe);for(const _r of u){let u=this._tiles[_r.key];if(u.hasData())continue;if(F+1>this._source.maxzoom){const u=_r.children(this._source.maxzoom)[0],F=this.getTile(u);if(F&&F.hasData()){Xe[u.key]=u;continue}}else{const u=_r.children(this._source.maxzoom);if(Xe[u[0].key]&&Xe[u[1].key]&&Xe[u[2].key]&&Xe[u[3].key])continue}let wr=u.wasRequested();for(let F=_r.overscaledZ-1;F>=fr;--F){const fr=_r.scaledTo(F);if(Vi[fr.key])break;if(Vi[fr.key]=!0,u=this.getTile(fr),!u&&wr&&(u=this._addTile(fr)),u){const F=u.hasData();if((F||!(null===(Wt=this.map)||void 0===Wt?void 0:Wt.cancelPendingTileRequestsWhileZooming)||wr)&&(Xe[fr.key]=fr),wr=u.wasRequested(),F)break}}}return Xe}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const u in this._tiles){const F=[];let Wt,Xe=this._tiles[u].tileID;for(;Xe.overscaledZ>0;){if(Xe.key in this._loadedParentTiles){Wt=this._loadedParentTiles[Xe.key];break}F.push(Xe.key);const u=Xe.scaledTo(Xe.overscaledZ-1);if(Wt=this._getLoadedTile(u),Wt)break;Xe=u}for(const u of F)this._loadedParentTiles[u]=Wt}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const u in this._tiles){const F=this._tiles[u].tileID,Wt=this._getLoadedTile(F);this._loadedSiblingTiles[F.key]=Wt}}_addTile(u){let F=this._tiles[u.key];if(F)return F;F=this._cache.getAndRemove(u),F&&(this._setTileReloadTimer(u.key,F),F.tileID=u,this._state.initializeTileState(F,this.map?this.map.painter:null),this._cacheTimers[u.key]&&(clearTimeout(this._cacheTimers[u.key]),delete this._cacheTimers[u.key],this._setTileReloadTimer(u.key,F)));const Xe=F;return F||(F=new lt(u,this._source.tileSize*u.overscaleFactor()),this._loadTile(F,u.key,F.state)),F.uses++,this._tiles[u.key]=F,Xe||this._source.fire(new Wt.k("dataloading",{tile:F,coord:F.tileID,dataType:"source"})),F}_setTileReloadTimer(u,F){u in this._timers&&(clearTimeout(this._timers[u]),delete this._timers[u]);const Wt=F.getExpiryTimeout();Wt&&(this._timers[u]=setTimeout((()=>{this._reloadTile(u,"expired"),delete this._timers[u]}),Wt))}_removeTile(u){const F=this._tiles[u];F&&(F.uses--,delete this._tiles[u],this._timers[u]&&(clearTimeout(this._timers[u]),delete this._timers[u]),F.uses>0||(F.hasData()&&"reloading"!==F.state?this._cache.add(F.tileID,F,F.getExpiryTimeout()):(F.aborted=!0,this._abortTile(F),this._unloadTile(F))))}_dataHandler(u){const F=u.sourceDataType;"source"===u.dataType&&"metadata"===F&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===F&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const u in this._tiles)this._removeTile(u);this._cache.reset()}tilesIn(u,F,Xe){const Vi=[],fr=this.transform;if(!fr)return Vi;const _r=Xe?fr.getCameraQueryGeometry(u):u,wr=u.map((u=>fr.pointCoordinate(u,this.terrain))),Ar=_r.map((u=>fr.pointCoordinate(u,this.terrain))),Kr=this.getIds();let In=1/0,ns=1/0,ca=-1/0,ha=-1/0;for(const u of Ar)In=Math.min(In,u.x),ns=Math.min(ns,u.y),ca=Math.max(ca,u.x),ha=Math.max(ha,u.y);for(let u=0;u<Kr.length;u++){const Xe=this._tiles[Kr[u]];if(Xe.holdingForFade())continue;const _r=Xe.tileID,ua=Math.pow(2,fr.zoom-Xe.tileID.overscaledZ),Da=F*Xe.queryPadding*Wt.X/Xe.tileSize/ua,io=[_r.getTilePoint(new Wt.Z(In,ns)),_r.getTilePoint(new Wt.Z(ca,ha))];if(io[0].x-Da<Wt.X&&io[0].y-Da<Wt.X&&io[1].x+Da>=0&&io[1].y+Da>=0){const u=wr.map((u=>_r.getTilePoint(u))),F=Ar.map((u=>_r.getTilePoint(u)));Vi.push({tile:Xe,tileID:_r,queryGeometry:u,cameraQueryGeometry:F,scale:ua})}}return Vi}getVisibleCoordinates(u){const F=this.getRenderableIds(u).map((u=>this._tiles[u].tileID));for(const u of F)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return F}hasTransition(){if(this._source.hasTransition())return!0;if(_t(this._source.type)){const u=_r.now();for(const F in this._tiles)if(this._tiles[F].fadeEndTime>=u)return!0}return!1}setFeatureState(u,F,Wt){this._state.updateState(u=u||"_geojsonTileLayer",F,Wt)}removeFeatureState(u,F,Wt){this._state.removeFeatureState(u=u||"_geojsonTileLayer",F,Wt)}getFeatureState(u,F){return this._state.getState(u=u||"_geojsonTileLayer",F)}setDependencies(u,F,Wt){const Xe=this._tiles[u];Xe&&Xe.setDependencies(F,Wt)}reloadTilesForDependencies(u,F){for(const Wt in this._tiles)this._tiles[Wt].hasDependency(u,F)&&this._reloadTile(Wt,"reloading");this._cache.filter((Wt=>!Wt.hasDependency(u,F)))}}function dt(u,F){const Wt=Math.abs(2*u.wrap)-+(u.wrap<0),Xe=Math.abs(2*F.wrap)-+(F.wrap<0);return u.overscaledZ-F.overscaledZ||Xe-Wt||F.canonical.y-u.canonical.y||F.canonical.x-u.canonical.x}function _t(u){return"raster"===u||"image"===u||"video"===u}ut.maxOverzooming=10,ut.maxUnderzooming=3;class pt{constructor(u,F){this.reset(u,F)}reset(u,F){this.points=u||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(F||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(u){if(1===this.points.length)return this.points[0];u=Wt.ac(u,0,1);let F=1,Xe=this._distances[F];const Vi=u*this.paddedLength+this.padding;for(;Xe<Vi&&F<this._distances.length;)Xe=this._distances[++F];const fr=F-1,_r=this._distances[fr],wr=Xe-_r,Ar=wr>0?(Vi-_r)/wr:0;return this.points[fr].mult(1-Ar).add(this.points[F].mult(Ar))}}function mt(u,F){let Wt=!0;return"always"===u||"never"!==u&&"never"!==F||(Wt=!1),Wt}class ft{constructor(u,F,Wt){const Xe=this.boxCells=[],Vi=this.circleCells=[];this.xCellCount=Math.ceil(u/Wt),this.yCellCount=Math.ceil(F/Wt);for(let u=0;u<this.xCellCount*this.yCellCount;u++)Xe.push([]),Vi.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=u,this.height=F,this.xScale=this.xCellCount/u,this.yScale=this.yCellCount/F,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(u,F,Wt,Xe,Vi){this._forEachCell(F,Wt,Xe,Vi,this._insertBoxCell,this.boxUid++),this.boxKeys.push(u),this.bboxes.push(F),this.bboxes.push(Wt),this.bboxes.push(Xe),this.bboxes.push(Vi)}insertCircle(u,F,Wt,Xe){this._forEachCell(F-Xe,Wt-Xe,F+Xe,Wt+Xe,this._insertCircleCell,this.circleUid++),this.circleKeys.push(u),this.circles.push(F),this.circles.push(Wt),this.circles.push(Xe)}_insertBoxCell(u,F,Wt,Xe,Vi,fr){this.boxCells[Vi].push(fr)}_insertCircleCell(u,F,Wt,Xe,Vi,fr){this.circleCells[Vi].push(fr)}_query(u,F,Wt,Xe,Vi,fr,_r){if(Wt<0||u>this.width||Xe<0||F>this.height)return[];const wr=[];if(u<=0&&F<=0&&this.width<=Wt&&this.height<=Xe){if(Vi)return[{key:null,x1:u,y1:F,x2:Wt,y2:Xe}];for(let u=0;u<this.boxKeys.length;u++)wr.push({key:this.boxKeys[u],x1:this.bboxes[4*u],y1:this.bboxes[4*u+1],x2:this.bboxes[4*u+2],y2:this.bboxes[4*u+3]});for(let u=0;u<this.circleKeys.length;u++){const F=this.circles[3*u],Wt=this.circles[3*u+1],Xe=this.circles[3*u+2];wr.push({key:this.circleKeys[u],x1:F-Xe,y1:Wt-Xe,x2:F+Xe,y2:Wt+Xe})}}else this._forEachCell(u,F,Wt,Xe,this._queryCell,wr,{hitTest:Vi,overlapMode:fr,seenUids:{box:{},circle:{}}},_r);return wr}query(u,F,Wt,Xe){return this._query(u,F,Wt,Xe,!1,null)}hitTest(u,F,Wt,Xe,Vi,fr){return this._query(u,F,Wt,Xe,!0,Vi,fr).length>0}hitTestCircle(u,F,Wt,Xe,Vi){const fr=u-Wt,_r=u+Wt,wr=F-Wt,Ar=F+Wt;if(_r<0||fr>this.width||Ar<0||wr>this.height)return!1;const Kr=[];return this._forEachCell(fr,wr,_r,Ar,this._queryCellCircle,Kr,{hitTest:!0,overlapMode:Xe,circle:{x:u,y:F,radius:Wt},seenUids:{box:{},circle:{}}},Vi),Kr.length>0}_queryCell(u,F,Wt,Xe,Vi,fr,_r,wr){const{seenUids:Ar,hitTest:Kr,overlapMode:In}=_r,ns=this.boxCells[Vi];if(null!==ns){const Vi=this.bboxes;for(const _r of ns)if(!Ar.box[_r]){Ar.box[_r]=!0;const ns=4*_r,ca=this.boxKeys[_r];if(u<=Vi[ns+2]&&F<=Vi[ns+3]&&Wt>=Vi[ns+0]&&Xe>=Vi[ns+1]&&(!wr||wr(ca))&&(!Kr||!mt(In,ca.overlapMode))&&(fr.push({key:ca,x1:Vi[ns],y1:Vi[ns+1],x2:Vi[ns+2],y2:Vi[ns+3]}),Kr))return!0}}const ca=this.circleCells[Vi];if(null!==ca){const Vi=this.circles;for(const _r of ca)if(!Ar.circle[_r]){Ar.circle[_r]=!0;const ns=3*_r,ca=this.circleKeys[_r];if(this._circleAndRectCollide(Vi[ns],Vi[ns+1],Vi[ns+2],u,F,Wt,Xe)&&(!wr||wr(ca))&&(!Kr||!mt(In,ca.overlapMode))){const u=Vi[ns],F=Vi[ns+1],Wt=Vi[ns+2];if(fr.push({key:ca,x1:u-Wt,y1:F-Wt,x2:u+Wt,y2:F+Wt}),Kr)return!0}}}return!1}_queryCellCircle(u,F,Wt,Xe,Vi,fr,_r,wr){const{circle:Ar,seenUids:Kr,overlapMode:In}=_r,ns=this.boxCells[Vi];if(null!==ns){const u=this.bboxes;for(const F of ns)if(!Kr.box[F]){Kr.box[F]=!0;const Wt=4*F,Xe=this.boxKeys[F];if(this._circleAndRectCollide(Ar.x,Ar.y,Ar.radius,u[Wt+0],u[Wt+1],u[Wt+2],u[Wt+3])&&(!wr||wr(Xe))&&!mt(In,Xe.overlapMode))return fr.push(!0),!0}}const ca=this.circleCells[Vi];if(null!==ca){const u=this.circles;for(const F of ca)if(!Kr.circle[F]){Kr.circle[F]=!0;const Wt=3*F,Xe=this.circleKeys[F];if(this._circlesCollide(u[Wt],u[Wt+1],u[Wt+2],Ar.x,Ar.y,Ar.radius)&&(!wr||wr(Xe))&&!mt(In,Xe.overlapMode))return fr.push(!0),!0}}}_forEachCell(u,F,Wt,Xe,Vi,fr,_r,wr){const Ar=this._convertToXCellCoord(u),Kr=this._convertToYCellCoord(F),In=this._convertToXCellCoord(Wt),ns=this._convertToYCellCoord(Xe);for(let ca=Ar;ca<=In;ca++)for(let Ar=Kr;Ar<=ns;Ar++)if(Vi.call(this,u,F,Wt,Xe,this.xCellCount*Ar+ca,fr,_r,wr))return}_convertToXCellCoord(u){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(u*this.xScale)))}_convertToYCellCoord(u){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(u*this.yScale)))}_circlesCollide(u,F,Wt,Xe,Vi,fr){const _r=Xe-u,wr=Vi-F,Ar=Wt+fr;return Ar*Ar>_r*_r+wr*wr}_circleAndRectCollide(u,F,Wt,Xe,Vi,fr,_r){const wr=(fr-Xe)/2,Ar=Math.abs(u-(Xe+wr));if(Ar>wr+Wt)return!1;const Kr=(_r-Vi)/2,In=Math.abs(F-(Vi+Kr));if(In>Kr+Wt)return!1;if(Ar<=wr||In<=Kr)return!0;const ns=Ar-wr,ca=In-Kr;return ns*ns+ca*ca<=Wt*Wt}}function gt(u,F,Xe,Vi,fr){const _r=Wt.H();return F?(Wt.K(_r,_r,[1/fr,1/fr,1]),Xe||Wt.ad(_r,_r,Vi.angle)):Wt.L(_r,Vi.labelPlaneMatrix,u),_r}function vt(u,F,Xe,Vi,fr){if(F){const F=Wt.ae(u);return Wt.K(F,F,[fr,fr,1]),Xe||Wt.ad(F,F,-Vi.angle),F}return Vi.glCoordMatrix}function xt(u,F,Xe,Vi){let fr;Vi?(fr=[u,F,Vi(u,F),1],Wt.af(fr,fr,Xe)):(fr=[u,F,0,1],kt(fr,fr,Xe));const _r=fr[3];return{point:new Wt.P(fr[0]/_r,fr[1]/_r),signedDistanceFromCamera:_r,isOccluded:!1}}function yt(u,F){return.5+u/F*.5}function bt(u,F){return u.x>=-F[0]&&u.x<=F[0]&&u.y>=-F[1]&&u.y<=F[1]}function wt(u,F,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua,Da){const io=Vi?u.textSizeData:u.iconSizeData,no=Wt.ag(io,Xe.transform.zoom),so=[256/Xe.width*2+1,256/Xe.height*2+1],ao=Vi?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;ao.clear();const oo=u.lineVertexArray,co=Vi?u.text.placedSymbolArray:u.icon.placedSymbolArray,ho=Xe.transform.width/Xe.transform.height;let go=!1;for(let Vi=0;Vi<co.length;Vi++){const xo=co.get(Vi);if(xo.hidden||xo.writingMode===Wt.ah.vertical&&!go){Rt(xo.numGlyphs,ao);continue}go=!1;const Io=xt(xo.anchorX,xo.anchorY,F,Da);if(!bt(Io.point,so)){Rt(xo.numGlyphs,ao);continue}const ko=yt(Xe.transform.cameraToCenterDistance,Io.signedDistanceFromCamera),Co=Wt.ai(io,no,xo),zo=wr?Co/ko:Co*ko,Bo={getElevation:Da,labelPlaneMatrix:fr,lineVertexArray:oo,pitchWithMap:wr,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:In,tileAnchorPoint:new Wt.P(xo.anchorX,xo.anchorY),unwrappedTileID:ns,width:ca,height:ha,translation:ua},al=Et(Bo,xo,zo,!1,Ar,F,_r,u.glyphOffsetArray,ao,ho,Kr);go=al.useVertical,(al.notEnoughRoom||go||al.needsFlipping&&Et(Bo,xo,zo,!0,Ar,F,_r,u.glyphOffsetArray,ao,ho,Kr).notEnoughRoom)&&Rt(xo.numGlyphs,ao)}Vi?u.text.dynamicLayoutVertexBuffer.updateData(ao):u.icon.dynamicLayoutVertexBuffer.updateData(ao)}function Tt(u,F,Wt,Xe,Vi,fr,_r,wr){const Ar=fr.glyphStartIndex+fr.numGlyphs,Kr=fr.lineStartIndex,In=fr.lineStartIndex+fr.lineLength,ns=F.getoffsetX(fr.glyphStartIndex),ca=F.getoffsetX(Ar-1),ha=Mt(u*ns,Wt,Xe,Vi,fr.segment,Kr,In,wr,_r);if(!ha)return null;const ua=Mt(u*ca,Wt,Xe,Vi,fr.segment,Kr,In,wr,_r);return ua?wr.projectionCache.anyProjectionOccluded?null:{first:ha,last:ua}:null}function It(u,F,Xe,Vi){return u===Wt.ah.horizontal&&Math.abs(Xe.y-F.y)>Math.abs(Xe.x-F.x)*Vi?{useVertical:!0}:(u===Wt.ah.vertical?F.y<Xe.y:F.x>Xe.x)?{needsFlipping:!0}:null}function Et(u,F,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns){const ca=Xe/24,ha=F.lineOffsetX*ca,ua=F.lineOffsetY*ca;let Da;if(F.numGlyphs>1){const Wt=F.glyphStartIndex+F.numGlyphs,Xe=F.lineStartIndex,_r=F.lineStartIndex+F.lineLength,Kr=Tt(ca,Ar,ha,ua,Vi,F,ns,u);if(!Kr)return{notEnoughRoom:!0};const io=xt(Kr.first.point.x,Kr.first.point.y,wr,u.getElevation).point,no=xt(Kr.last.point.x,Kr.last.point.y,wr,u.getElevation).point;if(fr&&!Vi){const u=It(F.writingMode,io,no,In);if(u)return u}Da=[Kr.first];for(let fr=F.glyphStartIndex+1;fr<Wt-1;fr++)Da.push(Mt(ca*Ar.getoffsetX(fr),ha,ua,Vi,F.segment,Xe,_r,u,ns));Da.push(Kr.last)}else{if(fr&&!Vi){const Xe=xt(u.tileAnchorPoint.x,u.tileAnchorPoint.y,_r,u.getElevation).point,Vi=F.lineStartIndex+F.segment+1,fr=new Wt.P(u.lineVertexArray.getx(Vi),u.lineVertexArray.gety(Vi)),wr=xt(fr.x,fr.y,_r,u.getElevation),Ar=wr.signedDistanceFromCamera>0?wr.point:function(u,F,Wt,Xe,Vi,fr){return Pt(u,F,Wt,1,Vi,fr)}(u.tileAnchorPoint,fr,Xe,0,_r,u),Kr=It(F.writingMode,Xe,Ar,In);if(Kr)return Kr}const Xe=Mt(ca*Ar.getoffsetX(F.glyphStartIndex),ha,ua,Vi,F.segment,F.lineStartIndex,F.lineStartIndex+F.lineLength,u,ns);if(!Xe||u.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Da=[Xe]}for(const u of Da)Wt.aj(Kr,u.point,u.angle);return{}}function Pt(u,F,Wt,Xe,Vi,fr){const _r=u.add(u.sub(F)._unit()),wr=void 0!==Vi?xt(_r.x,_r.y,Vi,fr.getElevation).point:St(_r.x,_r.y,fr).point,Ar=Wt.sub(wr);return Wt.add(Ar._mult(Xe/Ar.mag()))}function Ct(u,F,Xe){const Vi=F.projectionCache;if(Vi.projections[u])return Vi.projections[u];const fr=new Wt.P(F.lineVertexArray.getx(u),F.lineVertexArray.gety(u)),_r=St(fr.x,fr.y,F);if(_r.signedDistanceFromCamera>0)return Vi.projections[u]=_r.point,Vi.anyProjectionOccluded=Vi.anyProjectionOccluded||_r.isOccluded,_r.point;const wr=u-Xe.direction;return function(u,F,Wt,Xe,Vi){return Pt(u,F,Wt,Xe,void 0,Vi)}(0===Xe.distanceFromAnchor?F.tileAnchorPoint:new Wt.P(F.lineVertexArray.getx(wr),F.lineVertexArray.gety(wr)),fr,Xe.previousVertex,Xe.absOffsetX-Xe.distanceFromAnchor+1,F)}function St(u,F,Wt){const Xe=u+Wt.translation[0],Vi=F+Wt.translation[1];let fr;return!Wt.pitchWithMap&&Wt.projection.useSpecialProjectionForSymbols?(fr=Wt.projection.projectTileCoordinates(Xe,Vi,Wt.unwrappedTileID,Wt.getElevation),fr.point.x=(.5*fr.point.x+.5)*Wt.width,fr.point.y=(.5*-fr.point.y+.5)*Wt.height):(fr=xt(Xe,Vi,Wt.labelPlaneMatrix,Wt.getElevation),fr.isOccluded=!1),fr}function zt(u,F,Wt){return u._unit()._perp()._mult(F*Wt)}function Dt(u,F,Xe,Vi,fr,_r,wr,Ar,Kr){if(Ar.projectionCache.offsets[u])return Ar.projectionCache.offsets[u];const In=Xe.add(F);if(u+Kr.direction<Vi||u+Kr.direction>=fr)return Ar.projectionCache.offsets[u]=In,In;const ns=Ct(u+Kr.direction,Ar,Kr),ca=zt(ns.sub(Xe),wr,Kr.direction),ha=Xe.add(ca),ua=ns.add(ca);return Ar.projectionCache.offsets[u]=Wt.ak(_r,In,ha,ua)||In,Ar.projectionCache.offsets[u]}function Mt(u,F,Wt,Xe,Vi,fr,_r,wr,Ar){const Kr=Xe?u-F:u+F;let In=Kr>0?1:-1,ns=0;Xe&&(In*=-1,ns=Math.PI),In<0&&(ns+=Math.PI);let ca,ha=In>0?fr+Vi:fr+Vi+1;wr.projectionCache.cachedAnchorPoint?ca=wr.projectionCache.cachedAnchorPoint:(ca=St(wr.tileAnchorPoint.x,wr.tileAnchorPoint.y,wr).point,wr.projectionCache.cachedAnchorPoint=ca);let ua,Da,io=ca,no=ca,so=0,ao=0;const oo=Math.abs(Kr),co=[];let ho;for(;so+ao<=oo;){if(ha+=In,ha<fr||ha>=_r)return null;so+=ao,no=io,Da=ua;const u={absOffsetX:oo,direction:In,distanceFromAnchor:so,previousVertex:no};if(io=Ct(ha,wr,u),0===Wt)co.push(no),ho=io.sub(no);else{let F;const Xe=io.sub(no);F=0===Xe.mag()?zt(Ct(ha+In,wr,u).sub(io),Wt,In):zt(Xe,Wt,In),Da||(Da=no.add(F)),ua=Dt(ha,F,io,fr,_r,Da,Wt,wr,u),co.push(Da),ho=ua.sub(Da)}ao=ho.mag()}const go=ho._mult((oo-so)/ao)._add(Da||no),xo=ns+Math.atan2(io.y-no.y,io.x-no.x);return co.push(go),{point:go,angle:Ar?xo:0,path:co}}const Io=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Rt(u,F){for(let Wt=0;Wt<u;Wt++){const u=F.length;F.resize(u+4),F.float32.set(Io,3*u)}}function kt(u,F,Wt){const Xe=F[0],Vi=F[1];return u[0]=Wt[0]*Xe+Wt[4]*Vi+Wt[12],u[1]=Wt[1]*Xe+Wt[5]*Vi+Wt[13],u[3]=Wt[3]*Xe+Wt[7]*Vi+Wt[15],u}const ko=100;class Ft{constructor(u,F,Wt=new ft(u.width+200,u.height+200,25),Xe=new ft(u.width+200,u.height+200,25)){this.transform=u,this.mapProjection=F,this.grid=Wt,this.ignoredGrid=Xe,this.pitchFactor=Math.cos(u._pitch)*u.cameraToCenterDistance,this.screenRightBoundary=u.width+ko,this.screenBottomBoundary=u.height+ko,this.gridRightBoundary=u.width+200,this.gridBottomBoundary=u.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In){const ns=u.anchorPointX+wr[0],ca=u.anchorPointY+wr[1],ha=this.projectAndGetPerspectiveRatio(Xe,ns,ca,Vi,Kr),ua=Wt*ha.perspectiveRatio;let Da;if(fr||_r)Da=this._projectCollisionBox(u,ua,Xe,Vi,fr,_r,wr,ha,Kr,In);else{const F=ha.point.x+(In?In.x*ua:0),Wt=ha.point.y+(In?In.y*ua:0);Da={allPointsOccluded:!1,box:[F+u.x1*ua,Wt+u.y1*ua,F+u.x2*ua,Wt+u.y2*ua]}}const[io,no,so,ao]=Da.box;return this.mapProjection.useSpecialProjectionForSymbols&&(fr?Da.allPointsOccluded:this.mapProjection.isOccluded(ns,ca,Vi))||ha.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(io,no,so,ao)||"always"!==F&&this.grid.hitTest(io,no,so,ao,F,Ar)?{box:[io,no,so,ao],placeable:!1,offscreen:!1}:{box:[io,no,so,ao],placeable:!0,offscreen:this.isOffscreen(io,no,so,ao)}}placeCollisionCircles(u,F,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua,Da,io){const no=[],so=new Wt.P(F.anchorX,F.anchorY),ao=this.getPerspectiveRatio(_r,so.x,so.y,wr,io),oo=(ns?fr/ao:fr*ao)/Wt.ap,co={getElevation:io,labelPlaneMatrix:Ar,lineVertexArray:Xe,pitchWithMap:ns,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:so,unwrappedTileID:wr,width:this.transform.width,height:this.transform.height,translation:Da},ho=Tt(oo,Vi,F.lineOffsetX*oo,F.lineOffsetY*oo,!1,F,!1,co);let go=!1,xo=!1,Io=!0;if(ho){const F=.5*ha*ao+ua,Xe=new Wt.P(-100,-100),Vi=new Wt.P(this.screenRightBoundary,this.screenBottomBoundary),fr=new pt,_r=ho.first,wr=ho.last;let Ar=[];for(let u=_r.path.length-1;u>=1;u--)Ar.push(_r.path[u]);for(let u=1;u<wr.path.length;u++)Ar.push(wr.path[u]);const ns=2.5*F;if(Kr){const u=this.projectPathToScreenSpace(Ar,co,Kr);Ar=u.some((u=>u.signedDistanceFromCamera<=0))?[]:u.map((u=>u.point))}let Da=[];if(Ar.length>0){const u=Ar[0].clone(),F=Ar[0].clone();for(let Wt=1;Wt<Ar.length;Wt++)u.x=Math.min(u.x,Ar[Wt].x),u.y=Math.min(u.y,Ar[Wt].y),F.x=Math.max(F.x,Ar[Wt].x),F.y=Math.max(F.y,Ar[Wt].y);Da=u.x>=Xe.x&&F.x<=Vi.x&&u.y>=Xe.y&&F.y<=Vi.y?[Ar]:F.x<Xe.x||u.x>Vi.x||F.y<Xe.y||u.y>Vi.y?[]:Wt.al([Ar],Xe.x,Xe.y,Vi.x,Vi.y)}for(const Wt of Da){fr.reset(Wt,.25*F);let Xe=0;Xe=fr.length<=.5*F?1:Math.ceil(fr.paddedLength/ns)+1;for(let Wt=0;Wt<Xe;Wt++){const Vi=Wt/Math.max(Xe-1,1),_r=fr.lerp(Vi),wr=_r.x+ko,Ar=_r.y+ko;no.push(wr,Ar,F,0);const Kr=wr-F,ns=Ar-F,ha=wr+F,ua=Ar+F;if(Io=Io&&this.isOffscreen(Kr,ns,ha,ua),xo=xo||this.isInsideGrid(Kr,ns,ha,ua),"always"!==u&&this.grid.hitTestCircle(wr,Ar,F,u,ca)&&(go=!0,!In))return{circles:[],offscreen:!1,collisionDetected:go}}}}return{circles:!In&&go||!xo||ao<this.perspectiveRatioCutoff?[]:no,offscreen:Io,collisionDetected:go}}projectPathToScreenSpace(u,F,Wt){return u.map((u=>xt(u.x,u.y,Wt,F.getElevation)))}queryRenderedSymbols(u){if(0===u.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const F=[];let Xe=1/0,Vi=1/0,fr=-1/0,_r=-1/0;for(const wr of u){const u=new Wt.P(wr.x+ko,wr.y+ko);Xe=Math.min(Xe,u.x),Vi=Math.min(Vi,u.y),fr=Math.max(fr,u.x),_r=Math.max(_r,u.y),F.push(u)}const wr=this.grid.query(Xe,Vi,fr,_r).concat(this.ignoredGrid.query(Xe,Vi,fr,_r)),Ar={},Kr={};for(const u of wr){const Xe=u.key;if(void 0===Ar[Xe.bucketInstanceId]&&(Ar[Xe.bucketInstanceId]={}),Ar[Xe.bucketInstanceId][Xe.featureIndex])continue;const Vi=[new Wt.P(u.x1,u.y1),new Wt.P(u.x2,u.y1),new Wt.P(u.x2,u.y2),new Wt.P(u.x1,u.y2)];Wt.am(F,Vi)&&(Ar[Xe.bucketInstanceId][Xe.featureIndex]=!0,void 0===Kr[Xe.bucketInstanceId]&&(Kr[Xe.bucketInstanceId]=[]),Kr[Xe.bucketInstanceId].push(Xe.featureIndex))}return Kr}insertCollisionBox(u,F,Wt,Xe,Vi,fr){(Wt?this.ignoredGrid:this.grid).insert({bucketInstanceId:Xe,featureIndex:Vi,collisionGroupID:fr,overlapMode:F},u[0],u[1],u[2],u[3])}insertCollisionCircles(u,F,Wt,Xe,Vi,fr){const _r=Wt?this.ignoredGrid:this.grid,wr={bucketInstanceId:Xe,featureIndex:Vi,collisionGroupID:fr,overlapMode:F};for(let F=0;F<u.length;F+=4)_r.insertCircle(wr,u[F],u[F+1],u[F+2])}projectAndGetPerspectiveRatio(u,F,Xe,Vi,fr){let _r;fr?(_r=[F,Xe,fr(F,Xe),1],Wt.af(_r,_r,u)):(_r=[F,Xe,0,1],kt(_r,_r,u));const wr=_r[3];return{point:new Wt.P((_r[0]/wr+1)/2*this.transform.width+ko,(-_r[1]/wr+1)/2*this.transform.height+ko),perspectiveRatio:.5+this.transform.cameraToCenterDistance/wr*.5,isOccluded:!1,signedDistanceFromCamera:wr}}getPerspectiveRatio(u,F,Wt,Xe,Vi){const fr=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(F,Wt,Xe,Vi):xt(F,Wt,u,Vi);return.5+this.transform.cameraToCenterDistance/fr.signedDistanceFromCamera*.5}isOffscreen(u,F,Wt,Xe){return Wt<ko||u>=this.screenRightBoundary||Xe<ko||F>this.screenBottomBoundary}isInsideGrid(u,F,Wt,Xe){return Wt>=0&&u<this.gridRightBoundary&&Xe>=0&&F<this.gridBottomBoundary}getViewportMatrix(){const u=Wt.an([]);return Wt.J(u,u,[-100,-100,0]),u}_projectCollisionBox(u,F,Xe,Vi,fr,_r,wr,Ar,Kr,In){let ns=new Wt.P(1,0),ca=new Wt.P(0,1);const ha=new Wt.P(u.anchorPointX+wr[0],u.anchorPointY+wr[1]);if(_r&&!fr){const u=this.projectAndGetPerspectiveRatio(Xe,ha.x+1,ha.y,Vi,Kr).point.sub(Ar.point).unit(),F=Math.atan(u.y/u.x)+(u.x<0?Math.PI:0),fr=Math.sin(F),_r=Math.cos(F);ns=new Wt.P(_r,fr),ca=new Wt.P(-fr,_r)}else if(!_r&&fr){const u=-this.transform.angle,F=Math.sin(u),Xe=Math.cos(u);ns=new Wt.P(Xe,F),ca=new Wt.P(-F,Xe)}let ua=Ar.point,Da=F;if(fr){ua=ha;const u=this.transform.zoom-Math.floor(this.transform.zoom);Da=Math.pow(2,-u),Da*=this.mapProjection.getPitchedTextCorrection(this.transform,ha,Vi),In||(Da*=Wt.ac(.5+Ar.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}In&&(ua=ua.add(ns.mult(In.x*Da)).add(ca.mult(In.y*Da)));const io=u.x1*Da,no=u.x2*Da,so=(io+no)/2,ao=u.y1*Da,oo=u.y2*Da,co=(ao+oo)/2,ho=[{offsetX:io,offsetY:ao},{offsetX:so,offsetY:ao},{offsetX:no,offsetY:ao},{offsetX:no,offsetY:co},{offsetX:no,offsetY:oo},{offsetX:so,offsetY:oo},{offsetX:io,offsetY:oo},{offsetX:io,offsetY:co}];let go=[];for(const{offsetX:u,offsetY:F}of ho)go.push(new Wt.P(ua.x+ns.x*u+ca.x*F,ua.y+ns.y*u+ca.y*F));let xo=!1;if(fr){const u=go.map((u=>this.projectAndGetPerspectiveRatio(Xe,u.x,u.y,Vi,Kr)));xo=u.some((u=>!u.isOccluded)),go=u.map((u=>u.point))}else xo=!0;return{box:Wt.ao(go),allPointsOccluded:!xo}}}function Bt(u,F,Xe){return F*(Wt.X/(u.tileSize*Math.pow(2,Xe-u.tileID.overscaledZ)))}class Ot{constructor(u,F,Wt,Xe){this.opacity=u?Math.max(0,Math.min(1,u.opacity+(u.placed?F:-F))):Xe&&Wt?1:0,this.placed=Wt}isHidden(){return 0===this.opacity&&!this.placed}}class Nt{constructor(u,F,Wt,Xe,Vi){this.text=new Ot(u?u.text:null,F,Wt,Vi),this.icon=new Ot(u?u.icon:null,F,Xe,Vi)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ut{constructor(u,F,Wt){this.text=u,this.icon=F,this.skipFade=Wt}}class jt{constructor(){this.invProjMatrix=Wt.H(),this.viewportMatrix=Wt.H(),this.circles=[]}}class Zt{constructor(u,F,Wt,Xe,Vi){this.bucketInstanceId=u,this.featureIndex=F,this.sourceLayerIndex=Wt,this.bucketIndex=Xe,this.tileID=Vi}}class qt{constructor(u){this.crossSourceCollisions=u,this.maxGroupID=0,this.collisionGroups={}}get(u){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[u]){const F=++this.maxGroupID;this.collisionGroups[u]={ID:F,predicate:u=>u.collisionGroupID===F}}return this.collisionGroups[u]}}function Vt(u,F,Xe,Vi,fr){const{horizontalAlign:_r,verticalAlign:wr}=Wt.au(u);return new Wt.P(-(_r-.5)*F+Vi[0]*fr,-(wr-.5)*Xe+Vi[1]*fr)}class Gt{constructor(u,F,Wt,Xe,Vi,fr){this.transform=u.clone(),this.terrain=Wt,this.collisionIndex=new Ft(this.transform,F),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=Xe,this.retainedQueryData={},this.collisionGroups=new qt(Vi),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=fr,fr&&(fr.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(u){const F=this.terrain;return F?(Wt,Xe)=>F.getElevation(u,Wt,Xe):null}getBucketParts(u,F,Xe,Vi){const fr=Xe.getBucket(F),_r=Xe.latestFeatureIndex;if(!fr||!_r||F.id!==fr.layerIds[0])return;const wr=Xe.collisionBoxArray,Ar=fr.layers[0].layout,Kr=fr.layers[0].paint,In=Math.pow(2,this.transform.zoom-Xe.tileID.overscaledZ),ns=Xe.tileSize/Wt.X,ca=Xe.tileID.toUnwrapped(),ha=this.transform.calculatePosMatrix(ca),ua="map"===Ar.get("text-pitch-alignment"),Da="map"===Ar.get("text-rotation-alignment"),io=Bt(Xe,1,this.transform.zoom),no=this.collisionIndex.mapProjection.translatePosition(this.transform,Xe,Kr.get("text-translate"),Kr.get("text-translate-anchor")),so=this.collisionIndex.mapProjection.translatePosition(this.transform,Xe,Kr.get("icon-translate"),Kr.get("icon-translate-anchor")),ao=gt(ha,ua,Da,this.transform,io);let oo=null;if(ua){const u=vt(ha,ua,Da,this.transform,io);oo=Wt.L([],this.transform.labelPlaneMatrix,u)}this.retainedQueryData[fr.bucketInstanceId]=new Zt(fr.bucketInstanceId,_r,fr.sourceLayerIndex,fr.index,Xe.tileID);const co={bucket:fr,layout:Ar,translationText:no,translationIcon:so,posMatrix:ha,unwrappedTileID:ca,textLabelPlaneMatrix:ao,labelToScreenMatrix:oo,scale:In,textPixelRatio:ns,holdingForFade:Xe.holdingForFade(),collisionBoxArray:wr,partiallyEvaluatedTextSize:Wt.ag(fr.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(fr.sourceID)};if(Vi)for(const F of fr.sortKeyRanges){const{sortKey:Wt,symbolInstanceStart:Xe,symbolInstanceEnd:Vi}=F;u.push({sortKey:Wt,symbolInstanceStart:Xe,symbolInstanceEnd:Vi,parameters:co})}else u.push({symbolInstanceStart:0,symbolInstanceEnd:fr.symbolInstances.length,parameters:co})}attemptAnchorPlacement(u,F,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua,Da,io,no,so,ao){const oo=Wt.aq[u.textAnchor],co=[u.textOffset0,u.textOffset1],ho=Vt(oo,Xe,Vi,co,fr),go=this.collisionIndex.placeCollisionBox(F,ca,Ar,Kr,In,wr,_r,io,ns.predicate,ao,ho);if((!so||this.collisionIndex.placeCollisionBox(so,ca,Ar,Kr,In,wr,_r,no,ns.predicate,ao,ho).placeable)&&go.placeable){let u;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ha.crossTileID]&&this.prevPlacement.placements[ha.crossTileID]&&this.prevPlacement.placements[ha.crossTileID].text&&(u=this.prevPlacement.variableOffsets[ha.crossTileID].anchor),0===ha.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ha.crossTileID]={textOffset:co,width:Xe,height:Vi,anchor:oo,textBoxScale:fr,prevAnchor:u},this.markUsedJustification(ua,oo,ha,Da),ua.allowVerticalPlacement&&(this.markUsedOrientation(ua,Da,ha),this.placedOrientations[ha.crossTileID]=Da),{shift:ho,placedGlyphBoxes:go}}}placeLayerBucketPart(u,F,Xe){const{bucket:Vi,layout:fr,translationText:_r,translationIcon:wr,posMatrix:Ar,unwrappedTileID:Kr,textLabelPlaneMatrix:In,labelToScreenMatrix:ns,textPixelRatio:ca,holdingForFade:ha,collisionBoxArray:ua,partiallyEvaluatedTextSize:Da,collisionGroup:io}=u.parameters,no=fr.get("text-optional"),so=fr.get("icon-optional"),ao=Wt.ar(fr,"text-overlap","text-allow-overlap"),oo="always"===ao,co=Wt.ar(fr,"icon-overlap","icon-allow-overlap"),ho="always"===co,go="map"===fr.get("text-rotation-alignment"),xo="map"===fr.get("text-pitch-alignment"),Io="none"!==fr.get("icon-text-fit"),ko="viewport-y"===fr.get("symbol-z-order"),Co=oo&&(ho||!Vi.hasIconData()||so),zo=ho&&(oo||!Vi.hasTextData()||no);!Vi.collisionArrays&&ua&&Vi.deserializeCollisionBoxes(ua);const Bo=this._getTerrainElevationFunc(this.retainedQueryData[Vi.bucketInstanceId].tileID),D=(u,ua,ho)=>{var ko,al;if(F[u.crossTileID])return;if(ha)return void(this.placements[u.crossTileID]=new Ut(!1,!1,!1));let ol=!1,ll=!1,cl=!0,hl=null,dl={box:null,placeable:!1,offscreen:null},pl={box:null,placeable:!1,offscreen:null},fl=null,yl=null,vl=null,bl=0,Al=0,Ml=0;ua.textFeatureIndex?bl=ua.textFeatureIndex:u.useRuntimeCollisionCircles&&(bl=u.featureIndex),ua.verticalTextFeatureIndex&&(Al=ua.verticalTextFeatureIndex);const kl=ua.textBox;if(kl){const i=F=>{let Xe=Wt.ah.horizontal;if(Vi.allowVerticalPlacement&&!F&&this.prevPlacement){const F=this.prevPlacement.placedOrientations[u.crossTileID];F&&(this.placedOrientations[u.crossTileID]=F,Xe=F,this.markUsedOrientation(Vi,Xe,u))}return Xe},o=(F,Xe)=>{if(Vi.allowVerticalPlacement&&u.numVerticalGlyphVertices>0&&ua.verticalTextBox){for(const u of Vi.writingModes)if(u===Wt.ah.vertical?(dl=Xe(),pl=dl):dl=F(),dl&&dl.placeable)break}else dl=F()},F=u.textAnchorOffsetStartIndex,fr=u.textAnchorOffsetEndIndex;if(fr===F){const a=(F,Wt)=>{const Xe=this.collisionIndex.placeCollisionBox(F,ao,ca,Ar,Kr,xo,go,_r,io.predicate,Bo);return Xe&&Xe.placeable&&(this.markUsedOrientation(Vi,Wt,u),this.placedOrientations[u.crossTileID]=Wt),Xe};o((()=>a(kl,Wt.ah.horizontal)),(()=>{const F=ua.verticalTextBox;return Vi.allowVerticalPlacement&&u.numVerticalGlyphVertices>0&&F?a(F,Wt.ah.vertical):{box:null,offscreen:null}})),i(dl&&dl.placeable)}else{let In=Wt.aq[null===(al=null===(ko=this.prevPlacement)||void 0===ko?void 0:ko.variableOffsets[u.crossTileID])||void 0===al?void 0:al.anchor];const m=(ns,ha,ua)=>{const Da=ns.x2-ns.x1,no=ns.y2-ns.y1,so=u.textBoxScale,oo=Io&&"never"===co?ha:null;let ho=null,ko="never"===ao?1:2,Co="never";In&&ko++;for(let Wt=0;Wt<ko;Wt++){for(let Wt=F;Wt<fr;Wt++){const F=Vi.textAnchorOffsets.get(Wt);if(In&&F.textAnchor!==In)continue;const Xe=this.attemptAnchorPlacement(F,ns,Da,no,so,go,xo,ca,Ar,Kr,io,Co,u,Vi,ua,_r,wr,oo,Bo);if(Xe&&(ho=Xe.placedGlyphBoxes,ho&&ho.placeable))return ol=!0,hl=Xe.shift,ho}In?In=null:Co=ao}return Xe&&!ho&&(ho={box:this.collisionIndex.placeCollisionBox(kl,"always",ca,Ar,Kr,xo,go,_r,io.predicate,Bo,new Wt.P(0,0)).box,offscreen:!1,placeable:!1}),ho};o((()=>m(kl,ua.iconBox,Wt.ah.horizontal)),(()=>{const F=ua.verticalTextBox;return Vi.allowVerticalPlacement&&(!dl||!dl.placeable)&&u.numVerticalGlyphVertices>0&&F?m(F,ua.verticalIconBox,Wt.ah.vertical):{box:null,occluded:!0,offscreen:null}})),dl&&(ol=dl.placeable,cl=dl.offscreen);const ns=i(dl&&dl.placeable);if(!ol&&this.prevPlacement){const F=this.prevPlacement.variableOffsets[u.crossTileID];F&&(this.variableOffsets[u.crossTileID]=F,this.markUsedJustification(Vi,F.anchor,u,ns))}}}if(fl=dl,ol=fl&&fl.placeable,cl=fl&&fl.offscreen,u.useRuntimeCollisionCircles){const F=Vi.text.placedSymbolArray.get(u.centerJustifiedTextSymbolIndex),wr=Wt.ai(Vi.textSizeData,Da,F),ca=fr.get("text-padding");yl=this.collisionIndex.placeCollisionCircles(ao,F,Vi.lineVertexArray,Vi.glyphOffsetArray,wr,Ar,Kr,In,ns,Xe,xo,io.predicate,u.collisionCircleDiameter,ca,_r,Bo),yl.circles.length&&yl.collisionDetected&&!Xe&&Wt.w("Collisions detected, but collision boxes are not shown"),ol=oo||yl.circles.length>0&&!yl.collisionDetected,cl=cl&&yl.offscreen}if(ua.iconFeatureIndex&&(Ml=ua.iconFeatureIndex),ua.iconBox){const t=u=>this.collisionIndex.placeCollisionBox(u,co,ca,Ar,Kr,xo,go,wr,io.predicate,Bo,Io&&hl?hl:void 0);pl&&pl.placeable&&ua.verticalIconBox?(vl=t(ua.verticalIconBox),ll=vl.placeable):(vl=t(ua.iconBox),ll=vl.placeable),cl=cl&&vl.offscreen}const Dl=no||0===u.numHorizontalGlyphVertices&&0===u.numVerticalGlyphVertices,Ll=so||0===u.numIconVertices;Dl||Ll?Ll?Dl||(ll=ll&&ol):ol=ll&&ol:ll=ol=ll&&ol;const Rl=ll&&vl.placeable;if(ol&&fl.placeable&&this.collisionIndex.insertCollisionBox(fl.box,ao,fr.get("text-ignore-placement"),Vi.bucketInstanceId,pl&&pl.placeable&&Al?Al:bl,io.ID),Rl&&this.collisionIndex.insertCollisionBox(vl.box,co,fr.get("icon-ignore-placement"),Vi.bucketInstanceId,Ml,io.ID),yl&&ol&&this.collisionIndex.insertCollisionCircles(yl.circles,ao,fr.get("text-ignore-placement"),Vi.bucketInstanceId,bl,io.ID),Xe&&this.storeCollisionData(Vi.bucketInstanceId,ho,ua,fl,vl,yl),0===u.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===Vi.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[u.crossTileID]=new Ut(ol||Co,ll||zo,cl||Vi.justReloaded),F[u.crossTileID]=!0};if(ko){if(0!==u.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const F=Vi.getSortedSymbolIndexes(this.transform.angle);for(let u=F.length-1;u>=0;--u){const Wt=F[u];D(Vi.symbolInstances.get(Wt),Vi.collisionArrays[Wt],Wt)}}else for(let F=u.symbolInstanceStart;F<u.symbolInstanceEnd;F++)D(Vi.symbolInstances.get(F),Vi.collisionArrays[F],F);if(Xe&&Vi.bucketInstanceId in this.collisionCircleArrays){const u=this.collisionCircleArrays[Vi.bucketInstanceId];Wt.as(u.invProjMatrix,Ar),u.viewportMatrix=this.collisionIndex.getViewportMatrix()}Vi.justReloaded=!1}storeCollisionData(u,F,Wt,Xe,Vi,fr){if(Wt.textBox||Wt.iconBox){let fr,_r;this.collisionBoxArrays.has(u)?fr=this.collisionBoxArrays.get(u):(fr=new Map,this.collisionBoxArrays.set(u,fr)),fr.has(F)?_r=fr.get(F):(_r={text:null,icon:null},fr.set(F,_r)),Wt.textBox&&(_r.text=Xe.box),Wt.iconBox&&(_r.icon=Vi.box)}if(fr){let F=this.collisionCircleArrays[u];void 0===F&&(F=this.collisionCircleArrays[u]=new jt);for(let u=0;u<fr.circles.length;u+=4)F.circles.push(fr.circles[u+0]),F.circles.push(fr.circles[u+1]),F.circles.push(fr.circles[u+2]),F.circles.push(fr.collisionDetected?1:0)}}markUsedJustification(u,F,Xe,Vi){let fr;fr=Vi===Wt.ah.vertical?Xe.verticalPlacedTextSymbolIndex:{left:Xe.leftJustifiedTextSymbolIndex,center:Xe.centerJustifiedTextSymbolIndex,right:Xe.rightJustifiedTextSymbolIndex}[Wt.at(F)];const _r=[Xe.leftJustifiedTextSymbolIndex,Xe.centerJustifiedTextSymbolIndex,Xe.rightJustifiedTextSymbolIndex,Xe.verticalPlacedTextSymbolIndex];for(const F of _r)F>=0&&(u.text.placedSymbolArray.get(F).crossTileID=fr>=0&&F!==fr?0:Xe.crossTileID)}markUsedOrientation(u,F,Xe){const Vi=F===Wt.ah.horizontal||F===Wt.ah.horizontalOnly?F:0,fr=F===Wt.ah.vertical?F:0,_r=[Xe.leftJustifiedTextSymbolIndex,Xe.centerJustifiedTextSymbolIndex,Xe.rightJustifiedTextSymbolIndex];for(const F of _r)u.text.placedSymbolArray.get(F).placedOrientation=Vi;Xe.verticalPlacedTextSymbolIndex&&(u.text.placedSymbolArray.get(Xe.verticalPlacedTextSymbolIndex).placedOrientation=fr)}commit(u){this.commitTime=u,this.zoomAtLastRecencyCheck=this.transform.zoom;const F=this.prevPlacement;let Wt=!1;this.prevZoomAdjustment=F?F.zoomAdjustment(this.transform.zoom):0;const Xe=F?F.symbolFadeChange(u):1,Vi=F?F.opacities:{},fr=F?F.variableOffsets:{},_r=F?F.placedOrientations:{};for(const u in this.placements){const F=this.placements[u],fr=Vi[u];fr?(this.opacities[u]=new Nt(fr,Xe,F.text,F.icon),Wt=Wt||F.text!==fr.text.placed||F.icon!==fr.icon.placed):(this.opacities[u]=new Nt(null,Xe,F.text,F.icon,F.skipFade),Wt=Wt||F.text||F.icon)}for(const u in Vi){const F=Vi[u];if(!this.opacities[u]){const Vi=new Nt(F,Xe,!1,!1);Vi.isHidden()||(this.opacities[u]=Vi,Wt=Wt||F.text.placed||F.icon.placed)}}for(const u in fr)this.variableOffsets[u]||!this.opacities[u]||this.opacities[u].isHidden()||(this.variableOffsets[u]=fr[u]);for(const u in _r)this.placedOrientations[u]||!this.opacities[u]||this.opacities[u].isHidden()||(this.placedOrientations[u]=_r[u]);if(F&&void 0===F.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");Wt?this.lastPlacementChangeTime=u:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=F?F.lastPlacementChangeTime:u)}updateLayerOpacities(u,F){const Wt={};for(const Xe of F){const F=Xe.getBucket(u);F&&Xe.latestFeatureIndex&&u.id===F.layerIds[0]&&this.updateBucketOpacities(F,Xe.tileID,Wt,Xe.collisionBoxArray)}}updateBucketOpacities(u,F,Xe,Vi){u.hasTextData()&&(u.text.opacityVertexArray.clear(),u.text.hasVisibleVertices=!1),u.hasIconData()&&(u.icon.opacityVertexArray.clear(),u.icon.hasVisibleVertices=!1),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexArray.clear(),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexArray.clear();const fr=u.layers[0],_r=fr.layout,wr=new Nt(null,0,!1,!1,!0),Ar=_r.get("text-allow-overlap"),Kr=_r.get("icon-allow-overlap"),In=fr._unevaluatedLayout.hasValue("text-variable-anchor")||fr._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ns="map"===_r.get("text-rotation-alignment"),ca="map"===_r.get("text-pitch-alignment"),ha="none"!==_r.get("icon-text-fit"),ua=new Nt(null,0,Ar&&(Kr||!u.hasIconData()||_r.get("icon-optional")),Kr&&(Ar||!u.hasTextData()||_r.get("text-optional")),!0);!u.collisionArrays&&Vi&&(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData())&&u.deserializeCollisionBoxes(Vi);const m=(u,F,Wt)=>{for(let Xe=0;Xe<F/4;Xe++)u.opacityVertexArray.emplaceBack(Wt);u.hasVisibleVertices=u.hasVisibleVertices||Wt!==hl},Da=this.collisionBoxArrays.get(u.bucketInstanceId);for(let F=0;F<u.symbolInstances.length;F++){const Vi=u.symbolInstances.get(F),{numHorizontalGlyphVertices:fr,numVerticalGlyphVertices:_r,crossTileID:Ar}=Vi;let Kr=this.opacities[Ar];Xe[Ar]?Kr=wr:Kr||(Kr=ua,this.opacities[Ar]=Kr),Xe[Ar]=!0;const io=Vi.numIconVertices>0,no=this.placedOrientations[Vi.crossTileID],so=no===Wt.ah.vertical,ao=no===Wt.ah.horizontal||no===Wt.ah.horizontalOnly;if(fr>0||_r>0){const F=te(Kr.text);m(u.text,fr,so?hl:F),m(u.text,_r,ao?hl:F);const Wt=Kr.text.isHidden();[Vi.rightJustifiedTextSymbolIndex,Vi.centerJustifiedTextSymbolIndex,Vi.leftJustifiedTextSymbolIndex].forEach((F=>{F>=0&&(u.text.placedSymbolArray.get(F).hidden=Wt||so?1:0)})),Vi.verticalPlacedTextSymbolIndex>=0&&(u.text.placedSymbolArray.get(Vi.verticalPlacedTextSymbolIndex).hidden=Wt||ao?1:0);const Xe=this.variableOffsets[Vi.crossTileID];Xe&&this.markUsedJustification(u,Xe.anchor,Vi,no);const wr=this.placedOrientations[Vi.crossTileID];wr&&(this.markUsedJustification(u,"left",Vi,wr),this.markUsedOrientation(u,wr,Vi))}if(io){const F=te(Kr.icon),Wt=!(ha&&Vi.verticalPlacedIconSymbolIndex&&so);Vi.placedIconSymbolIndex>=0&&(m(u.icon,Vi.numIconVertices,Wt?F:hl),u.icon.placedSymbolArray.get(Vi.placedIconSymbolIndex).hidden=Kr.icon.isHidden()),Vi.verticalPlacedIconSymbolIndex>=0&&(m(u.icon,Vi.numVerticalIconVertices,Wt?hl:F),u.icon.placedSymbolArray.get(Vi.verticalPlacedIconSymbolIndex).hidden=Kr.icon.isHidden())}const oo=Da&&Da.has(F)?Da.get(F):{text:null,icon:null};if(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData()){const Xe=u.collisionArrays[F];if(Xe){let F=new Wt.P(0,0);if(Xe.textBox||Xe.verticalTextBox){let Wt=!0;if(In){const u=this.variableOffsets[Ar];u?(F=Vt(u.anchor,u.width,u.height,u.textOffset,u.textBoxScale),ns&&F._rotate(ca?this.transform.angle:-this.transform.angle)):Wt=!1}if(Xe.textBox||Xe.verticalTextBox){let Vi;Xe.textBox&&(Vi=so),Xe.verticalTextBox&&(Vi=ao),Ht(u.textCollisionBox.collisionVertexArray,Kr.text.placed,!Wt||Vi,oo.text,F.x,F.y)}}if(Xe.iconBox||Xe.verticalIconBox){const Wt=Boolean(!ao&&Xe.verticalIconBox);let Vi;Xe.iconBox&&(Vi=Wt),Xe.verticalIconBox&&(Vi=!Wt),Ht(u.iconCollisionBox.collisionVertexArray,Kr.icon.placed,Vi,oo.icon,ha?F.x:0,ha?F.y:0)}}}}if(u.sortFeatures(this.transform.angle),this.retainedQueryData[u.bucketInstanceId]&&(this.retainedQueryData[u.bucketInstanceId].featureSortOrder=u.featureSortOrder),u.hasTextData()&&u.text.opacityVertexBuffer&&u.text.opacityVertexBuffer.updateData(u.text.opacityVertexArray),u.hasIconData()&&u.icon.opacityVertexBuffer&&u.icon.opacityVertexBuffer.updateData(u.icon.opacityVertexArray),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexBuffer&&u.iconCollisionBox.collisionVertexBuffer.updateData(u.iconCollisionBox.collisionVertexArray),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexBuffer&&u.textCollisionBox.collisionVertexBuffer.updateData(u.textCollisionBox.collisionVertexArray),u.text.opacityVertexArray.length!==u.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${u.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${u.text.layoutVertexArray.length}) / 4`);if(u.icon.opacityVertexArray.length!==u.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${u.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${u.icon.layoutVertexArray.length}) / 4`);if(u.bucketInstanceId in this.collisionCircleArrays){const F=this.collisionCircleArrays[u.bucketInstanceId];u.placementInvProjMatrix=F.invProjMatrix,u.placementViewportMatrix=F.viewportMatrix,u.collisionCircleArray=F.circles,delete this.collisionCircleArrays[u.bucketInstanceId]}}symbolFadeChange(u){return 0===this.fadeDuration?1:(u-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(u){return Math.max(0,(this.transform.zoom-u)/1.5)}hasTransitions(u){return this.stale||u-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(u,F){const Wt=this.zoomAtLastRecencyCheck===F?1-this.zoomAdjustment(F):1;return this.zoomAtLastRecencyCheck=F,this.commitTime+this.fadeDuration*Wt>u}setStale(){this.stale=!0}}function Ht(u,F,Wt,Xe,Vi,fr){Xe&&0!==Xe.length||(Xe=[0,0,0,0]);const _r=Xe[0]-ko,wr=Xe[1]-ko,Ar=Xe[2]-ko,Kr=Xe[3]-ko;u.emplaceBack(F?1:0,Wt?1:0,Vi||0,fr||0,_r,wr),u.emplaceBack(F?1:0,Wt?1:0,Vi||0,fr||0,Ar,wr),u.emplaceBack(F?1:0,Wt?1:0,Vi||0,fr||0,Ar,Kr),u.emplaceBack(F?1:0,Wt?1:0,Vi||0,fr||0,_r,Kr)}const Co=Math.pow(2,25),zo=Math.pow(2,24),Bo=Math.pow(2,17),al=Math.pow(2,16),ol=Math.pow(2,9),ll=Math.pow(2,8),cl=Math.pow(2,1);function te(u){if(0===u.opacity&&!u.placed)return 0;if(1===u.opacity&&u.placed)return 4294967295;const F=u.placed?1:0,Wt=Math.floor(127*u.opacity);return Wt*Co+F*zo+Wt*Bo+F*al+Wt*ol+F*ll+Wt*cl+F}const hl=0;function ie(){return{isOccluded:(u,F,Wt)=>!1,getPitchedTextCorrection:(u,F,Wt)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(u,F,Wt,Xe){throw new Error("Not implemented.")},translatePosition:(u,F,Wt,Xe)=>function(u,F,Wt,Xe,Vi=!1){if(!Wt[0]&&!Wt[1])return[0,0];const fr=Vi?"map"===Xe?u.angle:0:"viewport"===Xe?-u.angle:0;if(fr){const u=Math.sin(fr),F=Math.cos(fr);Wt=[Wt[0]*F-Wt[1]*u,Wt[0]*u+Wt[1]*F]}return[Vi?Wt[0]:Bt(F,Wt[0],u.zoom),Vi?Wt[1]:Bt(F,Wt[1],u.zoom)]}(u,F,Wt,Xe),getCircleRadiusCorrection:u=>1}}class ae{constructor(u){this._sortAcrossTiles="viewport-y"!==u.layout.get("symbol-z-order")&&!u.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(u,F,Wt,Xe,Vi){const fr=this._bucketParts;for(;this._currentTileIndex<u.length;)if(F.getBucketParts(fr,Xe,u[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,Vi())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,fr.sort(((u,F)=>u.sortKey-F.sortKey)));this._currentPartIndex<fr.length;)if(F.placeLayerBucketPart(fr[this._currentPartIndex],this._seenCrossTileIDs,Wt),this._currentPartIndex++,Vi())return!0;return!1}}class se{constructor(u,F,Wt,Xe,Vi,fr,_r,wr){this.placement=new Gt(u,ie(),F,fr,_r,wr),this._currentPlacementIndex=Wt.length-1,this._forceFullPlacement=Xe,this._showCollisionBoxes=Vi,this._done=!1}isDone(){return this._done}continuePlacement(u,F,Wt){const Xe=_r.now(),s=()=>!this._forceFullPlacement&&_r.now()-Xe>2;for(;this._currentPlacementIndex>=0;){const Xe=F[u[this._currentPlacementIndex]],Vi=this.placement.collisionIndex.transform.zoom;if("symbol"===Xe.type&&(!Xe.minzoom||Xe.minzoom<=Vi)&&(!Xe.maxzoom||Xe.maxzoom>Vi)){if(this._inProgressLayer||(this._inProgressLayer=new ae(Xe)),this._inProgressLayer.continuePlacement(Wt[Xe.source],this.placement,this._showCollisionBoxes,Xe,s))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(u){return this.placement.commit(u),this.placement}}const dl=512/Wt.X/2;class re{constructor(u,F,Xe){this.tileID=u,this.bucketInstanceId=Xe,this._symbolsByKey={};const Vi=new Map;for(let u=0;u<F.length;u++){const Wt=F.get(u),Xe=Wt.key,fr=Vi.get(Xe);fr?fr.push(Wt):Vi.set(Xe,[Wt])}for(const[u,F]of Vi){const Xe={positions:F.map((u=>({x:Math.floor(u.anchorX*dl),y:Math.floor(u.anchorY*dl)}))),crossTileIDs:F.map((u=>u.crossTileID))};if(Xe.positions.length>128){const u=new Wt.av(Xe.positions.length,16,Uint16Array);for(const{x:F,y:Wt}of Xe.positions)u.add(F,Wt);u.finish(),delete Xe.positions,Xe.index=u}this._symbolsByKey[u]=Xe}}getScaledCoordinates(u,F){const{x:Xe,y:Vi,z:fr}=this.tileID.canonical,{x:_r,y:wr,z:Ar}=F.canonical,Kr=dl/Math.pow(2,Ar-fr),In=(wr*Wt.X+u.anchorY)*Kr,ns=Vi*Wt.X*dl;return{x:Math.floor((_r*Wt.X+u.anchorX)*Kr-Xe*Wt.X*dl),y:Math.floor(In-ns)}}findMatches(u,F,Wt){const Xe=this.tileID.canonical.z<F.canonical.z?1:Math.pow(2,this.tileID.canonical.z-F.canonical.z);for(let Vi=0;Vi<u.length;Vi++){const fr=u.get(Vi);if(fr.crossTileID)continue;const _r=this._symbolsByKey[fr.key];if(!_r)continue;const wr=this.getScaledCoordinates(fr,F);if(_r.index){const u=_r.index.range(wr.x-Xe,wr.y-Xe,wr.x+Xe,wr.y+Xe).sort();for(const F of u){const u=_r.crossTileIDs[F];if(!Wt[u]){Wt[u]=!0,fr.crossTileID=u;break}}}else if(_r.positions)for(let u=0;u<_r.positions.length;u++){const F=_r.positions[u],Vi=_r.crossTileIDs[u];if(Math.abs(F.x-wr.x)<=Xe&&Math.abs(F.y-wr.y)<=Xe&&!Wt[Vi]){Wt[Vi]=!0,fr.crossTileID=Vi;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:u})=>u))}}class ne{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class le{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(u){const F=Math.round((u-this.lng)/360);if(0!==F)for(const u in this.indexes){const Wt=this.indexes[u],Xe={};for(const u in Wt){const Vi=Wt[u];Vi.tileID=Vi.tileID.unwrapTo(Vi.tileID.wrap+F),Xe[Vi.tileID.key]=Vi}this.indexes[u]=Xe}this.lng=u}addBucket(u,F,Wt){if(this.indexes[u.overscaledZ]&&this.indexes[u.overscaledZ][u.key]){if(this.indexes[u.overscaledZ][u.key].bucketInstanceId===F.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(u.overscaledZ,this.indexes[u.overscaledZ][u.key])}for(let u=0;u<F.symbolInstances.length;u++)F.symbolInstances.get(u).crossTileID=0;this.usedCrossTileIDs[u.overscaledZ]||(this.usedCrossTileIDs[u.overscaledZ]={});const Xe=this.usedCrossTileIDs[u.overscaledZ];for(const Wt in this.indexes){const Vi=this.indexes[Wt];if(Number(Wt)>u.overscaledZ)for(const Wt in Vi){const fr=Vi[Wt];fr.tileID.isChildOf(u)&&fr.findMatches(F.symbolInstances,u,Xe)}else{const fr=Vi[u.scaledTo(Number(Wt)).key];fr&&fr.findMatches(F.symbolInstances,u,Xe)}}for(let u=0;u<F.symbolInstances.length;u++){const Vi=F.symbolInstances.get(u);Vi.crossTileID||(Vi.crossTileID=Wt.generate(),Xe[Vi.crossTileID]=!0)}return void 0===this.indexes[u.overscaledZ]&&(this.indexes[u.overscaledZ]={}),this.indexes[u.overscaledZ][u.key]=new re(u,F.symbolInstances,F.bucketInstanceId),!0}removeBucketCrossTileIDs(u,F){for(const Wt of F.getCrossTileIDsLists())for(const F of Wt)delete this.usedCrossTileIDs[u][F]}removeStaleBuckets(u){let F=!1;for(const Wt in this.indexes){const Xe=this.indexes[Wt];for(const Vi in Xe)u[Xe[Vi].bucketInstanceId]||(this.removeBucketCrossTileIDs(Wt,Xe[Vi]),delete Xe[Vi],F=!0)}return F}}class he{constructor(){this.layerIndexes={},this.crossTileIDs=new ne,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(u,F,Wt){let Xe=this.layerIndexes[u.id];void 0===Xe&&(Xe=this.layerIndexes[u.id]=new le);let Vi=!1;const fr={};Xe.handleWrapJump(Wt);for(const Wt of F){const F=Wt.getBucket(u);F&&u.id===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),Xe.addBucket(Wt.tileID,F,this.crossTileIDs)&&(Vi=!0),fr[F.bucketInstanceId]=!0)}return Xe.removeStaleBuckets(fr)&&(Vi=!0),Vi}pruneUnusedLayers(u){const F={};u.forEach((u=>{F[u]=!0}));for(const u in this.layerIndexes)F[u]||delete this.layerIndexes[u]}}const ce=(u,F)=>Wt.t(u,F&&F.filter((u=>"source.canvas"!==u.identifier))),pl=Wt.aw();class de extends Wt.E{constructor(u,F={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const F=this.sourceCaches[u].getSource().type;"vector"!==F&&"geojson"!==F||this.sourceCaches[u].reload()}},this.map=u,this.dispatcher=new U(N(),u._getMapId()),this.dispatcher.registerMessageHandler("GG",((u,F)=>this.getGlyphs(u,F))),this.dispatcher.registerMessageHandler("GI",((u,F)=>this.getImages(u,F))),this.imageManager=new T,this.imageManager.setEventedParent(this),this.glyphManager=new C(u._requestManager,F.localIdeographFontFamily),this.lineAtlas=new R(256,512),this.crossTileSymbolIndex=new he,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new Wt.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",Wt.ay()),nt().on(go,this._rtlPluginLoaded),this.on("data",(u=>{if("source"!==u.dataType||"metadata"!==u.sourceDataType)return;const F=this.sourceCaches[u.sourceId];if(!F)return;const Wt=F.getSource();if(Wt&&Wt.vectorLayerIds)for(const u in this._layers){const F=this._layers[u];F.source===Wt.id&&this._validateLayer(F)}}))}loadURL(u,F={},Xe){this.fire(new Wt.k("dataloading",{dataType:"style"})),F.validate="boolean"!=typeof F.validate||F.validate;const Vi=this.map._requestManager.transformRequest(u,"Style");this._loadStyleRequest=new AbortController;const fr=this._loadStyleRequest;Wt.h(Vi,this._loadStyleRequest).then((u=>{this._loadStyleRequest=null,this._load(u.data,F,Xe)})).catch((u=>{this._loadStyleRequest=null,u&&!fr.signal.aborted&&this.fire(new Wt.j(u))}))}loadJSON(u,F={},Xe){this.fire(new Wt.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,_r.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,F.validate=!1!==F.validate,this._load(u,F,Xe)})).catch((()=>{}))}loadEmpty(){this.fire(new Wt.k("dataloading",{dataType:"style"})),this._load(pl,{validate:!1})}_load(u,F,Xe){var Vi;const fr=F.transformStyle?F.transformStyle(Xe,u):u;if(!F.validate||!ce(this,Wt.u(fr))){this._loaded=!0,this.stylesheet=fr;for(const u in fr.sources)this.addSource(u,fr.sources[u],{validate:!1});fr.sprite?this._loadSprite(fr.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(fr.glyphs),this._createLayers(),this.light=new D(this.stylesheet.light),this.sky=new A(this.stylesheet.sky),this.map.setTerrain(null!==(Vi=this.stylesheet.terrain)&&void 0!==Vi?Vi:null),this.fire(new Wt.k("data",{dataType:"style"})),this.fire(new Wt.k("style.load"))}}_createLayers(){const u=Wt.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",u),this._order=u.map((u=>u.id)),this._layers={},this._serializedLayers=null;for(const F of u){const u=Wt.aA(F);u.setEventedParent(this,{layer:{id:F.id}}),this._layers[F.id]=u}}_loadSprite(u,F=!1,Xe=void 0){let Vi;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(u,F,Xe,Vi){return Wt._(this,void 0,void 0,(function*(){const fr=x(u),wr=Xe>1?"@2x":"",Ar={},Kr={};for(const{id:u,url:Xe}of fr){const fr=F.transformRequest(y(Xe,wr,".json"),"SpriteJSON");Ar[u]=Wt.h(fr,Vi);const _r=F.transformRequest(y(Xe,wr,".png"),"SpriteImage");Kr[u]=ca.getImage(_r,Vi)}return yield Promise.all([...Object.values(Ar),...Object.values(Kr)]),function(u,F){return Wt._(this,void 0,void 0,(function*(){const Wt={};for(const Xe in u){Wt[Xe]={};const Vi=_r.getImageCanvasContext((yield F[Xe]).data),fr=(yield u[Xe]).data;for(const u in fr){const{width:F,height:_r,x:wr,y:Ar,sdf:Kr,pixelRatio:In,stretchX:ns,stretchY:ca,content:ha,textFitWidth:ua,textFitHeight:Da}=fr[u];Wt[Xe][u]={data:null,pixelRatio:In,sdf:Kr,stretchX:ns,stretchY:ca,content:ha,textFitWidth:ua,textFitHeight:Da,spriteData:{width:F,height:_r,x:wr,y:Ar,context:Vi}}}}return Wt}))}(Ar,Kr)}))}(u,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((u=>{if(this._spriteRequest=null,u)for(const Wt in u){this._spritesImagesIds[Wt]=[];const Xe=this._spritesImagesIds[Wt]?this._spritesImagesIds[Wt].filter((F=>!(F in u))):[];for(const u of Xe)this.imageManager.removeImage(u),this._changedImages[u]=!0;for(const Xe in u[Wt]){const Vi="default"===Wt?Xe:`${Wt}:${Xe}`;this._spritesImagesIds[Wt].push(Vi),Vi in this.imageManager.images?this.imageManager.updateImage(Vi,u[Wt][Xe],!1):this.imageManager.addImage(Vi,u[Wt][Xe]),F&&(this._changedImages[Vi]=!0)}}})).catch((u=>{this._spriteRequest=null,Vi=u,this.fire(new Wt.j(Vi))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),F&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new Wt.k("data",{dataType:"style"})),Xe&&Xe(Vi)}))}_unloadSprite(){for(const u of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(u),this._changedImages[u]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new Wt.k("data",{dataType:"style"}))}_validateLayer(u){const F=this.sourceCaches[u.source];if(!F)return;const Xe=u.sourceLayer;if(!Xe)return;const Vi=F.getSource();("geojson"===Vi.type||Vi.vectorLayerIds&&-1===Vi.vectorLayerIds.indexOf(Xe))&&this.fire(new Wt.j(new Error(`Source layer "${Xe}" does not exist on source "${Vi.id}" as specified by style layer "${u.id}".`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const u in this.sourceCaches)if(!this.sourceCaches[u].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(u,F=!1){const Xe=this._serializedAllLayers();if(!u||0===u.length)return Object.values(F?Wt.aB(Xe):Xe);const Vi=[];for(const fr of u)if(Xe[fr]){const u=F?Wt.aB(Xe[fr]):Xe[fr];Vi.push(u)}return Vi}_serializedAllLayers(){let u=this._serializedLayers;if(u)return u;u=this._serializedLayers={};const F=Object.keys(this._layers);for(const Wt of F){const F=this._layers[Wt];"custom"!==F.type&&(u[Wt]=F.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.sky&&this.sky.hasTransition())return!0;for(const u in this.sourceCaches)if(this.sourceCaches[u].hasTransition())return!0;for(const u in this._layers)if(this._layers[u].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(u){if(!this._loaded)return;const F=this._changed;if(F){const F=Object.keys(this._updatedLayers),Wt=Object.keys(this._removedLayers);(F.length||Wt.length)&&this._updateWorkerLayers(F,Wt);for(const u in this._updatedSources){const F=this._updatedSources[u];if("reload"===F)this._reloadSource(u);else{if("clear"!==F)throw new Error(`Invalid action ${F}`);this._clearSource(u)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const F in this._updatedPaintProps)this._layers[F].updateTransitions(u);this.light.updateTransitions(u),this.sky.updateTransitions(u),this._resetUpdates()}const Xe={};for(const u in this.sourceCaches){const F=this.sourceCaches[u];Xe[u]=F.used,F.used=!1}for(const F of this._order){const Wt=this._layers[F];Wt.recalculate(u,this._availableImages),!Wt.isHidden(u.zoom)&&Wt.source&&(this.sourceCaches[Wt.source].used=!0)}for(const u in Xe){const F=this.sourceCaches[u];!!Xe[u]!=!!F.used&&F.fire(new Wt.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(u),this.sky.recalculate(u),this.z=u.zoom,F&&this.fire(new Wt.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const u=Object.keys(this._changedImages);if(u.length){for(const F in this.sourceCaches)this.sourceCaches[F].reloadTilesForDependencies(["icons","patterns"],u);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(u,F){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(u,!1),removedIds:F})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(u,F={}){var Xe;this._checkLoaded();const Vi=this.serialize();if(u=F.transformStyle?F.transformStyle(Vi,u):u,(null===(Xe=F.validate)||void 0===Xe||Xe)&&ce(this,Wt.u(u)))return!1;(u=Wt.aB(u)).layers=Wt.az(u.layers);const fr=Wt.aC(Vi,u),_r=this._getOperationsToPerform(fr);if(_r.unimplemented.length>0)throw new Error(`Unimplemented: ${_r.unimplemented.join(", ")}.`);if(0===_r.operations.length)return!1;for(const u of _r.operations)u();return this.stylesheet=u,this._serializedLayers=null,!0}_getOperationsToPerform(u){const F=[],Wt=[];for(const Xe of u)switch(Xe.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":F.push((()=>this.addLayer.apply(this,Xe.args)));break;case"removeLayer":F.push((()=>this.removeLayer.apply(this,Xe.args)));break;case"setPaintProperty":F.push((()=>this.setPaintProperty.apply(this,Xe.args)));break;case"setLayoutProperty":F.push((()=>this.setLayoutProperty.apply(this,Xe.args)));break;case"setFilter":F.push((()=>this.setFilter.apply(this,Xe.args)));break;case"addSource":F.push((()=>this.addSource.apply(this,Xe.args)));break;case"removeSource":F.push((()=>this.removeSource.apply(this,Xe.args)));break;case"setLayerZoomRange":F.push((()=>this.setLayerZoomRange.apply(this,Xe.args)));break;case"setLight":F.push((()=>this.setLight.apply(this,Xe.args)));break;case"setGeoJSONSourceData":F.push((()=>this.setGeoJSONSourceData.apply(this,Xe.args)));break;case"setGlyphs":F.push((()=>this.setGlyphs.apply(this,Xe.args)));break;case"setSprite":F.push((()=>this.setSprite.apply(this,Xe.args)));break;case"setSky":F.push((()=>this.setSky.apply(this,Xe.args)));break;case"setTerrain":F.push((()=>this.map.setTerrain.apply(this,Xe.args)));break;case"setTransition":F.push((()=>{}));break;default:Wt.push(Xe.command)}return{operations:F,unimplemented:Wt}}addImage(u,F){if(this.getImage(u))return this.fire(new Wt.j(new Error(`An image named "${u}" already exists.`)));this.imageManager.addImage(u,F),this._afterImageUpdated(u)}updateImage(u,F){this.imageManager.updateImage(u,F)}getImage(u){return this.imageManager.getImage(u)}removeImage(u){if(!this.getImage(u))return this.fire(new Wt.j(new Error(`An image named "${u}" does not exist.`)));this.imageManager.removeImage(u),this._afterImageUpdated(u)}_afterImageUpdated(u){this._availableImages=this.imageManager.listImages(),this._changedImages[u]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new Wt.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(u,F,Xe={}){if(this._checkLoaded(),void 0!==this.sourceCaches[u])throw new Error(`Source "${u}" already exists.`);if(!F.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(F).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(F.type)>=0&&this._validate(Wt.u.source,`sources.${u}`,F,null,Xe))return;this.map&&this.map._collectResourceTiming&&(F.collectResourceTiming=!0);const Vi=this.sourceCaches[u]=new ut(u,F,this.dispatcher);Vi.style=this,Vi.setEventedParent(this,(()=>({isSourceLoaded:Vi.loaded(),source:Vi.serialize(),sourceId:u}))),Vi.onAdd(this.map),this._changed=!0}removeSource(u){if(this._checkLoaded(),void 0===this.sourceCaches[u])throw new Error("There is no source with this ID");for(const F in this._layers)if(this._layers[F].source===u)return this.fire(new Wt.j(new Error(`Source "${u}" cannot be removed while layer "${F}" is using it.`)));const F=this.sourceCaches[u];delete this.sourceCaches[u],delete this._updatedSources[u],F.fire(new Wt.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:u})),F.setEventedParent(null),F.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(u,F){if(this._checkLoaded(),void 0===this.sourceCaches[u])throw new Error(`There is no source with this ID=${u}`);const Wt=this.sourceCaches[u].getSource();if("geojson"!==Wt.type)throw new Error(`geojsonSource.type is ${Wt.type}, which is !== 'geojson`);Wt.setData(F),this._changed=!0}getSource(u){return this.sourceCaches[u]&&this.sourceCaches[u].getSource()}addLayer(u,F,Xe={}){this._checkLoaded();const Vi=u.id;if(this.getLayer(Vi))return void this.fire(new Wt.j(new Error(`Layer "${Vi}" already exists on this map.`)));let fr;if("custom"===u.type){if(ce(this,Wt.aD(u)))return;fr=Wt.aA(u)}else{if("source"in u&&"object"==typeof u.source&&(this.addSource(Vi,u.source),u=Wt.aB(u),u=Wt.e(u,{source:Vi})),this._validate(Wt.u.layer,`layers.${Vi}`,u,{arrayIndex:-1},Xe))return;fr=Wt.aA(u),this._validateLayer(fr),fr.setEventedParent(this,{layer:{id:Vi}})}const _r=F?this._order.indexOf(F):this._order.length;if(F&&-1===_r)this.fire(new Wt.j(new Error(`Cannot add layer "${Vi}" before non-existing layer "${F}".`)));else{if(this._order.splice(_r,0,Vi),this._layerOrderChanged=!0,this._layers[Vi]=fr,this._removedLayers[Vi]&&fr.source&&"custom"!==fr.type){const u=this._removedLayers[Vi];delete this._removedLayers[Vi],u.type!==fr.type?this._updatedSources[fr.source]="clear":(this._updatedSources[fr.source]="reload",this.sourceCaches[fr.source].pause())}this._updateLayer(fr),fr.onAdd&&fr.onAdd(this.map)}}moveLayer(u,F){if(this._checkLoaded(),this._changed=!0,!this._layers[u])return void this.fire(new Wt.j(new Error(`The layer '${u}' does not exist in the map's style and cannot be moved.`)));if(u===F)return;const Xe=this._order.indexOf(u);this._order.splice(Xe,1);const Vi=F?this._order.indexOf(F):this._order.length;F&&-1===Vi?this.fire(new Wt.j(new Error(`Cannot move layer "${u}" before non-existing layer "${F}".`))):(this._order.splice(Vi,0,u),this._layerOrderChanged=!0)}removeLayer(u){this._checkLoaded();const F=this._layers[u];if(!F)return void this.fire(new Wt.j(new Error(`Cannot remove non-existing layer "${u}".`)));F.setEventedParent(null);const Xe=this._order.indexOf(u);this._order.splice(Xe,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[u]=F,delete this._layers[u],this._serializedLayers&&delete this._serializedLayers[u],delete this._updatedLayers[u],delete this._updatedPaintProps[u],F.onRemove&&F.onRemove(this.map)}getLayer(u){return this._layers[u]}getLayersOrder(){return[...this._order]}hasLayer(u){return u in this._layers}setLayerZoomRange(u,F,Xe){this._checkLoaded();const Vi=this.getLayer(u);Vi?Vi.minzoom===F&&Vi.maxzoom===Xe||(null!=F&&(Vi.minzoom=F),null!=Xe&&(Vi.maxzoom=Xe),this._updateLayer(Vi)):this.fire(new Wt.j(new Error(`Cannot set the zoom range of non-existing layer "${u}".`)))}setFilter(u,F,Xe={}){this._checkLoaded();const Vi=this.getLayer(u);if(Vi){if(!Wt.aE(Vi.filter,F))return null==F?(Vi.filter=void 0,void this._updateLayer(Vi)):void(this._validate(Wt.u.filter,`layers.${Vi.id}.filter`,F,null,Xe)||(Vi.filter=Wt.aB(F),this._updateLayer(Vi)))}else this.fire(new Wt.j(new Error(`Cannot filter non-existing layer "${u}".`)))}getFilter(u){return Wt.aB(this.getLayer(u).filter)}setLayoutProperty(u,F,Xe,Vi={}){this._checkLoaded();const fr=this.getLayer(u);fr?Wt.aE(fr.getLayoutProperty(F),Xe)||(fr.setLayoutProperty(F,Xe,Vi),this._updateLayer(fr)):this.fire(new Wt.j(new Error(`Cannot style non-existing layer "${u}".`)))}getLayoutProperty(u,F){const Xe=this.getLayer(u);if(Xe)return Xe.getLayoutProperty(F);this.fire(new Wt.j(new Error(`Cannot get style of non-existing layer "${u}".`)))}setPaintProperty(u,F,Xe,Vi={}){this._checkLoaded();const fr=this.getLayer(u);fr?Wt.aE(fr.getPaintProperty(F),Xe)||(fr.setPaintProperty(F,Xe,Vi)&&this._updateLayer(fr),this._changed=!0,this._updatedPaintProps[u]=!0,this._serializedLayers=null):this.fire(new Wt.j(new Error(`Cannot style non-existing layer "${u}".`)))}getPaintProperty(u,F){return this.getLayer(u).getPaintProperty(F)}setFeatureState(u,F){this._checkLoaded();const Xe=u.source,Vi=u.sourceLayer,fr=this.sourceCaches[Xe];if(void 0===fr)return void this.fire(new Wt.j(new Error(`The source '${Xe}' does not exist in the map's style.`)));const _r=fr.getSource().type;"geojson"===_r&&Vi?this.fire(new Wt.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==_r||Vi?(void 0===u.id&&this.fire(new Wt.j(new Error("The feature id parameter must be provided."))),fr.setFeatureState(Vi,u.id,F)):this.fire(new Wt.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(u,F){this._checkLoaded();const Xe=u.source,Vi=this.sourceCaches[Xe];if(void 0===Vi)return void this.fire(new Wt.j(new Error(`The source '${Xe}' does not exist in the map's style.`)));const fr=Vi.getSource().type,_r="vector"===fr?u.sourceLayer:void 0;"vector"!==fr||_r?F&&"string"!=typeof u.id&&"number"!=typeof u.id?this.fire(new Wt.j(new Error("A feature id is required to remove its specific state property."))):Vi.removeFeatureState(_r,u.id,F):this.fire(new Wt.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(u){this._checkLoaded();const F=u.source,Xe=u.sourceLayer,Vi=this.sourceCaches[F];if(void 0!==Vi)return"vector"!==Vi.getSource().type||Xe?(void 0===u.id&&this.fire(new Wt.j(new Error("The feature id parameter must be provided."))),Vi.getFeatureState(Xe,u.id)):void this.fire(new Wt.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new Wt.j(new Error(`The source '${F}' does not exist in the map's style.`)))}getTransition(){return Wt.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const u=Wt.aF(this.sourceCaches,(u=>u.serialize())),F=this._serializeByIds(this._order,!0),Xe=this.map.getTerrain()||void 0,Vi=this.stylesheet;return Wt.aG({version:Vi.version,name:Vi.name,metadata:Vi.metadata,light:Vi.light,sky:Vi.sky,center:Vi.center,zoom:Vi.zoom,bearing:Vi.bearing,pitch:Vi.pitch,sprite:Vi.sprite,glyphs:Vi.glyphs,transition:Vi.transition,sources:u,layers:F,terrain:Xe},(u=>void 0!==u))}_updateLayer(u){this._updatedLayers[u.id]=!0,u.source&&!this._updatedSources[u.source]&&"raster"!==this.sourceCaches[u.source].getSource().type&&(this._updatedSources[u.source]="reload",this.sourceCaches[u.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(u){const e=u=>"fill-extrusion"===this._layers[u].type,F={},Wt=[];for(let Xe=this._order.length-1;Xe>=0;Xe--){const Vi=this._order[Xe];if(e(Vi)){F[Vi]=Xe;for(const F of u){const u=F[Vi];if(u)for(const F of u)Wt.push(F)}}}Wt.sort(((u,F)=>F.intersectionZ-u.intersectionZ));const Xe=[];for(let Vi=this._order.length-1;Vi>=0;Vi--){const fr=this._order[Vi];if(e(fr))for(let u=Wt.length-1;u>=0;u--){const fr=Wt[u].feature;if(F[fr.layer.id]<Vi)break;Xe.push(fr),Wt.pop()}else for(const F of u){const u=F[fr];if(u)for(const F of u)Xe.push(F.feature)}}return Xe}queryRenderedFeatures(u,F,Xe){F&&F.filter&&this._validate(Wt.u.filter,"queryRenderedFeatures.filter",F.filter,null,F);const Vi={};if(F&&F.layers){if(!Array.isArray(F.layers))return this.fire(new Wt.j(new Error("parameters.layers must be an Array."))),[];for(const u of F.layers){const F=this._layers[u];if(!F)return this.fire(new Wt.j(new Error(`The layer '${u}' does not exist in the map's style and cannot be queried for features.`))),[];Vi[F.source]=!0}}const fr=[];F.availableImages=this._availableImages;const _r=this._serializedAllLayers();for(const Wt in this.sourceCaches)F.layers&&!Vi[Wt]||fr.push(q(this.sourceCaches[Wt],this._layers,_r,u,F,Xe));return this.placement&&fr.push(function(u,F,Wt,Xe,Vi,fr,_r){const wr={},Ar=fr.queryRenderedSymbols(Xe),Kr=[];for(const u of Object.keys(Ar).map(Number))Kr.push(_r[u]);Kr.sort(V);for(const Wt of Kr){const Xe=Wt.featureIndex.lookupSymbolFeatures(Ar[Wt.bucketInstanceId],F,Wt.bucketIndex,Wt.sourceLayerIndex,Vi.filter,Vi.layers,Vi.availableImages,u);for(const u in Xe){const F=wr[u]=wr[u]||[],Vi=Xe[u];Vi.sort(((u,F)=>{const Xe=Wt.featureSortOrder;if(Xe){const Wt=Xe.indexOf(u.featureIndex);return Xe.indexOf(F.featureIndex)-Wt}return F.featureIndex-u.featureIndex}));for(const u of Vi)F.push(u)}}for(const F in wr)wr[F].forEach((Xe=>{const Vi=Xe.feature,fr=Wt[u[F].source].getFeatureState(Vi.layer["source-layer"],Vi.id);Vi.source=Vi.layer.source,Vi.layer["source-layer"]&&(Vi.sourceLayer=Vi.layer["source-layer"]),Vi.state=fr}));return wr}(this._layers,_r,this.sourceCaches,u,F,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(fr)}querySourceFeatures(u,F){F&&F.filter&&this._validate(Wt.u.filter,"querySourceFeatures.filter",F.filter,null,F);const Xe=this.sourceCaches[u];return Xe?function(u,F){const Wt=u.getRenderableIds().map((F=>u.getTileByID(F))),Xe=[],Vi={};for(let u=0;u<Wt.length;u++){const fr=Wt[u],_r=fr.tileID.canonical.key;Vi[_r]||(Vi[_r]=!0,fr.querySourceFeatures(Xe,F))}return Xe}(Xe,F):[]}getLight(){return this.light.getLight()}setLight(u,F={}){this._checkLoaded();const Xe=this.light.getLight();let Vi=!1;for(const F in u)if(!Wt.aE(u[F],Xe[F])){Vi=!0;break}if(!Vi)return;const fr={now:_r.now(),transition:Wt.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(u,F),this.light.updateTransitions(fr)}getSky(){var u;return null===(u=this.stylesheet)||void 0===u?void 0:u.sky}setSky(u,F={}){const Xe=this.getSky();let Vi=!1;if(!u&&!Xe)return;if(u&&!Xe)Vi=!0;else if(!u&&Xe)Vi=!0;else for(const F in u)if(!Wt.aE(u[F],Xe[F])){Vi=!0;break}if(!Vi)return;const fr={now:_r.now(),transition:Wt.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=u,this.sky.setSky(u,F),this.sky.updateTransitions(fr)}_validate(u,F,Xe,Vi,fr={}){return(!fr||!1!==fr.validate)&&ce(this,u.call(Wt.u,Wt.e({key:F,style:this.serialize(),value:Xe,styleSpec:Wt.v},Vi)))}_remove(u=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),nt().off(go,this._rtlPluginLoaded);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this.sourceCaches){const F=this.sourceCaches[u];F.setEventedParent(null),F.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),u&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(u)}_clearSource(u){this.sourceCaches[u].clearTiles()}_reloadSource(u){this.sourceCaches[u].resume(),this.sourceCaches[u].reload()}_updateSources(u){for(const F in this.sourceCaches)this.sourceCaches[F].update(u,this.map.terrain)}_generateCollisionBoxes(){for(const u in this.sourceCaches)this._reloadSource(u)}_updatePlacement(u,F,Wt,Xe,Vi=!1){let fr=!1,wr=!1;const Ar={};for(const F of this._order){const Wt=this._layers[F];if("symbol"!==Wt.type)continue;if(!Ar[Wt.source]){const u=this.sourceCaches[Wt.source];Ar[Wt.source]=u.getRenderableIds(!0).map((F=>u.getTileByID(F))).sort(((u,F)=>F.tileID.overscaledZ-u.tileID.overscaledZ||(u.tileID.isLessThan(F.tileID)?-1:1)))}const Xe=this.crossTileSymbolIndex.addLayer(Wt,Ar[Wt.source],u.center.lng);fr=fr||Xe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((Vi=Vi||this._layerOrderChanged||0===Wt)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_r.now(),u.zoom))&&(this.pauseablePlacement=new se(u,this.map.terrain,this._order,Vi,F,Wt,Xe,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Ar),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(_r.now()),wr=!0),fr&&this.pauseablePlacement.placement.setStale()),wr||fr)for(const u of this._order){const F=this._layers[u];"symbol"===F.type&&this.placement.updateLayerOpacities(F,Ar[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_r.now())}_releaseSymbolFadeTiles(){for(const u in this.sourceCaches)this.sourceCaches[u].releaseSymbolFadeTiles()}getImages(u,F){return Wt._(this,void 0,void 0,(function*(){const u=yield this.imageManager.getImages(F.icons);this._updateTilesForChangedImages();const Wt=this.sourceCaches[F.source];return Wt&&Wt.setDependencies(F.tileID.key,F.type,F.icons),u}))}getGlyphs(u,F){return Wt._(this,void 0,void 0,(function*(){const u=yield this.glyphManager.getGlyphs(F.stacks),Wt=this.sourceCaches[F.source];return Wt&&Wt.setDependencies(F.tileID.key,F.type,[""]),u}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(u,F={}){this._checkLoaded(),u&&this._validate(Wt.u.glyphs,"glyphs",u,null,F)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=u,this.glyphManager.entries={},this.glyphManager.setURL(u))}addSprite(u,F,Xe={},Vi){this._checkLoaded();const fr=[{id:u,url:F}],_r=[...x(this.stylesheet.sprite),...fr];this._validate(Wt.u.sprite,"sprite",_r,null,Xe)||(this.stylesheet.sprite=_r,this._loadSprite(fr,!0,Vi))}removeSprite(u){this._checkLoaded();const F=x(this.stylesheet.sprite);if(F.find((F=>F.id===u))){if(this._spritesImagesIds[u])for(const F of this._spritesImagesIds[u])this.imageManager.removeImage(F),this._changedImages[F]=!0;F.splice(F.findIndex((F=>F.id===u)),1),this.stylesheet.sprite=F.length>0?F:void 0,delete this._spritesImagesIds[u],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new Wt.k("data",{dataType:"style"}))}else this.fire(new Wt.j(new Error(`Sprite "${u}" doesn't exists on this map.`)))}getSprite(){return x(this.stylesheet.sprite)}setSprite(u,F={},Xe){this._checkLoaded(),u&&this._validate(Wt.u.sprite,"sprite",u,null,F)||(this.stylesheet.sprite=u,u?this._loadSprite(u,!0,Xe):(this._unloadSprite(),Xe&&Xe(null)))}}var fl=Wt.Y([{name:"a_pos",type:"Int16",components:2}]);const yl={prelude:me("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}"),background:me("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:me("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:me("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:me("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:me("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}"),heatmapTexture:me("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:me("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:me("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:me("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:me("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:me("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:me("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:me("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:me("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:me("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:me("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:me("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:me("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:me("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:me("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:me("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:me("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:me("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:me("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:me("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:me("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:me("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:me("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:me("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function me(u,F){const Wt=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,Xe=F.match(/attribute ([\w]+) ([\w]+)/g),Vi=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),fr=F.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_r=fr?fr.concat(Vi):Vi,wr={};return{fragmentSource:u=u.replace(Wt,((u,F,Wt,Xe,Vi)=>(wr[Vi]=!0,"define"===F?`\n#ifndef HAS_UNIFORM_u_${Vi}\nvarying ${Wt} ${Xe} ${Vi};\n#else\nuniform ${Wt} ${Xe} u_${Vi};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Vi}\n    ${Wt} ${Xe} ${Vi} = u_${Vi};\n#endif\n`))),vertexSource:F=F.replace(Wt,((u,F,Wt,Xe,Vi)=>{const fr="float"===Xe?"vec2":"vec4",_r=Vi.match(/color/)?"color":fr;return wr[Vi]?"define"===F?`\n#ifndef HAS_UNIFORM_u_${Vi}\nuniform lowp float u_${Vi}_t;\nattribute ${Wt} ${fr} a_${Vi};\nvarying ${Wt} ${Xe} ${Vi};\n#else\nuniform ${Wt} ${Xe} u_${Vi};\n#endif\n`:"vec4"===_r?`\n#ifndef HAS_UNIFORM_u_${Vi}\n    ${Vi} = a_${Vi};\n#else\n    ${Wt} ${Xe} ${Vi} = u_${Vi};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Vi}\n    ${Vi} = unpack_mix_${_r}(a_${Vi}, u_${Vi}_t);\n#else\n    ${Wt} ${Xe} ${Vi} = u_${Vi};\n#endif\n`:"define"===F?`\n#ifndef HAS_UNIFORM_u_${Vi}\nuniform lowp float u_${Vi}_t;\nattribute ${Wt} ${fr} a_${Vi};\n#else\nuniform ${Wt} ${Xe} u_${Vi};\n#endif\n`:"vec4"===_r?`\n#ifndef HAS_UNIFORM_u_${Vi}\n    ${Wt} ${Xe} ${Vi} = a_${Vi};\n#else\n    ${Wt} ${Xe} ${Vi} = u_${Vi};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Vi}\n    ${Wt} ${Xe} ${Vi} = unpack_mix_${_r}(a_${Vi}, u_${Vi}_t);\n#else\n    ${Wt} ${Xe} ${Vi} = u_${Vi};\n#endif\n`})),staticAttributes:Xe,staticUniforms:_r}}class fe{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(u,F,Wt,Xe,Vi,fr,_r,wr,Ar){this.context=u;let Kr=this.boundPaintVertexBuffers.length!==Xe.length;for(let u=0;!Kr&&u<Xe.length;u++)this.boundPaintVertexBuffers[u]!==Xe[u]&&(Kr=!0);!this.vao||this.boundProgram!==F||this.boundLayoutVertexBuffer!==Wt||Kr||this.boundIndexBuffer!==Vi||this.boundVertexOffset!==fr||this.boundDynamicVertexBuffer!==_r||this.boundDynamicVertexBuffer2!==wr||this.boundDynamicVertexBuffer3!==Ar?this.freshBind(F,Wt,Xe,Vi,fr,_r,wr,Ar):(u.bindVertexArray.set(this.vao),_r&&_r.bind(),Vi&&Vi.dynamicDraw&&Vi.bind(),wr&&wr.bind(),Ar&&Ar.bind())}freshBind(u,F,Wt,Xe,Vi,fr,_r,wr){const Ar=u.numAttributes,Kr=this.context,In=Kr.gl;this.vao&&this.destroy(),this.vao=Kr.createVertexArray(),Kr.bindVertexArray.set(this.vao),this.boundProgram=u,this.boundLayoutVertexBuffer=F,this.boundPaintVertexBuffers=Wt,this.boundIndexBuffer=Xe,this.boundVertexOffset=Vi,this.boundDynamicVertexBuffer=fr,this.boundDynamicVertexBuffer2=_r,this.boundDynamicVertexBuffer3=wr,F.enableAttributes(In,u);for(const F of Wt)F.enableAttributes(In,u);fr&&fr.enableAttributes(In,u),_r&&_r.enableAttributes(In,u),wr&&wr.enableAttributes(In,u),F.bind(),F.setVertexAttribPointers(In,u,Vi);for(const F of Wt)F.bind(),F.setVertexAttribPointers(In,u,Vi);fr&&(fr.bind(),fr.setVertexAttribPointers(In,u,Vi)),Xe&&Xe.bind(),_r&&(_r.bind(),_r.setVertexAttribPointers(In,u,Vi)),wr&&(wr.bind(),wr.setVertexAttribPointers(In,u,Vi)),Kr.currentNumAttributes=Ar}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ge=(u,F,Xe,Vi,fr)=>({u_matrix:u,u_texture:0,u_ele_delta:F,u_fog_matrix:Xe,u_fog_color:Vi?Vi.properties.get("fog-color"):Wt.aM.white,u_fog_ground_blend:Vi?Vi.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:Vi?Vi.calculateFogBlendOpacity(fr):0,u_horizon_color:Vi?Vi.properties.get("horizon-color"):Wt.aM.white,u_horizon_fog_blend:Vi?Vi.properties.get("horizon-fog-blend"):1});function ve(u){const F=[];for(let Wt=0;Wt<u.length;Wt++){if(null===u[Wt])continue;const Xe=u[Wt].split(" ");F.push(Xe.pop())}return F}class xe{constructor(u,F,Xe,Vi,fr,_r){const wr=u.gl;this.program=wr.createProgram();const Ar=ve(F.staticAttributes),Kr=Xe?Xe.getBinderAttributes():[],In=Ar.concat(Kr),ns=yl.prelude.staticUniforms?ve(yl.prelude.staticUniforms):[],ca=F.staticUniforms?ve(F.staticUniforms):[],ha=Xe?Xe.getBinderUniforms():[],ua=ns.concat(ca).concat(ha),Da=[];for(const u of ua)Da.indexOf(u)<0&&Da.push(u);const io=Xe?Xe.defines():[];fr&&io.push("#define OVERDRAW_INSPECTOR;"),_r&&io.push("#define TERRAIN3D;");const no=io.concat(yl.prelude.fragmentSource,F.fragmentSource).join("\n"),so=io.concat(yl.prelude.vertexSource,F.vertexSource).join("\n"),ao=wr.createShader(wr.FRAGMENT_SHADER);if(wr.isContextLost())return void(this.failedToCreate=!0);if(wr.shaderSource(ao,no),wr.compileShader(ao),!wr.getShaderParameter(ao,wr.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${wr.getShaderInfoLog(ao)}`);wr.attachShader(this.program,ao);const oo=wr.createShader(wr.VERTEX_SHADER);if(wr.isContextLost())return void(this.failedToCreate=!0);if(wr.shaderSource(oo,so),wr.compileShader(oo),!wr.getShaderParameter(oo,wr.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${wr.getShaderInfoLog(oo)}`);wr.attachShader(this.program,oo),this.attributes={};const co={};this.numAttributes=In.length;for(let u=0;u<this.numAttributes;u++)In[u]&&(wr.bindAttribLocation(this.program,u,In[u]),this.attributes[In[u]]=u);if(wr.linkProgram(this.program),!wr.getProgramParameter(this.program,wr.LINK_STATUS))throw new Error(`Program failed to link: ${wr.getProgramInfoLog(this.program)}`);wr.deleteShader(oo),wr.deleteShader(ao);for(let u=0;u<Da.length;u++){const F=Da[u];if(F&&!co[F]){const u=wr.getUniformLocation(this.program,F);u&&(co[F]=u)}}this.fixedUniforms=Vi(u,co),this.terrainUniforms=((u,F)=>({u_depth:new Wt.aH(u,F.u_depth),u_terrain:new Wt.aH(u,F.u_terrain),u_terrain_dim:new Wt.aI(u,F.u_terrain_dim),u_terrain_matrix:new Wt.aJ(u,F.u_terrain_matrix),u_terrain_unpack:new Wt.aK(u,F.u_terrain_unpack),u_terrain_exaggeration:new Wt.aI(u,F.u_terrain_exaggeration)}))(u,co),this.binderUniforms=Xe?Xe.getUniforms(u,co):[]}draw(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua,Da,io,no){const so=u.gl;if(this.failedToCreate)return;if(u.program.set(this.program),u.setDepthMode(Wt),u.setStencilMode(Xe),u.setColorMode(Vi),u.setCullFace(fr),wr){u.activeTexture.set(so.TEXTURE2),so.bindTexture(so.TEXTURE_2D,wr.depthTexture),u.activeTexture.set(so.TEXTURE3),so.bindTexture(so.TEXTURE_2D,wr.texture);for(const u in this.terrainUniforms)this.terrainUniforms[u].set(wr[u])}for(const u in this.fixedUniforms)this.fixedUniforms[u].set(_r[u]);ua&&ua.setUniforms(u,this.binderUniforms,ca,{zoom:ha});let ao=0;switch(F){case so.LINES:ao=2;break;case so.TRIANGLES:ao=3;break;case so.LINE_STRIP:ao=1}for(const Wt of ns.get()){const Xe=Wt.vaos||(Wt.vaos={});(Xe[Ar]||(Xe[Ar]=new fe)).bind(u,this,Kr,ua?ua.getPaintVertexBuffers():[],In,Wt.vertexOffset,Da,io,no),so.drawElements(F,Wt.primitiveLength*ao,so.UNSIGNED_SHORT,Wt.primitiveOffset*ao*2)}}}function ye(u,F,Wt){const Xe=1/Bt(Wt,1,F.transform.tileZoom),Vi=Math.pow(2,Wt.tileID.overscaledZ),fr=Wt.tileSize*Math.pow(2,F.transform.tileZoom)/Vi,_r=fr*(Wt.tileID.canonical.x+Wt.tileID.wrap*Vi),wr=fr*Wt.tileID.canonical.y;return{u_image:0,u_texsize:Wt.imageAtlasTexture.size,u_scale:[Xe,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[_r>>16,wr>>16],u_pixel_coord_lower:[65535&_r,65535&wr]}}const be=(u,F,Xe,Vi)=>{const fr=F.style.light,_r=fr.properties.get("position"),wr=[_r.x,_r.y,_r.z],Ar=function(){var u=new Wt.A(9);return Wt.A!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}();"viewport"===fr.properties.get("anchor")&&function(u,F){var Wt=Math.sin(F),Xe=Math.cos(F);u[0]=Xe,u[1]=Wt,u[2]=0,u[3]=-Wt,u[4]=Xe,u[5]=0,u[6]=0,u[7]=0,u[8]=1}(Ar,-F.transform.angle),function(u,F,Wt){var Xe=F[0],Vi=F[1],fr=F[2];u[0]=Xe*Wt[0]+Vi*Wt[3]+fr*Wt[6],u[1]=Xe*Wt[1]+Vi*Wt[4]+fr*Wt[7],u[2]=Xe*Wt[2]+Vi*Wt[5]+fr*Wt[8]}(wr,wr,Ar);const Kr=fr.properties.get("color");return{u_matrix:u,u_lightpos:wr,u_lightintensity:fr.properties.get("intensity"),u_lightcolor:[Kr.r,Kr.g,Kr.b],u_vertical_gradient:+Xe,u_opacity:Vi}},we=(u,F,Xe,Vi,fr,_r,wr)=>Wt.e(be(u,F,Xe,Vi),ye(_r,F,wr),{u_height_factor:-Math.pow(2,fr.overscaledZ)/wr.tileSize/8}),Te=u=>({u_matrix:u}),Ie=(u,F,Xe,Vi)=>Wt.e(Te(u),ye(Xe,F,Vi)),Ee=(u,F)=>({u_matrix:u,u_world:F}),Pe=(u,F,Xe,Vi,fr)=>Wt.e(Ie(u,F,Xe,Vi),{u_world:fr}),Ce=(u,F,Wt,Xe)=>{const Vi=u.transform;let fr,_r;if("map"===Xe.paint.get("circle-pitch-alignment")){const u=Bt(Wt,1,Vi.zoom);fr=!0,_r=[u,u]}else fr=!1,_r=Vi.pixelsToGLUnits;return{u_camera_to_center_distance:Vi.cameraToCenterDistance,u_scale_with_map:+("map"===Xe.paint.get("circle-pitch-scale")),u_matrix:u.translatePosMatrix(F.posMatrix,Wt,Xe.paint.get("circle-translate"),Xe.paint.get("circle-translate-anchor")),u_pitch_with_map:+fr,u_device_pixel_ratio:u.pixelRatio,u_extrude_scale:_r}},Se=(u,F,Wt)=>({u_matrix:u,u_inv_matrix:F,u_camera_to_center_distance:Wt.cameraToCenterDistance,u_viewport_size:[Wt.width,Wt.height]}),ze=(u,F,Wt=1)=>({u_matrix:u,u_color:F,u_overlay:0,u_overlay_scale:Wt}),De=u=>({u_matrix:u}),Me=(u,F,Wt,Xe)=>({u_matrix:u,u_extrude_scale:Bt(F,1,Wt),u_intensity:Xe}),Ae=(u,F,Xe,Vi)=>{const fr=Wt.H();Wt.aP(fr,0,u.width,u.height,0,0,1);const _r=u.context.gl;return{u_matrix:fr,u_world:[_r.drawingBufferWidth,_r.drawingBufferHeight],u_image:Xe,u_color_ramp:Vi,u_opacity:F.paint.get("heatmap-opacity")}};function Re(u,F){const Xe=Math.pow(2,F.canonical.z),Vi=F.canonical.y;return[new Wt.Z(0,Vi/Xe).toLngLat().lat,new Wt.Z(0,(Vi+1)/Xe).toLngLat().lat]}const ke=(u,F,Wt,Xe)=>{const Vi=u.transform;return{u_matrix:Ne(u,F,Wt,Xe),u_ratio:1/Bt(F,1,Vi.zoom),u_device_pixel_ratio:u.pixelRatio,u_units_to_pixels:[1/Vi.pixelsToGLUnits[0],1/Vi.pixelsToGLUnits[1]]}},Le=(u,F,Xe,Vi,fr)=>Wt.e(ke(u,F,Xe,fr),{u_image:0,u_image_height:Vi}),Fe=(u,F,Wt,Xe,Vi)=>{const fr=u.transform,_r=Oe(F,fr);return{u_matrix:Ne(u,F,Wt,Vi),u_texsize:F.imageAtlasTexture.size,u_ratio:1/Bt(F,1,fr.zoom),u_device_pixel_ratio:u.pixelRatio,u_image:0,u_scale:[_r,Xe.fromScale,Xe.toScale],u_fade:Xe.t,u_units_to_pixels:[1/fr.pixelsToGLUnits[0],1/fr.pixelsToGLUnits[1]]}},Be=(u,F,Xe,Vi,fr,_r)=>{const wr=u.lineAtlas,Ar=Oe(F,u.transform),Kr="round"===Xe.layout.get("line-cap"),In=wr.getDash(Vi.from,Kr),ns=wr.getDash(Vi.to,Kr),ca=In.width*fr.fromScale,ha=ns.width*fr.toScale;return Wt.e(ke(u,F,Xe,_r),{u_patternscale_a:[Ar/ca,-In.height/2],u_patternscale_b:[Ar/ha,-ns.height/2],u_sdfgamma:wr.width/(256*Math.min(ca,ha)*u.pixelRatio)/2,u_image:0,u_tex_y_a:In.y,u_tex_y_b:ns.y,u_mix:fr.t})};function Oe(u,F){return 1/Bt(u,1,F.tileZoom)}function Ne(u,F,Wt,Xe){return u.translatePosMatrix(Xe?Xe.posMatrix:F.tileID.posMatrix,F,Wt.paint.get("line-translate"),Wt.paint.get("line-translate-anchor"))}const Ue=(u,F,Wt,Xe,Vi)=>{return{u_matrix:u,u_tl_parent:F,u_scale_parent:Wt,u_buffer_scale:1,u_fade_t:Xe.mix,u_opacity:Xe.opacity*Vi.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Vi.paint.get("raster-brightness-min"),u_brightness_high:Vi.paint.get("raster-brightness-max"),u_saturation_factor:(_r=Vi.paint.get("raster-saturation"),_r>0?1-1/(1.001-_r):-_r),u_contrast_factor:(fr=Vi.paint.get("raster-contrast"),fr>0?1/(1-fr):1+fr),u_spin_weights:je(Vi.paint.get("raster-hue-rotate"))};var fr,_r};function je(u){u*=Math.PI/180;const F=Math.sin(u),Wt=Math.cos(u);return[(2*Wt+1)/3,(-Math.sqrt(3)*F-Wt+1)/3,(Math.sqrt(3)*F-Wt+1)/3]}const Ze=(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha)=>{const ua=_r.transform;return{u_is_size_zoom_constant:+("constant"===u||"source"===u),u_is_size_feature_constant:+("constant"===u||"camera"===u),u_size_t:F?F.uSizeT:0,u_size:F?F.uSize:0,u_camera_to_center_distance:ua.cameraToCenterDistance,u_pitch:ua.pitch/360*2*Math.PI,u_rotate_symbol:+Wt,u_aspect_ratio:ua.width/ua.height,u_fade_change:_r.options.fadeDuration?_r.symbolFadeChange:1,u_matrix:wr,u_label_plane_matrix:Ar,u_coord_matrix:Kr,u_is_text:+ns,u_pitch_with_map:+Xe,u_is_along_line:Vi,u_is_variable_anchor:fr,u_texsize:ca,u_texture:0,u_translation:In,u_pitched_scale:ha}},qe=(u,F,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua,Da)=>{const io=wr.transform;return Wt.e(Ze(u,F,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,Da),{u_gamma_scale:Vi?Math.cos(io._pitch)*io.cameraToCenterDistance:1,u_device_pixel_ratio:wr.pixelRatio,u_is_halo:+ua})},Ve=(u,F,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua)=>Wt.e(qe(u,F,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,!0,ca,!0,ua),{u_texsize_icon:ha,u_texture_icon:1}),Ge=(u,F,Wt)=>({u_matrix:u,u_opacity:F,u_color:Wt}),He=(u,F,Xe,Vi,fr,_r)=>Wt.e(function(u,F,Wt,Xe){const Vi=Wt.imageManager.getPattern(u.from.toString()),fr=Wt.imageManager.getPattern(u.to.toString()),{width:_r,height:wr}=Wt.imageManager.getPixelSize(),Ar=Math.pow(2,Xe.tileID.overscaledZ),Kr=Xe.tileSize*Math.pow(2,Wt.transform.tileZoom)/Ar,In=Kr*(Xe.tileID.canonical.x+Xe.tileID.wrap*Ar),ns=Kr*Xe.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Vi.tl,u_pattern_br_a:Vi.br,u_pattern_tl_b:fr.tl,u_pattern_br_b:fr.br,u_texsize:[_r,wr],u_mix:F.t,u_pattern_size_a:Vi.displaySize,u_pattern_size_b:fr.displaySize,u_scale_a:F.fromScale,u_scale_b:F.toScale,u_tile_units_to_pixels:1/Bt(Xe,1,Wt.transform.tileZoom),u_pixel_coord_upper:[In>>16,ns>>16],u_pixel_coord_lower:[65535&In,65535&ns]}}(Vi,_r,Xe,fr),{u_matrix:u,u_opacity:F}),vl={fillExtrusion:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_lightpos:new Wt.aN(u,F.u_lightpos),u_lightintensity:new Wt.aI(u,F.u_lightintensity),u_lightcolor:new Wt.aN(u,F.u_lightcolor),u_vertical_gradient:new Wt.aI(u,F.u_vertical_gradient),u_opacity:new Wt.aI(u,F.u_opacity)}),fillExtrusionPattern:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_lightpos:new Wt.aN(u,F.u_lightpos),u_lightintensity:new Wt.aI(u,F.u_lightintensity),u_lightcolor:new Wt.aN(u,F.u_lightcolor),u_vertical_gradient:new Wt.aI(u,F.u_vertical_gradient),u_height_factor:new Wt.aI(u,F.u_height_factor),u_image:new Wt.aH(u,F.u_image),u_texsize:new Wt.aO(u,F.u_texsize),u_pixel_coord_upper:new Wt.aO(u,F.u_pixel_coord_upper),u_pixel_coord_lower:new Wt.aO(u,F.u_pixel_coord_lower),u_scale:new Wt.aN(u,F.u_scale),u_fade:new Wt.aI(u,F.u_fade),u_opacity:new Wt.aI(u,F.u_opacity)}),fill:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix)}),fillPattern:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_image:new Wt.aH(u,F.u_image),u_texsize:new Wt.aO(u,F.u_texsize),u_pixel_coord_upper:new Wt.aO(u,F.u_pixel_coord_upper),u_pixel_coord_lower:new Wt.aO(u,F.u_pixel_coord_lower),u_scale:new Wt.aN(u,F.u_scale),u_fade:new Wt.aI(u,F.u_fade)}),fillOutline:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_world:new Wt.aO(u,F.u_world)}),fillOutlinePattern:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_world:new Wt.aO(u,F.u_world),u_image:new Wt.aH(u,F.u_image),u_texsize:new Wt.aO(u,F.u_texsize),u_pixel_coord_upper:new Wt.aO(u,F.u_pixel_coord_upper),u_pixel_coord_lower:new Wt.aO(u,F.u_pixel_coord_lower),u_scale:new Wt.aN(u,F.u_scale),u_fade:new Wt.aI(u,F.u_fade)}),circle:(u,F)=>({u_camera_to_center_distance:new Wt.aI(u,F.u_camera_to_center_distance),u_scale_with_map:new Wt.aH(u,F.u_scale_with_map),u_pitch_with_map:new Wt.aH(u,F.u_pitch_with_map),u_extrude_scale:new Wt.aO(u,F.u_extrude_scale),u_device_pixel_ratio:new Wt.aI(u,F.u_device_pixel_ratio),u_matrix:new Wt.aJ(u,F.u_matrix)}),collisionBox:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_pixel_extrude_scale:new Wt.aO(u,F.u_pixel_extrude_scale)}),collisionCircle:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_inv_matrix:new Wt.aJ(u,F.u_inv_matrix),u_camera_to_center_distance:new Wt.aI(u,F.u_camera_to_center_distance),u_viewport_size:new Wt.aO(u,F.u_viewport_size)}),debug:(u,F)=>({u_color:new Wt.aL(u,F.u_color),u_matrix:new Wt.aJ(u,F.u_matrix),u_overlay:new Wt.aH(u,F.u_overlay),u_overlay_scale:new Wt.aI(u,F.u_overlay_scale)}),clippingMask:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix)}),heatmap:(u,F)=>({u_extrude_scale:new Wt.aI(u,F.u_extrude_scale),u_intensity:new Wt.aI(u,F.u_intensity),u_matrix:new Wt.aJ(u,F.u_matrix)}),heatmapTexture:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_world:new Wt.aO(u,F.u_world),u_image:new Wt.aH(u,F.u_image),u_color_ramp:new Wt.aH(u,F.u_color_ramp),u_opacity:new Wt.aI(u,F.u_opacity)}),hillshade:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_image:new Wt.aH(u,F.u_image),u_latrange:new Wt.aO(u,F.u_latrange),u_light:new Wt.aO(u,F.u_light),u_shadow:new Wt.aL(u,F.u_shadow),u_highlight:new Wt.aL(u,F.u_highlight),u_accent:new Wt.aL(u,F.u_accent)}),hillshadePrepare:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_image:new Wt.aH(u,F.u_image),u_dimension:new Wt.aO(u,F.u_dimension),u_zoom:new Wt.aI(u,F.u_zoom),u_unpack:new Wt.aK(u,F.u_unpack)}),line:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_ratio:new Wt.aI(u,F.u_ratio),u_device_pixel_ratio:new Wt.aI(u,F.u_device_pixel_ratio),u_units_to_pixels:new Wt.aO(u,F.u_units_to_pixels)}),lineGradient:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_ratio:new Wt.aI(u,F.u_ratio),u_device_pixel_ratio:new Wt.aI(u,F.u_device_pixel_ratio),u_units_to_pixels:new Wt.aO(u,F.u_units_to_pixels),u_image:new Wt.aH(u,F.u_image),u_image_height:new Wt.aI(u,F.u_image_height)}),linePattern:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_texsize:new Wt.aO(u,F.u_texsize),u_ratio:new Wt.aI(u,F.u_ratio),u_device_pixel_ratio:new Wt.aI(u,F.u_device_pixel_ratio),u_image:new Wt.aH(u,F.u_image),u_units_to_pixels:new Wt.aO(u,F.u_units_to_pixels),u_scale:new Wt.aN(u,F.u_scale),u_fade:new Wt.aI(u,F.u_fade)}),lineSDF:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_ratio:new Wt.aI(u,F.u_ratio),u_device_pixel_ratio:new Wt.aI(u,F.u_device_pixel_ratio),u_units_to_pixels:new Wt.aO(u,F.u_units_to_pixels),u_patternscale_a:new Wt.aO(u,F.u_patternscale_a),u_patternscale_b:new Wt.aO(u,F.u_patternscale_b),u_sdfgamma:new Wt.aI(u,F.u_sdfgamma),u_image:new Wt.aH(u,F.u_image),u_tex_y_a:new Wt.aI(u,F.u_tex_y_a),u_tex_y_b:new Wt.aI(u,F.u_tex_y_b),u_mix:new Wt.aI(u,F.u_mix)}),raster:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_tl_parent:new Wt.aO(u,F.u_tl_parent),u_scale_parent:new Wt.aI(u,F.u_scale_parent),u_buffer_scale:new Wt.aI(u,F.u_buffer_scale),u_fade_t:new Wt.aI(u,F.u_fade_t),u_opacity:new Wt.aI(u,F.u_opacity),u_image0:new Wt.aH(u,F.u_image0),u_image1:new Wt.aH(u,F.u_image1),u_brightness_low:new Wt.aI(u,F.u_brightness_low),u_brightness_high:new Wt.aI(u,F.u_brightness_high),u_saturation_factor:new Wt.aI(u,F.u_saturation_factor),u_contrast_factor:new Wt.aI(u,F.u_contrast_factor),u_spin_weights:new Wt.aN(u,F.u_spin_weights)}),symbolIcon:(u,F)=>({u_is_size_zoom_constant:new Wt.aH(u,F.u_is_size_zoom_constant),u_is_size_feature_constant:new Wt.aH(u,F.u_is_size_feature_constant),u_size_t:new Wt.aI(u,F.u_size_t),u_size:new Wt.aI(u,F.u_size),u_camera_to_center_distance:new Wt.aI(u,F.u_camera_to_center_distance),u_pitch:new Wt.aI(u,F.u_pitch),u_rotate_symbol:new Wt.aH(u,F.u_rotate_symbol),u_aspect_ratio:new Wt.aI(u,F.u_aspect_ratio),u_fade_change:new Wt.aI(u,F.u_fade_change),u_matrix:new Wt.aJ(u,F.u_matrix),u_label_plane_matrix:new Wt.aJ(u,F.u_label_plane_matrix),u_coord_matrix:new Wt.aJ(u,F.u_coord_matrix),u_is_text:new Wt.aH(u,F.u_is_text),u_pitch_with_map:new Wt.aH(u,F.u_pitch_with_map),u_is_along_line:new Wt.aH(u,F.u_is_along_line),u_is_variable_anchor:new Wt.aH(u,F.u_is_variable_anchor),u_texsize:new Wt.aO(u,F.u_texsize),u_texture:new Wt.aH(u,F.u_texture),u_translation:new Wt.aO(u,F.u_translation),u_pitched_scale:new Wt.aI(u,F.u_pitched_scale)}),symbolSDF:(u,F)=>({u_is_size_zoom_constant:new Wt.aH(u,F.u_is_size_zoom_constant),u_is_size_feature_constant:new Wt.aH(u,F.u_is_size_feature_constant),u_size_t:new Wt.aI(u,F.u_size_t),u_size:new Wt.aI(u,F.u_size),u_camera_to_center_distance:new Wt.aI(u,F.u_camera_to_center_distance),u_pitch:new Wt.aI(u,F.u_pitch),u_rotate_symbol:new Wt.aH(u,F.u_rotate_symbol),u_aspect_ratio:new Wt.aI(u,F.u_aspect_ratio),u_fade_change:new Wt.aI(u,F.u_fade_change),u_matrix:new Wt.aJ(u,F.u_matrix),u_label_plane_matrix:new Wt.aJ(u,F.u_label_plane_matrix),u_coord_matrix:new Wt.aJ(u,F.u_coord_matrix),u_is_text:new Wt.aH(u,F.u_is_text),u_pitch_with_map:new Wt.aH(u,F.u_pitch_with_map),u_is_along_line:new Wt.aH(u,F.u_is_along_line),u_is_variable_anchor:new Wt.aH(u,F.u_is_variable_anchor),u_texsize:new Wt.aO(u,F.u_texsize),u_texture:new Wt.aH(u,F.u_texture),u_gamma_scale:new Wt.aI(u,F.u_gamma_scale),u_device_pixel_ratio:new Wt.aI(u,F.u_device_pixel_ratio),u_is_halo:new Wt.aH(u,F.u_is_halo),u_translation:new Wt.aO(u,F.u_translation),u_pitched_scale:new Wt.aI(u,F.u_pitched_scale)}),symbolTextAndIcon:(u,F)=>({u_is_size_zoom_constant:new Wt.aH(u,F.u_is_size_zoom_constant),u_is_size_feature_constant:new Wt.aH(u,F.u_is_size_feature_constant),u_size_t:new Wt.aI(u,F.u_size_t),u_size:new Wt.aI(u,F.u_size),u_camera_to_center_distance:new Wt.aI(u,F.u_camera_to_center_distance),u_pitch:new Wt.aI(u,F.u_pitch),u_rotate_symbol:new Wt.aH(u,F.u_rotate_symbol),u_aspect_ratio:new Wt.aI(u,F.u_aspect_ratio),u_fade_change:new Wt.aI(u,F.u_fade_change),u_matrix:new Wt.aJ(u,F.u_matrix),u_label_plane_matrix:new Wt.aJ(u,F.u_label_plane_matrix),u_coord_matrix:new Wt.aJ(u,F.u_coord_matrix),u_is_text:new Wt.aH(u,F.u_is_text),u_pitch_with_map:new Wt.aH(u,F.u_pitch_with_map),u_is_along_line:new Wt.aH(u,F.u_is_along_line),u_is_variable_anchor:new Wt.aH(u,F.u_is_variable_anchor),u_texsize:new Wt.aO(u,F.u_texsize),u_texsize_icon:new Wt.aO(u,F.u_texsize_icon),u_texture:new Wt.aH(u,F.u_texture),u_texture_icon:new Wt.aH(u,F.u_texture_icon),u_gamma_scale:new Wt.aI(u,F.u_gamma_scale),u_device_pixel_ratio:new Wt.aI(u,F.u_device_pixel_ratio),u_is_halo:new Wt.aH(u,F.u_is_halo),u_translation:new Wt.aO(u,F.u_translation),u_pitched_scale:new Wt.aI(u,F.u_pitched_scale)}),background:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_opacity:new Wt.aI(u,F.u_opacity),u_color:new Wt.aL(u,F.u_color)}),backgroundPattern:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_opacity:new Wt.aI(u,F.u_opacity),u_image:new Wt.aH(u,F.u_image),u_pattern_tl_a:new Wt.aO(u,F.u_pattern_tl_a),u_pattern_br_a:new Wt.aO(u,F.u_pattern_br_a),u_pattern_tl_b:new Wt.aO(u,F.u_pattern_tl_b),u_pattern_br_b:new Wt.aO(u,F.u_pattern_br_b),u_texsize:new Wt.aO(u,F.u_texsize),u_mix:new Wt.aI(u,F.u_mix),u_pattern_size_a:new Wt.aO(u,F.u_pattern_size_a),u_pattern_size_b:new Wt.aO(u,F.u_pattern_size_b),u_scale_a:new Wt.aI(u,F.u_scale_a),u_scale_b:new Wt.aI(u,F.u_scale_b),u_pixel_coord_upper:new Wt.aO(u,F.u_pixel_coord_upper),u_pixel_coord_lower:new Wt.aO(u,F.u_pixel_coord_lower),u_tile_units_to_pixels:new Wt.aI(u,F.u_tile_units_to_pixels)}),terrain:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_texture:new Wt.aH(u,F.u_texture),u_ele_delta:new Wt.aI(u,F.u_ele_delta),u_fog_matrix:new Wt.aJ(u,F.u_fog_matrix),u_fog_color:new Wt.aL(u,F.u_fog_color),u_fog_ground_blend:new Wt.aI(u,F.u_fog_ground_blend),u_fog_ground_blend_opacity:new Wt.aI(u,F.u_fog_ground_blend_opacity),u_horizon_color:new Wt.aL(u,F.u_horizon_color),u_horizon_fog_blend:new Wt.aI(u,F.u_horizon_fog_blend)}),terrainDepth:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_ele_delta:new Wt.aI(u,F.u_ele_delta)}),terrainCoords:(u,F)=>({u_matrix:new Wt.aJ(u,F.u_matrix),u_texture:new Wt.aH(u,F.u_texture),u_terrain_coords_id:new Wt.aI(u,F.u_terrain_coords_id),u_ele_delta:new Wt.aI(u,F.u_ele_delta)}),sky:(u,F)=>({u_sky_color:new Wt.aL(u,F.u_sky_color),u_horizon_color:new Wt.aL(u,F.u_horizon_color),u_horizon:new Wt.aI(u,F.u_horizon),u_sky_horizon_blend:new Wt.aI(u,F.u_sky_horizon_blend)})};class $e{constructor(u,F,Wt){this.context=u;const Xe=u.gl;this.buffer=Xe.createBuffer(),this.dynamicDraw=Boolean(Wt),this.context.unbindVAO(),u.bindElementBuffer.set(this.buffer),Xe.bufferData(Xe.ELEMENT_ARRAY_BUFFER,F.arrayBuffer,this.dynamicDraw?Xe.DYNAMIC_DRAW:Xe.STATIC_DRAW),this.dynamicDraw||delete F.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(u){const F=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),F.bufferSubData(F.ELEMENT_ARRAY_BUFFER,0,u.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ke{constructor(u,F,Wt,Xe){this.length=F.length,this.attributes=Wt,this.itemSize=F.bytesPerElement,this.dynamicDraw=Xe,this.context=u;const Vi=u.gl;this.buffer=Vi.createBuffer(),u.bindVertexBuffer.set(this.buffer),Vi.bufferData(Vi.ARRAY_BUFFER,F.arrayBuffer,this.dynamicDraw?Vi.DYNAMIC_DRAW:Vi.STATIC_DRAW),this.dynamicDraw||delete F.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(u){if(u.length!==this.length)throw new Error(`Length of new data is ${u.length}, which doesn't match current length of ${this.length}`);const F=this.context.gl;this.bind(),F.bufferSubData(F.ARRAY_BUFFER,0,u.arrayBuffer)}enableAttributes(u,F){for(let Wt=0;Wt<this.attributes.length;Wt++){const Xe=F.attributes[this.attributes[Wt].name];void 0!==Xe&&u.enableVertexAttribArray(Xe)}}setVertexAttribPointers(u,F,Wt){for(let Xe=0;Xe<this.attributes.length;Xe++){const Vi=this.attributes[Xe],fr=F.attributes[Vi.name];void 0!==fr&&u.vertexAttribPointer(fr,Vi.components,u[bl[Vi.type]],!1,this.itemSize,Vi.offset+this.itemSize*(Wt||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Al=new WeakMap;function Ye(u){var F;if(Al.has(u))return Al.get(u);{const Wt=null===(F=u.getParameter(u.VERSION))||void 0===F?void 0:F.startsWith("WebGL 2.0");return Al.set(u,Wt),Wt}}class Qe{constructor(u){this.gl=u.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(u){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ti extends Qe{getDefault(){return Wt.aM.transparent}set(u){const F=this.current;(u.r!==F.r||u.g!==F.g||u.b!==F.b||u.a!==F.a||this.dirty)&&(this.gl.clearColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class ei extends Qe{getDefault(){return 1}set(u){(u!==this.current||this.dirty)&&(this.gl.clearDepth(u),this.current=u,this.dirty=!1)}}class ii extends Qe{getDefault(){return 0}set(u){(u!==this.current||this.dirty)&&(this.gl.clearStencil(u),this.current=u,this.dirty=!1)}}class ai extends Qe{getDefault(){return[!0,!0,!0,!0]}set(u){const F=this.current;(u[0]!==F[0]||u[1]!==F[1]||u[2]!==F[2]||u[3]!==F[3]||this.dirty)&&(this.gl.colorMask(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class si extends Qe{getDefault(){return!0}set(u){(u!==this.current||this.dirty)&&(this.gl.depthMask(u),this.current=u,this.dirty=!1)}}class oi extends Qe{getDefault(){return 255}set(u){(u!==this.current||this.dirty)&&(this.gl.stencilMask(u),this.current=u,this.dirty=!1)}}class ri extends Qe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(u){const F=this.current;(u.func!==F.func||u.ref!==F.ref||u.mask!==F.mask||this.dirty)&&(this.gl.stencilFunc(u.func,u.ref,u.mask),this.current=u,this.dirty=!1)}}class ni extends Qe{getDefault(){const u=this.gl;return[u.KEEP,u.KEEP,u.KEEP]}set(u){const F=this.current;(u[0]!==F[0]||u[1]!==F[1]||u[2]!==F[2]||this.dirty)&&(this.gl.stencilOp(u[0],u[1],u[2]),this.current=u,this.dirty=!1)}}class li extends Qe{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;u?F.enable(F.STENCIL_TEST):F.disable(F.STENCIL_TEST),this.current=u,this.dirty=!1}}class hi extends Qe{getDefault(){return[0,1]}set(u){const F=this.current;(u[0]!==F[0]||u[1]!==F[1]||this.dirty)&&(this.gl.depthRange(u[0],u[1]),this.current=u,this.dirty=!1)}}class ci extends Qe{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;u?F.enable(F.DEPTH_TEST):F.disable(F.DEPTH_TEST),this.current=u,this.dirty=!1}}class ui extends Qe{getDefault(){return this.gl.LESS}set(u){(u!==this.current||this.dirty)&&(this.gl.depthFunc(u),this.current=u,this.dirty=!1)}}class di extends Qe{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;u?F.enable(F.BLEND):F.disable(F.BLEND),this.current=u,this.dirty=!1}}class _i extends Qe{getDefault(){const u=this.gl;return[u.ONE,u.ZERO]}set(u){const F=this.current;(u[0]!==F[0]||u[1]!==F[1]||this.dirty)&&(this.gl.blendFunc(u[0],u[1]),this.current=u,this.dirty=!1)}}class pi extends Qe{getDefault(){return Wt.aM.transparent}set(u){const F=this.current;(u.r!==F.r||u.g!==F.g||u.b!==F.b||u.a!==F.a||this.dirty)&&(this.gl.blendColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class mi extends Qe{getDefault(){return this.gl.FUNC_ADD}set(u){(u!==this.current||this.dirty)&&(this.gl.blendEquation(u),this.current=u,this.dirty=!1)}}class fi extends Qe{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;u?F.enable(F.CULL_FACE):F.disable(F.CULL_FACE),this.current=u,this.dirty=!1}}class gi extends Qe{getDefault(){return this.gl.BACK}set(u){(u!==this.current||this.dirty)&&(this.gl.cullFace(u),this.current=u,this.dirty=!1)}}class vi extends Qe{getDefault(){return this.gl.CCW}set(u){(u!==this.current||this.dirty)&&(this.gl.frontFace(u),this.current=u,this.dirty=!1)}}class xi extends Qe{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}}class yi extends Qe{getDefault(){return this.gl.TEXTURE0}set(u){(u!==this.current||this.dirty)&&(this.gl.activeTexture(u),this.current=u,this.dirty=!1)}}class bi extends Qe{getDefault(){const u=this.gl;return[0,0,u.drawingBufferWidth,u.drawingBufferHeight]}set(u){const F=this.current;(u[0]!==F[0]||u[1]!==F[1]||u[2]!==F[2]||u[3]!==F[3]||this.dirty)&&(this.gl.viewport(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class wi extends Qe{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;F.bindFramebuffer(F.FRAMEBUFFER,u),this.current=u,this.dirty=!1}}class Ti extends Qe{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;F.bindRenderbuffer(F.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class Ii extends Qe{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;F.bindTexture(F.TEXTURE_2D,u),this.current=u,this.dirty=!1}}class Ei extends Qe{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;F.bindBuffer(F.ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class Pi extends Qe{getDefault(){return null}set(u){const F=this.gl;F.bindBuffer(F.ELEMENT_ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class Ci extends Qe{getDefault(){return null}set(u){var F;if(u===this.current&&!this.dirty)return;const Wt=this.gl;Ye(Wt)?Wt.bindVertexArray(u):null===(F=Wt.getExtension("OES_vertex_array_object"))||void 0===F||F.bindVertexArrayOES(u),this.current=u,this.dirty=!1}}class Si extends Qe{getDefault(){return 4}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;F.pixelStorei(F.UNPACK_ALIGNMENT,u),this.current=u,this.dirty=!1}}class zi extends Qe{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;F.pixelStorei(F.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),this.current=u,this.dirty=!1}}class Di extends Qe{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;F.pixelStorei(F.UNPACK_FLIP_Y_WEBGL,u),this.current=u,this.dirty=!1}}class Mi extends Qe{constructor(u,F){super(u),this.context=u,this.parent=F}getDefault(){return null}}class Ai extends Mi{setDirty(){this.dirty=!0}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const F=this.gl;F.framebufferTexture2D(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}}class Ri extends Mi{set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const F=this.gl;F.framebufferRenderbuffer(F.FRAMEBUFFER,F.DEPTH_ATTACHMENT,F.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class ki extends Mi{set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const F=this.gl;F.framebufferRenderbuffer(F.FRAMEBUFFER,F.DEPTH_STENCIL_ATTACHMENT,F.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class Li{constructor(u,F,Wt,Xe,Vi){this.context=u,this.width=F,this.height=Wt;const fr=u.gl,_r=this.framebuffer=fr.createFramebuffer();if(this.colorAttachment=new Ai(u,_r),Xe)this.depthAttachment=Vi?new ki(u,_r):new Ri(u,_r);else if(Vi)throw new Error("Stencil cannot be set without depth");if(fr.checkFramebufferStatus(fr.FRAMEBUFFER)!==fr.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const u=this.context.gl,F=this.colorAttachment.get();if(F&&u.deleteTexture(F),this.depthAttachment){const F=this.depthAttachment.get();F&&u.deleteRenderbuffer(F)}u.deleteFramebuffer(this.framebuffer)}}class Fi{constructor(u,F,Wt){this.blendFunction=u,this.blendColor=F,this.mask=Wt}}Fi.Replace=[1,0],Fi.disabled=new Fi(Fi.Replace,Wt.aM.transparent,[!1,!1,!1,!1]),Fi.unblended=new Fi(Fi.Replace,Wt.aM.transparent,[!0,!0,!0,!0]),Fi.alphaBlended=new Fi([1,771],Wt.aM.transparent,[!0,!0,!0,!0]);class Bi{constructor(u){var F,Wt;if(this.gl=u,this.clearColor=new ti(this),this.clearDepth=new ei(this),this.clearStencil=new ii(this),this.colorMask=new ai(this),this.depthMask=new si(this),this.stencilMask=new oi(this),this.stencilFunc=new ri(this),this.stencilOp=new ni(this),this.stencilTest=new li(this),this.depthRange=new hi(this),this.depthTest=new ci(this),this.depthFunc=new ui(this),this.blend=new di(this),this.blendFunc=new _i(this),this.blendColor=new pi(this),this.blendEquation=new mi(this),this.cullFace=new fi(this),this.cullFaceSide=new gi(this),this.frontFace=new vi(this),this.program=new xi(this),this.activeTexture=new yi(this),this.viewport=new bi(this),this.bindFramebuffer=new wi(this),this.bindRenderbuffer=new Ti(this),this.bindTexture=new Ii(this),this.bindVertexBuffer=new Ei(this),this.bindElementBuffer=new Pi(this),this.bindVertexArray=new Ci(this),this.pixelStoreUnpack=new Si(this),this.pixelStoreUnpackPremultiplyAlpha=new zi(this),this.pixelStoreUnpackFlipY=new Di(this),this.extTextureFilterAnisotropic=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=u.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE),Ye(u)){this.HALF_FLOAT=u.HALF_FLOAT;const Xe=u.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(F=u.RGBA16F)&&void 0!==F?F:null==Xe?void 0:Xe.RGBA16F_EXT,this.RGB16F=null!==(Wt=u.RGB16F)&&void 0!==Wt?Wt:null==Xe?void 0:Xe.RGB16F_EXT,u.getExtension("EXT_color_buffer_float")}else{u.getExtension("EXT_color_buffer_half_float"),u.getExtension("OES_texture_half_float_linear");const F=u.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==F?void 0:F.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(u,F){return new $e(this,u,F)}createVertexBuffer(u,F,Wt){return new Ke(this,u,F,Wt)}createRenderbuffer(u,F,Wt){const Xe=this.gl,Vi=Xe.createRenderbuffer();return this.bindRenderbuffer.set(Vi),Xe.renderbufferStorage(Xe.RENDERBUFFER,u,F,Wt),this.bindRenderbuffer.set(null),Vi}createFramebuffer(u,F,Wt,Xe){return new Li(this,u,F,Wt,Xe)}clear({color:u,depth:F,stencil:Wt}){const Xe=this.gl;let Vi=0;u&&(Vi|=Xe.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),void 0!==F&&(Vi|=Xe.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(F),this.depthMask.set(!0)),void 0!==Wt&&(Vi|=Xe.STENCIL_BUFFER_BIT,this.clearStencil.set(Wt),this.stencilMask.set(255)),Xe.clear(Vi)}setCullFace(u){!1===u.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(u.mode),this.frontFace.set(u.frontFace))}setDepthMode(u){u.func!==this.gl.ALWAYS||u.mask?(this.depthTest.set(!0),this.depthFunc.set(u.func),this.depthMask.set(u.mask),this.depthRange.set(u.range)):this.depthTest.set(!1)}setStencilMode(u){u.test.func!==this.gl.ALWAYS||u.mask?(this.stencilTest.set(!0),this.stencilMask.set(u.mask),this.stencilOp.set([u.fail,u.depthFail,u.pass]),this.stencilFunc.set({func:u.test.func,ref:u.ref,mask:u.test.mask})):this.stencilTest.set(!1)}setColorMode(u){Wt.aE(u.blendFunction,Fi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(u.blendFunction),this.blendColor.set(u.blendColor)),this.colorMask.set(u.mask)}createVertexArray(){var u;return Ye(this.gl)?this.gl.createVertexArray():null===(u=this.gl.getExtension("OES_vertex_array_object"))||void 0===u?void 0:u.createVertexArrayOES()}deleteVertexArray(u){var F;return Ye(this.gl)?this.gl.deleteVertexArray(u):null===(F=this.gl.getExtension("OES_vertex_array_object"))||void 0===F?void 0:F.deleteVertexArrayOES(u)}unbindVAO(){this.bindVertexArray.set(null)}}class Oi{constructor(u,F,Wt){this.func=u,this.mask=F,this.range=Wt}}Oi.ReadOnly=!1,Oi.ReadWrite=!0,Oi.disabled=new Oi(519,Oi.ReadOnly,[0,1]);const Ml=7680;class Ui{constructor(u,F,Wt,Xe,Vi,fr){this.test=u,this.ref=F,this.mask=Wt,this.fail=Xe,this.depthFail=Vi,this.pass=fr}}Ui.disabled=new Ui({func:519,mask:0},0,0,Ml,Ml,Ml);class ji{constructor(u,F,Wt){this.enable=u,this.mode=F,this.frontFace=Wt}}let kl;function qi(u,F,Xe,Vi,fr){const _r=u.context,wr=_r.gl,Ar=u.useProgram("collisionBox"),Kr=[];let In=0,ns=0;for(let ha=0;ha<Vi.length;ha++){const ua=Vi[ha],Da=F.getTile(ua).getBucket(Xe);if(!Da)continue;const io=fr?Da.textCollisionBox:Da.iconCollisionBox,no=Da.collisionCircleArray;if(no.length>0){const F=Wt.H();Wt.aQ(F,Da.placementInvProjMatrix,u.transform.glCoordMatrix),Wt.aQ(F,F,Da.placementViewportMatrix),Kr.push({circleArray:no,circleOffset:ns,transform:ua.posMatrix,invTransform:F,coord:ua}),In+=no.length/4,ns=In}io&&Ar.draw(_r,wr.LINES,Oi.disabled,Ui.disabled,u.colorModeForRenderPass(),ji.disabled,{u_matrix:ua.posMatrix,u_pixel_extrude_scale:[1/(ca=u.transform).width,1/ca.height]},u.style.map.terrain&&u.style.map.terrain.getTerrainData(ua),Xe.id,io.layoutVertexBuffer,io.indexBuffer,io.segments,null,u.transform.zoom,null,null,io.collisionVertexBuffer)}var ca;if(!fr||!Kr.length)return;const ha=u.useProgram("collisionCircle"),ua=new Wt.aR;ua.resize(4*In),ua._trim();let Da=0;for(const u of Kr)for(let F=0;F<u.circleArray.length/4;F++){const Wt=4*F,Xe=u.circleArray[Wt+0],Vi=u.circleArray[Wt+1],fr=u.circleArray[Wt+2],_r=u.circleArray[Wt+3];ua.emplace(Da++,Xe,Vi,fr,_r,0),ua.emplace(Da++,Xe,Vi,fr,_r,1),ua.emplace(Da++,Xe,Vi,fr,_r,2),ua.emplace(Da++,Xe,Vi,fr,_r,3)}(!kl||kl.length<2*In)&&(kl=function(u){const F=2*u,Xe=new Wt.aT;Xe.resize(F),Xe._trim();for(let u=0;u<F;u++){const F=6*u;Xe.uint16[F+0]=4*u+0,Xe.uint16[F+1]=4*u+1,Xe.uint16[F+2]=4*u+2,Xe.uint16[F+3]=4*u+2,Xe.uint16[F+4]=4*u+3,Xe.uint16[F+5]=4*u+0}return Xe}(In));const io=_r.createIndexBuffer(kl,!0),no=_r.createVertexBuffer(ua,Wt.aS.members,!0);for(const F of Kr){const Vi=Se(F.transform,F.invTransform,u.transform);ha.draw(_r,wr.TRIANGLES,Oi.disabled,Ui.disabled,u.colorModeForRenderPass(),ji.disabled,Vi,u.style.map.terrain&&u.style.map.terrain.getTerrainData(F.coord),Xe.id,no,io,Wt.a0.simpleSegment(0,2*F.circleOffset,F.circleArray.length,F.circleArray.length/2),null,u.transform.zoom,null,null,null)}no.destroy(),io.destroy()}ji.disabled=new ji(!1,1029,2305),ji.backCCW=new ji(!0,1029,2305);const Dl=Wt.an(new Float32Array(16));function Gi(u,F,Xe,Vi,fr,_r){const{horizontalAlign:wr,verticalAlign:Ar}=Wt.au(u);return new Wt.P((-(wr-.5)*F/fr+Vi[0])*_r,(-(Ar-.5)*Xe/fr+Vi[1])*_r)}function Hi(u,F,Xe,Vi,fr,_r){const wr=F.tileAnchorPoint.add(new Wt.P(F.translation[0],F.translation[1]));if(F.pitchWithMap){let u=Vi.mult(_r);Xe||(u=u.rotate(-fr));const Wt=wr.add(u);return xt(Wt.x,Wt.y,F.labelPlaneMatrix,F.getElevation).point}if(Xe){const Wt=St(F.tileAnchorPoint.x+1,F.tileAnchorPoint.y,F).point.sub(u),Xe=Math.atan(Wt.y/Wt.x)+(Wt.x<0?Math.PI:0);return u.add(Vi.rotate(Xe))}return u.add(Vi)}function Wi(u,F,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca,ha,ua){const Da=u.text.placedSymbolArray,io=u.text.dynamicLayoutVertexArray,no=u.icon.dynamicLayoutVertexArray,so={};io.clear();for(let no=0;no<Da.length;no++){const ao=Da.get(no),oo=ao.hidden||!ao.crossTileID||u.allowVerticalPlacement&&!ao.placedOrientation?null:Vi[ao.crossTileID];if(oo){const Vi=new Wt.P(ao.anchorX,ao.anchorY),Da={getElevation:ua,width:fr.width,height:fr.height,labelPlaneMatrix:_r,lineVertexArray:null,pitchWithMap:Xe,projection:ns,projectionCache:null,tileAnchorPoint:Vi,translation:ca,unwrappedTileID:ha},no=Xe?xt(Vi.x,Vi.y,wr,ua):St(Vi.x,Vi.y,Da),co=yt(fr.cameraToCenterDistance,no.signedDistanceFromCamera);let ho=Wt.ai(u.textSizeData,Kr,ao)*co/Wt.ap;Xe&&(ho*=u.tilePixelRatio/Ar);const{width:go,height:xo,anchor:Io,textOffset:ko,textBoxScale:Co}=oo,zo=Gi(Io,go,xo,ko,Co,ho),Bo=ns.getPitchedTextCorrection(fr,Vi.add(new Wt.P(ca[0],ca[1])),ha),al=Hi(no.point,Da,F,zo,fr.angle,Bo),ol=u.allowVerticalPlacement&&ao.placedOrientation===Wt.ah.vertical?Math.PI/2:0;for(let u=0;u<ao.numGlyphs;u++)Wt.aj(io,al,ol);In&&ao.associatedIconIndex>=0&&(so[ao.associatedIconIndex]={shiftedAnchor:al,angle:ol})}else Rt(ao.numGlyphs,io)}if(In){no.clear();const F=u.icon.placedSymbolArray;for(let u=0;u<F.length;u++){const Xe=F.get(u);if(Xe.hidden)Rt(Xe.numGlyphs,no);else{const F=so[u];if(F)for(let u=0;u<Xe.numGlyphs;u++)Wt.aj(no,F.shiftedAnchor,F.angle);else Rt(Xe.numGlyphs,no)}}u.icon.dynamicLayoutVertexBuffer.updateData(no)}u.text.dynamicLayoutVertexBuffer.updateData(io)}function $i(u,F,Wt){return Wt.iconsInText&&F?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function Xi(u,F,Xe,Vi,fr,_r,wr,Ar,Kr,In,ns,ca){const ha=u.context,ua=ha.gl,Da=u.transform,io=ie(),no="map"===Ar,so="map"===Kr,ao="viewport"!==Ar&&"point"!==Xe.layout.get("symbol-placement"),oo=no&&!so&&!ao,co=!so&&ao,ho=!Xe.layout.get("symbol-sort-key").isConstant();let go=!1;const xo=u.depthModeForSublayer(0,Oi.ReadOnly),Io=Xe._unevaluatedLayout.hasValue("text-variable-anchor")||Xe._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ko=[],Co=io.getCircleRadiusCorrection(Da);for(const Ar of Vi){const Vi=F.getTile(Ar),Kr=Vi.getBucket(Xe);if(!Kr)continue;const ns=fr?Kr.text:Kr.icon;if(!ns||!ns.segments.get().length||!ns.hasVisibleVertices)continue;const ca=ns.programConfigurations.get(Xe.id),ha=fr||Kr.sdfIcons,xo=fr?Kr.textSizeData:Kr.iconSizeData,zo=so||0!==Da.pitch,Bo=u.useProgram($i(ha,fr,Kr),ca),al=Wt.ag(xo,Da.zoom),ol=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Ar);let ll,cl,hl,dl,pl=[0,0],fl=null;if(fr)cl=Vi.glyphAtlasTexture,hl=ua.LINEAR,ll=Vi.glyphAtlasTexture.size,Kr.iconsInText&&(pl=Vi.imageAtlasTexture.size,fl=Vi.imageAtlasTexture,dl=zo||u.options.rotating||u.options.zooming||"composite"===xo.kind||"camera"===xo.kind?ua.LINEAR:ua.NEAREST);else{const F=1!==Xe.layout.get("icon-size").constantOr(0)||Kr.iconsNeedLinear;cl=Vi.imageAtlasTexture,hl=ha||u.options.rotating||u.options.zooming||F||zo?ua.LINEAR:ua.NEAREST,ll=Vi.imageAtlasTexture.size}const yl=Bt(Vi,1,u.transform.zoom),vl=co?Ar.posMatrix:Dl,bl=gt(vl,so,no,u.transform,yl),Al=vt(vl,so,no,u.transform,yl),Ml=vt(Ar.posMatrix,so,no,u.transform,yl),kl=io.translatePosition(u.transform,Vi,_r,wr),Ll=Io&&Kr.hasTextData(),Rl="none"!==Xe.layout.get("icon-text-fit")&&Ll&&Kr.hasIconData();if(ao){const F=u.style.map.terrain?(F,Wt)=>u.style.map.terrain.getElevation(Ar,F,Wt):null,Wt="map"===Xe.layout.get("text-rotation-alignment");wt(Kr,Ar.posMatrix,u,fr,bl,Ml,so,In,Wt,io,Ar.toUnwrapped(),Da.width,Da.height,kl,F)}const Bl=Ar.posMatrix,Ol=fr&&Io||Rl,Vl=ao||Ol?Dl:bl,jl=Al,Nl=ha&&0!==Xe.paint.get(fr?"text-halo-width":"icon-halo-width").constantOr(1);let Ul;Ul=ha?Kr.iconsInText?Ve(xo.kind,al,oo,so,ao,Ol,u,Bl,Vl,jl,kl,ll,pl,Co):qe(xo.kind,al,oo,so,ao,Ol,u,Bl,Vl,jl,kl,fr,ll,!0,Co):Ze(xo.kind,al,oo,so,ao,Ol,u,Bl,Vl,jl,kl,fr,ll,Co);const $l={program:Bo,buffers:ns,uniformValues:Ul,atlasTexture:cl,atlasTextureIcon:fl,atlasInterpolation:hl,atlasInterpolationIcon:dl,isSDF:ha,hasHalo:Nl};if(ho&&Kr.canOverlap){go=!0;const u=ns.segments.get();for(const F of u)ko.push({segments:new Wt.a0([F]),sortKey:F.sortKey,state:$l,terrainData:ol})}else ko.push({segments:ns.segments,sortKey:0,state:$l,terrainData:ol})}go&&ko.sort(((u,F)=>u.sortKey-F.sortKey));for(const F of ko){const Wt=F.state;if(ha.activeTexture.set(ua.TEXTURE0),Wt.atlasTexture.bind(Wt.atlasInterpolation,ua.CLAMP_TO_EDGE),Wt.atlasTextureIcon&&(ha.activeTexture.set(ua.TEXTURE1),Wt.atlasTextureIcon&&Wt.atlasTextureIcon.bind(Wt.atlasInterpolationIcon,ua.CLAMP_TO_EDGE)),Wt.isSDF){const Vi=Wt.uniformValues;Wt.hasHalo&&(Vi.u_is_halo=1,Ki(Wt.buffers,F.segments,Xe,u,Wt.program,xo,ns,ca,Vi,F.terrainData)),Vi.u_is_halo=0}Ki(Wt.buffers,F.segments,Xe,u,Wt.program,xo,ns,ca,Wt.uniformValues,F.terrainData)}}function Ki(u,F,Wt,Xe,Vi,fr,_r,wr,Ar,Kr){const In=Xe.context;Vi.draw(In,In.gl.TRIANGLES,fr,_r,wr,ji.disabled,Ar,Kr,Wt.id,u.layoutVertexBuffer,u.indexBuffer,F,Wt.paint,Xe.transform.zoom,u.programConfigurations.get(Wt.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function Ji(u,F,Xe,Vi){const fr=u.context,_r=fr.gl,wr=Ui.disabled,Ar=new Fi([_r.ONE,_r.ONE],Wt.aM.transparent,[!0,!0,!0,!0]),Kr=F.getBucket(Xe);if(!Kr)return;const In=Vi.key;let ns=Xe.heatmapFbos.get(In);ns||(ns=Qi(fr,F.tileSize,F.tileSize),Xe.heatmapFbos.set(In,ns)),fr.bindFramebuffer.set(ns.framebuffer),fr.viewport.set([0,0,F.tileSize,F.tileSize]),fr.clear({color:Wt.aM.transparent});const ca=Kr.programConfigurations.get(Xe.id),ha=u.useProgram("heatmap",ca),ua=u.style.map.terrain.getTerrainData(Vi);ha.draw(fr,_r.TRIANGLES,Oi.disabled,wr,Ar,ji.disabled,Me(Vi.posMatrix,F,u.transform.zoom,Xe.paint.get("heatmap-intensity")),ua,Xe.id,Kr.layoutVertexBuffer,Kr.indexBuffer,Kr.segments,Xe.paint,u.transform.zoom,ca)}function Yi(u,F,Wt){const Xe=u.context,Vi=Xe.gl;Xe.setColorMode(u.colorModeForRenderPass());const fr=ta(Xe,F),_r=Wt.key,wr=F.heatmapFbos.get(_r);wr&&(Xe.activeTexture.set(Vi.TEXTURE0),Vi.bindTexture(Vi.TEXTURE_2D,wr.colorAttachment.get()),Xe.activeTexture.set(Vi.TEXTURE1),fr.bind(Vi.LINEAR,Vi.CLAMP_TO_EDGE),u.useProgram("heatmapTexture").draw(Xe,Vi.TRIANGLES,Oi.disabled,Ui.disabled,u.colorModeForRenderPass(),ji.disabled,Ae(u,F,0,1),null,F.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments,F.paint,u.transform.zoom),wr.destroy(),F.heatmapFbos.delete(_r))}function Qi(u,F,Wt){var Xe,Vi;const fr=u.gl,_r=fr.createTexture();fr.bindTexture(fr.TEXTURE_2D,_r),fr.texParameteri(fr.TEXTURE_2D,fr.TEXTURE_WRAP_S,fr.CLAMP_TO_EDGE),fr.texParameteri(fr.TEXTURE_2D,fr.TEXTURE_WRAP_T,fr.CLAMP_TO_EDGE),fr.texParameteri(fr.TEXTURE_2D,fr.TEXTURE_MIN_FILTER,fr.LINEAR),fr.texParameteri(fr.TEXTURE_2D,fr.TEXTURE_MAG_FILTER,fr.LINEAR);const wr=null!==(Xe=u.HALF_FLOAT)&&void 0!==Xe?Xe:fr.UNSIGNED_BYTE,Ar=null!==(Vi=u.RGBA16F)&&void 0!==Vi?Vi:fr.RGBA;fr.texImage2D(fr.TEXTURE_2D,0,Ar,F,Wt,0,fr.RGBA,wr,null);const Kr=u.createFramebuffer(F,Wt,!1,!1);return Kr.colorAttachment.set(_r),Kr}function ta(u,F){return F.colorRampTexture||(F.colorRampTexture=new b(u,F.colorRamp,u.gl.RGBA)),F.colorRampTexture}function ea(u,F,Wt,Xe,Vi){if(!Wt||!Xe||!Xe.imageAtlas)return;const fr=Xe.imageAtlas.patternPositions;let _r=fr[Wt.to.toString()],wr=fr[Wt.from.toString()];if(!_r&&wr&&(_r=wr),!wr&&_r&&(wr=_r),!_r||!wr){const u=Vi.getPaintProperty(F);_r=fr[u],wr=fr[u]}_r&&wr&&u.setConstantPatternPositions(_r,wr)}function ia(u,F,Wt,Xe,Vi,fr,_r){const wr=u.context.gl,Ar="fill-pattern",Kr=Wt.paint.get(Ar),In=Kr&&Kr.constantOr(1),ns=Wt.getCrossfadeParameters();let ca,ha,ua,Da,io;_r?(ha=In&&!Wt.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ca=wr.LINES):(ha=In?"fillPattern":"fill",ca=wr.TRIANGLES);const no=Kr.constantOr(null);for(const Kr of Xe){const Xe=F.getTile(Kr);if(In&&!Xe.patternsLoaded())continue;const so=Xe.getBucket(Wt);if(!so)continue;const ao=so.programConfigurations.get(Wt.id),oo=u.useProgram(ha,ao),co=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Kr);In&&(u.context.activeTexture.set(wr.TEXTURE0),Xe.imageAtlasTexture.bind(wr.LINEAR,wr.CLAMP_TO_EDGE),ao.updatePaintBuffers(ns)),ea(ao,Ar,no,Xe,Wt);const ho=co?Kr:null,go=u.translatePosMatrix(ho?ho.posMatrix:Kr.posMatrix,Xe,Wt.paint.get("fill-translate"),Wt.paint.get("fill-translate-anchor"));if(_r){Da=so.indexBuffer2,io=so.segments2;const F=[wr.drawingBufferWidth,wr.drawingBufferHeight];ua="fillOutlinePattern"===ha&&In?Pe(go,u,ns,Xe,F):Ee(go,F)}else Da=so.indexBuffer,io=so.segments,ua=In?Ie(go,u,ns,Xe):Te(go);oo.draw(u.context,ca,Vi,u.stencilModeForClipping(Kr),fr,ji.disabled,ua,co,Wt.id,so.layoutVertexBuffer,Da,io,Wt.paint,u.transform.zoom,ao)}}function aa(u,F,Wt,Xe,Vi,fr,_r){const wr=u.context,Ar=wr.gl,Kr="fill-extrusion-pattern",In=Wt.paint.get(Kr),ns=In.constantOr(1),ca=Wt.getCrossfadeParameters(),ha=Wt.paint.get("fill-extrusion-opacity"),ua=In.constantOr(null);for(const In of Xe){const Xe=F.getTile(In),Da=Xe.getBucket(Wt);if(!Da)continue;const io=u.style.map.terrain&&u.style.map.terrain.getTerrainData(In),no=Da.programConfigurations.get(Wt.id),so=u.useProgram(ns?"fillExtrusionPattern":"fillExtrusion",no);ns&&(u.context.activeTexture.set(Ar.TEXTURE0),Xe.imageAtlasTexture.bind(Ar.LINEAR,Ar.CLAMP_TO_EDGE),no.updatePaintBuffers(ca)),ea(no,Kr,ua,Xe,Wt);const ao=u.translatePosMatrix(In.posMatrix,Xe,Wt.paint.get("fill-extrusion-translate"),Wt.paint.get("fill-extrusion-translate-anchor")),oo=Wt.paint.get("fill-extrusion-vertical-gradient"),co=ns?we(ao,u,oo,ha,In,ca,Xe):be(ao,u,oo,ha);so.draw(wr,wr.gl.TRIANGLES,Vi,fr,_r,ji.backCCW,co,io,Wt.id,Da.layoutVertexBuffer,Da.indexBuffer,Da.segments,Wt.paint,u.transform.zoom,no,u.style.map.terrain&&Da.centroidVertexBuffer)}}function sa(u,F,Wt,Xe,Vi,fr,_r){const wr=u.context,Ar=wr.gl,Kr=Wt.fbo;if(!Kr)return;const In=u.useProgram("hillshade"),ns=u.style.map.terrain&&u.style.map.terrain.getTerrainData(F);wr.activeTexture.set(Ar.TEXTURE0),Ar.bindTexture(Ar.TEXTURE_2D,Kr.colorAttachment.get()),In.draw(wr,Ar.TRIANGLES,Vi,fr,_r,ji.disabled,((u,F,Wt,Xe)=>{const Vi=Wt.paint.get("hillshade-shadow-color"),fr=Wt.paint.get("hillshade-highlight-color"),_r=Wt.paint.get("hillshade-accent-color");let wr=Wt.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Wt.paint.get("hillshade-illumination-anchor")&&(wr-=u.transform.angle);const Ar=!u.options.moving;return{u_matrix:Xe?Xe.posMatrix:u.transform.calculatePosMatrix(F.tileID.toUnwrapped(),Ar),u_image:0,u_latrange:Re(0,F.tileID),u_light:[Wt.paint.get("hillshade-exaggeration"),wr],u_shadow:Vi,u_highlight:fr,u_accent:_r}})(u,Wt,Xe,ns?F:null),ns,Xe.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}function oa(u,F,Xe,Vi,fr,_r){const wr=u.context,Ar=wr.gl,Kr=F.dem;if(Kr&&Kr.data){const In=Kr.dim,ns=Kr.stride,ca=Kr.getPixels();if(wr.activeTexture.set(Ar.TEXTURE1),wr.pixelStoreUnpackPremultiplyAlpha.set(!1),F.demTexture=F.demTexture||u.getTileTexture(ns),F.demTexture){const u=F.demTexture;u.update(ca,{premultiply:!1}),u.bind(Ar.NEAREST,Ar.CLAMP_TO_EDGE)}else F.demTexture=new b(wr,ca,Ar.RGBA,{premultiply:!1}),F.demTexture.bind(Ar.NEAREST,Ar.CLAMP_TO_EDGE);wr.activeTexture.set(Ar.TEXTURE0);let ha=F.fbo;if(!ha){const u=new b(wr,{width:In,height:In,data:null},Ar.RGBA);u.bind(Ar.LINEAR,Ar.CLAMP_TO_EDGE),ha=F.fbo=wr.createFramebuffer(In,In,!0,!1),ha.colorAttachment.set(u.texture)}wr.bindFramebuffer.set(ha.framebuffer),wr.viewport.set([0,0,In,In]),u.useProgram("hillshadePrepare").draw(wr,Ar.TRIANGLES,Vi,fr,_r,ji.disabled,((u,F)=>{const Xe=F.stride,Vi=Wt.H();return Wt.aP(Vi,0,Wt.X,-Wt.X,0,0,1),Wt.J(Vi,Vi,[0,-Wt.X,0]),{u_matrix:Vi,u_image:1,u_dimension:[Xe,Xe],u_zoom:u.overscaledZ,u_unpack:F.getUnpackVector()}})(F.tileID,Kr),null,Xe.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments),F.needsHillshadePrepare=!1}}function ra(u,F,Xe,Vi,fr,wr){const Ar=Vi.paint.get("raster-fade-duration");if(!wr&&Ar>0){const Vi=_r.now(),wr=(Vi-u.timeAdded)/Ar,Kr=F?(Vi-F.timeAdded)/Ar:-1,In=Xe.getSource(),ns=fr.coveringZoomLevel({tileSize:In.tileSize,roundZoom:In.roundZoom}),ca=!F||Math.abs(F.tileID.overscaledZ-ns)>Math.abs(u.tileID.overscaledZ-ns),ha=ca&&u.refreshedUponExpiration?1:Wt.ac(ca?wr:1-Kr,0,1);return u.refreshedUponExpiration&&wr>=1&&(u.refreshedUponExpiration=!1),F?{opacity:1,mix:1-ha}:{opacity:ha,mix:0}}return{opacity:1,mix:0}}const Ll=new Wt.aM(1,0,0,1),Rl=new Wt.aM(0,1,0,1),Bl=new Wt.aM(0,0,1,1),Ol=new Wt.aM(1,0,1,1),Vl=new Wt.aM(0,1,1,1);function da(u,F,Wt,Xe){pa(u,0,F+Wt/2,u.transform.width,Wt,Xe)}function _a(u,F,Wt,Xe){pa(u,F-Wt/2,0,Wt,u.transform.height,Xe)}function pa(u,F,Wt,Xe,Vi,fr){const _r=u.context,wr=_r.gl;wr.enable(wr.SCISSOR_TEST),wr.scissor(F*u.pixelRatio,Wt*u.pixelRatio,Xe*u.pixelRatio,Vi*u.pixelRatio),_r.clear({color:fr}),wr.disable(wr.SCISSOR_TEST)}function ma(u,F,Xe){const Vi=u.context,fr=Vi.gl,_r=Xe.posMatrix,wr=u.useProgram("debug"),Ar=Oi.disabled,Kr=Ui.disabled,In=u.colorModeForRenderPass(),ns="$debug",ca=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Xe);Vi.activeTexture.set(fr.TEXTURE0);const ha=F.getTileByID(Xe.key).latestRawTileData,ua=Math.floor((ha&&ha.byteLength||0)/1024),Da=F.getTile(Xe).tileSize,io=512/Math.min(Da,512)*(Xe.overscaledZ/u.transform.zoom)*.5;let no=Xe.canonical.toString();Xe.overscaledZ!==Xe.canonical.z&&(no+=` => ${Xe.overscaledZ}`),function(u,F){u.initDebugOverlayCanvas();const Wt=u.debugOverlayCanvas,Xe=u.context.gl,Vi=u.debugOverlayCanvas.getContext("2d");Vi.clearRect(0,0,Wt.width,Wt.height),Vi.shadowColor="white",Vi.shadowBlur=2,Vi.lineWidth=1.5,Vi.strokeStyle="white",Vi.textBaseline="top",Vi.font="bold 36px Open Sans, sans-serif",Vi.fillText(F,5,5),Vi.strokeText(F,5,5),u.debugOverlayTexture.update(Wt),u.debugOverlayTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE)}(u,`${no} ${ua}kB`),wr.draw(Vi,fr.TRIANGLES,Ar,Kr,Fi.alphaBlended,ji.disabled,ze(_r,Wt.aM.transparent,io),null,ns,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments),wr.draw(Vi,fr.LINE_STRIP,Ar,Kr,In,ji.disabled,ze(_r,Wt.aM.red),ca,ns,u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments)}function fa(u,F,Wt){const Xe=u.context,Vi=Xe.gl,fr=u.colorModeForRenderPass(),_r=new Oi(Vi.LEQUAL,Oi.ReadWrite,u.depthRangeFor3D),wr=u.useProgram("terrain"),Ar=F.getTerrainMesh();Xe.bindFramebuffer.set(null),Xe.viewport.set([0,0,u.width,u.height]);for(const Kr of Wt){const Wt=u.renderToTexture.getTexture(Kr),In=F.getTerrainData(Kr.tileID);Xe.activeTexture.set(Vi.TEXTURE0),Vi.bindTexture(Vi.TEXTURE_2D,Wt.texture);const ns=u.transform.calculatePosMatrix(Kr.tileID.toUnwrapped()),ca=F.getMeshFrameDelta(u.transform.zoom),ha=u.transform.calculateFogMatrix(Kr.tileID.toUnwrapped()),ua=ge(ns,ca,ha,u.style.sky,u.transform.pitch);wr.draw(Xe,Vi.TRIANGLES,_r,Ui.disabled,fr,ji.backCCW,ua,In,"terrain",Ar.vertexBuffer,Ar.indexBuffer,Ar.segments)}}class ga{constructor(u,F,Wt){this.vertexBuffer=u,this.indexBuffer=F,this.segments=Wt}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class va{constructor(u,F){this.context=new Bi(u),this.transform=F,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:Wt.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ut.maxUnderzooming+ut.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new he}resize(u,F,Wt){if(this.width=Math.floor(u*Wt),this.height=Math.floor(F*Wt),this.pixelRatio=Wt,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const u=this.context,F=new Wt.aX;F.emplaceBack(0,0),F.emplaceBack(Wt.X,0),F.emplaceBack(0,Wt.X),F.emplaceBack(Wt.X,Wt.X),this.tileExtentBuffer=u.createVertexBuffer(F,fl.members),this.tileExtentSegments=Wt.a0.simpleSegment(0,0,4,2);const Xe=new Wt.aX;Xe.emplaceBack(0,0),Xe.emplaceBack(Wt.X,0),Xe.emplaceBack(0,Wt.X),Xe.emplaceBack(Wt.X,Wt.X),this.debugBuffer=u.createVertexBuffer(Xe,fl.members),this.debugSegments=Wt.a0.simpleSegment(0,0,4,5);const Vi=new Wt.$;Vi.emplaceBack(0,0,0,0),Vi.emplaceBack(Wt.X,0,Wt.X,0),Vi.emplaceBack(0,Wt.X,0,Wt.X),Vi.emplaceBack(Wt.X,Wt.X,Wt.X,Wt.X),this.rasterBoundsBuffer=u.createVertexBuffer(Vi,co.members),this.rasterBoundsSegments=Wt.a0.simpleSegment(0,0,4,2);const fr=new Wt.aX;fr.emplaceBack(0,0),fr.emplaceBack(1,0),fr.emplaceBack(0,1),fr.emplaceBack(1,1),this.viewportBuffer=u.createVertexBuffer(fr,fl.members),this.viewportSegments=Wt.a0.simpleSegment(0,0,4,2);const _r=new Wt.aZ;_r.emplaceBack(0),_r.emplaceBack(1),_r.emplaceBack(3),_r.emplaceBack(2),_r.emplaceBack(0),this.tileBorderIndexBuffer=u.createIndexBuffer(_r);const wr=new Wt.aY;wr.emplaceBack(0,1,2),wr.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=u.createIndexBuffer(wr);const Ar=this.context.gl;this.stencilClearMode=new Ui({func:Ar.ALWAYS,mask:0},0,255,Ar.ZERO,Ar.ZERO,Ar.ZERO)}clearStencil(){const u=this.context,F=u.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const Xe=Wt.H();Wt.aP(Xe,0,this.width,this.height,0,0,1),Wt.K(Xe,Xe,[F.drawingBufferWidth,F.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(u,F.TRIANGLES,Oi.disabled,this.stencilClearMode,Fi.disabled,ji.disabled,De(Xe),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(u,F){if(this.currentStencilSource===u.source||!u.isTileClipped()||!F||!F.length)return;this.currentStencilSource=u.source;const Wt=this.context,Xe=Wt.gl;this.nextStencilID+F.length>256&&this.clearStencil(),Wt.setColorMode(Fi.disabled),Wt.setDepthMode(Oi.disabled);const Vi=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const u of F){const F=this._tileClippingMaskIDs[u.key]=this.nextStencilID++,fr=this.style.map.terrain&&this.style.map.terrain.getTerrainData(u);Vi.draw(Wt,Xe.TRIANGLES,Oi.disabled,new Ui({func:Xe.ALWAYS,mask:0},F,255,Xe.KEEP,Xe.KEEP,Xe.REPLACE),Fi.disabled,ji.disabled,De(u.posMatrix),fr,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const u=this.nextStencilID++,F=this.context.gl;return new Ui({func:F.NOTEQUAL,mask:255},u,255,F.KEEP,F.KEEP,F.REPLACE)}stencilModeForClipping(u){const F=this.context.gl;return new Ui({func:F.EQUAL,mask:255},this._tileClippingMaskIDs[u.key],0,F.KEEP,F.KEEP,F.REPLACE)}stencilConfigForOverlap(u){const F=this.context.gl,Wt=u.sort(((u,F)=>F.overscaledZ-u.overscaledZ)),Xe=Wt[Wt.length-1].overscaledZ,Vi=Wt[0].overscaledZ-Xe+1;if(Vi>1){this.currentStencilSource=void 0,this.nextStencilID+Vi>256&&this.clearStencil();const u={};for(let Wt=0;Wt<Vi;Wt++)u[Wt+Xe]=new Ui({func:F.GEQUAL,mask:255},Wt+this.nextStencilID,255,F.KEEP,F.KEEP,F.REPLACE);return this.nextStencilID+=Vi,[u,Wt]}return[{[Xe]:Ui.disabled},Wt]}colorModeForRenderPass(){const u=this.context.gl;if(this._showOverdrawInspector){const F=1/8;return new Fi([u.CONSTANT_COLOR,u.ONE],new Wt.aM(F,F,F,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Fi.unblended:Fi.alphaBlended}depthModeForSublayer(u,F,Wt){if(!this.opaquePassEnabledForLayer())return Oi.disabled;const Xe=1-((1+this.currentLayer)*this.numSublayers+u)*this.depthEpsilon;return new Oi(Wt||this.context.gl.LEQUAL,F,[Xe,Xe])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(u,F){this.style=u,this.options=F,this.lineAtlas=u.lineAtlas,this.imageManager=u.imageManager,this.glyphManager=u.glyphManager,this.symbolFadeChange=u.placement.symbolFadeChange(_r.now()),this.imageManager.beginFrame();const Xe=this.style._order,Vi=this.style.sourceCaches,fr={},wr={},Ar={};for(const u in Vi){const F=Vi[u];F.used&&F.prepare(this.context),fr[u]=F.getVisibleCoordinates(),wr[u]=fr[u].slice().reverse(),Ar[u]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let u=0;u<Xe.length;u++)if(this.style._layers[Xe[u]].is3D()){this.opaquePassCutoff=u;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const u of Xe){const F=this.style._layers[u];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const Wt=wr[F.source];("custom"===F.type||Wt.length)&&this.renderLayer(this,Vi[F.source],F,Wt)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:F.showOverdrawInspector?Wt.aM.black:Wt.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(u,F){const Xe=u.context,Vi=Xe.gl,fr=((u,F,Wt)=>({u_sky_color:u.properties.get("sky-color"),u_horizon_color:u.properties.get("horizon-color"),u_horizon:(F.height/2+F.getHorizon())*Wt,u_sky_horizon_blend:u.properties.get("sky-horizon-blend")*F.height/2*Wt}))(F,u.style.map.transform,u.pixelRatio),_r=new Oi(Vi.LEQUAL,Oi.ReadWrite,[0,1]),wr=Ui.disabled,Ar=u.colorModeForRenderPass(),Kr=u.useProgram("sky");if(!F.mesh){const u=new Wt.aX;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1);const Vi=new Wt.aY;Vi.emplaceBack(0,1,2),Vi.emplaceBack(0,2,3),F.mesh=new ga(Xe.createVertexBuffer(u,fl.members),Xe.createIndexBuffer(Vi),Wt.a0.simpleSegment(0,0,u.length,Vi.length))}Kr.draw(Xe,Vi.TRIANGLES,_r,wr,Ar,ji.disabled,fr,void 0,"sky",F.mesh.vertexBuffer,F.mesh.indexBuffer,F.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=F.showOverdrawInspector,this.depthRangeFor3D=[0,1-(u._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=Xe.length-1;this.currentLayer>=0;this.currentLayer--){const u=this.style._layers[Xe[this.currentLayer]],F=Vi[u.source],Wt=fr[u.source];this._renderTileClippingMasks(u,Wt),this.renderLayer(this,F,u,Wt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<Xe.length;this.currentLayer++){const u=this.style._layers[Xe[this.currentLayer]],F=Vi[u.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(u))continue;const Wt=("symbol"===u.type?Ar:wr)[u.source];this._renderTileClippingMasks(u,fr[u.source]),this.renderLayer(this,F,u,Wt)}if(this.options.showTileBoundaries){const u=function(u,F){let Wt=null;const Xe=Object.values(u._layers).flatMap((Wt=>Wt.source&&!Wt.isHidden(F)?[u.sourceCaches[Wt.source]]:[])),Vi=Xe.filter((u=>"vector"===u.getSource().type)),fr=Xe.filter((u=>"vector"!==u.getSource().type)),r=u=>{(!Wt||Wt.getSource().maxzoom<u.getSource().maxzoom)&&(Wt=u)};return Vi.forEach((u=>r(u))),Wt||fr.forEach((u=>r(u))),Wt}(this.style,this.transform.zoom);u&&function(u,F,Wt){for(let Xe=0;Xe<Wt.length;Xe++)ma(u,F,Wt[Xe])}(this,u,u.getVisibleCoordinates())}this.options.showPadding&&function(u){const F=u.transform.padding;da(u,u.transform.height-(F.top||0),3,Ll),da(u,F.bottom||0,3,Rl),_a(u,F.left||0,3,Bl),_a(u,u.transform.width-(F.right||0),3,Ol);const Wt=u.transform.centerPoint;!function(u,F,Wt,Xe){pa(u,F-1,Wt-10,2,20,Xe),pa(u,F-10,Wt-1,20,2,Xe)}(u,Wt.x,u.transform.height-Wt.y,Vl)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(u){if(!this.style||!this.style.map||!this.style.map.terrain)return;const F=this.terrainFacilitator.matrix,Xe=this.transform.modelViewProjectionMatrix;let Vi=this.terrainFacilitator.dirty;Vi||(Vi=u?!Wt.a_(F,Xe):!Wt.a$(F,Xe)),Vi||(Vi=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),Vi&&(Wt.b0(F,Xe),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(u,F){const Xe=u.context,Vi=Xe.gl,fr=Fi.unblended,_r=new Oi(Vi.LEQUAL,Oi.ReadWrite,[0,1]),wr=F.getTerrainMesh(),Ar=F.sourceCache.getRenderableTiles(),Kr=u.useProgram("terrainDepth");Xe.bindFramebuffer.set(F.getFramebuffer("depth").framebuffer),Xe.viewport.set([0,0,u.width/devicePixelRatio,u.height/devicePixelRatio]),Xe.clear({color:Wt.aM.transparent,depth:1});for(const Wt of Ar){const Ar=F.getTerrainData(Wt.tileID),In={u_matrix:u.transform.calculatePosMatrix(Wt.tileID.toUnwrapped()),u_ele_delta:F.getMeshFrameDelta(u.transform.zoom)};Kr.draw(Xe,Vi.TRIANGLES,_r,Ui.disabled,fr,ji.backCCW,In,Ar,"terrain",wr.vertexBuffer,wr.indexBuffer,wr.segments)}Xe.bindFramebuffer.set(null),Xe.viewport.set([0,0,u.width,u.height])}(this,this.style.map.terrain),function(u,F){const Xe=u.context,Vi=Xe.gl,fr=Fi.unblended,_r=new Oi(Vi.LEQUAL,Oi.ReadWrite,[0,1]),wr=F.getTerrainMesh(),Ar=F.getCoordsTexture(),Kr=F.sourceCache.getRenderableTiles(),In=u.useProgram("terrainCoords");Xe.bindFramebuffer.set(F.getFramebuffer("coords").framebuffer),Xe.viewport.set([0,0,u.width/devicePixelRatio,u.height/devicePixelRatio]),Xe.clear({color:Wt.aM.transparent,depth:1}),F.coordsIndex=[];for(const Wt of Kr){const Kr=F.getTerrainData(Wt.tileID);Xe.activeTexture.set(Vi.TEXTURE0),Vi.bindTexture(Vi.TEXTURE_2D,Ar.texture);const ns={u_matrix:u.transform.calculatePosMatrix(Wt.tileID.toUnwrapped()),u_terrain_coords_id:(255-F.coordsIndex.length)/255,u_texture:0,u_ele_delta:F.getMeshFrameDelta(u.transform.zoom)};In.draw(Xe,Vi.TRIANGLES,_r,Ui.disabled,fr,ji.backCCW,ns,Kr,"terrain",wr.vertexBuffer,wr.indexBuffer,wr.segments),F.coordsIndex.push(Wt.tileID.key)}Xe.bindFramebuffer.set(null),Xe.viewport.set([0,0,u.width,u.height])}(this,this.style.map.terrain))}renderLayer(u,F,Xe,Vi){if(!Xe.isHidden(this.transform.zoom)&&("background"===Xe.type||"custom"===Xe.type||(Vi||[]).length))switch(this.id=Xe.id,Xe.type){case"symbol":!function(u,F,Xe,Vi,fr){if("translucent"!==u.renderPass)return;const _r=Ui.disabled,wr=u.colorModeForRenderPass();(Xe._unevaluatedLayout.hasValue("text-variable-anchor")||Xe._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(u,F,Xe,Vi,fr,_r,wr,Ar,Kr){const In=F.transform,ns=ie(),ca="map"===fr,ha="map"===_r;for(const fr of u){const u=Vi.getTile(fr),_r=u.getBucket(Xe);if(!_r||!_r.text||!_r.text.segments.get().length)continue;const ua=Wt.ag(_r.textSizeData,In.zoom),Da=Bt(u,1,F.transform.zoom),io=gt(fr.posMatrix,ha,ca,F.transform,Da),no="none"!==Xe.layout.get("icon-text-fit")&&_r.hasIconData();if(ua){const Wt=Math.pow(2,In.zoom-u.tileID.overscaledZ),Xe=F.style.map.terrain?(u,Wt)=>F.style.map.terrain.getElevation(fr,u,Wt):null,Vi=ns.translatePosition(In,u,wr,Ar);Wi(_r,ca,ha,Kr,In,io,fr.posMatrix,Wt,ua,no,ns,Vi,fr.toUnwrapped(),Xe)}}}(Vi,u,Xe,F,Xe.layout.get("text-rotation-alignment"),Xe.layout.get("text-pitch-alignment"),Xe.paint.get("text-translate"),Xe.paint.get("text-translate-anchor"),fr),0!==Xe.paint.get("icon-opacity").constantOr(1)&&Xi(u,F,Xe,Vi,!1,Xe.paint.get("icon-translate"),Xe.paint.get("icon-translate-anchor"),Xe.layout.get("icon-rotation-alignment"),Xe.layout.get("icon-pitch-alignment"),Xe.layout.get("icon-keep-upright"),_r,wr),0!==Xe.paint.get("text-opacity").constantOr(1)&&Xi(u,F,Xe,Vi,!0,Xe.paint.get("text-translate"),Xe.paint.get("text-translate-anchor"),Xe.layout.get("text-rotation-alignment"),Xe.layout.get("text-pitch-alignment"),Xe.layout.get("text-keep-upright"),_r,wr),F.map.showCollisionBoxes&&(qi(u,F,Xe,Vi,!0),qi(u,F,Xe,Vi,!1))}(u,F,Xe,Vi,this.style.placement.variableOffsets);break;case"circle":!function(u,F,Xe,Vi){if("translucent"!==u.renderPass)return;const fr=Xe.paint.get("circle-opacity"),_r=Xe.paint.get("circle-stroke-width"),wr=Xe.paint.get("circle-stroke-opacity"),Ar=!Xe.layout.get("circle-sort-key").isConstant();if(0===fr.constantOr(1)&&(0===_r.constantOr(1)||0===wr.constantOr(1)))return;const Kr=u.context,In=Kr.gl,ns=u.depthModeForSublayer(0,Oi.ReadOnly),ca=Ui.disabled,ha=u.colorModeForRenderPass(),ua=[];for(let fr=0;fr<Vi.length;fr++){const _r=Vi[fr],wr=F.getTile(_r),Kr=wr.getBucket(Xe);if(!Kr)continue;const In=Kr.programConfigurations.get(Xe.id),ns=u.useProgram("circle",In),ca=Kr.layoutVertexBuffer,ha=Kr.indexBuffer,Da=u.style.map.terrain&&u.style.map.terrain.getTerrainData(_r),io={programConfiguration:In,program:ns,layoutVertexBuffer:ca,indexBuffer:ha,uniformValues:Ce(u,_r,wr,Xe),terrainData:Da};if(Ar){const u=Kr.segments.get();for(const F of u)ua.push({segments:new Wt.a0([F]),sortKey:F.sortKey,state:io})}else ua.push({segments:Kr.segments,sortKey:0,state:io})}Ar&&ua.sort(((u,F)=>u.sortKey-F.sortKey));for(const F of ua){const{programConfiguration:Wt,program:Vi,layoutVertexBuffer:fr,indexBuffer:_r,uniformValues:wr,terrainData:Ar}=F.state;Vi.draw(Kr,In.TRIANGLES,ns,ca,ha,ji.disabled,wr,Ar,Xe.id,fr,_r,F.segments,Xe.paint,u.transform.zoom,Wt)}}(u,F,Xe,Vi);break;case"heatmap":!function(u,F,Xe,Vi){if(0===Xe.paint.get("heatmap-opacity"))return;const fr=u.context;if(u.style.map.terrain){for(const Wt of Vi){const Vi=F.getTile(Wt);F.hasRenderableParent(Wt)||("offscreen"===u.renderPass?Ji(u,Vi,Xe,Wt):"translucent"===u.renderPass&&Yi(u,Xe,Wt))}fr.viewport.set([0,0,u.width,u.height])}else"offscreen"===u.renderPass?function(u,F,Xe,Vi){const fr=u.context,_r=fr.gl,wr=Ui.disabled,Ar=new Fi([_r.ONE,_r.ONE],Wt.aM.transparent,[!0,!0,!0,!0]);(function(u,F,Xe){const Vi=u.gl;u.activeTexture.set(Vi.TEXTURE1),u.viewport.set([0,0,F.width/4,F.height/4]);let fr=Xe.heatmapFbos.get(Wt.aU);fr?(Vi.bindTexture(Vi.TEXTURE_2D,fr.colorAttachment.get()),u.bindFramebuffer.set(fr.framebuffer)):(fr=Qi(u,F.width/4,F.height/4),Xe.heatmapFbos.set(Wt.aU,fr))})(fr,u,Xe),fr.clear({color:Wt.aM.transparent});for(let Wt=0;Wt<Vi.length;Wt++){const Kr=Vi[Wt];if(F.hasRenderableParent(Kr))continue;const In=F.getTile(Kr),ns=In.getBucket(Xe);if(!ns)continue;const ca=ns.programConfigurations.get(Xe.id),ha=u.useProgram("heatmap",ca),{zoom:ua}=u.transform;ha.draw(fr,_r.TRIANGLES,Oi.disabled,wr,Ar,ji.disabled,Me(Kr.posMatrix,In,ua,Xe.paint.get("heatmap-intensity")),null,Xe.id,ns.layoutVertexBuffer,ns.indexBuffer,ns.segments,Xe.paint,u.transform.zoom,ca)}fr.viewport.set([0,0,u.width,u.height])}(u,F,Xe,Vi):"translucent"===u.renderPass&&function(u,F){const Xe=u.context,Vi=Xe.gl;Xe.setColorMode(u.colorModeForRenderPass());const fr=F.heatmapFbos.get(Wt.aU);fr&&(Xe.activeTexture.set(Vi.TEXTURE0),Vi.bindTexture(Vi.TEXTURE_2D,fr.colorAttachment.get()),Xe.activeTexture.set(Vi.TEXTURE1),ta(Xe,F).bind(Vi.LINEAR,Vi.CLAMP_TO_EDGE),u.useProgram("heatmapTexture").draw(Xe,Vi.TRIANGLES,Oi.disabled,Ui.disabled,u.colorModeForRenderPass(),ji.disabled,Ae(u,F,0,1),null,F.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments,F.paint,u.transform.zoom))}(u,Xe)}(u,F,Xe,Vi);break;case"line":!function(u,F,Xe,Vi){if("translucent"!==u.renderPass)return;const fr=Xe.paint.get("line-opacity"),_r=Xe.paint.get("line-width");if(0===fr.constantOr(1)||0===_r.constantOr(1))return;const wr=u.depthModeForSublayer(0,Oi.ReadOnly),Ar=u.colorModeForRenderPass(),Kr=Xe.paint.get("line-dasharray"),In=Xe.paint.get("line-pattern"),ns=In.constantOr(1),ca=Xe.paint.get("line-gradient"),ha=Xe.getCrossfadeParameters(),ua=ns?"linePattern":Kr?"lineSDF":ca?"lineGradient":"line",Da=u.context,io=Da.gl;let no=!0;for(const fr of Vi){const Vi=F.getTile(fr);if(ns&&!Vi.patternsLoaded())continue;const _r=Vi.getBucket(Xe);if(!_r)continue;const so=_r.programConfigurations.get(Xe.id),ao=u.context.program.get(),oo=u.useProgram(ua,so),co=no||oo.program!==ao,ho=u.style.map.terrain&&u.style.map.terrain.getTerrainData(fr),go=In.constantOr(null);if(go&&Vi.imageAtlas){const u=Vi.imageAtlas,F=u.patternPositions[go.to.toString()],Wt=u.patternPositions[go.from.toString()];F&&Wt&&so.setConstantPatternPositions(F,Wt)}const xo=ho?fr:null,Io=ns?Fe(u,Vi,Xe,ha,xo):Kr?Be(u,Vi,Xe,Kr,ha,xo):ca?Le(u,Vi,Xe,_r.lineClipsArray.length,xo):ke(u,Vi,Xe,xo);if(ns)Da.activeTexture.set(io.TEXTURE0),Vi.imageAtlasTexture.bind(io.LINEAR,io.CLAMP_TO_EDGE),so.updatePaintBuffers(ha);else if(Kr&&(co||u.lineAtlas.dirty))Da.activeTexture.set(io.TEXTURE0),u.lineAtlas.bind(Da);else if(ca){const Vi=_r.gradients[Xe.id];let wr=Vi.texture;if(Xe.gradientVersion!==Vi.version){let Ar=256;if(Xe.stepInterpolant){const Xe=F.getSource().maxzoom,Vi=fr.canonical.z===Xe?Math.ceil(1<<u.transform.maxZoom-fr.canonical.z):1;Ar=Wt.ac(Wt.aV(_r.maxLineLength/Wt.X*1024*Vi),256,Da.maxTextureSize)}Vi.gradient=Wt.aW({expression:Xe.gradientExpression(),evaluationKey:"lineProgress",resolution:Ar,image:Vi.gradient||void 0,clips:_r.lineClipsArray}),Vi.texture?Vi.texture.update(Vi.gradient):Vi.texture=new b(Da,Vi.gradient,io.RGBA),Vi.version=Xe.gradientVersion,wr=Vi.texture}Da.activeTexture.set(io.TEXTURE0),wr.bind(Xe.stepInterpolant?io.NEAREST:io.LINEAR,io.CLAMP_TO_EDGE)}oo.draw(Da,io.TRIANGLES,wr,u.stencilModeForClipping(fr),Ar,ji.disabled,Io,ho,Xe.id,_r.layoutVertexBuffer,_r.indexBuffer,_r.segments,Xe.paint,u.transform.zoom,so,_r.layoutVertexBuffer2),no=!1}}(u,F,Xe,Vi);break;case"fill":!function(u,F,Xe,Vi){const fr=Xe.paint.get("fill-color"),_r=Xe.paint.get("fill-opacity");if(0===_r.constantOr(1))return;const wr=u.colorModeForRenderPass(),Ar=Xe.paint.get("fill-pattern"),Kr=u.opaquePassEnabledForLayer()&&!Ar.constantOr(1)&&1===fr.constantOr(Wt.aM.transparent).a&&1===_r.constantOr(0)?"opaque":"translucent";if(u.renderPass===Kr){const Wt=u.depthModeForSublayer(1,"opaque"===u.renderPass?Oi.ReadWrite:Oi.ReadOnly);ia(u,F,Xe,Vi,Wt,wr,!1)}if("translucent"===u.renderPass&&Xe.paint.get("fill-antialias")){const Wt=u.depthModeForSublayer(Xe.getPaintProperty("fill-outline-color")?2:0,Oi.ReadOnly);ia(u,F,Xe,Vi,Wt,wr,!0)}}(u,F,Xe,Vi);break;case"fill-extrusion":!function(u,F,Wt,Xe){const Vi=Wt.paint.get("fill-extrusion-opacity");if(0!==Vi&&"translucent"===u.renderPass){const fr=new Oi(u.context.gl.LEQUAL,Oi.ReadWrite,u.depthRangeFor3D);if(1!==Vi||Wt.paint.get("fill-extrusion-pattern").constantOr(1))aa(u,F,Wt,Xe,fr,Ui.disabled,Fi.disabled),aa(u,F,Wt,Xe,fr,u.stencilModeFor3D(),u.colorModeForRenderPass());else{const Vi=u.colorModeForRenderPass();aa(u,F,Wt,Xe,fr,Ui.disabled,Vi)}}}(u,F,Xe,Vi);break;case"hillshade":!function(u,F,Wt,Xe){if("offscreen"!==u.renderPass&&"translucent"!==u.renderPass)return;const Vi=u.context,fr=u.depthModeForSublayer(0,Oi.ReadOnly),_r=u.colorModeForRenderPass(),[wr,Ar]="translucent"===u.renderPass?u.stencilConfigForOverlap(Xe):[{},Xe];for(const Xe of Ar){const Vi=F.getTile(Xe);void 0!==Vi.needsHillshadePrepare&&Vi.needsHillshadePrepare&&"offscreen"===u.renderPass?oa(u,Vi,Wt,fr,Ui.disabled,_r):"translucent"===u.renderPass&&sa(u,Xe,Vi,Wt,fr,wr[Xe.overscaledZ],_r)}Vi.viewport.set([0,0,u.width,u.height])}(u,F,Xe,Vi);break;case"raster":!function(u,F,Wt,Xe){if("translucent"!==u.renderPass)return;if(0===Wt.paint.get("raster-opacity"))return;if(!Xe.length)return;const Vi=u.context,fr=Vi.gl,_r=F.getSource(),wr=u.useProgram("raster"),Ar=u.colorModeForRenderPass(),[Kr,In]=_r instanceof Q?[{},Xe]:u.stencilConfigForOverlap(Xe),ns=In[In.length-1].overscaledZ,ca=!u.options.moving;for(const Xe of In){const In=u.depthModeForSublayer(Xe.overscaledZ-ns,1===Wt.paint.get("raster-opacity")?Oi.ReadWrite:Oi.ReadOnly,fr.LESS),ha=F.getTile(Xe);ha.registerFadeDuration(Wt.paint.get("raster-fade-duration"));const ua=F.findLoadedParent(Xe,0),Da=F.findLoadedSibling(Xe),io=ra(ha,ua||Da||null,F,Wt,u.transform,u.style.map.terrain);let no,so;const ao="nearest"===Wt.paint.get("raster-resampling")?fr.NEAREST:fr.LINEAR;Vi.activeTexture.set(fr.TEXTURE0),ha.texture.bind(ao,fr.CLAMP_TO_EDGE,fr.LINEAR_MIPMAP_NEAREST),Vi.activeTexture.set(fr.TEXTURE1),ua?(ua.texture.bind(ao,fr.CLAMP_TO_EDGE,fr.LINEAR_MIPMAP_NEAREST),no=Math.pow(2,ua.tileID.overscaledZ-ha.tileID.overscaledZ),so=[ha.tileID.canonical.x*no%1,ha.tileID.canonical.y*no%1]):ha.texture.bind(ao,fr.CLAMP_TO_EDGE,fr.LINEAR_MIPMAP_NEAREST),ha.texture.useMipmap&&Vi.extTextureFilterAnisotropic&&u.transform.pitch>20&&fr.texParameterf(fr.TEXTURE_2D,Vi.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Vi.extTextureFilterAnisotropicMax);const oo=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Xe),co=oo?Xe:null,ho=co?co.posMatrix:u.transform.calculatePosMatrix(Xe.toUnwrapped(),ca),go=Ue(ho,so||[0,0],no||1,io,Wt);_r instanceof Q?wr.draw(Vi,fr.TRIANGLES,In,Ui.disabled,Ar,ji.disabled,go,oo,Wt.id,_r.boundsBuffer,u.quadTriangleIndexBuffer,_r.boundsSegments):wr.draw(Vi,fr.TRIANGLES,In,Kr[Xe.overscaledZ],Ar,ji.disabled,go,oo,Wt.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}}(u,F,Xe,Vi);break;case"background":!function(u,F,Wt,Xe){const Vi=Wt.paint.get("background-color"),fr=Wt.paint.get("background-opacity");if(0===fr)return;const _r=u.context,wr=_r.gl,Ar=u.transform,Kr=Ar.tileSize,In=Wt.paint.get("background-pattern");if(u.isPatternMissing(In))return;const ns=!In&&1===Vi.a&&1===fr&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==ns)return;const ca=Ui.disabled,ha=u.depthModeForSublayer(0,"opaque"===ns?Oi.ReadWrite:Oi.ReadOnly),ua=u.colorModeForRenderPass(),Da=u.useProgram(In?"backgroundPattern":"background"),io=Xe||Ar.coveringTiles({tileSize:Kr,terrain:u.style.map.terrain});In&&(_r.activeTexture.set(wr.TEXTURE0),u.imageManager.bind(u.context));const no=Wt.getCrossfadeParameters();for(const F of io){const Ar=Xe?F.posMatrix:u.transform.calculatePosMatrix(F.toUnwrapped()),ns=In?He(Ar,fr,u,In,{tileID:F,tileSize:Kr},no):Ge(Ar,fr,Vi),io=u.style.map.terrain&&u.style.map.terrain.getTerrainData(F);Da.draw(_r,wr.TRIANGLES,ha,ca,ua,ji.disabled,ns,io,Wt.id,u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}(u,0,Xe,Vi);break;case"custom":!function(u,F,Wt){const Xe=u.context,Vi=Wt.implementation;if("offscreen"===u.renderPass){const F=Vi.prerender;F&&(u.setCustomLayerDefaults(),Xe.setColorMode(u.colorModeForRenderPass()),F.call(Vi,Xe.gl,u.transform.customLayerMatrix()),Xe.setDirty(),u.setBaseState())}else if("translucent"===u.renderPass){u.setCustomLayerDefaults(),Xe.setColorMode(u.colorModeForRenderPass()),Xe.setStencilMode(Ui.disabled);const F="3d"===Vi.renderingMode?new Oi(u.context.gl.LEQUAL,Oi.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,Oi.ReadOnly);Xe.setDepthMode(F),Vi.render(Xe.gl,u.transform.customLayerMatrix(),{farZ:u.transform.farZ,nearZ:u.transform.nearZ,fov:u.transform._fov,modelViewProjectionMatrix:u.transform.modelViewProjectionMatrix,projectionMatrix:u.transform.projectionMatrix}),Xe.setDirty(),u.setBaseState(),Xe.bindFramebuffer.set(null)}}(u,0,Xe)}}translatePosMatrix(u,F,Xe,Vi,fr){if(!Xe[0]&&!Xe[1])return u;const _r=fr?"map"===Vi?this.transform.angle:0:"viewport"===Vi?-this.transform.angle:0;if(_r){const u=Math.sin(_r),F=Math.cos(_r);Xe=[Xe[0]*F-Xe[1]*u,Xe[0]*u+Xe[1]*F]}const wr=[fr?Xe[0]:Bt(F,Xe[0],this.transform.zoom),fr?Xe[1]:Bt(F,Xe[1],this.transform.zoom),0],Ar=new Float32Array(16);return Wt.J(Ar,u,wr),Ar}saveTileTexture(u){const F=this._tileTextures[u.size[0]];F?F.push(u):this._tileTextures[u.size[0]]=[u]}getTileTexture(u){const F=this._tileTextures[u];return F&&F.length>0?F.pop():null}isPatternMissing(u){if(!u)return!1;if(!u.from||!u.to)return!0;const F=this.imageManager.getPattern(u.from.toString()),Wt=this.imageManager.getPattern(u.to.toString());return!F||!Wt}useProgram(u,F){this.cache=this.cache||{};const Wt=u+(F?F.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[Wt]||(this.cache[Wt]=new xe(this.context,yl[u],F,vl[u],this._showOverdrawInspector,this.style.map.terrain)),this.cache[Wt]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const u=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(u.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new b(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:u,drawingBufferHeight:F}=this.context.gl;return this.width!==u||this.height!==F}}class xa{constructor(u,F){this.points=u,this.planes=F}static fromInvProjectionMatrix(u,F,Xe){const Vi=Math.pow(2,Xe),fr=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((Xe=>{const fr=1/(Xe=Wt.af([],Xe,u))[3]/F*Vi;return Wt.b1(Xe,Xe,[fr,fr,1/Xe[3],fr])})),_r=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((u=>{const F=function(u,F){var Wt=F[0],Xe=F[1],Vi=F[2],fr=Wt*Wt+Xe*Xe+Vi*Vi;return fr>0&&(fr=1/Math.sqrt(fr)),u[0]=F[0]*fr,u[1]=F[1]*fr,u[2]=F[2]*fr,u}([],function(u,F,Wt){var Xe=F[0],Vi=F[1],fr=F[2],_r=Wt[0],wr=Wt[1],Ar=Wt[2];return u[0]=Vi*Ar-fr*wr,u[1]=fr*_r-Xe*Ar,u[2]=Xe*wr-Vi*_r,u}([],g([],fr[u[0]],fr[u[1]]),g([],fr[u[2]],fr[u[1]]))),Wt=-((Xe=F)[0]*(Vi=fr[u[1]])[0]+Xe[1]*Vi[1]+Xe[2]*Vi[2]);var Xe,Vi;return F.concat(Wt)}));return new xa(fr,_r)}}class ya{constructor(u,F){this.min=u,this.max=F,this.center=function(u,F,Wt){return u[0]=.5*F[0],u[1]=.5*F[1],u[2]=.5*F[2],u}([],function(u,F,Wt){return u[0]=F[0]+Wt[0],u[1]=F[1]+Wt[1],u[2]=F[2]+Wt[2],u}([],this.min,this.max))}quadrant(u){const F=[u%2==0,u<2],Wt=m(this.min),Xe=m(this.max);for(let u=0;u<F.length;u++)Wt[u]=F[u]?this.min[u]:this.center[u],Xe[u]=F[u]?this.center[u]:this.max[u];return Xe[2]=this.max[2],new ya(Wt,Xe)}distanceX(u){return Math.max(Math.min(this.max[0],u[0]),this.min[0])-u[0]}distanceY(u){return Math.max(Math.min(this.max[1],u[1]),this.min[1])-u[1]}intersects(u){const F=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let Xe=!0;for(let Vi=0;Vi<u.planes.length;Vi++){const fr=u.planes[Vi];let _r=0;for(let u=0;u<F.length;u++)Wt.b2(fr,F[u])>=0&&_r++;if(0===_r)return 0;_r!==F.length&&(Xe=!1)}if(Xe)return 2;for(let F=0;F<3;F++){let Wt=Number.MAX_VALUE,Xe=-Number.MAX_VALUE;for(let Vi=0;Vi<u.points.length;Vi++){const fr=u.points[Vi][F]-this.min[F];Wt=Math.min(Wt,fr),Xe=Math.max(Xe,fr)}if(Xe<0||Wt>this.max[F]-this.min[F])return 0}return 1}}class ba{constructor(u=0,F=0,Wt=0,Xe=0){if(isNaN(u)||u<0||isNaN(F)||F<0||isNaN(Wt)||Wt<0||isNaN(Xe)||Xe<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=u,this.bottom=F,this.left=Wt,this.right=Xe}interpolate(u,F,Xe){return null!=F.top&&null!=u.top&&(this.top=Wt.y.number(u.top,F.top,Xe)),null!=F.bottom&&null!=u.bottom&&(this.bottom=Wt.y.number(u.bottom,F.bottom,Xe)),null!=F.left&&null!=u.left&&(this.left=Wt.y.number(u.left,F.left,Xe)),null!=F.right&&null!=u.right&&(this.right=Wt.y.number(u.right,F.right,Xe)),this}getCenter(u,F){const Xe=Wt.ac((this.left+u-this.right)/2,0,u),Vi=Wt.ac((this.top+F-this.bottom)/2,0,F);return new Wt.P(Xe,Vi)}equals(u){return this.top===u.top&&this.bottom===u.bottom&&this.left===u.left&&this.right===u.right}clone(){return new ba(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const jl=85.051129;class Ta{constructor(u,F,Xe,Vi,fr){this.tileSize=512,this._renderWorldCopies=void 0===fr||!!fr,this._minZoom=u||0,this._maxZoom=F||22,this._minPitch=null==Xe?0:Xe,this._maxPitch=null==Vi?60:Vi,this.setMaxBounds(),this.width=0,this.height=0,this._center=new Wt.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ba,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const u=new Ta(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return u.apply(this),u}apply(u){this.tileSize=u.tileSize,this.latRange=u.latRange,this.lngRange=u.lngRange,this.width=u.width,this.height=u.height,this._center=u._center,this._elevation=u._elevation,this.minElevationForCurrentTile=u.minElevationForCurrentTile,this.zoom=u.zoom,this.angle=u.angle,this._fov=u._fov,this._pitch=u._pitch,this._unmodified=u._unmodified,this._edgeInsets=u._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(u){this._minZoom!==u&&(this._minZoom=u,this.zoom=Math.max(this.zoom,u))}get maxZoom(){return this._maxZoom}set maxZoom(u){this._maxZoom!==u&&(this._maxZoom=u,this.zoom=Math.min(this.zoom,u))}get minPitch(){return this._minPitch}set minPitch(u){this._minPitch!==u&&(this._minPitch=u,this.pitch=Math.max(this.pitch,u))}get maxPitch(){return this._maxPitch}set maxPitch(u){this._maxPitch!==u&&(this._maxPitch=u,this.pitch=Math.min(this.pitch,u))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(u){void 0===u?u=!0:null===u&&(u=!1),this._renderWorldCopies=u}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new Wt.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(u){const F=-Wt.b3(u,-180,180)*Math.PI/180;this.angle!==F&&(this._unmodified=!1,this.angle=F,this._calcMatrices(),this.rotationMatrix=function(){var u=new Wt.A(4);return Wt.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,F,Wt){var Xe=F[0],Vi=F[1],fr=F[2],_r=F[3],wr=Math.sin(Wt),Ar=Math.cos(Wt);u[0]=Xe*Ar+fr*wr,u[1]=Vi*Ar+_r*wr,u[2]=Xe*-wr+fr*Ar,u[3]=Vi*-wr+_r*Ar}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(u){const F=Wt.ac(u,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==F&&(this._unmodified=!1,this._pitch=F,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(u){u=Math.max(.01,Math.min(60,u)),this._fov!==u&&(this._unmodified=!1,this._fov=u/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(u){const F=Math.min(Math.max(u,this.minZoom),this.maxZoom);this._zoom!==F&&(this._unmodified=!1,this._zoom=F,this.tileZoom=Math.max(0,Math.floor(F)),this.scale=this.zoomScale(F),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(u){u.lat===this._center.lat&&u.lng===this._center.lng||(this._unmodified=!1,this._center=u,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(u){u!==this._elevation&&(this._elevation=u,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(u){this._edgeInsets.equals(u)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,u,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(u){return this._edgeInsets.equals(u)}interpolatePadding(u,F,Wt){this._unmodified=!1,this._edgeInsets.interpolate(u,F,Wt),this._constrain(),this._calcMatrices()}coveringZoomLevel(u){const F=(u.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/u.tileSize));return Math.max(0,F)}getVisibleUnwrappedCoordinates(u){const F=[new Wt.b4(0,u)];if(this._renderWorldCopies){const Xe=this.pointCoordinate(new Wt.P(0,0)),Vi=this.pointCoordinate(new Wt.P(this.width,0)),fr=this.pointCoordinate(new Wt.P(this.width,this.height)),_r=this.pointCoordinate(new Wt.P(0,this.height)),wr=Math.floor(Math.min(Xe.x,Vi.x,fr.x,_r.x)),Ar=Math.floor(Math.max(Xe.x,Vi.x,fr.x,_r.x)),Kr=1;for(let Xe=wr-Kr;Xe<=Ar+Kr;Xe++)0!==Xe&&F.push(new Wt.b4(Xe,u))}return F}coveringTiles(u){var F,Xe;let Vi=this.coveringZoomLevel(u);const fr=Vi;if(void 0!==u.minzoom&&Vi<u.minzoom)return[];void 0!==u.maxzoom&&Vi>u.maxzoom&&(Vi=u.maxzoom);const _r=this.pointCoordinate(this.getCameraPoint()),wr=Wt.Z.fromLngLat(this.center),Ar=Math.pow(2,Vi),Kr=[Ar*_r.x,Ar*_r.y,0],In=[Ar*wr.x,Ar*wr.y,0],ns=xa.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,Vi);let ca=u.minzoom||0;!u.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ca=Vi);const ha=u.terrain?2/Math.min(this.tileSize,u.tileSize)*this.tileSize:3,p=u=>({aabb:new ya([u*Ar,0,0],[(u+1)*Ar,Ar,0]),zoom:0,x:0,y:0,wrap:u,fullyVisible:!1}),ua=[],Da=[],io=Vi,no=u.reparseOverscaled?fr:Vi;if(this._renderWorldCopies)for(let u=1;u<=3;u++)ua.push(p(-u)),ua.push(p(u));for(ua.push(p(0));ua.length>0;){const Vi=ua.pop(),fr=Vi.x,_r=Vi.y;let wr=Vi.fullyVisible;if(!wr){const u=Vi.aabb.intersects(ns);if(0===u)continue;wr=2===u}const Ar=u.terrain?Kr:In,so=Vi.aabb.distanceX(Ar),ao=Vi.aabb.distanceY(Ar),oo=Math.max(Math.abs(so),Math.abs(ao));if(Vi.zoom===io||oo>ha+(1<<io-Vi.zoom)-2&&Vi.zoom>=ca){const u=io-Vi.zoom,F=Kr[0]-.5-(fr<<u),Xe=Kr[1]-.5-(_r<<u);Da.push({tileID:new Wt.S(Vi.zoom===io?no:Vi.zoom,Vi.wrap,Vi.zoom,fr,_r),distanceSq:v([In[0]-.5-fr,In[1]-.5-_r]),tileDistanceToCamera:Math.sqrt(F*F+Xe*Xe)})}else for(let Ar=0;Ar<4;Ar++){const Kr=(fr<<1)+Ar%2,In=(_r<<1)+(Ar>>1),ns=Vi.zoom+1;let ca=Vi.aabb.quadrant(Ar);if(u.terrain){const fr=new Wt.S(ns,Vi.wrap,ns,Kr,In),_r=u.terrain.getMinMaxElevation(fr),wr=null!==(F=_r.minElevation)&&void 0!==F?F:this.elevation,Ar=null!==(Xe=_r.maxElevation)&&void 0!==Xe?Xe:this.elevation;ca=new ya([ca.min[0],ca.min[1],wr],[ca.max[0],ca.max[1],Ar])}ua.push({aabb:ca,zoom:ns,x:Kr,y:In,wrap:Vi.wrap,fullyVisible:wr})}}return Da.sort(((u,F)=>u.distanceSq-F.distanceSq)).map((u=>u.tileID))}resize(u,F){this.width=u,this.height=F,this.pixelsToGLUnits=[2/u,-2/F],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(u){return Math.pow(2,u)}scaleZoom(u){return Math.log(u)/Math.LN2}project(u){const F=Wt.ac(u.lat,-85.051129,jl);return new Wt.P(Wt.O(u.lng)*this.worldSize,Wt.Q(F)*this.worldSize)}unproject(u){return new Wt.Z(u.x/this.worldSize,u.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(u){const F=this.elevation,Xe=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,Vi=this.pointLocation(this.centerPoint,u),fr=u.getElevationForLngLatZoom(Vi,this.tileZoom);if(!(this.elevation-fr))return;const _r=Xe+F-fr,wr=Math.cos(this._pitch)*this.cameraToCenterDistance/_r/Wt.b5(1,Vi.lat),Ar=this.scaleZoom(wr/this.tileSize);this._elevation=fr,this._center=Vi,this.zoom=Ar}setLocationAtPoint(u,F){const Xe=this.pointCoordinate(F),Vi=this.pointCoordinate(this.centerPoint),fr=this.locationCoordinate(u),_r=new Wt.Z(fr.x-(Xe.x-Vi.x),fr.y-(Xe.y-Vi.y));this.center=this.coordinateLocation(_r),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(u,F){return F?this.coordinatePoint(this.locationCoordinate(u),F.getElevationForLngLatZoom(u,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(u))}pointLocation(u,F){return this.coordinateLocation(this.pointCoordinate(u,F))}locationCoordinate(u){return Wt.Z.fromLngLat(u)}coordinateLocation(u){return u&&u.toLngLat()}pointCoordinate(u,F){if(F){const Wt=F.pointCoordinate(u);if(null!=Wt)return Wt}const Xe=[u.x,u.y,0,1],Vi=[u.x,u.y,1,1];Wt.af(Xe,Xe,this.pixelMatrixInverse),Wt.af(Vi,Vi,this.pixelMatrixInverse);const fr=Xe[3],_r=Vi[3],wr=Xe[1]/fr,Ar=Vi[1]/_r,Kr=Xe[2]/fr,In=Vi[2]/_r,ns=Kr===In?0:(0-Kr)/(In-Kr);return new Wt.Z(Wt.y.number(Xe[0]/fr,Vi[0]/_r,ns)/this.worldSize,Wt.y.number(wr,Ar,ns)/this.worldSize)}coordinatePoint(u,F=0,Xe=this.pixelMatrix){const Vi=[u.x*this.worldSize,u.y*this.worldSize,F,1];return Wt.af(Vi,Vi,Xe),new Wt.P(Vi[0]/Vi[3],Vi[1]/Vi[3])}getBounds(){const u=Math.max(0,this.height/2-this.getHorizon());return(new H).extend(this.pointLocation(new Wt.P(0,u))).extend(this.pointLocation(new Wt.P(this.width,u))).extend(this.pointLocation(new Wt.P(this.width,this.height))).extend(this.pointLocation(new Wt.P(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new H([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(u){u?(this.lngRange=[u.getWest(),u.getEast()],this.latRange=[u.getSouth(),u.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,jl])}calculateTileMatrix(u){const F=u.canonical,Xe=this.worldSize/this.zoomScale(F.z),Vi=F.x+Math.pow(2,F.z)*u.wrap,fr=Wt.an(new Float64Array(16));return Wt.J(fr,fr,[Vi*Xe,F.y*Xe,0]),Wt.K(fr,fr,[Xe/Wt.X,Xe/Wt.X,1]),fr}calculatePosMatrix(u,F=!1){const Xe=u.key,Vi=F?this._alignedPosMatrixCache:this._posMatrixCache;if(Vi[Xe])return Vi[Xe];const fr=this.calculateTileMatrix(u);return Wt.L(fr,F?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,fr),Vi[Xe]=new Float32Array(fr),Vi[Xe]}calculateFogMatrix(u){const F=u.key,Xe=this._fogMatrixCache;if(Xe[F])return Xe[F];const Vi=this.calculateTileMatrix(u);return Wt.L(Vi,this.fogMatrix,Vi),Xe[F]=new Float32Array(Vi),Xe[F]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(u,F){F=Wt.ac(+F,this.minZoom,this.maxZoom);const Xe={center:new Wt.N(u.lng,u.lat),zoom:F};let Vi=this.lngRange;if(!this._renderWorldCopies&&null===Vi){const u=180-1e-10;Vi=[-u,u]}const fr=this.tileSize*this.zoomScale(Xe.zoom);let _r=0,wr=fr,Ar=0,Kr=fr,In=0,ns=0;const{x:ca,y:ha}=this.size;if(this.latRange){const u=this.latRange;_r=Wt.Q(u[1])*fr,wr=Wt.Q(u[0])*fr,wr-_r<ha&&(In=ha/(wr-_r))}Vi&&(Ar=Wt.b3(Wt.O(Vi[0])*fr,0,fr),Kr=Wt.b3(Wt.O(Vi[1])*fr,0,fr),Kr<Ar&&(Kr+=fr),Kr-Ar<ca&&(ns=ca/(Kr-Ar)));const{x:ua,y:Da}=this.project.call({worldSize:fr},u);let io,no;const so=Math.max(ns||0,In||0);if(so){const u=new Wt.P(ns?(Kr+Ar)/2:ua,In?(wr+_r)/2:Da);return Xe.center=this.unproject.call({worldSize:fr},u).wrap(),Xe.zoom+=this.scaleZoom(so),Xe}if(this.latRange){const u=ha/2;Da-u<_r&&(no=_r+u),Da+u>wr&&(no=wr-u)}if(Vi){const u=(Ar+Kr)/2;let F=ua;this._renderWorldCopies&&(F=Wt.b3(ua,u-fr/2,u+fr/2));const Xe=ca/2;F-Xe<Ar&&(io=Ar+Xe),F+Xe>Kr&&(io=Kr-Xe)}if(void 0!==io||void 0!==no){const u=new Wt.P(null!=io?io:ua,null!=no?no:Da);Xe.center=this.unproject.call({worldSize:fr},u).wrap()}return Xe}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const u=this._unmodified,{center:F,zoom:Wt}=this.getConstrained(this.center,this.zoom);this.center=F,this.zoom=Wt,this._unmodified=u,this._constraining=!1}_calcMatrices(){if(!this.height)return;const u=this.centerOffset,F=this.point.x,Xe=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=Wt.b5(1,this.center.lat)*this.worldSize;let Vi=Wt.an(new Float64Array(16));Wt.K(Vi,Vi,[this.width/2,-this.height/2,1]),Wt.J(Vi,Vi,[1,-1,0]),this.labelPlaneMatrix=Vi,Vi=Wt.an(new Float64Array(16)),Wt.K(Vi,Vi,[1,-1,1]),Wt.J(Vi,Vi,[-1,-1,0]),Wt.K(Vi,Vi,[2/this.width,2/this.height,1]),this.glCoordMatrix=Vi;const fr=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),_r=Math.min(this.elevation,this.minElevationForCurrentTile),wr=fr-_r*this._pixelPerMeter/Math.cos(this._pitch),Ar=_r<0?wr:fr,Kr=Math.PI/2+this._pitch,In=this._fov*(.5+u.y/this.height),ns=Math.sin(In)*Ar/Math.sin(Wt.ac(Math.PI-Kr-In,.01,Math.PI-.01)),ca=this.getHorizon(),ha=2*Math.atan(ca/this.cameraToCenterDistance)*(.5+u.y/(2*ca)),ua=Math.sin(ha)*Ar/Math.sin(Wt.ac(Math.PI-Kr-ha,.01,Math.PI-.01)),Da=Math.min(ns,ua);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Da+Ar),this.nearZ=this.height/50,Vi=new Float64Array(16),Wt.b6(Vi,this._fov,this.width/this.height,this.nearZ,this.farZ),Vi[8]=2*-u.x/this.width,Vi[9]=2*u.y/this.height,this.projectionMatrix=Wt.ae(Vi),Wt.K(Vi,Vi,[1,-1,1]),Wt.J(Vi,Vi,[0,0,-this.cameraToCenterDistance]),Wt.b7(Vi,Vi,this._pitch),Wt.ad(Vi,Vi,this.angle),Wt.J(Vi,Vi,[-F,-Xe,0]),this.mercatorMatrix=Wt.K([],Vi,[this.worldSize,this.worldSize,this.worldSize]),Wt.K(Vi,Vi,[1,1,this._pixelPerMeter]),this.pixelMatrix=Wt.L(new Float64Array(16),this.labelPlaneMatrix,Vi),Wt.J(Vi,Vi,[0,0,-this.elevation]),this.modelViewProjectionMatrix=Vi,this.invModelViewProjectionMatrix=Wt.as([],Vi),this.fogMatrix=new Float64Array(16),Wt.b6(this.fogMatrix,this._fov,this.width/this.height,fr,this.farZ),this.fogMatrix[8]=2*-u.x/this.width,this.fogMatrix[9]=2*u.y/this.height,Wt.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),Wt.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),Wt.b7(this.fogMatrix,this.fogMatrix,this._pitch),Wt.ad(this.fogMatrix,this.fogMatrix,this.angle),Wt.J(this.fogMatrix,this.fogMatrix,[-F,-Xe,0]),Wt.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),Wt.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=Wt.L(new Float64Array(16),this.labelPlaneMatrix,Vi);const io=this.width%2/2,no=this.height%2/2,so=Math.cos(this.angle),ao=Math.sin(this.angle),oo=F-Math.round(F)+so*io+ao*no,co=Xe-Math.round(Xe)+so*no+ao*io,ho=new Float64Array(Vi);if(Wt.J(ho,ho,[oo>.5?oo-1:oo,co>.5?co-1:co,0]),this.alignedModelViewProjectionMatrix=ho,Vi=Wt.as(new Float64Array(16),this.pixelMatrix),!Vi)throw new Error("failed to invert matrix");this.pixelMatrixInverse=Vi,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const u=this.pointCoordinate(new Wt.P(0,0)),F=[u.x*this.worldSize,u.y*this.worldSize,0,1];return Wt.af(F,F,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const u=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new Wt.P(0,u))}getCameraQueryGeometry(u){const F=this.getCameraPoint();if(1===u.length)return[u[0],F];{let Xe=F.x,Vi=F.y,fr=F.x,_r=F.y;for(const F of u)Xe=Math.min(Xe,F.x),Vi=Math.min(Vi,F.y),fr=Math.max(fr,F.x),_r=Math.max(_r,F.y);return[new Wt.P(Xe,Vi),new Wt.P(fr,Vi),new Wt.P(fr,_r),new Wt.P(Xe,_r),new Wt.P(Xe,Vi)]}}lngLatToCameraDepth(u,F){const Xe=this.locationCoordinate(u),Vi=[Xe.x*this.worldSize,Xe.y*this.worldSize,F,1];return Wt.af(Vi,Vi,this.modelViewProjectionMatrix),Vi[2]/Vi[3]}}function Ia(F,Wt){let Xe,Vi=!1,fr=null,_r=null;const r=()=>{fr=null,Vi&&(F.apply(_r,Xe),fr=setTimeout(r,Wt),Vi=!1)};return(...F)=>(Vi=!0,_r=this||u,Xe=F,fr||r(),fr)}class Ea{constructor(u){this._getCurrentHash=()=>{const u=window.location.hash.replace("#","");if(this._hashName){let F;return u.split("&").map((u=>u.split("="))).forEach((u=>{u[0]===this._hashName&&(F=u)})),(F&&F[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{const u=this._getCurrentHash();if(u.length>=3&&!u.some((u=>isNaN(u)))){const F=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:F,pitch:+(u[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{const u=this._getCurrentHash();if(0===u.length)return;const F=u.join("/");let Wt=F;Wt.split("&").length>0&&(Wt=Wt.split("&")[0]),this._hashName&&(Wt=`${this._hashName}=${F}`);let Xe=window.location.hash.replace(Wt,"");Xe.startsWith("#&")?Xe=Xe.slice(0,1)+Xe.slice(2):"#"===Xe&&(Xe="");let Vi=window.location.href.replace(/(#.+)?$/,Xe);Vi=Vi.replace("&&","&"),window.history.replaceState(window.history.state,null,Vi)},this._updateHash=Ia(this._updateHashUnthrottled,300),this._hashName=u&&encodeURIComponent(u)}addTo(u){return this._map=u,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(u){const F=this._map.getCenter(),Wt=Math.round(100*this._map.getZoom())/100,Xe=Math.ceil((Wt*Math.LN2+Math.log(512/360/.5))/Math.LN10),Vi=Math.pow(10,Xe),fr=Math.round(F.lng*Vi)/Vi,_r=Math.round(F.lat*Vi)/Vi,wr=this._map.getBearing(),Ar=this._map.getPitch();let Kr="";if(Kr+=u?`/${fr}/${_r}/${Wt}`:`${Wt}/${_r}/${fr}`,(wr||Ar)&&(Kr+="/"+Math.round(10*wr)/10),Ar&&(Kr+=`/${Math.round(Ar)}`),this._hashName){const u=this._hashName;let F=!1;const Wt=window.location.hash.slice(1).split("&").map((Wt=>{const Xe=Wt.split("=")[0];return Xe===u?(F=!0,`${Xe}=${Kr}`):Wt})).filter((u=>u));return F||Wt.push(`${u}=${Kr}`),`#${Wt.join("&")}`}return`#${Kr}`}}const Nl={linearity:.3,easing:Wt.b8(0,0,.3,1)},Ul=Wt.e({deceleration:2500,maxSpeed:1400},Nl),$l=Wt.e({deceleration:20,maxSpeed:1400},Nl),Zl=Wt.e({deceleration:1e3,maxSpeed:360},Nl),Gl=Wt.e({deceleration:1e3,maxSpeed:90},Nl);class Ma{constructor(u){this._map=u,this.clear()}clear(){this._inertiaBuffer=[]}record(u){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:_r.now(),settings:u})}_drainInertiaBuffer(){const u=this._inertiaBuffer,F=_r.now();for(;u.length>0&&F-u[0].time>160;)u.shift()}_onMoveEnd(u){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const F={zoom:0,bearing:0,pitch:0,pan:new Wt.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:u}of this._inertiaBuffer)F.zoom+=u.zoomDelta||0,F.bearing+=u.bearingDelta||0,F.pitch+=u.pitchDelta||0,u.panDelta&&F.pan._add(u.panDelta),u.around&&(F.around=u.around),u.pinchAround&&(F.pinchAround=u.pinchAround);const Xe=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,Vi={};if(F.pan.mag()){const fr=Ra(F.pan.mag(),Xe,Wt.e({},Ul,u||{}));Vi.offset=F.pan.mult(fr.amount/F.pan.mag()),Vi.center=this._map.transform.center,Aa(Vi,fr)}if(F.zoom){const u=Ra(F.zoom,Xe,$l);Vi.zoom=this._map.transform.zoom+u.amount,Aa(Vi,u)}if(F.bearing){const u=Ra(F.bearing,Xe,Zl);Vi.bearing=this._map.transform.bearing+Wt.ac(u.amount,-179,179),Aa(Vi,u)}if(F.pitch){const u=Ra(F.pitch,Xe,Gl);Vi.pitch=this._map.transform.pitch+u.amount,Aa(Vi,u)}if(Vi.zoom||Vi.bearing){const u=void 0===F.pinchAround?F.around:F.pinchAround;Vi.around=u?this._map.unproject(u):this._map.getCenter()}return this.clear(),Wt.e(Vi,{noMoveStart:!0})}}function Aa(u,F){(!u.duration||u.duration<F.duration)&&(u.duration=F.duration,u.easing=F.easing)}function Ra(u,F,Xe){const{maxSpeed:Vi,linearity:fr,deceleration:_r}=Xe,wr=Wt.ac(u*fr/(F/1e3),-Vi,Vi),Ar=Math.abs(wr)/(_r*fr);return{easing:Xe.easing,duration:1e3*Ar,amount:wr*(Ar/2)}}class ka extends Wt.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,F,Xe,Vi={}){const fr=r.mousePos(F.getCanvas(),Xe),_r=F.unproject(fr);super(u,Wt.e({point:fr,lngLat:_r,originalEvent:Xe},Vi)),this._defaultPrevented=!1,this.target=F}}class La extends Wt.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,F,Xe){const Vi="touchend"===u?Xe.changedTouches:Xe.touches,fr=r.touchPos(F.getCanvasContainer(),Vi),_r=fr.map((u=>F.unproject(u))),wr=fr.reduce(((u,F,Wt,Xe)=>u.add(F.div(Xe.length))),new Wt.P(0,0));super(u,{points:fr,point:wr,lngLats:_r,lngLat:F.unproject(wr),originalEvent:Xe}),this._defaultPrevented=!1}}class Fa extends Wt.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,F,Wt){super(u,{originalEvent:Wt}),this._defaultPrevented=!1}}class Ba{constructor(u,F){this._map=u,this._clickTolerance=F.clickTolerance}reset(){delete this._mousedownPos}wheel(u){return this._firePreventable(new Fa(u.type,this._map,u))}mousedown(u,F){return this._mousedownPos=F,this._firePreventable(new ka(u.type,this._map,u))}mouseup(u){this._map.fire(new ka(u.type,this._map,u))}click(u,F){this._mousedownPos&&this._mousedownPos.dist(F)>=this._clickTolerance||this._map.fire(new ka(u.type,this._map,u))}dblclick(u){return this._firePreventable(new ka(u.type,this._map,u))}mouseover(u){this._map.fire(new ka(u.type,this._map,u))}mouseout(u){this._map.fire(new ka(u.type,this._map,u))}touchstart(u){return this._firePreventable(new La(u.type,this._map,u))}touchmove(u){this._map.fire(new La(u.type,this._map,u))}touchend(u){this._map.fire(new La(u.type,this._map,u))}touchcancel(u){this._map.fire(new La(u.type,this._map,u))}_firePreventable(u){if(this._map.fire(u),u.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oa{constructor(u){this._map=u}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(u){this._map.fire(new ka(u.type,this._map,u))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ka("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(u){this._delayContextMenu?this._contextMenuEvent=u:this._ignoreContextMenu||this._map.fire(new ka(u.type,this._map,u)),this._map.listens("contextmenu")&&u.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Na{constructor(u){this._map=u}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(u){return this.transform.pointLocation(Wt.P.convert(u),this._map.terrain)}}class Ua{constructor(u,F){this._map=u,this._tr=new Na(u),this._el=u.getCanvasContainer(),this._container=u.getContainer(),this._clickTolerance=F.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(u,F){this.isEnabled()&&u.shiftKey&&0===u.button&&(r.disableDrag(),this._startPos=this._lastPos=F,this._active=!0)}mousemoveWindow(u,F){if(!this._active)return;const Wt=F;if(this._lastPos.equals(Wt)||!this._box&&Wt.dist(this._startPos)<this._clickTolerance)return;const Xe=this._startPos;this._lastPos=Wt,this._box||(this._box=r.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",u));const Vi=Math.min(Xe.x,Wt.x),fr=Math.max(Xe.x,Wt.x),_r=Math.min(Xe.y,Wt.y),wr=Math.max(Xe.y,Wt.y);r.setTransform(this._box,`translate(${Vi}px,${_r}px)`),this._box.style.width=fr-Vi+"px",this._box.style.height=wr-_r+"px"}mouseupWindow(u,F){if(!this._active)return;if(0!==u.button)return;const Xe=this._startPos,Vi=F;if(this.reset(),r.suppressClick(),Xe.x!==Vi.x||Xe.y!==Vi.y)return this._map.fire(new Wt.k("boxzoomend",{originalEvent:u})),{cameraAnimation:u=>u.fitScreenCoordinates(Xe,Vi,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",u)}keydown(u){this._active&&27===u.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",u))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(r.remove(this._box),this._box=null),r.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(u,F){return this._map.fire(new Wt.k(u,{originalEvent:F}))}}function ja(u,F){if(u.length!==F.length)throw new Error(`The number of touches and points are not equal - touches ${u.length}, points ${F.length}`);const Wt={};for(let Xe=0;Xe<u.length;Xe++)Wt[u[Xe].identifier]=F[Xe];return Wt}class Za{constructor(u){this.reset(),this.numTouches=u.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(u,F,Xe){(this.centroid||Xe.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=u.timeStamp),Xe.length===this.numTouches&&(this.centroid=function(u){const F=new Wt.P(0,0);for(const Wt of u)F._add(Wt);return F.div(u.length)}(F),this.touches=ja(Xe,F)))}touchmove(u,F,Wt){if(this.aborted||!this.centroid)return;const Xe=ja(Wt,F);for(const u in this.touches){const F=Xe[u];(!F||F.dist(this.touches[u])>30)&&(this.aborted=!0)}}touchend(u,F,Wt){if((!this.centroid||u.timeStamp-this.startTime>500)&&(this.aborted=!0),0===Wt.length){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class qa{constructor(u){this.singleTap=new Za(u),this.numTaps=u.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(u,F,Wt){this.singleTap.touchstart(u,F,Wt)}touchmove(u,F,Wt){this.singleTap.touchmove(u,F,Wt)}touchend(u,F,Wt){const Xe=this.singleTap.touchend(u,F,Wt);if(Xe){const F=u.timeStamp-this.lastTime<500,Wt=!this.lastTap||this.lastTap.dist(Xe)<30;if(F&&Wt||this.reset(),this.count++,this.lastTime=u.timeStamp,this.lastTap=Xe,this.count===this.numTaps)return this.reset(),Xe}}}class Va{constructor(u){this._tr=new Na(u),this._zoomIn=new qa({numTouches:1,numTaps:2}),this._zoomOut=new qa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(u,F,Wt){this._zoomIn.touchstart(u,F,Wt),this._zoomOut.touchstart(u,F,Wt)}touchmove(u,F,Wt){this._zoomIn.touchmove(u,F,Wt),this._zoomOut.touchmove(u,F,Wt)}touchend(u,F,Wt){const Xe=this._zoomIn.touchend(u,F,Wt),Vi=this._zoomOut.touchend(u,F,Wt),fr=this._tr;return Xe?(this._active=!0,u.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:F=>F.easeTo({duration:300,zoom:fr.zoom+1,around:fr.unproject(Xe)},{originalEvent:u})}):Vi?(this._active=!0,u.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:F=>F.easeTo({duration:300,zoom:fr.zoom-1,around:fr.unproject(Vi)},{originalEvent:u})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ga{constructor(u){this._enabled=!!u.enable,this._moveStateManager=u.moveStateManager,this._clickTolerance=u.clickTolerance||1,this._moveFunction=u.move,this._activateOnStart=!!u.activateOnStart,u.assignEvents(this),this.reset()}reset(u){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(u)}_move(...u){const F=this._moveFunction(...u);if(F.bearingDelta||F.pitchDelta||F.around||F.panDelta)return this._active=!0,F}dragStart(u,F){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(u)&&(this._moveStateManager.startMove(u),this._lastPoint=F.length?F[0]:F,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(u,F){if(!this.isEnabled())return;const Wt=this._lastPoint;if(!Wt)return;if(u.preventDefault(),!this._moveStateManager.isValidMoveEvent(u))return void this.reset(u);const Xe=F.length?F[0]:F;return!this._moved&&Xe.dist(Wt)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=Xe,this._move(Wt,Xe))}dragEnd(u){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(u)&&(this._moved&&r.suppressClick(),this.reset(u))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Wl={0:1,2:2};class Wa{constructor(u){this._correctEvent=u.checkCorrectEvent}startMove(u){const F=r.mouseButton(u);this._eventButton=F}endMove(u){delete this._eventButton}isValidStartEvent(u){return this._correctEvent(u)}isValidMoveEvent(u){return!function(u,F){const Wt=Wl[F];return void 0===u.buttons||(u.buttons&Wt)!==Wt}(u,this._eventButton)}isValidEndEvent(u){return r.mouseButton(u)===this._eventButton}}class $a{constructor(){this._firstTouch=void 0}_isOneFingerTouch(u){return 1===u.targetTouches.length}_isSameTouchEvent(u){return u.targetTouches[0].identifier===this._firstTouch}startMove(u){this._firstTouch=u.targetTouches[0].identifier}endMove(u){delete this._firstTouch}isValidStartEvent(u){return this._isOneFingerTouch(u)}isValidMoveEvent(u){return this._isOneFingerTouch(u)&&this._isSameTouchEvent(u)}isValidEndEvent(u){return this._isOneFingerTouch(u)&&this._isSameTouchEvent(u)}}const Xa=u=>{u.mousedown=u.dragStart,u.mousemoveWindow=u.dragMove,u.mouseup=u.dragEnd,u.contextmenu=u=>{u.preventDefault()}},Ka=({enable:u,clickTolerance:F,bearingDegreesPerPixelMoved:Wt=.8})=>{const Xe=new Wa({checkCorrectEvent:u=>0===r.mouseButton(u)&&u.ctrlKey||2===r.mouseButton(u)});return new Ga({clickTolerance:F,move:(u,F)=>({bearingDelta:(F.x-u.x)*Wt}),moveStateManager:Xe,enable:u,assignEvents:Xa})},Ja=({enable:u,clickTolerance:F,pitchDegreesPerPixelMoved:Wt=-.5})=>{const Xe=new Wa({checkCorrectEvent:u=>0===r.mouseButton(u)&&u.ctrlKey||2===r.mouseButton(u)});return new Ga({clickTolerance:F,move:(u,F)=>({pitchDelta:(F.y-u.y)*Wt}),moveStateManager:Xe,enable:u,assignEvents:Xa})};class Ya{constructor(u,F){this._clickTolerance=u.clickTolerance||1,this._map=F,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new Wt.P(0,0)}_shouldBePrevented(u){return u<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(u,F,Wt){return this._calculateTransform(u,F,Wt)}touchmove(u,F,Wt){if(this._active){if(!this._shouldBePrevented(Wt.length))return u.preventDefault(),this._calculateTransform(u,F,Wt);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",u)}}touchend(u,F,Wt){this._calculateTransform(u,F,Wt),this._active&&this._shouldBePrevented(Wt.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(u,F,Xe){Xe.length>0&&(this._active=!0);const Vi=ja(Xe,F),fr=new Wt.P(0,0),_r=new Wt.P(0,0);let wr=0;for(const u in Vi){const F=Vi[u],Wt=this._touches[u];Wt&&(fr._add(F),_r._add(F.sub(Wt)),wr++,Vi[u]=F)}if(this._touches=Vi,this._shouldBePrevented(wr)||!_r.mag())return;const Ar=_r.div(wr);return this._sum._add(Ar),this._sum.mag()<this._clickTolerance?void 0:{around:fr.div(wr),panDelta:Ar}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(u,F,Wt){this._firstTwoTouches||Wt.length<2||(this._firstTwoTouches=[Wt[0].identifier,Wt[1].identifier],this._start([F[0],F[1]]))}touchmove(u,F,Wt){if(!this._firstTwoTouches)return;u.preventDefault();const[Xe,Vi]=this._firstTwoTouches,fr=ts(Wt,F,Xe),_r=ts(Wt,F,Vi);if(!fr||!_r)return;const wr=this._aroundCenter?null:fr.add(_r).div(2);return this._move([fr,_r],wr,u)}touchend(u,F,Wt){if(!this._firstTwoTouches)return;const[Xe,Vi]=this._firstTwoTouches,fr=ts(Wt,F,Xe),_r=ts(Wt,F,Vi);fr&&_r||(this._active&&r.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(u){this._enabled=!0,this._aroundCenter=!!u&&"center"===u.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ts(u,F,Wt){for(let Xe=0;Xe<u.length;Xe++)if(u[Xe].identifier===Wt)return F[Xe]}function es(u,F){return Math.log(u/F)/Math.LN2}class is extends Qa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(u){this._startDistance=this._distance=u[0].dist(u[1])}_move(u,F){const Wt=this._distance;if(this._distance=u[0].dist(u[1]),this._active||!(Math.abs(es(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:es(this._distance,Wt),pinchAround:F}}}function as(u,F){return 180*u.angleWith(F)/Math.PI}class ss extends Qa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(u){this._startVector=this._vector=u[0].sub(u[1]),this._minDiameter=u[0].dist(u[1])}_move(u,F,Wt){const Xe=this._vector;if(this._vector=u[0].sub(u[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:as(this._vector,Xe),pinchAround:F}}_isBelowThreshold(u){this._minDiameter=Math.min(this._minDiameter,u.mag());const F=25/(Math.PI*this._minDiameter)*360,Wt=as(u,this._startVector);return Math.abs(Wt)<F}}function os(u){return Math.abs(u.y)>Math.abs(u.x)}class rs extends Qa{constructor(u){super(),this._currentTouchCount=0,this._map=u}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(u,F,Wt){super.touchstart(u,F,Wt),this._currentTouchCount=Wt.length}_start(u){this._lastPoints=u,os(u[0].sub(u[1]))&&(this._valid=!1)}_move(u,F,Wt){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const Xe=u[0].sub(this._lastPoints[0]),Vi=u[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(Xe,Vi,Wt.timeStamp),this._valid?(this._lastPoints=u,this._active=!0,{pitchDelta:(Xe.y+Vi.y)/2*-.5}):void 0}gestureBeginsVertically(u,F,Wt){if(void 0!==this._valid)return this._valid;const Xe=u.mag()>=2,Vi=F.mag()>=2;if(!Xe&&!Vi)return;if(!Xe||!Vi)return void 0===this._firstMove&&(this._firstMove=Wt),Wt-this._firstMove<100&&void 0;const fr=u.y>0==F.y>0;return os(u)&&os(F)&&fr}}const Xl={panStep:100,bearingStep:15,pitchStep:10};class ls{constructor(u){this._tr=new Na(u);const F=Xl;this._panStep=F.panStep,this._bearingStep=F.bearingStep,this._pitchStep=F.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(u){if(u.altKey||u.ctrlKey||u.metaKey)return;let F=0,Wt=0,Xe=0,Vi=0,fr=0;switch(u.keyCode){case 61:case 107:case 171:case 187:F=1;break;case 189:case 109:case 173:F=-1;break;case 37:u.shiftKey?Wt=-1:(u.preventDefault(),Vi=-1);break;case 39:u.shiftKey?Wt=1:(u.preventDefault(),Vi=1);break;case 38:u.shiftKey?Xe=1:(u.preventDefault(),fr=-1);break;case 40:u.shiftKey?Xe=-1:(u.preventDefault(),fr=1);break;default:return}return this._rotationDisabled&&(Wt=0,Xe=0),{cameraAnimation:_r=>{const wr=this._tr;_r.easeTo({duration:300,easeId:"keyboardHandler",easing:hs,zoom:F?Math.round(wr.zoom)+F*(u.shiftKey?2:1):wr.zoom,bearing:wr.bearing+Wt*this._bearingStep,pitch:wr.pitch+Xe*this._pitchStep,offset:[-Vi*this._panStep,-fr*this._panStep],center:wr.center},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function hs(u){return u*(2-u)}const Jl=4.000244140625;class us{constructor(u,F){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=u,this._tr=new Na(u),this._triggerRenderFrame=F,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(u){this._defaultZoomRate=u}setWheelZoomRate(u){this._wheelZoomRate=u}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(u){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!u&&"center"===u.around)}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(u){return!!this._map.cooperativeGestures.isEnabled()&&!(u.ctrlKey||this._map.cooperativeGestures.isBypassed(u))}wheel(u){if(!this.isEnabled())return;if(this._shouldBePrevented(u))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",u);let F=u.deltaMode===WheelEvent.DOM_DELTA_LINE?40*u.deltaY:u.deltaY;const Wt=_r.now(),Xe=Wt-(this._lastWheelEventTime||0);this._lastWheelEventTime=Wt,0!==F&&F%Jl==0?this._type="wheel":0!==F&&Math.abs(F)<4?this._type="trackpad":Xe>400?(this._type=null,this._lastValue=F,this._timeout=setTimeout(this._onTimeout,40,u)):this._type||(this._type=Math.abs(Xe*F)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,F+=this._lastValue)),u.shiftKey&&F&&(F/=4),this._type&&(this._lastWheelEvent=u,this._delta-=F,this._active||this._start(u)),u.preventDefault()}_start(u){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const F=r.mousePos(this._map.getCanvas(),u),Xe=this._tr;this._around=F.y>Xe.transform.height/2-Xe.transform.getHorizon()?Wt.N.convert(this._aroundCenter?Xe.center:Xe.unproject(F)):Wt.N.convert(Xe.center),this._aroundPoint=Xe.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const u=this._tr.transform;if(0!==this._delta){const F="wheel"===this._type&&Math.abs(this._delta)>Jl?this._wheelZoomRate:this._defaultZoomRate;let Wt=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&0!==Wt&&(Wt=1/Wt);const Xe="number"==typeof this._targetZoom?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(Xe*Wt))),"wheel"===this._type&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const F="number"==typeof this._targetZoom?this._targetZoom:u.zoom,Xe=this._startZoom,Vi=this._easing;let fr,wr=!1;const Ar=_r.now()-this._lastWheelEventTime;if("wheel"===this._type&&Xe&&Vi&&Ar){const u=Math.min(Ar/200,1),_r=Vi(u);fr=Wt.y.number(Xe,F,_r),u<1?this._frameId||(this._frameId=!0):wr=!0}else fr=F,wr=!0;return this._active=!0,wr&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!wr,zoomDelta:fr-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(u){let F=Wt.b9;if(this._prevEase){const u=this._prevEase,Xe=(_r.now()-u.start)/u.duration,Vi=u.easing(Xe+.01)-u.easing(Xe),fr=.27/Math.sqrt(Vi*Vi+1e-4)*.01,wr=Math.sqrt(.0729-fr*fr);F=Wt.b8(fr,wr,.25,1)}return this._prevEase={start:_r.now(),duration:u,easing:F},F}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ds{constructor(u,F){this._clickZoom=u,this._tapZoom=F}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _s{constructor(u){this._tr=new Na(u),this.reset()}reset(){this._active=!1}dblclick(u,F){return u.preventDefault(),{cameraAnimation:Wt=>{Wt.easeTo({duration:300,zoom:this._tr.zoom+(u.shiftKey?-1:1),around:this._tr.unproject(F)},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ps{constructor(){this._tap=new qa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(u,F,Wt){if(!this._swipePoint)if(this._tapTime){const Xe=F[0],Vi=u.timeStamp-this._tapTime<500,fr=this._tapPoint.dist(Xe)<30;Vi&&fr?Wt.length>0&&(this._swipePoint=Xe,this._swipeTouch=Wt[0].identifier):this.reset()}else this._tap.touchstart(u,F,Wt)}touchmove(u,F,Wt){if(this._tapTime){if(this._swipePoint){if(Wt[0].identifier!==this._swipeTouch)return;const Xe=F[0],Vi=Xe.y-this._swipePoint.y;return this._swipePoint=Xe,u.preventDefault(),this._active=!0,{zoomDelta:Vi/128}}}else this._tap.touchmove(u,F,Wt)}touchend(u,F,Wt){if(this._tapTime)this._swipePoint&&0===Wt.length&&this.reset();else{const Xe=this._tap.touchend(u,F,Wt);Xe&&(this._tapTime=u.timeStamp,this._tapPoint=Xe)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ms{constructor(u,F,Wt){this._el=u,this._mousePan=F,this._touchPan=Wt}enable(u){this._inertiaOptions=u||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fs{constructor(u,F,Wt){this._pitchWithRotate=u.pitchWithRotate,this._mouseRotate=F,this._mousePitch=Wt}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class gs{constructor(u,F,Wt,Xe){this._el=u,this._touchZoom=F,this._touchRotate=Wt,this._tapDragZoom=Xe,this._rotationDisabled=!1,this._enabled=!0}enable(u){this._touchZoom.enable(u),this._rotationDisabled||this._touchRotate.enable(u),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class vs{constructor(u,F){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=u,this._options=F,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const u=this._map.getCanvasContainer();u.classList.add("maplibregl-cooperative-gestures"),this._container=r.create("div","maplibregl-cooperative-gesture-screen",u);let F=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(F=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const Wt=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),Xe=document.createElement("div");Xe.className="maplibregl-desktop-message",Xe.textContent=F,this._container.appendChild(Xe);const Vi=document.createElement("div");Vi.className="maplibregl-mobile-message",Vi.textContent=Wt,this._container.appendChild(Vi),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(r.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(u){return u[this._bypassKey]}notifyGestureBlocked(u,F){this._enabled&&(this._map.fire(new Wt.k("cooperativegestureprevented",{gestureType:u,originalEvent:F})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const xs=u=>u.zoom||u.drag||u.pitch||u.rotate;class ys extends Wt.k{}function bs(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class ws{constructor(u,F){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,F)=>{if("blur"===u.type)return void this.stop(!0);this._updatingCamera=!0;const Wt="renderFrame"===u.type?void 0:u,Xe={needsRenderFrame:!1},Vi={},fr={},_r=u.touches,wr=_r?this._getMapTouches(_r):void 0,Ar=wr?r.touchPos(this._map.getCanvas(),wr):r.mousePos(this._map.getCanvas(),u);for(const{handlerName:_r,handler:Kr,allowed:In}of this._handlers){if(!Kr.isEnabled())continue;let ns;this._blockedByActive(fr,In,_r)?Kr.reset():Kr[F||u.type]&&(ns=Kr[F||u.type](u,Ar,wr),this.mergeHandlerResult(Xe,Vi,ns,_r,Wt),ns&&ns.needsRenderFrame&&this._triggerRenderFrame()),(ns||Kr.isActive())&&(fr[_r]=Kr)}const Kr={};for(const u in this._previousActiveHandlers)fr[u]||(Kr[u]=Wt);this._previousActiveHandlers=fr,(Object.keys(Kr).length||bs(Xe))&&(this._changes.push([Xe,Vi,Kr]),this._triggerRenderFrame()),(Object.keys(fr).length||bs(Xe))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:In}=Xe;In&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],In(this._map))},this._map=u,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ma(u),this._bearingSnap=F.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(F);const Wt=this._el;this._listeners=[[Wt,"touchstart",{passive:!0}],[Wt,"touchmove",{passive:!1}],[Wt,"touchend",void 0],[Wt,"touchcancel",void 0],[Wt,"mousedown",void 0],[Wt,"mousemove",void 0],[Wt,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[Wt,"mouseover",void 0],[Wt,"mouseout",void 0],[Wt,"dblclick",void 0],[Wt,"click",void 0],[Wt,"keydown",{capture:!1}],[Wt,"keyup",void 0],[Wt,"wheel",{passive:!1}],[Wt,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,F,Wt]of this._listeners)r.addEventListener(u,F,u===document?this.handleWindowEvent:this.handleEvent,Wt)}destroy(){for(const[u,F,Wt]of this._listeners)r.removeEventListener(u,F,u===document?this.handleWindowEvent:this.handleEvent,Wt)}_addDefaultHandlers(u){const F=this._map,Wt=F.getCanvasContainer();this._add("mapEvent",new Ba(F,u));const Xe=F.boxZoom=new Ua(F,u);this._add("boxZoom",Xe),u.interactive&&u.boxZoom&&Xe.enable();const Vi=F.cooperativeGestures=new vs(F,u.cooperativeGestures);this._add("cooperativeGestures",Vi),u.cooperativeGestures&&Vi.enable();const fr=new Va(F),_r=new _s(F);F.doubleClickZoom=new ds(_r,fr),this._add("tapZoom",fr),this._add("clickZoom",_r),u.interactive&&u.doubleClickZoom&&F.doubleClickZoom.enable();const wr=new ps;this._add("tapDragZoom",wr);const Ar=F.touchPitch=new rs(F);this._add("touchPitch",Ar),u.interactive&&u.touchPitch&&F.touchPitch.enable(u.touchPitch);const Kr=Ka(u),In=Ja(u);F.dragRotate=new fs(u,Kr,In),this._add("mouseRotate",Kr,["mousePitch"]),this._add("mousePitch",In,["mouseRotate"]),u.interactive&&u.dragRotate&&F.dragRotate.enable();const ns=(({enable:u,clickTolerance:F})=>{const Wt=new Wa({checkCorrectEvent:u=>0===r.mouseButton(u)&&!u.ctrlKey});return new Ga({clickTolerance:F,move:(u,F)=>({around:F,panDelta:F.sub(u)}),activateOnStart:!0,moveStateManager:Wt,enable:u,assignEvents:Xa})})(u),ca=new Ya(u,F);F.dragPan=new ms(Wt,ns,ca),this._add("mousePan",ns),this._add("touchPan",ca,["touchZoom","touchRotate"]),u.interactive&&u.dragPan&&F.dragPan.enable(u.dragPan);const ha=new ss,ua=new is;F.touchZoomRotate=new gs(Wt,ua,ha,wr),this._add("touchRotate",ha,["touchPan","touchZoom"]),this._add("touchZoom",ua,["touchPan","touchRotate"]),u.interactive&&u.touchZoomRotate&&F.touchZoomRotate.enable(u.touchZoomRotate);const Da=F.scrollZoom=new us(F,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Da,["mousePan"]),u.interactive&&u.scrollZoom&&F.scrollZoom.enable(u.scrollZoom);const io=F.keyboard=new ls(F);this._add("keyboard",io),u.interactive&&u.keyboard&&F.keyboard.enable(),this._add("blockableMapEvent",new Oa(F))}_add(u,F,Wt){this._handlers.push({handlerName:u,handler:F,allowed:Wt}),this._handlersById[u]=F}stop(u){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},u),this._changes=[]}}isActive(){for(const{handler:u}of this._handlers)if(u.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(xs(this._eventsInProgress))||this.isZooming()}_blockedByActive(u,F,Wt){for(const Xe in u)if(Xe!==Wt&&(!F||F.indexOf(Xe)<0))return!0;return!1}_getMapTouches(u){const F=[];for(const Wt of u)this._el.contains(Wt.target)&&F.push(Wt);return F}mergeHandlerResult(u,F,Xe,Vi,fr){if(!Xe)return;Wt.e(u,Xe);const _r={handlerName:Vi,originalEvent:Xe.originalEvent||fr};void 0!==Xe.zoomDelta&&(F.zoom=_r),void 0!==Xe.panDelta&&(F.drag=_r),void 0!==Xe.pitchDelta&&(F.pitch=_r),void 0!==Xe.bearingDelta&&(F.rotate=_r)}_applyChanges(){const u={},F={},Xe={};for(const[Vi,fr,_r]of this._changes)Vi.panDelta&&(u.panDelta=(u.panDelta||new Wt.P(0,0))._add(Vi.panDelta)),Vi.zoomDelta&&(u.zoomDelta=(u.zoomDelta||0)+Vi.zoomDelta),Vi.bearingDelta&&(u.bearingDelta=(u.bearingDelta||0)+Vi.bearingDelta),Vi.pitchDelta&&(u.pitchDelta=(u.pitchDelta||0)+Vi.pitchDelta),void 0!==Vi.around&&(u.around=Vi.around),void 0!==Vi.pinchAround&&(u.pinchAround=Vi.pinchAround),Vi.noInertia&&(u.noInertia=Vi.noInertia),Wt.e(F,fr),Wt.e(Xe,_r);this._updateMapTransform(u,F,Xe),this._changes=[]}_updateMapTransform(u,F,Wt){const Xe=this._map,Vi=Xe._getTransformForUpdate(),fr=Xe.terrain;if(!(bs(u)||fr&&this._terrainMovement))return this._fireEvents(F,Wt,!0);let{panDelta:_r,zoomDelta:wr,bearingDelta:Ar,pitchDelta:Kr,around:In,pinchAround:ns}=u;void 0!==ns&&(In=ns),Xe._stop(!0),In=In||Xe.transform.centerPoint;const ca=Vi.pointLocation(_r?In.sub(_r):In);Ar&&(Vi.bearing+=Ar),Kr&&(Vi.pitch+=Kr),wr&&(Vi.zoom+=wr),fr?this._terrainMovement||!F.drag&&!F.zoom?F.drag&&this._terrainMovement?Vi.center=Vi.pointLocation(Vi.centerPoint.sub(_r)):Vi.setLocationAtPoint(ca,In):(this._terrainMovement=!0,this._map._elevationFreeze=!0,Vi.setLocationAtPoint(ca,In)):Vi.setLocationAtPoint(ca,In),Xe._applyUpdatedTransform(Vi),this._map._update(),u.noInertia||this._inertia.record(u),this._fireEvents(F,Wt,!0)}_fireEvents(u,F,Xe){const Vi=xs(this._eventsInProgress),fr=xs(u),wr={};for(const F in u){const{originalEvent:Wt}=u[F];this._eventsInProgress[F]||(wr[`${F}start`]=Wt),this._eventsInProgress[F]=u[F]}!Vi&&fr&&this._fireEvent("movestart",fr.originalEvent);for(const u in wr)this._fireEvent(u,wr[u]);fr&&this._fireEvent("move",fr.originalEvent);for(const F in u){const{originalEvent:Wt}=u[F];this._fireEvent(F,Wt)}const Ar={};let Kr;for(const u in this._eventsInProgress){const{handlerName:Wt,originalEvent:Xe}=this._eventsInProgress[u];this._handlersById[Wt].isActive()||(delete this._eventsInProgress[u],Kr=F[Wt]||Xe,Ar[`${u}end`]=Kr)}for(const u in Ar)this._fireEvent(u,Ar[u]);const In=xs(this._eventsInProgress),ns=(Vi||fr)&&!In;if(ns&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const u=this._map._getTransformForUpdate();u.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(u)}if(Xe&&ns){this._updatingCamera=!0;const u=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=u=>0!==u&&-this._bearingSnap<u&&u<this._bearingSnap;!u||!u.essential&&_r.prefersReducedMotion?(this._map.fire(new Wt.k("moveend",{originalEvent:Kr})),i(this._map.getBearing())&&this._map.resetNorth()):(i(u.bearing||this._map.getBearing())&&(u.bearing=0),u.freezeElevation=!0,this._map.easeTo(u,{originalEvent:Kr})),this._updatingCamera=!1}}_fireEvent(u,F){this._map.fire(new Wt.k(u,F?{originalEvent:F}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((u=>{delete this._frameId,this.handleEvent(new ys("renderFrame",{timeStamp:u})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Ts extends Wt.E{constructor(u,F){super(),this._renderFrameCallback=()=>{const u=Math.min((_r.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=u,this._bearingSnap=F.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new Wt.N(this.transform.center.lng,this.transform.center.lat)}setCenter(u,F){return this.jumpTo({center:u},F)}panBy(u,F,Xe){return u=Wt.P.convert(u).mult(-1),this.panTo(this.transform.center,Wt.e({offset:u},F),Xe)}panTo(u,F,Xe){return this.easeTo(Wt.e({center:u},F),Xe)}getZoom(){return this.transform.zoom}setZoom(u,F){return this.jumpTo({zoom:u},F),this}zoomTo(u,F,Xe){return this.easeTo(Wt.e({zoom:u},F),Xe)}zoomIn(u,F){return this.zoomTo(this.getZoom()+1,u,F),this}zoomOut(u,F){return this.zoomTo(this.getZoom()-1,u,F),this}getBearing(){return this.transform.bearing}setBearing(u,F){return this.jumpTo({bearing:u},F),this}getPadding(){return this.transform.padding}setPadding(u,F){return this.jumpTo({padding:u},F),this}rotateTo(u,F,Xe){return this.easeTo(Wt.e({bearing:u},F),Xe)}resetNorth(u,F){return this.rotateTo(0,Wt.e({duration:1e3},u),F),this}resetNorthPitch(u,F){return this.easeTo(Wt.e({bearing:0,pitch:0,duration:1e3},u),F),this}snapToNorth(u,F){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(u,F):this}getPitch(){return this.transform.pitch}setPitch(u,F){return this.jumpTo({pitch:u},F),this}cameraForBounds(u,F){u=H.convert(u).adjustAntiMeridian();const Wt=F&&F.bearing||0;return this._cameraForBoxAndBearing(u.getNorthWest(),u.getSouthEast(),Wt,F)}_cameraForBoxAndBearing(u,F,Xe,Vi){const fr={top:0,bottom:0,right:0,left:0};if("number"==typeof(Vi=Wt.e({padding:fr,offset:[0,0],maxZoom:this.transform.maxZoom},Vi)).padding){const u=Vi.padding;Vi.padding={top:u,bottom:u,right:u,left:u}}Vi.padding=Wt.e(fr,Vi.padding);const _r=this.transform,wr=_r.padding,Ar=new H(u,F),Kr=_r.project(Ar.getNorthWest()),In=_r.project(Ar.getNorthEast()),ns=_r.project(Ar.getSouthEast()),ca=_r.project(Ar.getSouthWest()),ha=Wt.ba(-Xe),ua=Kr.rotate(ha),Da=In.rotate(ha),io=ns.rotate(ha),no=ca.rotate(ha),so=new Wt.P(Math.max(ua.x,Da.x,no.x,io.x),Math.max(ua.y,Da.y,no.y,io.y)),ao=new Wt.P(Math.min(ua.x,Da.x,no.x,io.x),Math.min(ua.y,Da.y,no.y,io.y)),oo=so.sub(ao),co=(_r.width-(wr.left+wr.right+Vi.padding.left+Vi.padding.right))/oo.x,ho=(_r.height-(wr.top+wr.bottom+Vi.padding.top+Vi.padding.bottom))/oo.y;if(ho<0||co<0)return void Wt.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const go=Math.min(_r.scaleZoom(_r.scale*Math.min(co,ho)),Vi.maxZoom),xo=Wt.P.convert(Vi.offset),Io=new Wt.P((Vi.padding.left-Vi.padding.right)/2,(Vi.padding.top-Vi.padding.bottom)/2).rotate(Wt.ba(Xe)),ko=xo.add(Io).mult(_r.scale/_r.zoomScale(go));return{center:_r.unproject(Kr.add(ns).div(2).sub(ko)),zoom:go,bearing:Xe}}fitBounds(u,F,Wt){return this._fitInternal(this.cameraForBounds(u,F),F,Wt)}fitScreenCoordinates(u,F,Xe,Vi,fr){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(Wt.P.convert(u)),this.transform.pointLocation(Wt.P.convert(F)),Xe,Vi),Vi,fr)}_fitInternal(u,F,Xe){return u?(delete(F=Wt.e(u,F)).padding,F.linear?this.easeTo(F,Xe):this.flyTo(F,Xe)):this}jumpTo(u,F){this.stop();const Xe=this._getTransformForUpdate();let Vi=!1,fr=!1,_r=!1;return"zoom"in u&&Xe.zoom!==+u.zoom&&(Vi=!0,Xe.zoom=+u.zoom),void 0!==u.center&&(Xe.center=Wt.N.convert(u.center)),"bearing"in u&&Xe.bearing!==+u.bearing&&(fr=!0,Xe.bearing=+u.bearing),"pitch"in u&&Xe.pitch!==+u.pitch&&(_r=!0,Xe.pitch=+u.pitch),null==u.padding||Xe.isPaddingEqual(u.padding)||(Xe.padding=u.padding),this._applyUpdatedTransform(Xe),this.fire(new Wt.k("movestart",F)).fire(new Wt.k("move",F)),Vi&&this.fire(new Wt.k("zoomstart",F)).fire(new Wt.k("zoom",F)).fire(new Wt.k("zoomend",F)),fr&&this.fire(new Wt.k("rotatestart",F)).fire(new Wt.k("rotate",F)).fire(new Wt.k("rotateend",F)),_r&&this.fire(new Wt.k("pitchstart",F)).fire(new Wt.k("pitch",F)).fire(new Wt.k("pitchend",F)),this.fire(new Wt.k("moveend",F))}calculateCameraOptionsFromTo(u,F,Xe,Vi=0){const fr=Wt.Z.fromLngLat(u,F),_r=Wt.Z.fromLngLat(Xe,Vi),wr=_r.x-fr.x,Ar=_r.y-fr.y,Kr=_r.z-fr.z,In=Math.hypot(wr,Ar,Kr);if(0===In)throw new Error("Can't calculate camera options with same From and To");const ns=Math.hypot(wr,Ar),ca=this.transform.scaleZoom(this.transform.cameraToCenterDistance/In/this.transform.tileSize),ha=180*Math.atan2(wr,-Ar)/Math.PI;let ua=180*Math.acos(ns/In)/Math.PI;return ua=Kr<0?90-ua:90+ua,{center:_r.toLngLat(),zoom:ca,pitch:ua,bearing:ha}}easeTo(u,F){var Xe;this._stop(!1,u.easeId),(!1===(u=Wt.e({offset:[0,0],duration:500,easing:Wt.b9},u)).animate||!u.essential&&_r.prefersReducedMotion)&&(u.duration=0);const Vi=this._getTransformForUpdate(),fr=Vi.zoom,wr=Vi.bearing,Ar=Vi.pitch,Kr=Vi.padding,In="bearing"in u?this._normalizeBearing(u.bearing,wr):wr,ns="pitch"in u?+u.pitch:Ar,ca="padding"in u?u.padding:Vi.padding,ha=Wt.P.convert(u.offset);let ua=Vi.centerPoint.add(ha);const Da=Vi.pointLocation(ua),{center:io,zoom:no}=Vi.getConstrained(Wt.N.convert(u.center||Da),null!==(Xe=u.zoom)&&void 0!==Xe?Xe:fr);this._normalizeCenter(io,Vi);const so=Vi.project(Da),ao=Vi.project(io).sub(so),oo=Vi.zoomScale(no-fr);let co,ho;u.around&&(co=Wt.N.convert(u.around),ho=Vi.locationPoint(co));const go={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||no!==fr,this._rotating=this._rotating||wr!==In,this._pitching=this._pitching||ns!==Ar,this._padding=!Vi.isPaddingEqual(ca),this._easeId=u.easeId,this._prepareEase(F,u.noMoveStart,go),this.terrain&&this._prepareElevation(io),this._ease((Xe=>{if(this._zooming&&(Vi.zoom=Wt.y.number(fr,no,Xe)),this._rotating&&(Vi.bearing=Wt.y.number(wr,In,Xe)),this._pitching&&(Vi.pitch=Wt.y.number(Ar,ns,Xe)),this._padding&&(Vi.interpolatePadding(Kr,ca,Xe),ua=Vi.centerPoint.add(ha)),this.terrain&&!u.freezeElevation&&this._updateElevation(Xe),co)Vi.setLocationAtPoint(co,ho);else{const u=Vi.zoomScale(Vi.zoom-fr),F=no>fr?Math.min(2,oo):Math.max(.5,oo),Wt=Math.pow(F,1-Xe),_r=Vi.unproject(so.add(ao.mult(Xe*Wt)).mult(u));Vi.setLocationAtPoint(Vi.renderWorldCopies?_r.wrap():_r,ua)}this._applyUpdatedTransform(Vi),this._fireMoveEvents(F)}),(Wt=>{this.terrain&&u.freezeElevation&&this._finalizeElevation(),this._afterEase(F,Wt)}),u),this}_prepareEase(u,F,Xe={}){this._moving=!0,F||Xe.moving||this.fire(new Wt.k("movestart",u)),this._zooming&&!Xe.zooming&&this.fire(new Wt.k("zoomstart",u)),this._rotating&&!Xe.rotating&&this.fire(new Wt.k("rotatestart",u)),this._pitching&&!Xe.pitching&&this.fire(new Wt.k("pitchstart",u))}_prepareElevation(u){this._elevationCenter=u,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(u){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const F=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(u<1&&F!==this._elevationTarget){const Wt=this._elevationTarget-this._elevationStart;this._elevationStart+=u*(Wt-(F-(Wt*u+this._elevationStart))/(1-u)),this._elevationTarget=F}this.transform.elevation=Wt.y.number(this._elevationStart,this._elevationTarget,u)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(u){const F=u.getCameraPosition(),Wt=this.terrain.getElevationForLngLatZoom(F.lngLat,u.zoom);if(F.altitude<Wt){const Xe=this.calculateCameraOptionsFromTo(F.lngLat,Wt,u.center,u.elevation);return{pitch:Xe.pitch,zoom:Xe.zoom}}return{}}_applyUpdatedTransform(u){const F=[];if(this.terrain&&F.push((u=>this._elevateCameraIfInsideTerrain(u))),this.transformCameraUpdate&&F.push((u=>this.transformCameraUpdate(u))),!F.length)return;const Wt=u.clone();for(const u of F){const F=Wt.clone(),{center:Xe,zoom:Vi,pitch:fr,bearing:_r,elevation:wr}=u(F);Xe&&(F.center=Xe),void 0!==Vi&&(F.zoom=Vi),void 0!==fr&&(F.pitch=fr),void 0!==_r&&(F.bearing=_r),void 0!==wr&&(F.elevation=wr),Wt.apply(F)}this.transform.apply(Wt)}_fireMoveEvents(u){this.fire(new Wt.k("move",u)),this._zooming&&this.fire(new Wt.k("zoom",u)),this._rotating&&this.fire(new Wt.k("rotate",u)),this._pitching&&this.fire(new Wt.k("pitch",u))}_afterEase(u,F){if(this._easeId&&F&&this._easeId===F)return;delete this._easeId;const Xe=this._zooming,Vi=this._rotating,fr=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,Xe&&this.fire(new Wt.k("zoomend",u)),Vi&&this.fire(new Wt.k("rotateend",u)),fr&&this.fire(new Wt.k("pitchend",u)),this.fire(new Wt.k("moveend",u))}flyTo(u,F){var Xe;if(!u.essential&&_r.prefersReducedMotion){const Xe=Wt.M(u,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Xe,F)}this.stop(),u=Wt.e({offset:[0,0],speed:1.2,curve:1.42,easing:Wt.b9},u);const Vi=this._getTransformForUpdate(),fr=Vi.zoom,wr=Vi.bearing,Ar=Vi.pitch,Kr=Vi.padding,In="bearing"in u?this._normalizeBearing(u.bearing,wr):wr,ns="pitch"in u?+u.pitch:Ar,ca="padding"in u?u.padding:Vi.padding,ha=Wt.P.convert(u.offset);let ua=Vi.centerPoint.add(ha);const Da=Vi.pointLocation(ua),{center:io,zoom:no}=Vi.getConstrained(Wt.N.convert(u.center||Da),null!==(Xe=u.zoom)&&void 0!==Xe?Xe:fr);this._normalizeCenter(io,Vi);const so=Vi.zoomScale(no-fr),ao=Vi.project(Da),oo=Vi.project(io).sub(ao);let co=u.curve;const ho=Math.max(Vi.width,Vi.height),go=ho/so,xo=oo.mag();if("minZoom"in u){const F=Wt.ac(Math.min(u.minZoom,fr,no),Vi.minZoom,Vi.maxZoom),Xe=ho/Vi.zoomScale(F-fr);co=Math.sqrt(Xe/xo*2)}const Io=co*co;function P(u){const F=(go*go-ho*ho+(u?-1:1)*Io*Io*xo*xo)/(2*(u?go:ho)*Io*xo);return Math.log(Math.sqrt(F*F+1)-F)}function C(u){return(Math.exp(u)-Math.exp(-u))/2}function S(u){return(Math.exp(u)+Math.exp(-u))/2}const ko=P(!1);let D=function(u){return S(ko)/S(ko+co*u)},M=function(u){return ho*((S(ko)*(C(F=ko+co*u)/S(F))-C(ko))/Io)/xo;var F},Co=(P(!0)-ko)/co;if(Math.abs(xo)<1e-6||!isFinite(Co)){if(Math.abs(ho-go)<1e-6)return this.easeTo(u,F);const Wt=go<ho?-1:1;Co=Math.abs(Math.log(go/ho))/co,M=()=>0,D=u=>Math.exp(Wt*co*u)}return u.duration="duration"in u?+u.duration:1e3*Co/("screenSpeed"in u?+u.screenSpeed/co:+u.speed),u.maxDuration&&u.duration>u.maxDuration&&(u.duration=0),this._zooming=!0,this._rotating=wr!==In,this._pitching=ns!==Ar,this._padding=!Vi.isPaddingEqual(ca),this._prepareEase(F,!1),this.terrain&&this._prepareElevation(io),this._ease((Xe=>{const _r=Xe*Co,Da=1/D(_r);Vi.zoom=1===Xe?no:fr+Vi.scaleZoom(Da),this._rotating&&(Vi.bearing=Wt.y.number(wr,In,Xe)),this._pitching&&(Vi.pitch=Wt.y.number(Ar,ns,Xe)),this._padding&&(Vi.interpolatePadding(Kr,ca,Xe),ua=Vi.centerPoint.add(ha)),this.terrain&&!u.freezeElevation&&this._updateElevation(Xe);const so=1===Xe?io:Vi.unproject(ao.add(oo.mult(M(_r))).mult(Da));Vi.setLocationAtPoint(Vi.renderWorldCopies?so.wrap():so,ua),this._applyUpdatedTransform(Vi),this._fireMoveEvents(F)}),(()=>{this.terrain&&u.freezeElevation&&this._finalizeElevation(),this._afterEase(F)}),u),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(u,F){var Wt;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,F)}return u||null===(Wt=this.handlers)||void 0===Wt||Wt.stop(!1),this}_ease(u,F,Wt){!1===Wt.animate||0===Wt.duration?(u(1),F()):(this._easeStart=_r.now(),this._easeOptions=Wt,this._onEaseFrame=u,this._onEaseEnd=F,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(u,F){u=Wt.b3(u,-180,180);const Xe=Math.abs(u-F);return Math.abs(u-360-F)<Xe&&(u-=360),Math.abs(u+360-F)<Xe&&(u+=360),u}_normalizeCenter(u,F){if(!F.renderWorldCopies||F.lngRange)return;const Wt=u.lng-F.center.lng;u.lng+=Wt>180?-360:Wt<-180?360:0}queryTerrainElevation(u){return this.terrain?this.terrain.getElevationForLngLatZoom(Wt.N.convert(u),this.transform.tileZoom)-this.transform.elevation:null}}const Ql={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Es{constructor(u=Ql){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||"metadata"!==u.sourceDataType&&"visibility"!==u.sourceDataType&&"style"!==u.dataType&&"terrain"!==u.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=u}getDefaultPosition(){return"bottom-right"}onAdd(u){return this._map=u,this._compact=this.options.compact,this._container=r.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=r.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=r.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){r.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(u,F){const Wt=this._map._getUIString(`AttributionControl.${F}`);u.title=Wt,u.setAttribute("aria-label",Wt)}_updateAttributions(){if(!this._map.style)return;let u=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?u=u.concat(this.options.customAttribution.map((u=>"string"!=typeof u?"":u))):"string"==typeof this.options.customAttribution&&u.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const F=this._map.style.sourceCaches;for(const Wt in F){const Xe=F[Wt];if(Xe.used||Xe.usedForTerrain){const F=Xe.getSource();F.attribution&&u.indexOf(F.attribution)<0&&u.push(F.attribution)}}u=u.filter((u=>String(u).trim())),u.sort(((u,F)=>u.length-F.length)),u=u.filter(((F,Wt)=>{for(let Xe=Wt+1;Xe<u.length;Xe++)if(u[Xe].indexOf(F)>=0)return!1;return!0}));const Wt=u.join(" | ");Wt!==this._attribHTML&&(this._attribHTML=Wt,u.length?(this._innerContainer.innerHTML=Wt,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ps{constructor(u={}){this._updateCompact=()=>{const u=this._container.children;if(u.length){const F=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&F.classList.add("maplibregl-compact"):F.classList.remove("maplibregl-compact")}},this.options=u}getDefaultPosition(){return"bottom-left"}onAdd(u){this._map=u,this._compact=this.options&&this.options.compact,this._container=r.create("div","maplibregl-ctrl");const F=r.create("a","maplibregl-ctrl-logo");return F.target="_blank",F.rel="noopener nofollow",F.href="https://maplibre.org/",F.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),F.setAttribute("rel","noopener nofollow"),this._container.appendChild(F),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){r.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Cs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(u){const F=++this._id;return this._queue.push({callback:u,id:F,cancelled:!1}),F}remove(u){const F=this._currentlyRunning,Wt=F?this._queue.concat(F):this._queue;for(const F of Wt)if(F.id===u)return void(F.cancelled=!0)}run(u=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const F=this._currentlyRunning=this._queue;this._queue=[];for(const Wt of F)if(!Wt.cancelled&&(Wt.callback(u),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ic=Wt.Y([{name:"a_pos3d",type:"Int16",components:3}]);class zs extends Wt.E{constructor(u){super(),this.sourceCache=u,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,u.usedForTerrain=!0,u.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(u,F){this.sourceCache.update(u,F),this._renderableTilesKeys=[];const Xe={};for(const Vi of u.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:F}))Xe[Vi.key]=!0,this._renderableTilesKeys.push(Vi.key),this._tiles[Vi.key]||(Vi.posMatrix=new Float64Array(16),Wt.aP(Vi.posMatrix,0,Wt.X,0,Wt.X,0,1),this._tiles[Vi.key]=new lt(Vi,this.tileSize));for(const u in this._tiles)Xe[u]||delete this._tiles[u]}freeRtt(u){for(const F in this._tiles){const Wt=this._tiles[F];(!u||Wt.tileID.equals(u)||Wt.tileID.isChildOf(u)||u.isChildOf(Wt.tileID))&&(Wt.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((u=>this.getTileByID(u)))}getTileByID(u){return this._tiles[u]}getTerrainCoords(u){const F={};for(const Xe of this._renderableTilesKeys){const Vi=this._tiles[Xe].tileID;if(Vi.canonical.equals(u.canonical)){const Vi=u.clone();Vi.posMatrix=new Float64Array(16),Wt.aP(Vi.posMatrix,0,Wt.X,0,Wt.X,0,1),F[Xe]=Vi}else if(Vi.canonical.isChildOf(u.canonical)){const fr=u.clone();fr.posMatrix=new Float64Array(16);const _r=Vi.canonical.z-u.canonical.z,wr=Vi.canonical.x-(Vi.canonical.x>>_r<<_r),Ar=Vi.canonical.y-(Vi.canonical.y>>_r<<_r),Kr=Wt.X>>_r;Wt.aP(fr.posMatrix,0,Kr,0,Kr,0,1),Wt.J(fr.posMatrix,fr.posMatrix,[-wr*Kr,-Ar*Kr,0]),F[Xe]=fr}else if(u.canonical.isChildOf(Vi.canonical)){const fr=u.clone();fr.posMatrix=new Float64Array(16);const _r=u.canonical.z-Vi.canonical.z,wr=u.canonical.x-(u.canonical.x>>_r<<_r),Ar=u.canonical.y-(u.canonical.y>>_r<<_r),Kr=Wt.X>>_r;Wt.aP(fr.posMatrix,0,Wt.X,0,Wt.X,0,1),Wt.J(fr.posMatrix,fr.posMatrix,[wr*Kr,Ar*Kr,0]),Wt.K(fr.posMatrix,fr.posMatrix,[1/2**_r,1/2**_r,0]),F[Xe]=fr}}return F}getSourceTile(u,F){const Wt=this.sourceCache._source;let Xe=u.overscaledZ-this.deltaZoom;if(Xe>Wt.maxzoom&&(Xe=Wt.maxzoom),Xe<Wt.minzoom)return null;this._sourceTileCache[u.key]||(this._sourceTileCache[u.key]=u.scaledTo(Xe).key);let Vi=this.sourceCache.getTileByID(this._sourceTileCache[u.key]);if((!Vi||!Vi.dem)&&F)for(;Xe>=Wt.minzoom&&(!Vi||!Vi.dem);)Vi=this.sourceCache.getTileByID(u.scaledTo(Xe--).key);return Vi}tilesAfterTime(u=Date.now()){return Object.values(this._tiles).filter((F=>F.timeAdded>=u))}}class Ds{constructor(u,F,Wt){this.painter=u,this.sourceCache=new zs(F),this.options=Wt,this.exaggeration="number"==typeof Wt.exaggeration?Wt.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(u,F,Xe,Vi=Wt.X){var fr;if(!(F>=0&&F<Vi&&Xe>=0&&Xe<Vi))return 0;const _r=this.getTerrainData(u),wr=null===(fr=_r.tile)||void 0===fr?void 0:fr.dem;if(!wr)return 0;const Ar=function(u,F,Wt){var Xe=F[0],Vi=F[1];return u[0]=Wt[0]*Xe+Wt[4]*Vi+Wt[12],u[1]=Wt[1]*Xe+Wt[5]*Vi+Wt[13],u}([],[F/Vi*Wt.X,Xe/Vi*Wt.X],_r.u_terrain_matrix),Kr=[Ar[0]*wr.dim,Ar[1]*wr.dim],In=Math.floor(Kr[0]),ns=Math.floor(Kr[1]),ca=Kr[0]-In,ha=Kr[1]-ns;return wr.get(In,ns)*(1-ca)*(1-ha)+wr.get(In+1,ns)*ca*(1-ha)+wr.get(In,ns+1)*(1-ca)*ha+wr.get(In+1,ns+1)*ca*ha}getElevationForLngLatZoom(u,F){if(!Wt.bb(F,u.wrap()))return 0;const{tileID:Xe,mercatorX:Vi,mercatorY:fr}=this._getOverscaledTileIDFromLngLatZoom(u,F);return this.getElevation(Xe,Vi%Wt.X,fr%Wt.X,Wt.X)}getElevation(u,F,Xe,Vi=Wt.X){return this.getDEMElevation(u,F,Xe,Vi)*this.exaggeration}getTerrainData(u){if(!this._emptyDemTexture){const u=this.painter.context,F=new Wt.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new b(u,F,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new b(u,new Wt.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=Wt.an([])}const F=this.sourceCache.getSourceTile(u,!0);if(F&&F.dem&&(!F.demTexture||F.needsTerrainPrepare)){const u=this.painter.context;F.demTexture=this.painter.getTileTexture(F.dem.stride),F.demTexture?F.demTexture.update(F.dem.getPixels(),{premultiply:!1}):F.demTexture=new b(u,F.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),F.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),F.needsTerrainPrepare=!1}const Xe=F&&F+F.tileID.key+u.key;if(Xe&&!this._demMatrixCache[Xe]){const Xe=this.sourceCache.sourceCache._source.maxzoom;let Vi=u.canonical.z-F.tileID.canonical.z;u.overscaledZ>u.canonical.z&&(u.canonical.z>=Xe?Vi=u.canonical.z-Xe:Wt.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const fr=u.canonical.x-(u.canonical.x>>Vi<<Vi),_r=u.canonical.y-(u.canonical.y>>Vi<<Vi),wr=Wt.bc(new Float64Array(16),[1/(Wt.X<<Vi),1/(Wt.X<<Vi),0]);Wt.J(wr,wr,[fr*Wt.X,_r*Wt.X,0]),this._demMatrixCache[u.key]={matrix:wr,coord:u}}return{u_depth:2,u_terrain:3,u_terrain_dim:F&&F.dem&&F.dem.dim||1,u_terrain_matrix:Xe?this._demMatrixCache[u.key].matrix:this._emptyDemMatrix,u_terrain_unpack:F&&F.dem&&F.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(F&&F.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:F}}getFramebuffer(u){const F=this.painter,Wt=F.width/devicePixelRatio,Xe=F.height/devicePixelRatio;return!this._fbo||this._fbo.width===Wt&&this._fbo.height===Xe||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new b(F.context,{width:Wt,height:Xe,data:null},F.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(F.context.gl.NEAREST,F.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new b(F.context,{width:Wt,height:Xe,data:null},F.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(F.context.gl.NEAREST,F.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=F.context.createFramebuffer(Wt,Xe,!0,!1),this._fbo.depthAttachment.set(F.context.createRenderbuffer(F.context.gl.DEPTH_COMPONENT16,Wt,Xe))),this._fbo.colorAttachment.set("coords"===u?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const u=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const F=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let u=0,Wt=0;u<this._coordsTextureSize;u++)for(let Xe=0;Xe<this._coordsTextureSize;Xe++,Wt+=4)F[Wt+0]=255&Xe,F[Wt+1]=255&u,F[Wt+2]=Xe>>8<<4|u>>8,F[Wt+3]=0;const Xe=new Wt.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(F.buffer)),Vi=new b(u,Xe,u.gl.RGBA,{premultiply:!1});return Vi.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._coordsTexture=Vi,Vi}pointCoordinate(u){this.painter.maybeDrawDepthAndCoords(!0);const F=new Uint8Array(4),Xe=this.painter.context,Vi=Xe.gl,fr=Math.round(u.x*this.painter.pixelRatio/devicePixelRatio),_r=Math.round(u.y*this.painter.pixelRatio/devicePixelRatio),wr=Math.round(this.painter.height/devicePixelRatio);Xe.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),Vi.readPixels(fr,wr-_r-1,1,1,Vi.RGBA,Vi.UNSIGNED_BYTE,F),Xe.bindFramebuffer.set(null);const Ar=F[0]+(F[2]>>4<<8),Kr=F[1]+((15&F[2])<<8),In=this.coordsIndex[255-F[3]],ns=In&&this.sourceCache.getTileByID(In);if(!ns)return null;const ca=this._coordsTextureSize,ha=(1<<ns.tileID.canonical.z)*ca;return new Wt.Z((ns.tileID.canonical.x*ca+Ar)/ha+ns.tileID.wrap,(ns.tileID.canonical.y*ca+Kr)/ha,this.getElevation(ns.tileID,Ar,Kr,ca))}depthAtPoint(u){const F=new Uint8Array(4),Wt=this.painter.context,Xe=Wt.gl;return Wt.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),Xe.readPixels(u.x,this.painter.height/devicePixelRatio-u.y-1,1,1,Xe.RGBA,Xe.UNSIGNED_BYTE,F),Wt.bindFramebuffer.set(null),(F[0]/16777216+F[1]/65536+F[2]/256+F[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const u=this.painter.context,F=new Wt.bd,Xe=new Wt.aY,Vi=this.meshSize,fr=Wt.X/Vi,_r=Vi*Vi;for(let u=0;u<=Vi;u++)for(let Wt=0;Wt<=Vi;Wt++)F.emplaceBack(Wt*fr,u*fr,0);for(let u=0;u<_r;u+=Vi+1)for(let F=0;F<Vi;F++)Xe.emplaceBack(F+u,Vi+F+u+1,Vi+F+u+2),Xe.emplaceBack(F+u,Vi+F+u+2,F+u+1);const wr=F.length,Ar=wr+2*(Vi+1);for(const u of[0,1])for(let Xe=0;Xe<=Vi;Xe++)for(const Vi of[0,1])F.emplaceBack(Xe*fr,u*Wt.X,Vi);for(let u=0;u<2*Vi;u+=2)Xe.emplaceBack(Ar+u,Ar+u+1,Ar+u+3),Xe.emplaceBack(Ar+u,Ar+u+3,Ar+u+2),Xe.emplaceBack(wr+u,wr+u+3,wr+u+1),Xe.emplaceBack(wr+u,wr+u+2,wr+u+3);const Kr=F.length,In=Kr+2*(Vi+1);for(const u of[0,1])for(let Xe=0;Xe<=Vi;Xe++)for(const Vi of[0,1])F.emplaceBack(u*Wt.X,Xe*fr,Vi);for(let u=0;u<2*Vi;u+=2)Xe.emplaceBack(Kr+u,Kr+u+1,Kr+u+3),Xe.emplaceBack(Kr+u,Kr+u+3,Kr+u+2),Xe.emplaceBack(In+u,In+u+3,In+u+1),Xe.emplaceBack(In+u,In+u+2,In+u+3);return this._mesh=new ga(u.createVertexBuffer(F,ic.members),u.createIndexBuffer(Xe),Wt.a0.simpleSegment(0,0,F.length,Xe.length)),this._mesh}getMeshFrameDelta(u){return 2*Math.PI*Wt.be/Math.pow(2,u)/5}getMinTileElevationForLngLatZoom(u,F){var Wt;const{tileID:Xe}=this._getOverscaledTileIDFromLngLatZoom(u,F);return null!==(Wt=this.getMinMaxElevation(Xe).minElevation)&&void 0!==Wt?Wt:0}getMinMaxElevation(u){const F=this.getTerrainData(u).tile,Wt={minElevation:null,maxElevation:null};return F&&F.dem&&(Wt.minElevation=F.dem.min*this.exaggeration,Wt.maxElevation=F.dem.max*this.exaggeration),Wt}_getOverscaledTileIDFromLngLatZoom(u,F){const Xe=Wt.Z.fromLngLat(u.wrap()),Vi=(1<<F)*Wt.X,fr=Xe.x*Vi,_r=Xe.y*Vi,wr=Math.floor(fr/Wt.X),Ar=Math.floor(_r/Wt.X);return{tileID:new Wt.S(F,0,F,wr,Ar),mercatorX:fr,mercatorY:_r}}}class Ms{constructor(u,F,Wt){this._context=u,this._size=F,this._tileSize=Wt,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const u of this._objects)u.texture.destroy(),u.fbo.destroy()}_createObject(u){const F=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),Wt=new b(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return Wt.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),F.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),F.colorAttachment.set(Wt.texture),{id:u,fbo:F,texture:Wt,stamp:-1,inUse:!1}}getObjectForId(u){return this._objects[u]}useObject(u){u.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((F=>u.id!==F)),this._recentlyUsed.push(u.id)}stampObject(u){u.stamp=++this._stamp}getOrCreateFreeObject(){for(const u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const u=this._createObject(this._objects.length);return this._objects.push(u),u}freeObject(u){u.inUse=!1}freeAllObjects(){for(const u of this._objects)this.freeObject(u)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some((u=>!u.inUse))}}const rc={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Rs{constructor(u,F){this.painter=u,this.terrain=F,this.pool=new Ms(u.context,30,F.sourceCache.tileSize*F.qualityFactor)}destruct(){this.pool.destruct()}getTexture(u){return this.pool.getObjectForId(u.rtt[this._stacks.length-1].id).texture}prepareForRender(u,F){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=u._order.filter((Wt=>!u._layers[Wt].isHidden(F))),this._coordsDescendingInv={};for(const F in u.sourceCaches){this._coordsDescendingInv[F]={};const Wt=u.sourceCaches[F].getVisibleCoordinates();for(const u of Wt){const Wt=this.terrain.sourceCache.getTerrainCoords(u);for(const u in Wt)this._coordsDescendingInv[F][u]||(this._coordsDescendingInv[F][u]=[]),this._coordsDescendingInv[F][u].push(Wt[u])}}this._coordsDescendingInvStr={};for(const F of u._order){const Wt=u._layers[F],Xe=Wt.source;if(rc[Wt.type]&&!this._coordsDescendingInvStr[Xe]){this._coordsDescendingInvStr[Xe]={};for(const u in this._coordsDescendingInv[Xe])this._coordsDescendingInvStr[Xe][u]=this._coordsDescendingInv[Xe][u].map((u=>u.key)).sort().join()}}for(const u of this._renderableTiles)for(const F in this._coordsDescendingInvStr){const Wt=this._coordsDescendingInvStr[F][u.tileID.key];Wt&&Wt!==u.rttCoords[F]&&(u.rtt=[])}}renderLayer(u){if(u.isHidden(this.painter.transform.zoom))return!1;const F=u.type,Xe=this.painter,Vi=this._renderableLayerIds[this._renderableLayerIds.length-1]===u.id;if(rc[F]&&(this._prevType&&rc[this._prevType]||this._stacks.push([]),this._prevType=F,this._stacks[this._stacks.length-1].push(u.id),!Vi))return!0;if(rc[this._prevType]||rc[F]&&Vi){this._prevType=F;const u=this._stacks.length-1,Vi=this._stacks[u]||[];for(const F of this._renderableTiles){if(this.pool.isFull()&&(fa(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(F),F.rtt[u]){const Wt=this.pool.getObjectForId(F.rtt[u].id);if(Wt.stamp===F.rtt[u].stamp){this.pool.useObject(Wt);continue}}const fr=this.pool.getOrCreateFreeObject();this.pool.useObject(fr),this.pool.stampObject(fr),F.rtt[u]={id:fr.id,stamp:fr.stamp},Xe.context.bindFramebuffer.set(fr.fbo.framebuffer),Xe.context.clear({color:Wt.aM.transparent,stencil:0}),Xe.currentStencilSource=void 0;for(let u=0;u<Vi.length;u++){const Wt=Xe.style._layers[Vi[u]],_r=Wt.source?this._coordsDescendingInv[Wt.source][F.tileID.key]:[F.tileID];Xe.context.viewport.set([0,0,fr.fbo.width,fr.fbo.height]),Xe._renderTileClippingMasks(Wt,_r),Xe.renderLayer(Xe,Xe.style.sourceCaches[Wt.source],Wt,_r),Wt.source&&(F.rttCoords[Wt.source]=this._coordsDescendingInvStr[Wt.source][F.tileID.key])}}return fa(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),rc[F]}return!1}}const nc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},oc=Xe,lc={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ql,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:Wt.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Bs=u=>{u.touchstart=u.dragStart,u.touchmoveWindow=u.dragMove,u.touchend=u.dragEnd},mc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ns{constructor(u,F,Xe=!1){this.mousedown=u=>{this.startMouse(Wt.e({},u,{ctrlKey:!0,preventDefault:()=>u.preventDefault()}),r.mousePos(this.element,u)),r.addEventListener(window,"mousemove",this.mousemove),r.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=u=>{this.moveMouse(u,r.mousePos(this.element,u))},this.mouseup=u=>{this.mouseRotate.dragEnd(u),this.mousePitch&&this.mousePitch.dragEnd(u),this.offTemp()},this.touchstart=u=>{1!==u.targetTouches.length?this.reset():(this._startPos=this._lastPos=r.touchPos(this.element,u.targetTouches)[0],this.startTouch(u,this._startPos),r.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),r.addEventListener(window,"touchend",this.touchend))},this.touchmove=u=>{1!==u.targetTouches.length?this.reset():(this._lastPos=r.touchPos(this.element,u.targetTouches)[0],this.moveTouch(u,this._lastPos))},this.touchend=u=>{0===u.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const Vi=u.dragRotate._mouseRotate.getClickTolerance(),fr=u.dragRotate._mousePitch.getClickTolerance();this.element=F,this.mouseRotate=Ka({clickTolerance:Vi,enable:!0}),this.touchRotate=(({enable:u,clickTolerance:F,bearingDegreesPerPixelMoved:Wt=.8})=>{const Xe=new $a;return new Ga({clickTolerance:F,move:(u,F)=>({bearingDelta:(F.x-u.x)*Wt}),moveStateManager:Xe,enable:u,assignEvents:Bs})})({clickTolerance:Vi,enable:!0}),this.map=u,Xe&&(this.mousePitch=Ja({clickTolerance:fr,enable:!0}),this.touchPitch=(({enable:u,clickTolerance:F,pitchDegreesPerPixelMoved:Wt=-.5})=>{const Xe=new $a;return new Ga({clickTolerance:F,move:(u,F)=>({pitchDelta:(F.y-u.y)*Wt}),moveStateManager:Xe,enable:u,assignEvents:Bs})})({clickTolerance:fr,enable:!0})),r.addEventListener(F,"mousedown",this.mousedown),r.addEventListener(F,"touchstart",this.touchstart,{passive:!1}),r.addEventListener(F,"touchcancel",this.reset)}startMouse(u,F){this.mouseRotate.dragStart(u,F),this.mousePitch&&this.mousePitch.dragStart(u,F),r.disableDrag()}startTouch(u,F){this.touchRotate.dragStart(u,F),this.touchPitch&&this.touchPitch.dragStart(u,F),r.disableDrag()}moveMouse(u,F){const Wt=this.map,{bearingDelta:Xe}=this.mouseRotate.dragMove(u,F)||{};if(Xe&&Wt.setBearing(Wt.getBearing()+Xe),this.mousePitch){const{pitchDelta:Xe}=this.mousePitch.dragMove(u,F)||{};Xe&&Wt.setPitch(Wt.getPitch()+Xe)}}moveTouch(u,F){const Wt=this.map,{bearingDelta:Xe}=this.touchRotate.dragMove(u,F)||{};if(Xe&&Wt.setBearing(Wt.getBearing()+Xe),this.touchPitch){const{pitchDelta:Xe}=this.touchPitch.dragMove(u,F)||{};Xe&&Wt.setPitch(Wt.getPitch()+Xe)}}off(){const u=this.element;r.removeEventListener(u,"mousedown",this.mousedown),r.removeEventListener(u,"touchstart",this.touchstart,{passive:!1}),r.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),r.removeEventListener(window,"touchend",this.touchend),r.removeEventListener(u,"touchcancel",this.reset),this.offTemp()}offTemp(){r.enableDrag(),r.removeEventListener(window,"mousemove",this.mousemove),r.removeEventListener(window,"mouseup",this.mouseup),r.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),r.removeEventListener(window,"touchend",this.touchend)}}let gc;function js(u,F,Xe){const Vi=new Wt.N(u.lng,u.lat);if(u=new Wt.N(u.lng,u.lat),F){const Vi=new Wt.N(u.lng-360,u.lat),fr=new Wt.N(u.lng+360,u.lat),_r=Xe.locationPoint(u).distSqr(F);Xe.locationPoint(Vi).distSqr(F)<_r?u=Vi:Xe.locationPoint(fr).distSqr(F)<_r&&(u=fr)}for(;Math.abs(u.lng-Xe.center.lng)>180;){const F=Xe.locationPoint(u);if(F.x>=0&&F.y>=0&&F.x<=Xe.width&&F.y<=Xe.height)break;u.lng>Xe.center.lng?u.lng-=360:u.lng+=360}return u.lng!==Vi.lng&&Xe.locationPoint(u).y>Xe.height/2-Xe.getHorizon()?u:Vi}const yc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function qs(u,F,Wt){const Xe=u.classList;for(const u in yc)Xe.remove(`maplibregl-${Wt}-anchor-${u}`);Xe.add(`maplibregl-${Wt}-anchor-${F}`)}class Vs extends Wt.E{constructor(u){if(super(),this._onKeyPress=u=>{const F=u.code,Wt=u.charCode||u.keyCode;"Space"!==F&&"Enter"!==F&&32!==Wt&&13!==Wt||this.togglePopup()},this._onMapClick=u=>{const F=u.originalEvent.target,Wt=this._element;this._popup&&(F===Wt||Wt.contains(F))&&this.togglePopup()},this._update=u=>{var F;if(!this._map)return;const Wt=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==u?void 0:u.type)||"render"===(null==u?void 0:u.type)&&!Wt)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?js(this._lngLat,this._flatPos,this._map.transform):null===(F=this._lngLat)||void 0===F?void 0:F.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let Xe="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?Xe=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(Xe=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let Vi="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?Vi="rotateX(0deg)":"map"===this._pitchAlignment&&(Vi=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&"moveend"!==u.type||(this._pos=this._pos.round()),r.setTransform(this._element,`${yc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${Vi} ${Xe}`),_r.frameAsync(new AbortController).then((()=>{this._updateOpacity(u&&"moveend"===u.type)})).catch((()=>{}))},this._onMove=u=>{if(!this._isDragging){const F=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=F}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new Wt.k("dragstart"))),this.fire(new Wt.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new Wt.k("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=u&&u.anchor||"center",this._color=u&&u.color||"#3FB1CE",this._scale=u&&u.scale||1,this._draggable=u&&u.draggable||!1,this._clickTolerance=u&&u.clickTolerance||0,this._subpixelPositioning=u&&u.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=u&&u.rotation||0,this._rotationAlignment=u&&u.rotationAlignment||"auto",this._pitchAlignment=u&&u.pitchAlignment&&"auto"!==u.pitchAlignment?u.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(null==u?void 0:u.opacity,null==u?void 0:u.opacityWhenCovered),u&&u.element)this._element=u.element,this._offset=Wt.P.convert(u&&u.offset||[0,0]);else{this._defaultMarker=!0,this._element=r.create("div");const F=r.createNS("http://www.w3.org/2000/svg","svg"),Xe=41,Vi=27;F.setAttributeNS(null,"display","block"),F.setAttributeNS(null,"height",`${Xe}px`),F.setAttributeNS(null,"width",`${Vi}px`),F.setAttributeNS(null,"viewBox",`0 0 ${Vi} ${Xe}`);const fr=r.createNS("http://www.w3.org/2000/svg","g");fr.setAttributeNS(null,"stroke","none"),fr.setAttributeNS(null,"stroke-width","1"),fr.setAttributeNS(null,"fill","none"),fr.setAttributeNS(null,"fill-rule","evenodd");const _r=r.createNS("http://www.w3.org/2000/svg","g");_r.setAttributeNS(null,"fill-rule","nonzero");const wr=r.createNS("http://www.w3.org/2000/svg","g");wr.setAttributeNS(null,"transform","translate(3.0, 29.0)"),wr.setAttributeNS(null,"fill","#000000");const Ar=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const u of Ar){const F=r.createNS("http://www.w3.org/2000/svg","ellipse");F.setAttributeNS(null,"opacity","0.04"),F.setAttributeNS(null,"cx","10.5"),F.setAttributeNS(null,"cy","5.80029008"),F.setAttributeNS(null,"rx",u.rx),F.setAttributeNS(null,"ry",u.ry),wr.appendChild(F)}const Kr=r.createNS("http://www.w3.org/2000/svg","g");Kr.setAttributeNS(null,"fill",this._color);const In=r.createNS("http://www.w3.org/2000/svg","path");In.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Kr.appendChild(In);const ns=r.createNS("http://www.w3.org/2000/svg","g");ns.setAttributeNS(null,"opacity","0.25"),ns.setAttributeNS(null,"fill","#000000");const ca=r.createNS("http://www.w3.org/2000/svg","path");ca.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ns.appendChild(ca);const ha=r.createNS("http://www.w3.org/2000/svg","g");ha.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ha.setAttributeNS(null,"fill","#FFFFFF");const ua=r.createNS("http://www.w3.org/2000/svg","g");ua.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Da=r.createNS("http://www.w3.org/2000/svg","circle");Da.setAttributeNS(null,"fill","#000000"),Da.setAttributeNS(null,"opacity","0.25"),Da.setAttributeNS(null,"cx","5.5"),Da.setAttributeNS(null,"cy","5.5"),Da.setAttributeNS(null,"r","5.4999962");const io=r.createNS("http://www.w3.org/2000/svg","circle");io.setAttributeNS(null,"fill","#FFFFFF"),io.setAttributeNS(null,"cx","5.5"),io.setAttributeNS(null,"cy","5.5"),io.setAttributeNS(null,"r","5.4999962"),ua.appendChild(Da),ua.appendChild(io),_r.appendChild(wr),_r.appendChild(Kr),_r.appendChild(ns),_r.appendChild(ha),_r.appendChild(ua),F.appendChild(_r),F.setAttributeNS(null,"height",Xe*this._scale+"px"),F.setAttributeNS(null,"width",Vi*this._scale+"px"),this._element.appendChild(F),this._offset=Wt.P.convert(u&&u.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(u=>{u.preventDefault()})),this._element.addEventListener("mousedown",(u=>{u.preventDefault()})),qs(this._element,this._anchor,"marker"),u&&u.className)for(const F of u.className.split(" "))this._element.classList.add(F);this._popup=null}addTo(u){return this.remove(),this._map=u,this._element.setAttribute("aria-label",u._getUIString("Marker.Title")),u.getCanvasContainer().appendChild(this._element),u.on("move",this._update),u.on("moveend",this._update),u.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),r.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=Wt.N.convert(u),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(u){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),u){if(!("offset"in u.options)){const F=38.1,Wt=13.5,Xe=Math.abs(Wt)/Math.SQRT2;u.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-F],"bottom-left":[Xe,-1*(F-Wt+Xe)],"bottom-right":[-Xe,-1*(F-Wt+Xe)],left:[Wt,-1*(F-Wt)],right:[-Wt,-1*(F-Wt)]}:this._offset}this._popup=u,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(u){return this._subpixelPositioning=u,this}getPopup(){return this._popup}togglePopup(){const u=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:u?(u.isOpen()?u.remove():(u.setLngLat(this._lngLat),u.addTo(this._map)),this):this}_updateOpacity(u=!1){var F,Xe;if(!(null===(F=this._map)||void 0===F?void 0:F.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(u)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const Vi=this._map,fr=Vi.terrain.depthAtPoint(this._pos),_r=Vi.terrain.getElevationForLngLatZoom(this._lngLat,Vi.transform.tileZoom);if(Vi.transform.lngLatToCameraDepth(this._lngLat,_r)-fr<.006)return void(this._element.style.opacity=this._opacity);const wr=-this._offset.y/Vi.transform._pixelPerMeter,Ar=Math.sin(Vi.getPitch()*Math.PI/180)*wr,Kr=Vi.terrain.depthAtPoint(new Wt.P(this._pos.x,this._pos.y-this._offset.y)),In=Vi.transform.lngLatToCameraDepth(this._lngLat,_r+Ar)-Kr>.006;(null===(Xe=this._popup)||void 0===Xe?void 0:Xe.isOpen())&&In&&this._popup.remove(),this._element.style.opacity=In?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(u){return this._offset=Wt.P.convert(u),this._update(),this}addClassName(u){this._element.classList.add(u)}removeClassName(u){this._element.classList.remove(u)}toggleClassName(u){return this._element.classList.toggle(u)}setDraggable(u){return this._draggable=!!u,this._map&&(u?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(u){return this._rotation=u||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(u){return this._rotationAlignment=u||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(u){return this._pitchAlignment=u&&"auto"!==u?u:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(u,F){return void 0===u&&void 0===F&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==u&&(this._opacity=u),void 0!==F&&(this._opacityWhenCovered=F),this._map&&this._updateOpacity(!0),this}}const bc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let wc=0,Sc=!1;const Ac={maxWidth:100,unit:"metric"};function Xs(u,F,Wt){const Xe=Wt&&Wt.maxWidth||100,Vi=u._container.clientHeight/2,fr=u.unproject([0,Vi]),_r=u.unproject([Xe,Vi]),wr=fr.distanceTo(_r);if(Wt&&"imperial"===Wt.unit){const Wt=3.2808*wr;Wt>5280?Ks(F,Xe,Wt/5280,u._getUIString("ScaleControl.Miles")):Ks(F,Xe,Wt,u._getUIString("ScaleControl.Feet"))}else Wt&&"nautical"===Wt.unit?Ks(F,Xe,wr/1852,u._getUIString("ScaleControl.NauticalMiles")):wr>=1e3?Ks(F,Xe,wr/1e3,u._getUIString("ScaleControl.Kilometers")):Ks(F,Xe,wr,u._getUIString("ScaleControl.Meters"))}function Ks(u,F,Wt,Xe){const Vi=function(u){const F=Math.pow(10,`${Math.floor(u)}`.length-1);let Wt=u/F;return Wt=Wt>=10?10:Wt>=5?5:Wt>=3?3:Wt>=2?2:Wt>=1?1:function(u){const F=Math.pow(10,Math.ceil(-Math.log(u)/Math.LN10));return Math.round(u*F)/F}(Wt),F*Wt}(Wt);u.style.width=F*(Vi/Wt)+"px",u.innerHTML=`${Vi}&nbsp;${Xe}`}const Cc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},zc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Qs(u){if(u){if("number"==typeof u){const F=Math.round(Math.abs(u)/Math.SQRT2);return{center:new Wt.P(0,0),top:new Wt.P(0,u),"top-left":new Wt.P(F,F),"top-right":new Wt.P(-F,F),bottom:new Wt.P(0,-u),"bottom-left":new Wt.P(F,-F),"bottom-right":new Wt.P(-F,-F),left:new Wt.P(u,0),right:new Wt.P(-u,0)}}if(u instanceof Wt.P||Array.isArray(u)){const F=Wt.P.convert(u);return{center:F,top:F,"top-left":F,"top-right":F,bottom:F,"bottom-left":F,"bottom-right":F,left:F,right:F}}return{center:Wt.P.convert(u.center||[0,0]),top:Wt.P.convert(u.top||[0,0]),"top-left":Wt.P.convert(u["top-left"]||[0,0]),"top-right":Wt.P.convert(u["top-right"]||[0,0]),bottom:Wt.P.convert(u.bottom||[0,0]),"bottom-left":Wt.P.convert(u["bottom-left"]||[0,0]),"bottom-right":Wt.P.convert(u["bottom-right"]||[0,0]),left:Wt.P.convert(u.left||[0,0]),right:Wt.P.convert(u.right||[0,0])}}return Qs(new Wt.P(0,0))}const ih=Xe;F.AJAXError=Wt.bh,F.Evented=Wt.E,F.LngLat=Wt.N,F.MercatorCoordinate=Wt.Z,F.Point=Wt.P,F.addProtocol=Wt.bi,F.config=Wt.a,F.removeProtocol=Wt.bj,F.AttributionControl=Es,F.BoxZoomHandler=Ua,F.CanvasSource=et,F.CooperativeGesturesHandler=vs,F.DoubleClickZoomHandler=ds,F.DragPanHandler=ms,F.DragRotateHandler=fs,F.EdgeInsets=ba,F.FullscreenControl=class extends Wt.E{constructor(u={}){super(),this._onFullscreenChange=()=>{var u;let F=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null===(u=null==F?void 0:F.shadowRoot)||void 0===u?void 0:u.fullscreenElement;)F=F.shadowRoot.fullscreenElement;F===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:Wt.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=r.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){r.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const u=this._fullscreenButton=r.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);r.create("span","maplibregl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new Wt.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new Wt.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},F.GeoJSONSource=J,F.GeolocateControl=class extends Wt.E{constructor(u){super(),this._onSuccess=u=>{if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new Wt.k("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(u),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new Wt.k("geolocate",u)),this._finish()}},this._updateCamera=u=>{const F=new Wt.N(u.coords.longitude,u.coords.latitude),Xe=u.coords.accuracy,Vi=this._map.getBearing(),fr=Wt.e({bearing:Vi},this.options.fitBoundsOptions),_r=H.fromLngLat(F,Xe);this._map.fitBounds(_r,fr,{geolocateSource:!0})},this._updateMarker=u=>{if(u){const F=new Wt.N(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(F).addTo(this._map),this._userLocationDotMarker.setLngLat(F).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=u=>{if(this._map){if(this.options.trackUserLocation)if(1===u.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===u.code&&Sc)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new Wt.k("error",u)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(u=>u.preventDefault())),this._geolocateButton=r.create("button","maplibregl-ctrl-geolocate",this._container),r.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=u=>{if(this._map){if(!1===u){Wt.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=r.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Vs({element:this._dotElement}),this._circleElement=r.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Vs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(u=>{u.geolocateSource||"ACTIVE_LOCK"!==this._watchState||u.originalEvent&&"resize"===u.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Wt.k("trackuserlocationend")),this.fire(new Wt.k("userlocationlostfocus")))}))}},this.options=Wt.e({},bc,u)}onAdd(u){return this._map=u,this._container=r.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return Wt._(this,arguments,void 0,(function*(u=!1){if(void 0!==gc&&!u)return gc;if(void 0===window.navigator.permissions)return gc=!!window.navigator.geolocation,gc;try{const u=yield window.navigator.permissions.query({name:"geolocation"});gc="denied"!==u.state}catch(u){gc=!!window.navigator.geolocation}return gc}))}().then((u=>this._finishSetupUI(u))),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),r.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,wc=0,Sc=!1}_isOutOfMapMaxBounds(u){const F=this._map.getMaxBounds(),Wt=u.coords;return F&&(Wt.longitude<F.getWest()||Wt.longitude>F.getEast()||Wt.latitude<F.getSouth()||Wt.latitude>F.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const u=this._map.getBounds(),F=u.getSouthEast(),Wt=u.getNorthEast(),Xe=F.distanceTo(Wt),Vi=Math.ceil(this._accuracy/(Xe/this._map._container.clientHeight)*2);this._circleElement.style.width=`${Vi}px`,this._circleElement.style.height=`${Vi}px`}trigger(){if(!this._setup)return Wt.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Wt.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":wc--,Sc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new Wt.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Wt.k("trackuserlocationstart")),this.fire(new Wt.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let u;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),wc++,wc>1?(u={maximumAge:6e5,timeout:0},Sc=!0):(u=this.options.positionOptions,Sc=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},F.Hash=Ea,F.ImageSource=Q,F.KeyboardHandler=ls,F.LngLatBounds=H,F.LogoControl=Ps,F.Map=class extends Ts{constructor(u){Wt.bf.mark(Wt.bg.create);const F=Object.assign(Object.assign({},lc),u);if(null!=F.minZoom&&null!=F.maxZoom&&F.minZoom>F.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=F.minPitch&&null!=F.maxPitch&&F.minPitch>F.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=F.minPitch&&F.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=F.maxPitch&&F.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ta(F.minZoom,F.maxZoom,F.minPitch,F.maxPitch,F.renderWorldCopies),{bearingSnap:F.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Cs,this._controls=[],this._mapId=Wt.a4(),this._contextLost=u=>{u.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new Wt.k("webglcontextlost",{originalEvent:u}))},this._contextRestored=u=>{this._setupPainter(),this.resize(),this._update(),this.fire(new Wt.k("webglcontextrestored",{originalEvent:u}))},this._onMapScroll=u=>{if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=F.interactive,this._maxTileCacheSize=F.maxTileCacheSize,this._maxTileCacheZoomLevels=F.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=!0===F.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=!0===F.preserveDrawingBuffer,this._antialias=!0===F.antialias,this._trackResize=!0===F.trackResize,this._bearingSnap=F.bearingSnap,this._refreshExpiredTiles=!0===F.refreshExpiredTiles,this._fadeDuration=F.fadeDuration,this._crossSourceCollisions=!0===F.crossSourceCollisions,this._collectResourceTiming=!0===F.collectResourceTiming,this._locale=Object.assign(Object.assign({},nc),F.locale),this._clickTolerance=F.clickTolerance,this._overridePixelRatio=F.pixelRatio,this._maxCanvasSize=F.maxCanvasSize,this.transformCameraUpdate=F.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=!0===F.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=ca.addThrottleControl((()=>this.isMoving())),this._requestManager=new p(F.transformRequest),"string"==typeof F.container){if(this._container=document.getElementById(F.container),!this._container)throw new Error(`Container '${F.container}' not found.`)}else{if(!(F.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=F.container}if(F.maxBounds&&this.setMaxBounds(F.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))).on("moveend",(()=>this._update(!1))).on("zoom",(()=>this._update(!0))).on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})).once("idle",(()=>{this._idleTriggered=!0})),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let u=!1;const F=Ia((u=>{this._trackResize&&!this._removed&&(this.resize(u),this.redraw())}),50);this._resizeObserver=new ResizeObserver((Wt=>{u?F(Wt):u=!0})),this._resizeObserver.observe(this._container)}this.handlers=new ws(this,F),this._hash=F.hash&&new Ea("string"==typeof F.hash&&F.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:F.center,zoom:F.zoom,bearing:F.bearing,pitch:F.pitch}),F.bounds&&(this.resize(),this.fitBounds(F.bounds,Wt.e({},F.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=F.localIdeographFontFamily,this._validateStyle=F.validateStyle,F.style&&this.setStyle(F.style,{localIdeographFontFamily:F.localIdeographFontFamily}),F.attributionControl&&this.addControl(new Es("boolean"==typeof F.attributionControl?void 0:F.attributionControl)),F.maplibreLogo&&this.addControl(new Ps,F.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(u=>{this._update("style"===u.dataType),this.fire(new Wt.k(`${u.dataType}data`,u))})),this.on("dataloading",(u=>{this.fire(new Wt.k(`${u.dataType}dataloading`,u))})),this.on("dataabort",(u=>{this.fire(new Wt.k("sourcedataabort",u))}))}_getMapId(){return this._mapId}addControl(u,F){if(void 0===F&&(F=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new Wt.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const Xe=u.onAdd(this);this._controls.push(u);const Vi=this._controlPositions[F];return-1!==F.indexOf("bottom")?Vi.insertBefore(Xe,Vi.firstChild):Vi.appendChild(Xe),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new Wt.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const F=this._controls.indexOf(u);return F>-1&&this._controls.splice(F,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}calculateCameraOptionsFromTo(u,F,Wt,Xe){return null==Xe&&this.terrain&&(Xe=this.terrain.getElevationForLngLatZoom(Wt,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(u,F,Wt,Xe)}resize(u){var F;const Xe=this._containerDimensions(),Vi=Xe[0],fr=Xe[1],_r=this._getClampedPixelRatio(Vi,fr);if(this._resizeCanvas(Vi,fr,_r),this.painter.resize(Vi,fr,_r),this.painter.overLimit()){const u=this.painter.context.gl;this._maxCanvasSize=[u.drawingBufferWidth,u.drawingBufferHeight];const F=this._getClampedPixelRatio(Vi,fr);this._resizeCanvas(Vi,fr,F),this.painter.resize(Vi,fr,F)}this.transform.resize(Vi,fr),null===(F=this._requestedCameraState)||void 0===F||F.resize(Vi,fr);const wr=!this._moving;return wr&&(this.stop(),this.fire(new Wt.k("movestart",u)).fire(new Wt.k("move",u))),this.fire(new Wt.k("resize",u)),wr&&this.fire(new Wt.k("moveend",u)),this}_getClampedPixelRatio(u,F){const{0:Wt,1:Xe}=this._maxCanvasSize,Vi=this.getPixelRatio(),fr=u*Vi,_r=F*Vi;return Math.min(fr>Wt?Wt/fr:1,_r>Xe?Xe/_r:1)*Vi}getPixelRatio(){var u;return null!==(u=this._overridePixelRatio)&&void 0!==u?u:devicePixelRatio}setPixelRatio(u){this._overridePixelRatio=u,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(u){return this.transform.setMaxBounds(H.convert(u)),this._update()}setMinZoom(u){if((u=null==u?-2:u)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u&&this.setZoom(u),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=null==u?22:u)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u&&this.setZoom(u),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=null==u?0:u)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u&&this.setPitch(u),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=null==u?60:u)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u&&this.setPitch(u),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this._update()}project(u){return this.transform.locationPoint(Wt.N.convert(u),this.style&&this.terrain)}unproject(u){return this.transform.pointLocation(Wt.P.convert(u),this.terrain)}isMoving(){var u;return this._moving||(null===(u=this.handlers)||void 0===u?void 0:u.isMoving())}isZooming(){var u;return this._zooming||(null===(u=this.handlers)||void 0===u?void 0:u.isZooming())}isRotating(){var u;return this._rotating||(null===(u=this.handlers)||void 0===u?void 0:u.isRotating())}_createDelegatedListener(u,F,Wt){if("mouseenter"===u||"mouseover"===u){let Xe=!1;const s=Vi=>{const fr=F.filter((u=>this.getLayer(u))),_r=0!==fr.length?this.queryRenderedFeatures(Vi.point,{layers:fr}):[];_r.length?Xe||(Xe=!0,Wt.call(this,new ka(u,this,Vi.originalEvent,{features:_r}))):Xe=!1};return{layers:F,listener:Wt,delegates:{mousemove:s,mouseout:()=>{Xe=!1}}}}if("mouseleave"===u||"mouseout"===u){let Xe=!1;const s=Vi=>{const fr=F.filter((u=>this.getLayer(u)));(0!==fr.length?this.queryRenderedFeatures(Vi.point,{layers:fr}):[]).length?Xe=!0:Xe&&(Xe=!1,Wt.call(this,new ka(u,this,Vi.originalEvent)))},o=F=>{Xe&&(Xe=!1,Wt.call(this,new ka(u,this,F.originalEvent)))};return{layers:F,listener:Wt,delegates:{mousemove:s,mouseout:o}}}{const a=u=>{const Xe=F.filter((u=>this.getLayer(u))),Vi=0!==Xe.length?this.queryRenderedFeatures(u.point,{layers:Xe}):[];Vi.length&&(u.features=Vi,Wt.call(this,u),delete u.features)};return{layers:F,listener:Wt,delegates:{[u]:a}}}}_saveDelegatedListener(u,F){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(F)}_removeDelegatedListener(u,F,Wt){if(!this._delegatedListeners||!this._delegatedListeners[u])return;const Xe=this._delegatedListeners[u];for(let u=0;u<Xe.length;u++){const Vi=Xe[u];if(Vi.listener===Wt&&Vi.layers.length===F.length&&Vi.layers.every((u=>F.includes(u)))){for(const u in Vi.delegates)this.off(u,Vi.delegates[u]);return void Xe.splice(u,1)}}}on(u,F,Wt){if(void 0===Wt)return super.on(u,F);const Xe=this._createDelegatedListener(u,"string"==typeof F?[F]:F,Wt);this._saveDelegatedListener(u,Xe);for(const u in Xe.delegates)this.on(u,Xe.delegates[u]);return this}once(u,F,Wt){if(void 0===Wt)return super.once(u,F);const Xe="string"==typeof F?[F]:F,Vi=this._createDelegatedListener(u,Xe,Wt);for(const F in Vi.delegates){const fr=Vi.delegates[F];Vi.delegates[F]=(...F)=>{this._removeDelegatedListener(u,Xe,Wt),fr(...F)}}this._saveDelegatedListener(u,Vi);for(const u in Vi.delegates)this.once(u,Vi.delegates[u]);return this}off(u,F,Wt){return void 0===Wt?super.off(u,F):(this._removeDelegatedListener(u,"string"==typeof F?[F]:F,Wt),this)}queryRenderedFeatures(u,F){if(!this.style)return[];let Xe;const Vi=u instanceof Wt.P||Array.isArray(u),fr=Vi?u:[[0,0],[this.transform.width,this.transform.height]];if(F=F||(Vi?{}:u)||{},fr instanceof Wt.P||"number"==typeof fr[0])Xe=[Wt.P.convert(fr)];else{const u=Wt.P.convert(fr[0]),F=Wt.P.convert(fr[1]);Xe=[u,new Wt.P(F.x,u.y),F,new Wt.P(u.x,F.y),u]}return this.style.queryRenderedFeatures(Xe,F,this.transform)}querySourceFeatures(u,F){return this.style.querySourceFeatures(u,F)}setStyle(u,F){return!1!==(F=Wt.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},F)).diff&&F.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&u?(this._diffStyle(u,F),this):(this._localIdeographFontFamily=F.localIdeographFontFamily,this._updateStyle(u,F))}setTransformRequest(u){return this._requestManager.setTransformRequest(u),this}_getUIString(u){const F=this._locale[u];if(null==F)throw new Error(`Missing UI string '${u}'`);return F}_updateStyle(u,F){if(F.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(u,F)));const Wt=this.style&&F.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!u)),u?(this.style=new de(this,F||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof u?this.style.loadURL(u,F,Wt):this.style.loadJSON(u,F,Wt),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new de(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,F){if("string"==typeof u){const Xe=this._requestManager.transformRequest(u,"Style");Wt.h(Xe,new AbortController).then((u=>{this._updateDiff(u.data,F)})).catch((u=>{u&&this.fire(new Wt.j(u))}))}else"object"==typeof u&&this._updateDiff(u,F)}_updateDiff(u,F){try{this.style.setState(u,F)&&this._update(!0)}catch(Xe){Wt.w(`Unable to perform style diff: ${Xe.message||Xe.error||Xe}.  Rebuilding the style from scratch.`),this._updateStyle(u,F)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():Wt.w("There is no style added to the map.")}addSource(u,F){return this._lazyInitEmptyStyle(),this.style.addSource(u,F),this._update(!0)}isSourceLoaded(u){const F=this.style&&this.style.sourceCaches[u];if(void 0!==F)return F.loaded();this.fire(new Wt.j(new Error(`There is no source with ID '${u}'`)))}setTerrain(u){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),u){const F=this.style.sourceCaches[u.source];if(!F)throw new Error(`cannot load terrain, because there exists no source with ID: ${u.source}`);null===this.terrain&&F.reload();for(const F in this.style._layers){const Xe=this.style._layers[F];"hillshade"===Xe.type&&Xe.source===u.source&&Wt.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ds(this.painter,F,u),this.painter.renderToTexture=new Rs(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=F=>{"style"===F.dataType?this.terrain.sourceCache.freeRtt():"source"===F.dataType&&F.tile&&(F.sourceId!==u.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(F.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new Wt.k("terrain",{terrain:u})),this}getTerrain(){var u,F;return null!==(F=null===(u=this.terrain)||void 0===u?void 0:u.options)&&void 0!==F?F:null}areTilesLoaded(){const u=this.style&&this.style.sourceCaches;for(const F in u){const Wt=u[F]._tiles;for(const u in Wt){const F=Wt[u];if("loaded"!==F.state&&"errored"!==F.state)return!1}}return!0}removeSource(u){return this.style.removeSource(u),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,F,Xe={}){const{pixelRatio:Vi=1,sdf:fr=!1,stretchX:wr,stretchY:Ar,content:Kr,textFitWidth:In,textFitHeight:ns}=Xe;if(this._lazyInitEmptyStyle(),!(F instanceof HTMLImageElement||Wt.b(F))){if(void 0===F.width||void 0===F.height)return this.fire(new Wt.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:Xe,height:_r,data:ca}=F,ha=F;return this.style.addImage(u,{data:new Wt.R({width:Xe,height:_r},new Uint8Array(ca)),pixelRatio:Vi,stretchX:wr,stretchY:Ar,content:Kr,textFitWidth:In,textFitHeight:ns,sdf:fr,version:0,userImage:ha}),ha.onAdd&&ha.onAdd(this,u),this}}{const{width:Xe,height:ca,data:ha}=_r.getImageData(F);this.style.addImage(u,{data:new Wt.R({width:Xe,height:ca},ha),pixelRatio:Vi,stretchX:wr,stretchY:Ar,content:Kr,textFitWidth:In,textFitHeight:ns,sdf:fr,version:0})}}updateImage(u,F){const Xe=this.style.getImage(u);if(!Xe)return this.fire(new Wt.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const Vi=F instanceof HTMLImageElement||Wt.b(F)?_r.getImageData(F):F,{width:fr,height:wr,data:Ar}=Vi;if(void 0===fr||void 0===wr)return this.fire(new Wt.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(fr!==Xe.data.width||wr!==Xe.data.height)return this.fire(new Wt.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const Kr=!(F instanceof HTMLImageElement||Wt.b(F));return Xe.data.replace(Ar,Kr),this.style.updateImage(u,Xe),this}getImage(u){return this.style.getImage(u)}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new Wt.j(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u){return ca.getImage(this._requestManager.transformRequest(u,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(u,F){return this._lazyInitEmptyStyle(),this.style.addLayer(u,F),this._update(!0)}moveLayer(u,F){return this.style.moveLayer(u,F),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(u,F,Wt){return this.style.setLayerZoomRange(u,F,Wt),this._update(!0)}setFilter(u,F,Wt={}){return this.style.setFilter(u,F,Wt),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,F,Wt,Xe={}){return this.style.setPaintProperty(u,F,Wt,Xe),this._update(!0)}getPaintProperty(u,F){return this.style.getPaintProperty(u,F)}setLayoutProperty(u,F,Wt,Xe={}){return this.style.setLayoutProperty(u,F,Wt,Xe),this._update(!0)}getLayoutProperty(u,F){return this.style.getLayoutProperty(u,F)}setGlyphs(u,F={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(u,F),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(u,F,Wt={}){return this._lazyInitEmptyStyle(),this.style.addSprite(u,F,Wt,(u=>{u||this._update(!0)})),this}removeSprite(u){return this._lazyInitEmptyStyle(),this.style.removeSprite(u),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(u,F={}){return this._lazyInitEmptyStyle(),this.style.setSprite(u,F,(u=>{u||this._update(!0)})),this}setLight(u,F={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,F),this._update(!0)}getLight(){return this.style.getLight()}setSky(u){return this._lazyInitEmptyStyle(),this.style.setSky(u),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(u,F){return this.style.setFeatureState(u,F),this._update()}removeFeatureState(u,F){return this.style.removeFeatureState(u,F),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let u=0,F=0;return this._container&&(u=this._container.clientWidth||400,F=this._container.clientHeight||300),[u,F]}_setupContainer(){const u=this._container;u.classList.add("maplibregl-map");const F=this._canvasContainer=r.create("div","maplibregl-canvas-container",u);this._interactive&&F.classList.add("maplibregl-interactive"),this._canvas=r.create("canvas","maplibregl-canvas",F),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const Wt=this._containerDimensions(),Xe=this._getClampedPixelRatio(Wt[0],Wt[1]);this._resizeCanvas(Wt[0],Wt[1],Xe);const Vi=this._controlContainer=r.create("div","maplibregl-control-container",u),fr=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((u=>{fr[u]=r.create("div",`maplibregl-ctrl-${u} `,Vi)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,F,Wt){this._canvas.width=Math.floor(Wt*u),this._canvas.height=Math.floor(Wt*F),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${F}px`}_setupPainter(){const u={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let F=null;this._canvas.addEventListener("webglcontextcreationerror",(Wt=>{F={requestedAttributes:u},Wt&&(F.statusMessage=Wt.statusMessage,F.type=Wt.type)}),{once:!0});const Wt=this._canvas.getContext("webgl2",u)||this._canvas.getContext("webgl",u);if(!Wt){const u="Failed to initialize WebGL";throw F?(F.message=u,new Error(JSON.stringify(F))):new Error(u)}this.painter=new va(Wt,this.transform),wr.testSupport(Wt)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_render(u){const F=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._removed)return;let Xe=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,Vi=_r.now();this.style.zoomHistory.update(u,Vi);const fr=new Wt.z(u,{now:Vi,fadeDuration:F,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),wr=fr.crossFadingFactor();1===wr&&wr===this._crossFadingFactor||(Xe=!0,this._crossFadingFactor=wr),this.style.update(fr)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,F,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:F,showPadding:this.showPadding}),this.fire(new Wt.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Wt.bf.mark(Wt.bg.load),this.fire(new Wt.k("load"))),this.style&&(this.style.hasTransitions()||Xe)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const Vi=this._sourcesDirty||this._styleDirty||this._placementDirty;return Vi||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new Wt.k("idle")),!this._loaded||this._fullyLoaded||Vi||(this._fullyLoaded=!0,Wt.bf.mark(Wt.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var u;this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),ca.removeThrottleControl(this._imageQueueHandle),null===(u=this._resizeObserver)||void 0===u||u.disconnect();const F=this.painter.context.gl.getExtension("WEBGL_lose_context");(null==F?void 0:F.loseContext)&&F.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),r.remove(this._canvasContainer),r.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),Wt.bf.clearMetrics(),this._removed=!0,this.fire(new Wt.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,_r.frameAsync(this._frameRequest).then((u=>{Wt.bf.frame(u),this._frameRequest=null,this._render(u)})).catch((()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get version(){return oc}getCameraTargetElevation(){return this.transform.elevation}},F.MapMouseEvent=ka,F.MapTouchEvent=La,F.MapWheelEvent=Fa,F.Marker=Vs,F.NavigationControl=class{constructor(u){this._updateZoomButtons=()=>{const u=this._map.getZoom(),F=u===this._map.getMaxZoom(),Wt=u===this._map.getMinZoom();this._zoomInButton.disabled=F,this._zoomOutButton.disabled=Wt,this._zoomInButton.setAttribute("aria-disabled",F.toString()),this._zoomOutButton.setAttribute("aria-disabled",Wt.toString())},this._rotateCompassArrow=()=>{const u=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=u},this._setButtonTitle=(u,F)=>{const Wt=this._map._getUIString(`NavigationControl.${F}`);u.title=Wt,u.setAttribute("aria-label",Wt)},this.options=Wt.e({},mc,u),this._container=r.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(u=>u.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(u=>this._map.zoomIn({},{originalEvent:u}))),r.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(u=>this._map.zoomOut({},{originalEvent:u}))),r.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(u=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:u}):this._map.resetNorth({},{originalEvent:u})})),this._compassIcon=r.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ns(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){r.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,F){const Wt=r.create("button",u,this._container);return Wt.type="button",Wt.addEventListener("click",F),Wt}},F.Popup=class extends Wt.E{constructor(u){super(),this.remove=()=>(this._content&&r.remove(this._content),this._container&&(r.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new Wt.k("close"))),this),this._onMouseUp=u=>{this._update(u.point)},this._onMouseMove=u=>{this._update(u.point)},this._onDrag=u=>{this._update(u.point)},this._update=u=>{var F;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=r.create("div","maplibregl-popup",this._map.getContainer()),this._tip=r.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const u of this.options.className.split(" "))this._container.classList.add(u);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?js(this._lngLat,this._flatPos,this._map.transform):null===(F=this._lngLat)||void 0===F?void 0:F.wrap(),this._trackPointer&&!u)return;const Wt=this._flatPos=this._pos=this._trackPointer&&u?u:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&u?u:this._map.transform.locationPoint(this._lngLat));let Xe=this.options.anchor;const Vi=Qs(this.options.offset);if(!Xe){const u=this._container.offsetWidth,F=this._container.offsetHeight;let fr;fr=Wt.y+Vi.bottom.y<F?["top"]:Wt.y>this._map.transform.height-F?["bottom"]:[],Wt.x<u/2?fr.push("left"):Wt.x>this._map.transform.width-u/2&&fr.push("right"),Xe=0===fr.length?"bottom":fr.join("-")}let fr=Wt.add(Vi[Xe]);this.options.subpixelPositioning||(fr=fr.round()),r.setTransform(this._container,`${yc[Xe]} translate(${fr.x}px,${fr.y}px)`),qs(this._container,Xe,"popup")},this._onClose=()=>{this.remove()},this.options=Wt.e(Object.create(Cc),u)}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new Wt.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=Wt.N.convert(u),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const F=document.createDocumentFragment(),Wt=document.createElement("body");let Xe;for(Wt.innerHTML=u;Xe=Wt.firstChild,Xe;)F.appendChild(Xe);return this.setDOMContent(F)}getMaxWidth(){var u;return null===(u=this._container)||void 0===u?void 0:u.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=r.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){return this._container&&this._container.classList.add(u),this}removeClassName(u){return this._container&&this._container.classList.remove(u),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){if(this._container)return this._container.classList.toggle(u)}setSubpixelPositioning(u){this.options.subpixelPositioning=u}_createCloseButton(){this.options.closeButton&&(this._closeButton=r.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(zc);u&&u.focus()}},F.RasterDEMTileSource=K,F.RasterTileSource=X,F.ScaleControl=class{constructor(u){this._onMove=()=>{Xs(this._map,this._container,this.options)},this.setUnit=u=>{this.options.unit=u,Xs(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ac),u)}getDefaultPosition(){return"bottom-left"}onAdd(u){return this._map=u,this._container=r.create("div","maplibregl-ctrl maplibregl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){r.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},F.ScrollZoomHandler=us,F.Style=de,F.TerrainControl=class{constructor(u){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=u}onAdd(u){return this._map=u,this._container=r.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=r.create("button","maplibregl-ctrl-terrain",this._container),r.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){r.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},F.TwoFingersTouchPitchHandler=rs,F.TwoFingersTouchRotateHandler=ss,F.TwoFingersTouchZoomHandler=is,F.TwoFingersTouchZoomRotateHandler=gs,F.VectorTileSource=$,F.VideoSource=tt,F.addSourceType=(u,F)=>Wt._(void 0,void 0,void 0,(function*(){if(at(u))throw new Error(`A source type called "${u}" already exists.`);((u,F)=>{ho[u]=F})(u,F)})),F.clearPrewarmedResources=function(){const u=ao;u&&(u.isPreloaded()&&1===u.numActive()?(u.release(no),ao=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},F.getMaxParallelImageRequests=function(){return Wt.a.MAX_PARALLEL_IMAGE_REQUESTS},F.getRTLTextPluginStatus=function(){return nt().getRTLTextPluginStatus()},F.getVersion=function(){return ih},F.getWorkerCount=function(){return L.workerCount},F.getWorkerUrl=function(){return Wt.a.WORKER_URL},F.importScriptInWorkers=function(u){return j().broadcast("IS",u)},F.prewarm=function(){N().acquire(no)},F.setMaxParallelImageRequests=function(u){Wt.a.MAX_PARALLEL_IMAGE_REQUESTS=u},F.setRTLTextPlugin=function(u,F){return nt().setRTLTextPlugin(u,F)},F.setWorkerCount=function(u){L.workerCount=u},F.setWorkerUrl=function(u){Wt.a.WORKER_URL=u}}));var Xe=F;return Xe}));var Wt=F;export{Wt as default};

